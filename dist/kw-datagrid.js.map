{"version":3,"file":"kw-datagrid.js","sources":["../src/common/legacySchema.js","../src/common/misc.js","../src/common/idb.js","../src/common/fetcher.js","../src/common/mapper.js","../src/common/collection.js","../src/datagrid/component.js","../src/datagrid/rowFactory.js","../src/common/image.js","../src/component/formBox.js","../src/datagrid.js","../src/datagrid/state.js","../src/datagrid/rowFilter.js","../src/datagrid/sort.js"],"sourcesContent":["\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: [\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ],\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nfunction convertPackage(json) {\n  let specs = {};\n  if (!json.hasOwnProperty('views')) {\n    const now = new Date();\n    const isNW = json.hasOwnProperty('edges');\n    const data = isNW ? convertNetwork(json) : convertTable(json);\n    const nodes = isNW ? data.nodes : data;\n    specs = {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n      name: data.edges.name,\n      views: [],\n      dataset: []\n    };\n    specs.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: nodes.id,\n      name: nodes.name,\n      contents: [{\n        $schema: nodes.$schema,\n        workflowID: nodes.reference.workflow,\n        name: nodes.name,\n        fields: nodes.fields,\n        records: nodes.records,\n        created: nodes.created,\n        status: nodes.status,\n        query: nodes.query,\n        execTime: nodes.execTime,\n        progress: nodes.progress\n      }]\n    });\n    specs.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: nodes.id,\n      name: nodes.name,\n      viewType: \"datagrid\",\n      rows: nodes.id,\n      fields: nodes.fields,\n      sortOrder: null,\n      filterText: null,\n      checkpoints: [{\n        type: 'convert',\n        date: now.toString(),\n        description: 'converted from legacy format'\n      }]\n    });\n    if (isNW) {\n      specs.dataset.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: data.edges.id,\n        name: data.edges.name,\n        contents: [{\n          $schema: data.edges.$schema,\n          workflowID: data.edges.reference.workflow,\n          name: data.edges.name,\n          fields: data.edges.fields,\n          records: data.edges.records,\n          created: data.edges.created,\n          status: data.edges.status,\n          query: data.edges.query,\n          execTime: data.edges.execTime,\n          progress: data.edges.progress\n        }]\n      });\n      specs.views.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n        viewID: data.edges.id,\n        name: data.edges.name,\n        viewType: \"network\",\n        nodes: nodes.id,\n        edges: data.edges.id,\n        nodeColor: data.edges.snapshot.nodeColor,\n        nodeSize: data.edges.snapshot.nodeSize,\n        nodeLabel: data.edges.snapshot.nodeLabel,\n        nodeLabelColor: data.edges.snapshot.nodeLabelColor,\n        edgeWidth: data.edges.snapshot.edgeWidth,\n        edgeLabel: data.edges.snapshot.edgeLabel,\n        networkThreshold: data.edges.snapshot.networkThreshold,\n        networkThresholdCutoff: data.edges.snapshot.networkThresholdCutoff,\n        fieldTransform: data.edges.snapshot.fieldTransform,\n        coords: data.edges.snapshot.coords,\n        checkpoints: [{\n          type: 'convert',\n          date: now.toString(),\n          description: 'converted from legacy format'\n        }]\n      });\n    }\n    specs.views.filter(e => e.viewType === 'network')\n      .forEach(view => {\n        view.minConnThld = view.networkThresholdCutoff;\n        view.currentConnThld = view.networkThreshold;\n        if (view.hasOwnProperty('nodeLabel')) {\n          view.nodeLabel.field = view.nodeLabel.text;\n        }\n        if (view.hasOwnProperty('edgeLabel')) {\n          view.edgeLabel.field = 'weight';\n        }\n        if (view.hasOwnProperty('edgeWidth')) {\n          view.edgeWidth.field = 'weight';\n        }\n      });\n  }\n  specs.views.filter(e => e.viewType === 'network')\n    .forEach(view => {\n      if (!view.nodeColor.field) { view.nodeColor.field = 'index' ;}\n      if (!view.nodeSize.field) { view.nodeSize.field = 'index' ;}\n      if (!view.nodeLabel.field) { view.nodeLabel.field = 'index' ;}\n      if (!view.nodeLabelColor.field) { view.nodeLabelColor.field = 'index' ;}\n      if (!view.edgeColor) {\n        view.edgeColor = {\n          field: 'weight', color: 'monogray',\n          scale: 'linear', domain: [0, 1],\n          range: ['#999999', '#999999'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeColor.field) { view.edgeColor.field = 'weight' ;}\n      if (!view.edgeWidth.field) { view.edgeWidth.field = 'weight' ;}\n      if (!view.edgeLabel.field) { view.edgeLabel.field = 'weight' ;}\n      if (!view.edgeLabelColor) {\n        view.edgeLabelColor = {\n          field: 'weight', color: 'monoblack',\n          scale: 'linear', domain: [1, 1],\n          range: ['#333333', '#333333'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeLabelColor.field) { view.edgeLabelColor.field = 'weight' ;}\n    });\n  return specs;\n}\n\n\nexport default {\n  convertPackage\n};\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\n\n\n// TODO: re-define\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  if (['text_field', 'checkbox', 'html'].includes(fmt)) return 'html';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  sortType, formatNum, partialMatch, uuidv4\n};\n","\n/** @module common/idb */\n\nimport _ from 'lodash';\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\nimport {default as legacy} from './legacySchema.js';\n\n// TODO: need package, view and dataset tables?\nconst schema = {\n  items: 'storeID, sessionStarted'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('sessionStarted')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Returns a view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @return {array} view objects\n */\nfunction getView(storeID, viewID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).views)\n    .then(views => {\n      const view = views.find(e => e.viewID === viewID);\n      if (!view) return;\n      view.storeID = storeID;\n      return view;\n    });\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object\n */\nfunction appendView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos + 1, 0, viewObj);\n  });\n}\n\n\n/**\n * Update view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object or update function\n */\nfunction updateView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    if (_.isFunction(viewObj)) {\n      viewObj(item.views[pos]);\n    } else {\n      item.views[pos] = viewObj;\n    }\n  });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteView(storeID, viewID) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos, 1);\n    // prune orphaned collections\n    const bin = {};\n    item.dataset.forEach(e => { bin[e.collectionID] = 0; });\n    item.views.forEach(view => {\n      ['rows', 'items', 'nodes', 'edges']\n        .filter(e => view.hasOwnProperty(e))\n        .forEach(e => { bin[view[e]] += 1; });\n    });\n    Object.entries(bin).forEach(entry => {\n      if (!entry[1]) {\n        const i = item.dataset.findIndex(e => e.collectionID === entry[0]);\n        item.dataset.splice(i, 1);\n      }\n    });\n  });\n}\n\n\n/**\n * Returns all collections in the store\n * @return {array} Collection objects\n */\nfunction getAllCollections() {\n  return getAllItems()\n    .then(items => _.flatten(\n      items.map(item => {\n        return item.dataset.map(coll => {\n          coll.storeID = item.storeID;\n          return coll;\n        });\n      })\n    ));\n}\n\n\n/**\n * Returns a collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @return {array} Collection objects\n */\nfunction getCollection(storeID, collID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).dataset)\n    .then(colls => {\n      const coll = colls.find(e => e.collectionID === collID);\n      if (!coll) return;\n      coll.storeID = storeID;\n      return coll;\n    });\n}\n\n\n/**\n * Update collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object or update function\n */\nfunction updateCollection(storeID, collID, collObj) {\n  return updateItem(storeID, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    if (_.isFunction(collObj)) {\n      collObj(item.dataset[pos]);\n    } else {\n      item.dataset[pos] = collObj;\n    }\n  });\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction importItem(data) {\n  // Legacy format converter\n  data = legacy.convertPackage(data);\n\n  const now = new Date();\n  data.storeID = misc.uuidv4().slice(0, 8);\n  data.sessionStarted = now.toString();\n  return idb.items.put(data);\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} response - response data\n * @return {string} - viewID if sucessfully added\n */\nfunction newDatagrid(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const storeID = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    storeID: storeID,\n    name: response.name,\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n        viewID: viewID,\n        name: response.name,\n        viewType: \"datagrid\",\n        rows: collectionID,\n        checkpoints: [\n          {type: 'creation', date: date}\n        ]\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        name: response.name,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return idb.items.put(data)\n    .then(() => ({storeID: storeID, viewID:viewID}));\n}\n\n\n/**\n * Store new network view\n * @param {string} storeID - Store ID\n * @param {string} nodesID - ID of nodes collection\n * @param {string} nodesName - Name of nodes collection\n * @param {object} response - Response object\n */\nfunction newNetwork(storeID, nodesID, nodesName, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const edgesID = response.workflowID.slice(0, 8);\n  return updateItem(storeID, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: viewID,\n      name: `${nodesName}_${response.name}`,\n      viewType: 'network',\n      nodes: nodesID,\n      edges: edgesID,\n      minConnThld: response.query.params.threshold\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: edgesID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\nexport default {\n  reset, getAllItems, getItem, updateItem, deleteItem,\n  getView, appendView, updateView, deleteView,\n  getAllCollections, getCollection, updateCollection,\n  importItem, newDatagrid, newNetwork\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '../req/';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\nfunction serverStatus() {\n  const response = {};\n  return get('server')\n    .then(json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => get('schema'))\n    .then(json)\n    .then(res => {\n      response.schema = res;\n    })\n    .then(() => response);\n}\n\n\nexport default {\n  get, json, text, blob, post, error, serverStatus\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: [keyField].concat(mp.fields),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: table.fields.filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key)),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: fields,\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(mp.fields)\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/collection */\n\nimport _ from 'lodash';\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as mapper} from './mapper.js';\n\n\nexport default class Collection {\n  /**\n   * Create Collection from a flashflood response datatable\n   * If data is not specified, put datatables later by this.append(data)\n   * @param {object} coll - Collection or response object\n   */\n  constructor(coll) {\n    // Settings\n    this.autoIndex = 'index';  // enumerate records\n\n    this.collectionID = coll.collectionID || null;\n    this.storeID = coll.storeID || null;\n    this.name = coll.name || null;\n    if (coll.records) {\n      this.contents = [coll];\n      this.fields = [];\n    } else {\n      this.contents = coll.contents;\n      this.fields = coll.fields || [];\n    }\n    this.contents.forEach(content => {\n      content.fields.forEach(e => this.addField(e));\n    });\n  }\n\n  /**\n   * Add fields\n   * @param {array} fs - list of fields\n   */\n  addField(field) {\n    if (this.fields.find(e => e.key === field.key)) return;\n    if (!field.hasOwnProperty('name')) field.name = field.key;\n    if (!field.hasOwnProperty('visible')) field.visible = true;\n    if (field.hasOwnProperty('d3_format')) field.format = 'd3_format';\n    if (!field.hasOwnProperty('format')) field.format = 'raw';\n    this.fields.push(field);\n  }\n\n  /**\n   * Update fields properties\n   * @param {array} fs - list of fields\n   */\n  updateFields(fs) {\n    this.fields = [];\n    fs.forEach(e => this.addField(e));\n  }\n\n  /**\n   * Join fields\n   * @param {object} mapping - column mapper object\n   */\n  joinFields(mapping) {\n    this.contents.forEach(c => {\n      mapper.apply(c, mapping);\n    });\n    if (mapping.hasOwnProperty('fields')) {\n      mapping.fields.forEach(e => this.addField(e));\n    } else {\n      this.addField(mapping.field);\n    }\n  }\n\n  /**\n   * Apply function to the original data records\n   * new fields should be manually added by Collection.addField\n   * @param {function} func - function to be applied\n   */\n  apply(func) {\n    this.contents.forEach(content => {\n      content.records.forEach(rcd => {\n        func(rcd);\n      });\n    });\n  }\n\n  /**\n   * Return all records of the collection\n   * @return {array} records\n   */\n  records() {\n    return _.flatten(this.contents.map(e => e.records));\n  }\n\n  fetch(command) {\n    const fs = this.contents\n      .filter(e => ['running', 'ready', 'interrupted', 'queued'].includes(e.status))\n      .map(content => {\n        const query = {id: content.workflowID, command: command};\n        return fetcher.get('progress', query)\n          .then(fetcher.json)\n          .then(data => {\n            return idb.updateCollection(this.storeID, this.collectionID, coll => {\n              const i = coll.contents\n                .findIndex(e => e.workflowID === query.id);\n              if (data.status === 'failure') {  // No data found on server\n                coll.contents[i].status = 'failure';\n              } else {\n                coll.contents[i] = data;\n              }\n            });\n          });\n      });\n    return Promise.all(fs)\n      .then(() => idb.getCollection(this.storeID, this.collectionID))\n      .then(coll => {\n        this.contents = coll.contents;\n      });\n  }\n\n  /**\n   * Retrieve workflows and store it into a local store.\n   * @return {Promise}\n   */\n  pull() {\n    return this.fetch('pull');\n  }\n\n  /**\n   * Retrieve workflows, abort all ongoing workflow task\n   * and store it into a local store.\n   * @return {Promise}\n   */\n  abort() {\n    return this.fetch('abort');\n  }\n\n  /**\n   * Return total number of records\n   * @return {float} total number of records\n   */\n  size() {\n    return _.sum(this.contents.map(e => e.records.length));\n  }\n\n  /**\n   * Return status\n   * @return {string} status\n   */\n  status() {\n    if (this.contents.some(e => e.status === 'interrupted')) return 'interrupted';\n    if (this.contents.some(e => e.status === 'running')) return 'running';\n    if (this.contents.some(e => e.status === 'queued')) return 'queued';\n    if (this.contents.some(e => e.status === 'ready')) return 'ready';\n    if (this.contents.some(e => e.status === 'aborted')) return 'aborted';\n    if (this.contents.some(e => e.status === 'failure')) return 'failure';\n    return 'done';\n  }\n\n  /**\n   * Return ongoing or not\n   * @return {bool} ongoing or not\n   */\n  ongoing() {\n    const s = ['ready', 'queued', 'running', 'interrupted'];\n    return s.includes(this.status());\n  }\n\n  /**\n   * Return percentage of workflow progress\n   * @return {float} progress in percent\n   */\n  progress() {\n    return _.min(this.contents.map(e => e.progress));\n  }\n\n  /**\n   * Return total execution time\n   * @return {float} total time\n   */\n  execTime() {\n    return _.sum(this.contents.map(e => e.execTime));\n  }\n\n  /**\n   * Export collection object as JSON\n   * @return {object} collection JSON\n   */\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: this.collectionID,\n      name: this.name,\n      fields: this.fields,\n      contents: this.contents\n    };\n  }\n}\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction headerCellRenderer(header) {\n  header.style('display', 'inline-block')\n    .style('width', d => `${d.width}%`)\n    .text(d => d.name);\n}\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .call(state.headerCellRenderer);\n}\n\n\nfunction updateRows(selection, state) {\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.selectAll('.dg-cell').remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', 'absolute')\n      .style('width', '100%')\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0)\n          .call(state.rowFactory(), d);\n      });\n}\n\n\nfunction updateViewport(selection, state, scrollPos) {\n  selection.select('.dg-body').style('height', `${state.bodyHeight}px`);\n  state.setScrollPosition(scrollPos);\n  selection.call(updateRows, state, scrollPos);\n  selection.select('.dg-viewport').node().scrollTop = scrollPos * state.rowHeight;\n}\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.resizeViewport(window.innerHeight - viewportTop - 5);\n  viewport.style('height', `${state.viewportHeight}px`);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(updateRows, state, pos);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyHeader();\n    selection.call(updateHeader, state);\n    selection.call(resize, state);\n    state.applyData();\n    selection.call(updateViewport, state, state.viewportTop);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    selection.call(updateViewport, state, 0);\n  };\n}\n\n\n\nexport default {\n  headerCellRenderer, updateHeader, updateRows, updateViewport,\n  resize, datagrid\n};\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction date(selection, record, field) {\n  // TODO; formatter\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  // TODO: Check vulnerabilities\n  selection.html(record[field.key]);\n}\n\n\nfunction compound_id(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n}\n\nfunction textField(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'text')\n      .style('width', '90%')\n      .property('value', record[field.key])\n      .on('change', function () {\n        record[field.key] = this.value;\n      });\n}\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  date: date,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compound_id,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  text_field: textField,\n  control: call,\n  svg: html,\n  html: html\n};\n\n\nfunction rowCell(selection) {\n  selection.classed('dg-cell', true)\n    .classed('align-middle', true)\n    .classed('text-truncate', true)\n    .style('display', 'inline-block');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n          .call(rowCell)\n          .style('width', `${field.width}%`);\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compound_id, image, checkbox, textField, call,\n  rowCell, rowFactory\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nfunction binaryToDataURI(binary) {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      resolve(event.target.result);\n    };\n    reader.readAsDataURL(binary);\n  });\n}\n\n\nexport default {\n  plotCell, plotThumbnail, binaryToDataURI\n};\n","\n/** @module component/formBox */\n\n\nimport d3 from 'd3';\n\n\nfunction textBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text');\n}\n\nfunction updateTextBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction textBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction readonlyBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .attr('readonly', 'readonly');\n}\n\n\nfunction textareaBox(selection, label, rows) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows);\n}\n\nfunction updateTextareaBox(selection, value) {\n  selection.select('textarea').property('value', value);\n}\n\nfunction updateTextareaPlaceholder(selection, placeholder) {\n  selection.select('textarea').attr('placeholder', placeholder);\n}\n\nfunction textareaBoxValue(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value;  // TODO: 0 is falsy\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder;\n  return '';\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n').filter(e => e.length > 0);\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder.split('\\n').filter(e => e.length > 0);\n  return [];\n}\n\n\nfunction checkBox(selection, label) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox');\n  box.append('span')\n      .text(label);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, label, min, max, step) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'number')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step);\n}\n\nfunction updateNumberBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction numberIntValid(selection) {\n  const value = numberBoxIntValue(selection);\n  const min = parseInt(selection.select('input').attr('min'));\n  const max = parseInt(selection.select('input').attr('max'));\n  const valid = !isNaN(value) && value >= min && value <= max;\n  selection.select('input')\n      .style('background-color', valid ? '#ffffff' : '#ffcccc');\n  return valid;\n}\n\nfunction numberFloatValid(selection) {\n  const value = numberBoxFloatValue(selection);\n  const min = parseInt(selection.select('input').attr('min'));\n  const max = parseInt(selection.select('input').attr('max'));\n  const valid = !isNaN(value) && value >= min && value <= max;\n  selection.select('input')\n      .style('background-color', valid ? '#ffffff' : '#ffcccc');\n  return valid;\n}\n\nfunction numberBoxIntValue(selection) {\n  return parseInt(selection.select('input').property('value'));\n}\n\nfunction numberBoxFloatValue(selection) {\n  return parseFloat(selection.select('input').property('value'));\n}\n\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n}\n\n\nfunction updateColorBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\n\nfunction colorBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction fileInputBox(selection, label, accept) {\nselection\n    .classed('form-group', true)\n    .classed('form-row', true);\nselection.append('label')\n    .classed('col-form-label', true)\n    .classed('col-form-label-sm', true)\n    .classed('col-4', true)\n    .text(label);\nselection.append('input')\n    .classed('form-control', true)\n    .classed('form-control-sm', true)\n    .classed('form-control-file', true)\n    .classed('col-8', true)\n    .attr('type', 'file')\n    .attr('accept', accept);\n}\n\nfunction clearFileInput(selection) {\n  // TODO: FileList object (input.files) may be a readonly property\n  const accept = selection.select('input').attr();\n  selection.select('input').remove();\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('form-control-file', true)\n      .classed('col-8', true)\n      .attr('type', 'file')\n      .attr('accept', accept);\n}\n\nfunction fileInputBoxValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\n\nexport default {\n  textBox, updateTextBox, textBoxValue, readonlyBox,\n  textareaBox, updateTextareaBox, updateTextareaPlaceholder,\n  textareaBoxValue, textareaBoxLines,\n  checkBox, updateCheckBox, checkBoxValue,\n  numberBox, updateNumberBox, numberIntValid, numberFloatValid,\n  numberBoxIntValue, numberBoxFloatValue,\n  colorBox, updateColorBox, colorBoxValue,\n  fileInputBox, clearFileInput, fileInputBoxValue\n};\n","\n/** @module datagrid */\n\nimport {default as legacy} from './common/legacySchema.js';\n\nimport DatagridState from './datagrid/state.js';\nimport {default as component} from './datagrid/component.js';\nimport {default as rowFilter} from './datagrid/rowFilter.js';\nimport {default as sort} from './datagrid/sort.js';\n\n\nexport default {\n  DatagridState, component, rowFilter, sort, legacy\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport Collection from '../common/collection.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as component} from './component.js';\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(view, coll) {\n    this.storeID = view.storeID || null;\n    this.viewID = view.viewID || null;\n    this.name = view.name || null;\n    this.sortOrder = view.sortOrder || [];\n    this.filterText = view.filterText || null;\n    this.rows = new Collection(coll);\n\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    // TODO: auto adjust\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      html: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.viewportTop = 0;\n    this.previousViewportTop = null;\n    this.viewportBottom = null;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.headerCellRenderer = component.headerCellRenderer;\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n  }\n\n  /**\n   * Set viewport height and number of rows to show\n   * @param {int} height - viewport height\n   */\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n  }\n\n  /**\n   * Set range of the row indices to show\n   * @param {int} position - Index of the top row to show\n   */\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setNumViewportRows() {\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  resizeViewport(height) {\n    this.setViewportSize(height);\n    this.setNumViewportRows();\n  }\n\n  /**\n   * Apply header data\n   */\n  applyHeader() {\n    this.visibleFields = this.rows.fields.filter(e => e.visible);\n    const widthfSum = this.visibleFields.reduce((a, c) => a + (c.widthf || 1), 0);\n    this.visibleFields = this.visibleFields.map(e => {\n      const field = {\n        width: (e.widthf || 1) / widthfSum * 100,\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b, 0).height;\n  }\n\n  /**\n   * Apply row data\n   * 1. applyHeader: define fields and set rowHeight\n   * 2. resize: measure actual window size and calc viewportHeight\n   * 3. applyData: calc number of rows from rowHeight and viewportHeight\n   * 4. setScrollPosition: calc row index range\n   * 5. recordsToShow: slice rows to show\n   */\n  applyData() {\n    this.setNumViewportRows();\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.rows.records().slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.rows.records().slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  updateFields(fs) {\n    this.rows.updateFields(fs);\n  }\n\n  joinFields(mapping) {\n    this.rows.joinFields(mapping);\n    this.applyData();\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  save() {\n    return idb.updateItem(this.storeID, item => {\n      const ci = item.dataset\n        .findIndex(e => e.collectionID === this.rows.collectionID);\n      item.dataset[ci] = this.rows.export();\n      const vi = item.views.findIndex(e => e.viewID === this.viewID);\n      item.views[vi] = this.export();\n    });\n  }\n\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: this.viewID,\n      name: this.name,\n      viewType: \"datagrid\",\n      rows: this.rows.collectionID,\n      sortOrder: this.sortOrder,\n      filterText: this.filterText\n    };\n  }\n}\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, 'Search');\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.textBoxValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction setSort(selection, state) {\n  state.headerCellRenderer = header => {\n    header.style('display', 'inline-block')\n      .style('width', d => `${d.width}%`)\n      .text(d => d.name)\n      .filter(d => misc.sortType(d.format) !== 'none')\n      .append('span').append('a')\n        .attr('id', d => `sort-${d.key}`)\n        .text('^v')\n        .style('display', 'inline-block')\n        .style('width', '30px')\n        .style('text-align', 'center')\n      .on('click', d => {\n        const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n        d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n        state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n        selection.call(component.updateRows, state);\n      });\n  };\n}\n\n\nexport default {\n  setSort\n};\n"],"names":["statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","json","fields","columns","map","e","sort","format","id","name","dataType","schemaVersion","revision","status","records","query","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v10_nodes","reference","convertNetwork","data","edges","hasOwnProperty","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","key","column","domain","range","unknown","size","text","visible","nodeContent","structure","label","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","forEach","i","index","_structure","_index","source","target","v08_graph","nodeContentVisible","d3","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","$schema","convertPackage","specs","now","Date","isNW","v08_nodes","width","height","convertTable","views","dataset","push","collectionID","contents","workflowID","workflow","viewID","viewType","rows","sortOrder","filterText","checkpoints","type","date","toString","description","networkThresholdCutoff","filter","view","minConnThld","currentConnThld","edgeColor","color","edgeLabelColor","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","partialMatch","toUpperCase","indexOf","uuidv4","replace","c","r","Math","random","schema","items","idb","Dexie","getAllItems","orderBy","reverse","toArray","updateItem","storeID","updateFunc","where","equals","modify","catch","err","console","error","version","stores","reset","delete","then","getItem","first","deleteItem","getView","appendView","viewObj","item","pos","findIndex","splice","updateView","_","isFunction","deleteView","bin","Object","entries","entry","getAllCollections","flatten","coll","getCollection","collID","colls","updateCollection","collObj","importItem","legacy","misc","slice","sessionStarted","put","newDatagrid","response","toLocaleString","timeZone","newNetwork","nodesName","edgesID","baseURL","get","url","q","keys","length","JSON","stringify","fetch","credentials","res","Promise","reject","Error","statusText","resolve","blob","post","formdata","method","body","serverStatus","server","singleToMulti","mapping","newMapping","m","mappingToTable","mp","concat","rcd","f","tableToMapping","table","ignore","row","csvToMapping","csvString","lines","split","header","shift","headerIdx","h","line","values","k","Array","apply","fd","uniqBy","Collection","[object Object]","this","autoIndex","content","addField","fs","mapper","func","command","fetcher","all","sum","some","min","updateHeader","selection","state","select","selectAll","remove","visibleFields","enter","append","classed","call","headerCellRenderer","updateRows","recordsToShow","keyFunc","exit","attr","style","merge","rowHeight","each","d","rowIndex","viewportTop","rowPos","rowFactory","updateViewport","scrollPos","bodyHeight","setScrollPosition","node","scrollTop","resize","viewport","getBoundingClientRect","top","resizeViewport","window","innerHeight","viewportHeight","datagrid","on","floor","previousViewportTop","updateContentsNotifier","applyHeader","applyData","updateFilterNotifier","setFilterText","d3Format","record","d3_format","html","compound_id","image","checkbox","property","disabled","checked","textField","cellFunc","numeric","raw","assay_id","list","plot","plotCell","vega","View","parse","initialize","run","plotThumbnail","vegaSpec","toImageURL","binaryToDataURI","binary","reader","FileReader","onload","event","result","readAsDataURL","text_field","control","svg","rowCell","cell","numberBoxIntValue","parseInt","numberBoxFloatValue","textBox","updateTextBox","textBoxValue","readonlyBox","textareaBox","updateTextareaBox","updateTextareaPlaceholder","placeholder","textareaBoxValue","textareaBoxLines","checkBox","box","updateCheckBox","checkBoxValue","numberBox","max","step","updateNumberBox","numberIntValid","valid","numberFloatValid","colorBox","stopPropagation","updateColorBox","colorBoxValue","fileInputBox","accept","clearFileInput","fileInputBoxValue","DatagridState","sortedRecords","filteredRecords","defaultColumnHeight","none","scrollBarSpace","numViewportRows","viewportBottom","fixedViewportHeight","component","factory","position","ceil","setViewportSize","setNumViewportRows","widthfSum","reduce","a","widthf","assign","b","applyOrder","order","orders","applyFilter","ki","obj","updateFields","joinFields","ci","export","vi","rowFilter","setFilter","searchBox","setSort","isAsc","setSortOrder"],"mappings":"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"}