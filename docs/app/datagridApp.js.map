{"version":3,"file":"datagridApp.js","sources":["../../src/common/client.js","../../src/common/fetcher.js","../../src/common/file.js","../../src/common/misc.js","../../src/common/legacySchema.js","../../src/common/idb.js","../../src/component/badge.js","../../src/component/button.js","../../src/component/modal.js","../../src/common/scale.js","../../src/common/mapper.js","../../src/common/collection.js","../../src/datagrid/component.js","../../src/common/image.js","../../src/datagrid/rowFactory.js","../../src/datagrid/state.js","../../src/component/formBox.js","../../src/datagrid/rowFilter.js","../../src/datagrid/sort.js","../../src/datagrid/table.js","../../src/dialog/fieldConfig.js","../../src/dialog/fieldFetch.js","../../src/component/shape.js","../../src/component/formListBox.js","../../src/dialog/fieldFile.js","../../src/component/dropdown.js","../../src/dialog/fieldInput.js","../../src/dialog/formGroup.js","../../src/dialog/networkgen.js","../../src/dialog/rename.js","../../src/datagridApp.js"],"sourcesContent":["\n/** @module common/client */\n\nimport _ from 'lodash';\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\nfunction compatibility() {\n  if (!window.indexedDB) {\n    return 'Client compatibility error: IndexedDB not supported';\n  }\n  try {\n    () => {};\n  } catch (err) {\n    return 'Client compatibility error: Arrow function not supported';\n  }\n  try {\n    FormData;\n  } catch (err) {\n    return 'Client compatibility error: FormData not supported';\n  }\n  try {\n    fetch;\n  } catch (err) {\n    return 'Client compatibility error: fetch API not supported';\n  }\n}\n\n\nfunction registerServiceWorker() {\n  if ('serviceWorker' in navigator) {\n    if (!isDebugBuild) {  // Grobal isDebugBuild (see rollup.js)\n      window.addEventListener('load', () => {\n        navigator.serviceWorker.register('../sw.js');  // TODO: root path option\n      });\n    } else {\n      console.info('Service worker is disabled for debugging');\n    }\n  } else {\n    console.info('Service worker is not supported');\n  }\n}\n\n\nfunction registerCtrlCommand(key, callback) {\n  document.addEventListener('keydown', event => {\n    if (event.ctrlKey && event.key === key) {\n      callback();\n    }\n  });\n}\n\n\nexport default {\n  URLQuery, compatibility, registerServiceWorker, registerCtrlCommand\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '../req/';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\nfunction serverStatus() {\n  const response = {};\n  return get('server')\n    .then(json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => get('schema'))\n    .then(json)\n    .then(res => {\n      response.schema = res;\n    })\n    .then(() => response);\n}\n\n\nfunction batchRequest(reqs, interval) {\n  const ress = reqs.map((req, i) => {\n    return new Promise(resolve => {\n      setTimeout(() => resolve(req()), i * interval * 1000);\n    });\n  });\n  return Promise.all(ress);\n}\n\n\nfunction sequentialBatchRequest(reqs, interval) {\n  const ress = [];\n  const batch = reqs.reduce((a, b) => {\n    return a\n      .then(res => {\n        if (res) ress.push(res);\n        return new Promise(resolve => {\n          setTimeout(() => resolve(b()), interval * 1000);\n        });\n      });\n  }, Promise.resolve());\n  return batch.then(() => ress);\n}\n\n\n\nexport default {\n  get, json, text, blob, post, error, serverStatus, batchRequest\n};\n","\n/** @module common/file */\n\nimport pako from 'pako';\n\n\nfunction readFile(file, sizeLimit, blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    const truncated = sizeLimit ? file.slice(0, sizeLimit) : file;\n    reader.onload = event => resolve(event.target.result);\n    reader.onerror = error => reject(error);\n    if (blob) {\n      reader.readAsArrayBuffer(truncated);\n    } else {\n      reader.readAsText(truncated);\n    }\n  });\n}\n\n\nfunction parseJSON(data, compressed) {\n  const text = compressed ? pako.inflate(data, {to: 'string'}) : data;\n  return JSON.parse(text);\n}\n\n\nfunction loadJSON(file) {\n  const compressed = file.name.endsWith('c') || file.name.endsWith('.gz');\n  return readFile(file, false, compressed)\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction fetchJSON(url) {\n  const decoded = decodeURIComponent(url);\n  const compressed = decoded.endsWith('c') || decoded.endsWith('.gz');\n  return fetch(decoded)\n    .then(res => compressed ? res.arrayBuffer() : res.json())\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction downloadDataFile(data, name) {\n  try {\n    // cannot hundle large file with dataURI scheme\n    // url = 'data:application/json,' + encodeURIComponent(JSON.stringify(json))\n    const url = window.URL.createObjectURL(new Blob([data]));\n    const a = document.createElement('a');\n    a.download = name;\n    a.href = url;\n    // a.click() does not work on firefox\n    a.dispatchEvent(new MouseEvent('click', {\n      'view': window,\n      'bubbles': true,\n      'cancelable': false\n    }));\n    // window.URL.revokeObjectURL(url) does not work on firefox\n  } catch (e) {\n    // no DOM (unit testing)\n  }\n}\n\n\nfunction downloadJSON(json, name, compress=true) {\n  const str = JSON.stringify(json);\n  const data = compress ? pako.gzip(str) : str;\n  const ext = `.ap${compress ? 'c' : 'r'}`;\n  downloadDataFile(data, `${name}${ext}`);\n}\n\n\nexport default {\n  readFile, parseJSON, loadJSON, fetchJSON,\n  downloadDataFile, downloadJSON\n};\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\n\n\n// TODO: re-define\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  if (['text_field', 'checkbox', 'html'].includes(fmt)) return 'html';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  sortType, formatNum, partialMatch, uuidv4\n};\n","\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: [\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ],\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nfunction convertPackage(json) {\n  let specs = {};\n  if (!json.hasOwnProperty('views')) {\n    const now = new Date();\n    const isNW = json.hasOwnProperty('edges');\n    const data = isNW ? convertNetwork(json) : convertTable(json);\n    const nodes = isNW ? data.nodes : data;\n    specs = {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n      name: data.edges.name,\n      views: [],\n      dataset: []\n    };\n    specs.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: nodes.id,\n      name: nodes.name,\n      contents: [{\n        $schema: nodes.$schema,\n        workflowID: nodes.reference.workflow,\n        name: nodes.name,\n        fields: nodes.fields,\n        records: nodes.records,\n        created: nodes.created,\n        status: nodes.status,\n        query: nodes.query,\n        execTime: nodes.execTime,\n        progress: nodes.progress\n      }]\n    });\n    specs.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: nodes.id,\n      name: nodes.name,\n      viewType: \"datagrid\",\n      rows: nodes.id,\n      fields: nodes.fields,\n      sortOrder: null,\n      filterText: null,\n      checkpoints: [{\n        type: 'convert',\n        date: now.toString(),\n        description: 'converted from legacy format'\n      }]\n    });\n    if (isNW) {\n      specs.dataset.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: data.edges.id,\n        name: data.edges.name,\n        contents: [{\n          $schema: data.edges.$schema,\n          workflowID: data.edges.reference.workflow,\n          name: data.edges.name,\n          fields: data.edges.fields,\n          records: data.edges.records,\n          created: data.edges.created,\n          status: data.edges.status,\n          query: data.edges.query,\n          execTime: data.edges.execTime,\n          progress: data.edges.progress\n        }]\n      });\n      specs.views.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n        viewID: data.edges.id,\n        name: data.edges.name,\n        viewType: \"network\",\n        nodes: nodes.id,\n        edges: data.edges.id,\n        nodeColor: data.edges.snapshot.nodeColor,\n        nodeSize: data.edges.snapshot.nodeSize,\n        nodeLabel: data.edges.snapshot.nodeLabel,\n        nodeLabelColor: data.edges.snapshot.nodeLabelColor,\n        edgeWidth: data.edges.snapshot.edgeWidth,\n        edgeLabel: data.edges.snapshot.edgeLabel,\n        networkThreshold: data.edges.snapshot.networkThreshold,\n        networkThresholdCutoff: data.edges.snapshot.networkThresholdCutoff,\n        fieldTransform: data.edges.snapshot.fieldTransform,\n        coords: data.edges.snapshot.coords,\n        checkpoints: [{\n          type: 'convert',\n          date: now.toString(),\n          description: 'converted from legacy format'\n        }]\n      });\n    }\n    specs.views.filter(e => e.viewType === 'network')\n      .forEach(view => {\n        view.minConnThld = view.networkThresholdCutoff;\n        view.currentConnThld = view.networkThreshold;\n        if (view.hasOwnProperty('nodeLabel')) {\n          view.nodeLabel.field = view.nodeLabel.text;\n        }\n        if (view.hasOwnProperty('edgeLabel')) {\n          view.edgeLabel.field = 'weight';\n        }\n        if (view.hasOwnProperty('edgeWidth')) {\n          view.edgeWidth.field = 'weight';\n        }\n      });\n  } else {\n    specs = json;\n  }\n  specs.views.filter(e => e.viewType === 'network')\n    .forEach(view => {\n      if (!view.nodeColor.field) { view.nodeColor.field = 'index' ;}\n      if (!view.nodeSize.field) { view.nodeSize.field = 'index' ;}\n      if (!view.nodeLabel.field) { view.nodeLabel.field = 'index' ;}\n      if (!view.nodeLabelColor.field) { view.nodeLabelColor.field = 'index' ;}\n      if (!view.edgeColor) {\n        view.edgeColor = {\n          field: 'weight', color: 'monogray',\n          scale: 'linear', domain: [0, 1],\n          range: ['#999999', '#999999'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeColor.field) { view.edgeColor.field = 'weight' ;}\n      if (!view.edgeWidth.field) { view.edgeWidth.field = 'weight' ;}\n      if (!view.edgeLabel.field) { view.edgeLabel.field = 'weight' ;}\n      if (!view.edgeLabelColor) {\n        view.edgeLabelColor = {\n          field: 'weight', color: 'monoblack',\n          scale: 'linear', domain: [1, 1],\n          range: ['#333333', '#333333'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeLabelColor.field) { view.edgeLabelColor.field = 'weight' ;}\n    });\n  return specs;\n}\n\n\nexport default {\n  convertPackage\n};\n","\n/** @module common/idb */\n\nimport _ from 'lodash';\n\nimport {default as misc} from './misc.js';\nimport {default as legacy} from './legacySchema.js';\n\n\n// Increment versions if IDB schema has updated.\nconst pkgStoreVersion = 2;\nconst assetStoreVersion = 1;\n\n\nfunction connect(name, version, createObj) {\n  return new Promise((resolve, reject) => {\n    const request = window.indexedDB.open(name, version);\n    request.onsuccess = function () {\n      resolve(this.result);\n    };\n    request.onerror = event => reject(event);\n    request.onupgradeneeded = event => {\n      createObj(event.currentTarget.result);\n    };\n  });\n}\n\n\nconst instance = {\n  pkgs: connect(\"Packages\", pkgStoreVersion, db => {\n    db.createObjectStore(\"Packages\", {keyPath: 'id'});\n  }),\n  assets: connect(\"Assets\", assetStoreVersion, db => {\n    db.createObjectStore(\"Assets\", {keyPath: 'key'});\n  })\n};\n\n\n/**\n * Clear database\n * @param {string} dbid - database ID\n */\nfunction clear(dbid) {\n  return new Promise((resolve, reject) => {\n    return instance[dbid].then(db => {\n      const req = db.transaction(db.name, 'readwrite')\n          .objectStore(db.name).clear();\n        req.onsuccess = () => resolve();\n        req.onerror = event => reject(event);\n    });\n  });\n}\n\n\n/**\n * Delete all data in the local storage\n */\nfunction clearAll() {\n  return Promise.all([clear('pkgs'), clear('assets')]);\n}\n\n\n/**\n * Returns all packages\n * @return {Promise} Promise of list of packages\n */\nfunction getAllItems() {\n  return new Promise(resolve => {\n    const res = [];\n    return instance.pkgs.then(db => {\n      db.transaction(db.name)\n        .objectStore(db.name).openCursor()\n        .onsuccess = event => {\n          const cursor = event.target.result;\n          if (cursor) {\n            res.push(cursor.value);\n            cursor.continue();\n          } else {\n            resolve(res);\n          }\n        };\n    });\n  });\n}\n\n\n/**\n * Get packages by instance ID\n * @param {string} id - Package instance ID\n * @return {array} data store object\n */\nfunction getItem(id) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const req = db.transaction(db.name)\n        .objectStore(db.name).get(id);\n      req.onsuccess = event => resolve(event.target.result);\n      req.onerror = event => reject(event);\n    });\n  });\n}\n\n\n/**\n * Put data object in the store\n * @param {string} value - value to store\n */\nfunction putItem(value) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const obj = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name);\n      const req = obj.put(value);\n      req.onerror = event => reject(event);\n      req.onsuccess = () => resolve();\n    });\n  });\n}\n\n\n/**\n * Update package in the store\n * @param {string} id - Package instance ID\n * @param {function} updater - update function\n */\nfunction updateItem(id, updater) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const obj = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name);\n      const req = obj.get(id);\n      req.onerror = event => reject(event);\n      req.onsuccess = event => {\n        const res = event.target.result;\n        updater(res);\n        const upd = obj.put(res);\n        upd.onsuccess = () => resolve();\n        upd.onerror = event => reject(event);\n      };\n    });\n  });\n}\n\n\n/**\n * Delete a package\n * @param {string} id - Package instance ID\n */\nfunction deleteItem(id) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const req = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name).delete(id);\n      req.onerror = event => reject(event);\n      req.onsuccess = () => resolve();\n    });\n  });\n}\n\n\n/**\n * Returns a view\n * @param {string} id - Package instance ID\n * @param {string} viewID - view ID\n * @return {array} view objects\n */\nfunction getView(id, viewID) {\n  return getItem(id)\n    .then(pkg => pkg.views.find(e => e.viewID === viewID));\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} id - Package instance ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object\n */\nfunction appendView(id, viewID, viewObj) {\n  return updateItem(id, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos + 1, 0, viewObj);\n  });\n}\n\n\n/**\n * Update view\n * @param {string} id - Package instance ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object or update function\n */\nfunction updateView(id, viewID, viewObj) {\n  return updateItem(id, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    if (_.isFunction(viewObj)) {\n      viewObj(item.views[pos]);\n    } else {\n      item.views[pos] = viewObj;\n    }\n  });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} id - Package instance ID\n * @return {integer} - number of deleted items\n */\nfunction deleteView(id, viewID) {\n  return updateItem(id, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos, 1);\n    // prune orphaned collections\n    const bin = {};\n    item.dataset.forEach(e => { bin[e.collectionID] = 0; });\n    item.views.forEach(view => {\n      ['rows', 'items', 'nodes', 'edges']\n        .filter(e => view.hasOwnProperty(e))\n        .forEach(e => { bin[view[e]] += 1; });\n    });\n    Object.entries(bin).forEach(entry => {\n      if (!entry[1]) {\n        const i = item.dataset.findIndex(e => e.collectionID === entry[0]);\n        item.dataset.splice(i, 1);\n      }\n    });\n  });\n}\n\n\n/**\n * Returns all collections in the store\n * @return {array} Collection objects\n */\nfunction getAllCollections() {\n  return getAllItems()\n    .then(items => _.flatten(\n      items.map(item => {\n        return item.dataset.map(coll => {\n          coll.instance = item.id;\n          return coll;\n        });\n      })\n    ));\n}\n\n\n/**\n * Returns a collection\n * @param {string} id - Package instance ID\n * @param {string} collID - Collection ID\n * @return {array} Collection objects\n */\nfunction getCollection(id, collID) {\n  return getItem(id)\n    .then(pkg => pkg.dataset.find(e => e.collectionID === collID));\n}\n\n\nfunction addCollection(id, collID, collObj) {\n  return updateItem(id, item => {\n    item.dataset.push(collObj);\n  });\n}\n\n/**\n * Update collection\n * @param {string} id - Package instance ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object or update function\n */\nfunction updateCollection(id, collID, collObj) {\n  return updateItem(id, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    if (_.isFunction(collObj)) {\n      collObj(item.dataset[pos]);\n    } else {\n      item.dataset[pos] = collObj;\n    }\n  });\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - id if sucessfully added\n */\nfunction importItem(data) {\n  // Legacy format converter\n  data = legacy.convertPackage(data);\n\n  const now = new Date();\n  data.id = misc.uuidv4().slice(0, 8);\n  data.sessionStarted = now.toString();\n  return putItem(data);\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} response - response data\n * @return {string} - viewID if sucessfully added\n */\nfunction newDatagrid(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const instance = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    id: instance,\n    name: response.name,\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n        viewID: viewID,\n        name: response.name,\n        viewType: \"datagrid\",\n        rows: collectionID,\n        checkpoints: [\n          {type: 'creation', date: date}\n        ]\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        name: response.name,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return putItem(data)\n    .then(() => ({instance: instance, viewID:viewID}));\n}\n\n\nfunction addDatagrid(instance, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  return updateItem(instance, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: viewID,\n      name: response.name,\n      viewType: \"datagrid\",\n      rows: collectionID,\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: collectionID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\nfunction new384Tiles(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const instance = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    id: instance,\n    name: response.name,\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/tile_v1.0.json\",\n        viewID: viewID,\n        name: `${response.name}_tiles`,\n        viewType: 'tile',\n        items: collectionID,\n        rowCount: 16,\n        columnCount: 24\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        name: response.name,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return putItem(data)\n    .then(() => ({instance: instance, viewID:viewID}));\n}\n\n\nfunction add384Tiles(instance, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  return updateItem(instance, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/tile_v1.0.json\",\n      viewID: viewID,\n      name: `${response.name}_tiles`,\n      viewType: 'tile',\n      items: collectionID,\n      rowCount: 16,\n      columnCount: 24,\n      chunksPerRow: 10\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: collectionID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\n/**\n * Store new network view\n * @param {string} instance - Package instance ID\n * @param {string} nodesID - ID of nodes collection\n * @param {string} nodesName - Name of nodes collection\n * @param {object} response - Response object\n */\nfunction newNetwork(instance, nodesID, nodesName, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const edgesID = response.workflowID.slice(0, 8);\n  return updateItem(instance, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: viewID,\n      name: `${nodesName}_${response.name}`,\n      viewType: 'network',\n      nodes: nodesID,\n      edges: edgesID,\n      minConnThld: response.query.params.threshold\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: edgesID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\n/**\n * Get asset by a key\n * @param {string} key - key\n * @return {array} asset object (if not found, resolve with undefined)\n */\nfunction getAsset(key) {\n  return new Promise((resolve, reject) => {\n    return instance.assets.then(db => {\n      const req = db.transaction(db.name)\n        .objectStore(db.name).get(key);\n      req.onsuccess = event => {\n        const undef = event.target.result === undefined;\n        const value = undef ? undefined : event.target.result.value;\n        resolve(value);\n      };\n      req.onerror = event => reject(event);\n    });\n  });\n}\n\n/**\n * Put asset object with a key\n * @param {string} key - key\n * @param {string} content - asset to store\n */\nfunction putAsset(key, content) {\n  return new Promise((resolve, reject) => {\n    return instance.assets.then(db => {\n      const obj = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name);\n      const req = obj.put({key: key, value: content});\n      req.onerror = event => reject(event);\n      req.onsuccess = () => resolve();\n    });\n  });\n}\n\n\nexport default {\n  clear, clearAll, getAllItems, getItem, updateItem, deleteItem,\n  getView, appendView, updateView, deleteView,\n  getAllCollections, getCollection, addCollection, updateCollection,\n  importItem, newDatagrid, addDatagrid, add384Tiles, newNetwork,\n  getAsset, putAsset\n};\n","\n/** @module component/badge */\n\nimport d3 from 'd3';\n\nconst assetBaseURL = '../assets/';\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction badge(selection) {\n  selection.classed('badge', true);\n  selection.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('text', true);\n}\n\n\nfunction updateBadge(selection, text, type, icon) {\n  selection.classed(`badge-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nfunction notify(selection) {\n  selection\n    .style('opacity', 0)\n    .style('display', 'inline')\n    .transition()\n      .duration(500)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 1.0)\n    .transition()\n      .delay(3000)\n      .duration(1000)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 0)\n      .on('end', function () {\n        selection.style('display', 'none');\n      });\n}\n\n\nfunction loadingCircle(selection) {\n  selection\n      .style('display', 'none')\n    .append('img')\n      .attr('src', `${assetBaseURL}loading1.gif`)\n      .style('width', '2rem')\n      .style('height', '2rem');\n}\n\n\nfunction alert(selection) {\n  selection.classed('alert', true)\n      .classed('px-1', true)\n      .classed('py-0', true);\n  selection.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('text', true)\n      .style('font-size', '75%');\n}\n\n\nfunction updateAlert(selection, text, type, icon) {\n  selection.classed(`alert-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nfunction invalidFeedback(selection) {\n  selection.classed('invalid-feedback', true)\n      .style('display', 'none');\n  selection.append('img')\n      .classed('icon', true)\n      .attr('src', `${iconBaseURL}caution-salmon.svg`)\n      .style('width', '1rem')\n      .style('height', '1rem');\n  selection.append('span')\n      .classed('invalid-msg', true);\n}\n\nfunction updateInvalidMessage(selection, msg) {\n  selection.select('.invalid-msg')\n      .text(msg);\n}\n\n\nexport default {\n  badge, updateBadge, notify, loadingCircle,\n  alert, updateAlert, invalidFeedback, updateInvalidMessage\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction buttonBox(selection, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .text(label);\n}\n\n\nfunction menuButton(selection, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, target, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('label', true)\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, label, type, icon) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  const button = selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  button.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  button.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, label, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, label, target, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, label, accept, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      });\n  selection.append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  iconBaseURL, buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module component/modal */\n\nimport d3 from 'd3';\n\n\nfunction dialogBase(selection, id) {\n  selection\n      .classed('modal', true)\n      .attr('tabindex', -1)\n      .attr('role', 'dialog')\n      .attr('aria-labelledby', '')\n      .attr('aria-hidden', true)\n      .attr('id', id);\n  selection.append('div')\n      .classed('modal-dialog', true)\n      .attr('role', 'document')\n    .append('div')\n      .classed('modal-content', true);\n}\n\n\nfunction confirmDialog(selection, id) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // body\n  base.append('div')\n      .classed('modal-body', true)\n    .append('div')\n      .classed('message', true);\n  // footer\n  const footer = base.append('div')\n      .classed('modal-footer', true);\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-outline-secondary', true)\n      .classed('cancel', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Cancel');\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-warning', true)\n      .classed('ok', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('OK')\n      .on('click', () => {\n        selection.dispatch('submit');\n      });\n}\n\n\nfunction updateConfirmDialog(selection, message) {\n  selection.select('.message').text(message);\n}\n\n\nfunction submitDialog(selection, id, title) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // header\n  const header = base.append('div')\n      .classed('modal-header', true);\n  header.append('h4')\n      .classed('modal-title', true)\n      .text(title);\n  header.append('button')\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('aria-label', 'Close')\n      .classed('close', true)\n    .append('span')\n      .attr('aria-hidden', true)\n      .html('&times;');\n  // body\n  base.append('div')\n      .classed('modal-body', true);\n  // footer\n  base.append('div')\n      .classed('modal-footer', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-primary', true)\n      .classed('submit', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Submit')\n      .on('click', () => {\n        // Dismiss before submit\n        // Submit event can update the modal itself\n        // (ex. disable submit button before onSubmit call has completed)\n        $(`#${id}`).modal('hide');\n        selection.dispatch('submit');\n      });\n}\n\n\nexport default {\n  confirmDialog, updateConfirmDialog, submitDialog\n};\n","\n/** @module common/scale */\n\nimport d3 from 'd3';\n\n\nconst colorScales = [\n  {key: 'monoblack', type: 'monocolor', colors: ['#333333'], unknown: '#333333'},\n  {key: 'monogray', type: 'monocolor', colors: ['#cccccc'], unknown: '#cccccc'},\n  {key: 'nodeDefault', type: 'monocolor', colors: ['#7fffd4'], unknown: '#7fffd4'},\n  {key: 'aquamarine', type: 'bicolor',\n   colors: ['#778899', '#7fffd4'], unknown: '#f0f0f0'},\n  {key: 'chartreuse', type: 'bicolor',\n   colors: ['#778899', '#7fff00'], unknown: '#f0f0f0'},\n  {key: 'salmon', type: 'bicolor',\n   colors: ['#778899', '#fa8072'], unknown: '#f0f0f0'},\n  {key: 'violet', type: 'bicolor',\n   colors: ['#778899', '#ee82ee'], unknown: '#f0f0f0'},\n  {key: 'temperature', type: 'tricolor',\n   colors: ['#87ceeb', '#fff5ee', '#fa8072'], unknown: '#f0f0f0'},\n  {key: 'spectrum', type: 'tricolor',\n   colors: ['#6495ed', '#ccff66', '#ffa500'], unknown: '#f0f0f0'},\n  {key: 'category10', type: 'categorical',\n   colors: ['#8dd3c7','#ffffb3','#bebada','#fb8072','#80b1d3','#fdb462',\n    '#b3de69','#fccde5','#bc80bd','#ccebc5'], unknown: '#f0f0f0'},\n  {key: 'cbsafe', type: 'categorical',\n   colors: ['#543005','#8c510a','#bf812d','#dfc27d','#f6e8c3','#c7eae5',\n   '#80cdc1','#35978f','#01665e','#003c30'], unknown: '#f0f0f0'},\n  {key: 'category20', type: 'categorical',\n   colors: d3.schemePaired.concat(d3.schemeSet2), unknown: '#f0f0f0'},\n  {key: 'category40', type: 'categorical',\n   colors: d3.schemePaired.concat(d3.schemePastel2, d3.schemeSet2, d3.schemeSet3),\n   unknown: '#f0f0f0'},\n  {key: 'custom', type: 'custom', colors: ['#ffffff'], text: 'custom'}\n];\n\n\nconst types = [\n  {key: 'linear', name: 'Linear', func: d3.scaleLinear},\n  {key: 'log', name: 'Log', func: d3.scaleLog},\n  {key: 'quantize', name: 'Quantize', func: d3.scaleQuantize},\n  {key: 'ordinal', name: 'Ordinal', func: d3.scaleOrdinal}\n];\n\n\nfunction scaleFunction(state) {\n  const cscale = colorScales.find(e => e.key === state.color);\n  let range;\n  let unknown;\n  if (cscale && cscale.key !== 'custom') {\n      range = cscale.colors;\n      unknown = cscale.unknown;\n  } else {\n    range = state.range;\n    unknown = state.unknown;\n  }\n  let domain = null;\n  if (range.length === 3) {\n    const mid = (parseFloat(state.domain[0]) + parseFloat(state.domain[1])) / 2;\n    domain = [state.domain[0], mid, state.domain[1]];\n  } else {\n    domain = state.domain;\n  }\n  // Build\n  let scaleFunc = types.find(e => e.key === state.scale).func();\n  scaleFunc = scaleFunc.domain(domain);\n  scaleFunc = scaleFunc.range(range);\n  if (['linear', 'log'].includes(state.scale)) {\n    scaleFunc = scaleFunc.clamp(true);\n  }\n\n  return d => {\n    // Sanitize\n    if (d === '' || typeof d === 'undefined' || d === null) {\n      return unknown;  // invalid values\n    }\n    if (['linear', 'log'].includes(state.scale) && parseFloat(d) != d) {\n      return unknown;  // texts\n    }\n    if (state.scale === 'log' && d <= 0) {\n      return unknown;  // negative values in log scale\n    }\n    // Apply function\n    const result = scaleFunc(d);\n    if (result === undefined) {\n      return unknown;  // TODO: specify unexpected behavior\n    }\n    return result;\n  };\n}\n\n\nfunction isD3Format(notation) {\n  try {\n    d3.format(notation);\n  } catch (err) {\n    return false;\n  }\n  return true;\n}\n\n\nexport default {\n  colorScales, types, scaleFunction, isD3Format\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: [keyField].concat(mp.fields),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: table.fields.filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key)),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: fields,\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(mp.fields)\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/collection */\n\nimport _ from 'lodash';\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as mapper} from './mapper.js';\n\n\nexport default class Collection {\n  /**\n   * Create Collection from a flashflood response datatable\n   * If data is not specified, put datatables later by this.append(data)\n   * @param {object} coll - Collection or response object\n   */\n  constructor(coll) {\n    // Settings\n    this.autoIndex = 'index';  // enumerate records\n\n    this.collectionID = coll.collectionID || null;\n    this.instance = coll.instance || null;\n    this.name = coll.name || null;\n    if (coll.records) {\n      this.contents = [coll];\n      this.fields = [];\n    } else {\n      this.contents = coll.contents;\n      this.fields = coll.fields || [];\n    }\n    this.contents.forEach(content => {\n      content.fields.forEach(e => this.addField(e));\n    });\n  }\n\n  /**\n   * Add fields\n   * @param {array} fs - list of fields\n   */\n  addField(field) {\n    if (this.fields.find(e => e.key === field.key)) return;\n    if (!field.hasOwnProperty('name')) field.name = field.key;\n    if (!field.hasOwnProperty('visible')) field.visible = true;\n    if (field.hasOwnProperty('d3_format')) field.format = 'd3_format';\n    if (!field.hasOwnProperty('format')) field.format = 'raw';\n    this.fields.push(field);\n  }\n\n  /**\n   * Update fields properties\n   * @param {array} fs - list of fields\n   */\n  updateFields(fs) {\n    this.fields = [];\n    fs.forEach(e => this.addField(e));\n  }\n\n  /**\n   * Join fields\n   * @param {object} mapping - column mapper object\n   */\n  joinFields(mapping) {\n    this.contents.forEach(c => {\n      mapper.apply(c, mapping);\n    });\n    if (mapping.hasOwnProperty('fields')) {\n      mapping.fields.forEach(e => this.addField(e));\n    } else {\n      this.addField(mapping.field);\n    }\n  }\n\n  /**\n   * Apply function to the original data records\n   * new fields should be manually added by Collection.addField\n   * @param {function} func - function to be applied\n   */\n  apply(func) {\n    this.contents.forEach(content => {\n      content.records.forEach(rcd => {\n        func(rcd);\n      });\n    });\n  }\n\n  /**\n   * Return all records of the collection\n   * @return {array} records\n   */\n  records() {\n    return _.flatten(this.contents.map(e => e.records));\n  }\n\n  fetch(command) {\n    const fs = this.contents\n      .filter(e => ['running', 'ready', 'interrupted', 'queued'].includes(e.status))\n      .map(content => {\n        const query = {id: content.workflowID, command: command};\n        return fetcher.get('progress', query)\n          .then(fetcher.json)\n          .then(data => {\n            return idb.updateCollection(this.instance, this.collectionID, coll => {\n              const i = coll.contents\n                .findIndex(e => e.workflowID === query.id);\n              if (data.status === 'failure') {  // No data found on server\n                coll.contents[i].status = 'failure';\n              } else {\n                coll.contents[i] = data;\n              }\n            });\n          });\n      });\n    return Promise.all(fs)\n      .then(() => idb.getCollection(this.instance, this.collectionID))\n      .then(coll => {\n        this.contents = coll.contents;\n      });\n  }\n\n  /**\n   * Retrieve workflows and store it into a local store.\n   * @return {Promise}\n   */\n  pull() {\n    return this.fetch('pull');\n  }\n\n  /**\n   * Retrieve workflows, abort all ongoing workflow task\n   * and store it into a local store.\n   * @return {Promise}\n   */\n  abort() {\n    return this.fetch('abort');\n  }\n\n  /**\n   * Return total number of records\n   * @return {float} total number of records\n   */\n  size() {\n    return _.sum(this.contents.map(e => e.records.length));\n  }\n\n  /**\n   * Return status\n   * @return {string} status\n   */\n  status() {\n    if (this.contents.some(e => e.status === 'interrupted')) return 'interrupted';\n    if (this.contents.some(e => e.status === 'running')) return 'running';\n    if (this.contents.some(e => e.status === 'queued')) return 'queued';\n    if (this.contents.some(e => e.status === 'ready')) return 'ready';\n    if (this.contents.some(e => e.status === 'aborted')) return 'aborted';\n    if (this.contents.some(e => e.status === 'failure')) return 'failure';\n    return 'done';\n  }\n\n  /**\n   * Return ongoing or not\n   * @return {bool} ongoing or not\n   */\n  ongoing() {\n    const s = ['ready', 'queued', 'running', 'interrupted'];\n    return s.includes(this.status());\n  }\n\n  /**\n   * Return percentage of workflow progress\n   * @return {float} progress in percent\n   */\n  progress() {\n    return _.min(this.contents.map(e => e.progress));\n  }\n\n  /**\n   * Return total execution time\n   * @return {float} total time\n   */\n  execTime() {\n    return _.sum(this.contents.map(e => e.execTime));\n  }\n\n  /**\n   * Export collection object as JSON\n   * @return {object} collection JSON\n   */\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: this.collectionID,\n      name: this.name,\n      fields: this.fields,\n      contents: this.contents\n    };\n  }\n}\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction headerCellRenderer(header) {\n  header.style('display', 'inline-block')\n    .style('width', d => `${d.width}%`)\n    .text(d => d.name);\n}\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .call(state.headerCellRenderer);\n}\n\n\nfunction updateRows(selection, state) {\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.selectAll('.dg-cell').remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', 'absolute')\n      .style('width', '100%')\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0)\n          .call(state.rowFactory(), d);\n      });\n}\n\n\nfunction updateViewport(selection, state, scrollPos) {\n  selection.select('.dg-body').style('height', `${state.bodyHeight}px`);\n  state.setScrollPosition(scrollPos);\n  selection.call(updateRows, state, scrollPos);\n  selection.select('.dg-viewport').node().scrollTop = scrollPos * state.rowHeight;\n}\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.resizeViewport(window.innerHeight - viewportTop - 5);\n  viewport.style('height', `${state.viewportHeight}px`);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(updateRows, state, pos);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyHeader();\n    selection.call(updateHeader, state);\n    selection.call(resize, state);\n    state.applyData();\n    selection.call(updateViewport, state, state.viewportTop);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    selection.call(updateViewport, state, 0);\n  };\n}\n\n\n\nexport default {\n  headerCellRenderer, updateHeader, updateRows, updateViewport,\n  resize, datagrid\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nfunction binaryToDataURI(binary) {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      resolve(event.target.result);\n    };\n    reader.readAsDataURL(binary);\n  });\n}\n\n\nexport default {\n  plotCell, plotThumbnail, binaryToDataURI\n};\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction date(selection, record, field) {\n  // TODO; formatter\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  // TODO: Check vulnerabilities\n  selection.html(record[field.key]);\n}\n\n\nfunction compoundID(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n}\n\n\nfunction textField(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'text')\n      .style('width', '90%')\n      .property('value', record[field.key])\n      .on('change', function () {\n        record[field.key] = this.value;\n      });\n}\n\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nfunction asyncImage(selection, record, field) {\n  const req = `${field.request}${record[field.key]}`;\n  idb.getAsset(req)\n    .then(res => {\n      if (res !== undefined) return res;\n      return fetch(req, { credentials: 'include' })\n        .then(res => res.blob())\n        .then(res => idb.putAsset(req, res).then(() => res));\n    })\n    .then(obj => {\n      selection.append('img')\n          .attr('width', 180)\n          .attr('height', 180)\n          .attr('src', URL.createObjectURL(obj));\n    });\n}\n\n\nfunction asyncHtml(selection, record, field) {\n  const req = `${field.request}${record[field.key]}`;\n  idb.getAsset(req)\n    .then(res => {\n      if (res !== undefined) return res;\n      return fetch(req, { credentials: 'include' })\n        .then(res => res.text())\n        .then(res => idb.putAsset(req, res).then(() => res));\n    })\n    .then(txt => {\n      selection.html(txt);\n    });\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  date: date,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compoundID,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  text_field: textField,\n  control: call,\n  svg: html,\n  html: html,\n  async_image: asyncImage,\n  async_html: asyncHtml\n};\n\n\nfunction rowCell(selection) {\n  selection.classed('dg-cell', true)\n    .classed('align-middle', true)\n    .classed('text-truncate', true)\n    .style('display', 'inline-block');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n          .call(rowCell)\n          .style('width', `${field.width}%`);\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compoundID, image, checkbox, textField, call,\n  asyncImage, asyncHtml,\n  rowCell, rowFactory\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport Collection from '../common/collection.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as component} from './component.js';\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(view, coll) {\n    this.instance = view.instance || null;\n    this.viewID = view.viewID || null;\n    this.name = view.name || null;\n    this.sortOrder = view.sortOrder || [];\n    this.filterText = view.filterText || null;\n    this.rows = new Collection(coll);\n\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    // TODO: auto adjust\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      html: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.viewportTop = 0;\n    this.previousViewportTop = null;\n    this.viewportBottom = null;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.headerCellRenderer = component.headerCellRenderer;\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n  }\n\n  /**\n   * Set viewport height and number of rows to show\n   * @param {int} height - viewport height\n   */\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n  }\n\n  /**\n   * Set range of the row indices to show\n   * @param {int} position - Index of the top row to show\n   */\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setNumViewportRows() {\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  resizeViewport(height) {\n    this.setViewportSize(height);\n    this.setNumViewportRows();\n  }\n\n  /**\n   * Apply header data\n   */\n  applyHeader() {\n    this.visibleFields = this.rows.fields.filter(e => e.visible);\n    const widthfSum = this.visibleFields.reduce((a, c) => a + (c.widthf || 1), 0);\n    this.visibleFields = this.visibleFields.map(e => {\n      const field = {\n        width: (e.widthf || 1) / widthfSum * 100,\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b, 0).height;\n  }\n\n  /**\n   * Apply row data\n   * 1. applyHeader: define fields and set rowHeight\n   * 2. resize: measure actual window size and calc viewportHeight\n   * 3. applyData: calc number of rows from rowHeight and viewportHeight\n   * 4. setScrollPosition: calc row index range\n   * 5. recordsToShow: slice rows to show\n   */\n  applyData() {\n    this.setNumViewportRows();\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.rows.records().slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.rows.records().slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  updateFields(fs) {\n    this.rows.updateFields(fs);\n  }\n\n  joinFields(mapping) {\n    this.rows.joinFields(mapping);\n    this.applyData();\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  save() {\n    return idb.updateItem(this.instance, item => {\n      const ci = item.dataset\n        .findIndex(e => e.collectionID === this.rows.collectionID);\n      item.dataset[ci] = this.rows.export();\n      const vi = item.views.findIndex(e => e.viewID === this.viewID);\n      item.views[vi] = this.export();\n    });\n  }\n\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: this.viewID,\n      name: this.name,\n      viewType: \"datagrid\",\n      rows: this.rows.collectionID,\n      sortOrder: this.sortOrder,\n      filterText: this.filterText\n    };\n  }\n}\n","\n/** @module component/formBox */\n\nimport d3 from 'd3';\n\nimport {default as badge} from './badge.js';\n\n\nfunction updateFormValue(selection, value) {\n  selection.select('.form-control').property('value', value);\n  selection.call(setValidity, true);  // Clear validity state\n}\n\n\nfunction formValue(selection) {\n  return selection.select('.form-control').property('value');\n}\n\n\nfunction formValid(selection) {\n  return selection.select('.form-control').node().checkValidity();\n}\n\n\nfunction setValidity(selection, valid) {\n  selection.select('.invalid-feedback')\n      .style('display', valid ? 'none': 'inherit');\n  selection.select('.form-control')\n      .style('background-color', valid ? null : '#ffcccc');\n}\n\n\nfunction textBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .on('input', function () {\n        const valid = formValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\n\nfunction readonlyBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .attr('readonly', 'readonly');\n}\n\nfunction updateReadonlyValue(selection, value) {\n  selection.select('.form-control-plaintext').property('value', value);\n}\n\nfunction readonlyValue(selection) {\n  return selection.select('.form-control-plaintext').property('value');\n}\n\n\nfunction textareaBox(selection, label, rows, placeholder) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  const formLabel = selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  formLabel.append('div')\n      .call(badge.invalidFeedback);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows)\n      .attr('placeholder', placeholder)\n      .on('input', function () {\n        const valid = textareaValid(selection);\n        selection.call(setValidity, valid);\n      });\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n')\n    .map(e => e.replace(/^\\s+|\\s+$/g, ''))  // strip spaces\n    .filter(e => e.length > 0);\n  return [];\n}\n\nfunction textareaValid(selection) {\n  return /\\s*?\\w\\s*?/.test(formValue(selection));\n}\n\n\nfunction checkBox(selection, label) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox');\n  box.append('span')\n      .text(label);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'number')\n      .on('input', function () {\n        const valid = formValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\nfunction updateNumberRange(selection, min, max, step) {\n  selection.select('.form-control')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step)\n      .dispatch('input', {bubbles: true});\n}\n\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n}\n\n\nfunction fileInputBox(selection, label, accept) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('form-control-file', true)\n      .classed('col-8', true)\n      .attr('type', 'file')\n      .attr('accept', accept)\n      .on('change', function () {\n        const valid = fileInputValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\nfunction clearFileInput(selection) {\n  // TODO: FileList object (input.files) may be a readonly property\n  const label = selection.select('label').text();\n  const accept = selection.select('input').attr('accept');\n  selection.selectAll('*').remove();\n  selection.call(fileInputBox, label, accept);\n}\n\nfunction fileInputValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\nfunction fileInputValid(selection) {\n  // TODO: attribute 'require' does not work with input type=file\n  return selection.select('input').property('files').length > 0;\n}\n\n\nexport default {\n  updateFormValue, formValue, formValid, setValidity,\n  textBox, readonlyBox, updateReadonlyValue, readonlyValue,\n  textareaBox, textareaBoxLines, textareaValid,\n  numberBox, updateNumberRange,\n  checkBox, updateCheckBox, checkBoxValue,\n  colorBox,\n  fileInputBox, clearFileInput, fileInputValue, fileInputValid\n};\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, 'Search');\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.formValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction setSort(selection, state) {\n  state.headerCellRenderer = header => {\n    header.style('display', 'inline-block')\n      .style('width', d => `${d.width}%`)\n      .text(d => d.name)\n      .filter(d => misc.sortType(d.format) !== 'none')\n      .append('span').append('a')\n        .attr('id', d => `sort-${d.key}`)\n        .text('^v')\n        .style('display', 'inline-block')\n        .style('width', '30px')\n        .style('text-align', 'center')\n      .on('click', d => {\n        const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n        d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n        state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n        selection.call(component.updateRows, state);\n      });\n  };\n}\n\n\nexport default {\n  setSort\n};\n","\n/** @module datagrid/table */\n\nimport Collection from '../common/collection.js';\n\nimport DatagridState from './state.js';\nimport {default as component} from './component.js';\nimport {default as rowf} from './rowFilter.js';\nimport {default as sort} from './sort.js';\n\n\nfunction table(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  state.keyFunc = d => d;\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterSortTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(sort.setSort, state)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction update(selection, fields, records) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = selection.datum();\n  state.rows = new Collection(data);\n  state.updateContentsNotifier();\n}\n\n\nfunction updateRecords(selection, records) {\n  const state = selection.datum();\n  state.rows.contents[0].records = records;\n  state.updateContentsNotifier();\n}\n\n\nfunction tableRecords(selection) {\n  const state = selection.datum();\n  return state.rows.records();\n}\n\n\nexport default {\n  table, filterTable, filterSortTable, update, updateRecords, tableRecords\n};\n","\n/** @module dialog/fieldConfig */\n\nimport d3 from 'd3';\n\nimport {default as scale} from '../common/scale.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\nimport {default as rowf} from '../datagrid/rowFactory.js';\n\n\nconst id = 'fieldconf-dialog';\nconst title = 'Column setting';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-edittable');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[0].width}%`)\n        .text(record.name);\n    selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[1].width}%`)\n      .append('input')\n        .attr('type', 'checkbox')\n        .property('checked', record.visible)\n        .on('change', function () {\n          record.visible = this.checked;\n        });\n    const select = selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[2].width}%`)\n      .append('select');\n    const extra = !fields[2].options.includes(record.format);\n    select.selectAll('option').data(extra ? [record.format] : fields[2].options)\n      .enter().append('option')\n        .attr('value', d => d)\n        .text(d => d);\n    select.property('value', record.format)\n        .property('disabled', extra)\n        .on('change', function () {\n          record.format = this.value;\n          selection.select('.d3f input')\n            .property('disabled', record.format !== 'd3_format');\n        });\n    selection.append('div')\n        .call(rowf.rowCell)\n        .classed('d3f', true)\n        .style('width', `${fields[3].width}%`)\n      .append('input')\n        .attr('type', 'text')\n        .style('width', '90%')\n        .property('value', record.d3_format)\n        .property('disabled', record.format !== 'd3_format')\n        .on('input', function () {\n          const valid = scale.isD3Format(this.value);\n          d3.select(this)\n              .style('background-color', valid ? '#ffffff' : '#ffcccc');\n          if (valid) {\n            record.d3_format = this.value;\n            selection.dispatch('change', {bubbles: true});\n          }\n        });\n  };\n}\n\n\nfunction body(selection) {\n  const fields = [\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'visible', name: 'Visible', format: 'checkbox',\n     widthf: 0.5, height: 40},\n    {key: 'format', name: 'Format', format: 'select',\n     options: ['text', 'numeric', 'd3_format', 'raw', 'compound_id'],\n     height: 40},\n    {key: 'd3_format', name: 'D3 format', format: 'text_field',\n     height: 40}\n  ];\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-dialog').classed('modal-lg', true);\n  dialog.select('.modal-body').append('div')\n      .classed('dgfields', true)\n      .call(table.table, fields, [], rowFactory, 300);\n}\n\n\nfunction updateBody(selection, dgfields) {\n  selection.select('.dgfields')\n      .call(table.updateRecords, dgfields)\n      .on('change', function () {\n        const d3fValid = d3.select(this).selectAll('.d3f input')\n          .nodes().map(e => e.value)\n          .every(n => scale.isD3Format(n));\n        selection.select('.submit')\n            .property('disabled', !d3fValid);\n      });\n}\n\n\nfunction value(selection) {\n  return table.tableRecords(selection.select('.dgfields'));\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module dialog/fieldFetch */\n\nimport _ from 'lodash';\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as mapper} from '../common/mapper.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\n\n\nconst id = 'fieldfetch-dialog';\nconst title = 'Fetch assays';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addassay');\n}\n\n\nfunction body(selection) {\n  const fields = [\n    {key: 'check', name: 'Check', format: 'checkbox',\n     widthf: 0.5, height: 40, disabled: 'check_d'},\n    {key: 'assay_id', name: 'Assay ID', format: 'assay_id'},\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'value_type', name: 'Value type', format: 'text'},\n    {key: 'tags', name: 'Tags', format: 'list', widthf: 2}\n  ];\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-dialog').classed('modal-lg', true);\n  dialog.select('.modal-body').append('div')\n    .classed('assays', true)\n    .call(table.filterTable, fields, []);\n}\n\n\nfunction updateBody(selection, schema, dgfields) {\n  const assays = _.flatten(\n    schema.resources.filter(e => e.domain === 'assay').map(e => e.data)\n  );\n  const items = _.flatMap(assays, assay => {\n    return assay.value_types.map(e => {\n      const copy = Object.assign({}, assay);\n      copy.value_type = e.key;\n      delete copy.value_types;\n      return copy;\n    });\n  });\n  const done = {};\n  dgfields.filter(e => e.hasOwnProperty('__origin'))\n    .map(e => e.__origin)\n    .forEach(e => {\n      if (!done.hasOwnProperty(e.assay_id)) {\n        done[e.assay_id] = [];\n      }\n      done[e.assay_id].push(e.value_type);\n    });\n  const records = items.map(item => {\n    const d = done.hasOwnProperty(item.assay_id)\n        && done[item.assay_id].includes(item.value_type);\n    item.check = d;\n    item.check_d = d;\n    return item;\n  });\n  selection.select('.assays')\n    .call(table.updateRecords, records)\n    .on('change', function () {  // Validation\n      const anyChecked = table.tableRecords(d3.select(this))\n        .filter(e => e.check && !e.check_d).length;\n      selection.select('.submit').property('disabled', !anyChecked);\n    })\n    .dispatch('change');\n}\n\n\nfunction execute(selection, compounds, schema) {\n  const targets = schema.resources\n    .filter(e => e.domain === 'activity').map(e => e.id);\n  const queries = table.tableRecords(selection.select('.assays'))\n    .filter(e => e.check && !e.check_d)\n    .map(e => {\n      return {\n        workflow: 'activity',\n        targets: targets,\n        assay_id: e.assay_id,\n        condition: {\n          compounds: compounds,\n          value_types: [e.value_type]\n        }\n      };\n    })\n    .map(q => {\n      return fetcher.get(q.workflow, q)\n        .then(fetcher.json);\n    });\n    return Promise.all(queries).then(res => {\n      const merged = res.shift();\n      res.forEach(data => {\n        const mp = mapper.tableToMapping(\n          data, 'compound_id', ['index', 'assay_id']);\n        mapper.apply(merged, mp);\n      });\n      return mapper.tableToMapping(\n        merged, 'compound_id', ['index', 'assay_id']);\n    });\n}\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module component/shape */\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction monocolorBar(selection, colors, text) {\n  const group = selection.append('g');\n  group.append('rect')\n      .attr('x', 0).attr('y', 0)\n      .attr('width', 100).attr('height', 10)\n      .attr('fill', colors[0]);\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 10)\n      .attr('font-size', 12)\n      .text(text);\n}\n\nfunction bicolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n      .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n      .attr('offset', 1).attr('stop-color', colors[1]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction tricolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n    .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n    .attr('offset', 0.5).attr('stop-color', colors[1]);\n  grad.append('stop')\n    .attr('offset', 1).attr('stop-color', colors[2]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction categoricalBar(selection, colors, text) {\n  const sw = 100 / colors.length;\n  const group = selection.append('g');\n  colors.forEach((e, i) => {\n    group.append('rect')\n        .attr('x', sw * i).attr('y', 0)\n        .attr('width', sw).attr('height', 10)\n        .attr('fill', colors[i]);\n  });\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 10)\n      .attr('font-size', 12)\n      .text(text);\n}\n\nfunction setSize(selection, width, height) {\n  selection.attr('width', width).attr('height', height);\n}\n\n\nconst colorBar = {\n  'monocolor': monocolorBar,\n  'bicolor': bicolorBar,\n  'tricolor': tricolorBar,\n  'categorical': categoricalBar,\n  'custom': monocolorBar\n};\n\n\nexport default {\n  colorBar, setSize\n};\n","\n/** @module component/formListBox */\n\nimport d3 from 'd3';\n\nimport {default as badge} from './badge.js';\nimport {default as box} from './formBox.js';\nimport {default as shape} from './shape.js';\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction selectBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('select')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .on('input', function () {\n        const valid = box.formValid(selection);\n        selection.call(box.setValidity, valid);\n      });\n}\n\nfunction updateSelectBoxOptions(selection, items) {\n  const options = selection.select('select')\n    .selectAll('option')\n      .data(items, d => d.key);\n  options.exit().remove();\n  options.enter()\n    .append('option')\n      .attr('value', d => d.key)\n      .text(d => d.name);\n}\n\nfunction selectedRecord(selection) {\n  const value = box.formValue(selection);\n  return selection.selectAll('select option').data()\n      .find(e => e.key === value);\n}\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction checklistBox(selection, label) {\n  // TODO: scroll\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  const formLabel = selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  formLabel.append('div')\n      .call(badge.invalidFeedback);\n  selection.append('ul')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n}\n\nfunction updateChecklistItems(selection, items) {\n  const listitems = selection.select('ul')\n    .selectAll('li')\n      .data(items, d => d.key);\n  listitems.exit().remove();\n  const form = listitems.enter()\n    .append('li')\n      .attr('class', 'form-check')\n    .append('label')\n      .attr('class', 'form-check-label');\n  form.append('input')\n      .attr('type', 'checkbox')\n      .attr('class', 'form-check-input')\n      .property('value', d => d.key);\n  form.append('span')\n      .text(d => d.name);\n}\n\nfunction checkRequired(selection) {\n  selection.selectAll('input')\n      .on('change', function () {\n        const valid = anyChecked(selection);\n        selection.call(setChecklistValidity, valid);\n      });\n}\n\nfunction updateChecklistValues(selection, values) {\n  selection.selectAll('input')\n    .each(function (d) {\n      d3.select(this).property('checked', values.includes(d.key));\n    });\n  selection.call(setChecklistValidity, true);  // Clear validity state\n}\n\nfunction checklistValues(selection) {\n  return selection.selectAll('input:checked').data().map(d => d.key);\n}\n\nfunction anyChecked(selection) {\n  return checklistValues(selection).length > 0;\n}\n\nfunction setChecklistValidity(selection, valid) {\n  selection.select('.invalid-feedback')\n      .style('display', valid ? 'none': 'inherit');\n  selection.select('.form-control')\n      .style('background-color', valid ? null : 'LightPink');\n}\n\n\nfunction colorScaleBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label || 'Colorscale');\n  const form = selection.append('div')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n  const dropdown = form.append('div')\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  dropdown.append('button')\n      .classed('btn', true)\n      .classed(`btn-light`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  dropdown.append('div')\n      .classed('dropdown-menu', true)\n      .classed('py-0', true);\n  form.append('span')\n      .classed('selected', true);\n}\n\nfunction colorScaleBoxItems(selection, items) {\n  const listitems = selection.select('.dropdown-menu')\n    .selectAll('a')\n      .data(items, d => d);\n  listitems.exit().remove();\n  listitems.enter()\n    .append('a')\n      .classed('dropdown-item', true)\n      .classed('py-0', true)\n      .attr('href', '#')\n      .attr('title', d => d.key)\n      .on('click', function (d) {\n        selection.call(setSelectedColorScale, d);\n        selection.dispatch('change', {bubbles: true});\n      })\n    .append('svg')\n      .each(function (d) {\n        d3.select(this)\n          .attr('viewBox', '0 0 100 10')\n          .attr('preserveAspectRatio', 'none')\n          .call(shape.colorBar[d.type], d.colors, d.text)\n          .call(shape.setSize, 100, 10);\n      });\n}\n\nfunction setSelectedColorScale(selection, item) {\n  const selected = selection.select('.selected');\n  selected.selectAll('svg').remove();\n  selected.datum(item);  // Bind selected item record\n  selected.append('svg')\n      .attr('viewBox', '0 0 100 10')\n      .attr('preserveAspectRatio', 'none')\n      .call(shape.colorBar[item.type], item.colors, item.text)\n      .call(shape.setSize, 100, 10);\n}\n\nfunction updateColorScaleBox(selection, key) {\n  const data = selection.select('.dropdown-menu')\n    .selectAll('a').data();\n  const item = data.find(e => e.key === key);\n  selection.call(setSelectedColorScale, item);\n}\n\nfunction colorScaleBoxValue(selection) {\n  return selection.select('.selected').datum().key;\n}\n\nfunction colorScaleBoxItem(selection) {\n  return selection.select('.selected').datum();\n}\n\n\nexport default {\n  selectBox, updateSelectBoxOptions, selectedRecord,\n  checklistBox, updateChecklistItems, checkRequired, updateChecklistValues,\n  checklistValues, anyChecked, setChecklistValidity,\n  colorScaleBox, colorScaleBoxItems, updateColorScaleBox,\n  colorScaleBoxValue, colorScaleBoxItem\n};\n","\n/** @module dialog/fieldFile */\n\nimport d3 from 'd3';\n\nimport {default as mapper} from '../common/mapper.js';\nimport {default as misc} from '../common/misc.js';\nimport {default as hfile} from '../common/file.js';\nimport {default as himg} from '../common/image.js';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\n\n\nconst id = 'fieldfile-dialog';\nconst title = 'Import fields from file';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addfile');\n}\n\n\nfunction body(selection) {\n  const mbody = selection.call(modal.submitDialog, id, title)\n      .select('.modal-body');\n\n  // File input\n  mbody.append('div')\n      .classed('file', true)\n      .call(box.fileInputBox, 'File (JSON mapping or CSV)', '.json,.csv')\n      .on('change', function () {\n        const valid = box.fileInputValid(d3.select(this));\n        selection.select('.submit').property('disabled', !valid);\n        if (!valid) return;\n        const file = box.fileInputValue(d3.select(this));\n        return hfile.readFile(file)\n          .then(res => {\n            const isCsv = file.name.split('.').pop() === 'csv';\n            const mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n            const tbl = mapper.mappingToTable(mapping);\n            selection.select('.right')\n              .call(lbox.updateSelectBoxOptions,\n                    [{key: mapping.key, name: mapping.key}])\n              .call(box.updateFormValue, mapping.key);\n            selection.select('.preview')\n              .call(table.update, tbl.fields, tbl.records.slice(0, 5));\n          });\n      });\n\n  // Left join key\n  mbody.append('div')\n      .classed('left', true)\n      .call(lbox.selectBox, 'Datagrid ID');\n\n  // Right join key\n  mbody.append('div')\n      .classed('right', true)\n      .call(lbox.selectBox, 'File ID')\n    .select('select')\n      .property('disabled', true);\n\n  // Preview\n  mbody.append('h5')\n      .classed('mt-2', true)\n      .text('Preview');\n  mbody.append('div')\n      .classed('preview', true)\n      .call(table.table, [], [], null, 210);\n}\n\n\nfunction updateBody(selection, fields) {\n  const leftFields = fields.filter(e => misc.sortType(e.format) !== 'none');\n  const leftDefault = leftFields\n    .find(e => e.format === 'compound_id') || leftFields[0];\n  selection.select('.left')\n      .call(lbox.updateSelectBoxOptions, leftFields)\n      .call(box.updateFormValue, leftDefault.key);\n  selection.select('.preview')\n      .call(table.update, [], []);\n  selection.select('.file')\n      .call(box.clearFileInput)\n      .call(badge.updateInvalidMessage, 'Please choose a valid file');\n  selection.select('.submit').property('disabled', true);\n}\n\n\nfunction readFile(selection) {\n  const left = box.formValue(selection.select('.left'));\n  const file = box.fileInputValue(selection.select('.file'));\n  const isCsv = file.name.split('.').pop() === 'csv';\n  return hfile.readFile(file)\n    .then(res => {\n      let mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n      if (mapping.hasOwnProperty('field')) {\n        mapping = mapper.singleToMulti(mapping);\n      }\n      mapping.key = left;\n      // TODO; refactor\n      const plotCols = [];\n      mapping.fields.forEach((e, i) => {\n        if (e.format === 'plot') {\n          mapping.fields[i].format = 'image';\n          plotCols.push(i);\n        }\n      });\n      if (plotCols.length > 0) {\n        const ps = [];\n        Object.entries(mapping.mapping).forEach(m => {\n          plotCols.forEach(e => {\n            const p = himg.plotThumbnail(m[1][e])\n              .then(img => {\n                mapping.mapping[m[0]][e] = img;\n              });\n            ps.push(p);\n          });\n        });\n        return Promise.all(ps).then(() => mapping);\n      } else {\n        return mapping;\n      }\n    });\n}\n\n\nexport default {\n  menuLink, body, updateBody, readFile\n};\n","\n/** @module component/dropdown */\n\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction dropdownFormGroup(selection, label) {\n  const id = misc.uuidv4().slice(0, 8);\n  selection.classed('mb-3', true)\n    .append('div')\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('justify-content-end', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-sm', true)\n      .classed('btn-outline-primary', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'collapse')\n      .attr('data-target', `#${id}-collapse`)\n      .attr('aria-expanded', 'false')\n      .attr('aria-controls', `${id}-collapse`)\n      .text(label);\n  selection.append('div')\n      .classed('collapse', true)\n      .attr('id', `${id}-collapse`)\n    .append('div')\n      .classed('card', true)\n      .classed('card-body', true);\n}\n\n\nexport default {\n  dropdownFormGroup\n};\n","\n/** @module dialog/fieldInput */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as scale} from '../common/scale.js';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as button} from '../component/button.js';\nimport {default as dropdown} from '../component/dropdown.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'fieldinput-dialog';\nconst title = 'Add custom field';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addcheckbox');\n}\n\n\nfunction body(selection) {\n  const mbody = selection.call(modal.submitDialog, id, title)\n      .select('.modal-body');\n\n  // Custom field name\n  mbody.append('div')\n      .classed('key', true)\n      .call(box.textBox, 'Field key')\n    .select('.form-control')\n      .attr('required', 'required');\n\n  // Field type\n  const options = [\n    {key: 'checkbox', name: 'Checkbox', format: 'checkbox'},\n    {key: 'text_field', name: 'Text field', format: 'text_field'},\n    {key: 'template', name: 'Template', format: 'html'}\n  ];\n  mbody.append('div')\n      .classed('type', true)\n      .call(lbox.selectBox, 'Type')\n      .call(lbox.updateSelectBoxOptions, options)\n      .on('change',  function () {\n        const type = box.formValue(d3.select(this));\n        const custom = type === 'template';\n        selection.selectAll('.tmpbuild .form-control')\n            .property('disabled', !custom);\n      });\n\n  // Template builder\n  const collapse = mbody.append('div')\n      .call(dropdown.dropdownFormGroup, 'Template builder')\n    .select('.card-body');\n\n  // Template field\n  collapse.append('div')\n      .classed('tmpfield', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Field')\n      .on('change', function () {\n        const rcd = lbox.selectedRecord(d3.select(this));\n        const notation = rcd.d3_format ? `:${rcd.d3_format}` : '';\n        selection.select('.notation')\n            .call(box.updateReadonlyValue, `{${rcd.key}${notation}}`);\n      });\n\n  // Notation\n  collapse.append('div')\n      .classed('notation', true)\n      .call(box.readonlyBox, 'Notation');\n\n  // Template input\n  collapse.append('div')\n      .classed('contents', true)\n      .call(box.textareaBox, 'Contents', 5);\n}\n\n\nfunction updateBody(selection, fields) {\n  selection.select('.key')\n      .call(box.updateFormValue, '')\n      .on('input', function() {\n        const value = box.formValue(d3.select(this));\n        const noDup = keyNoDup(d3.select(this), fields);\n        if (!noDup) box.setValidity(d3.select(this), false);\n        const invmsg = noDup ? 'Please provide valid field name'\n          : `Key '${value}' already exsists`;\n        d3.select(this).call(badge.updateInvalidMessage, invmsg);\n        const valid = dialogFormValid(selection, fields);\n        selection.select('.submit').property('disabled', !valid);\n      });\n  selection.select('.type')\n      .call(box.updateFormValue, 'checkbox')\n      .on('change', function () {\n        const valid = dialogFormValid(selection, fields);\n        selection.select('.submit').property('disabled', !valid);\n      });\n  const tmpFields = fields.filter(e => misc.sortType(e.format) !== 'none');\n  selection.select('.tmpfield')\n      .call(lbox.updateSelectBoxOptions, tmpFields)\n      .call(box.updateFormValue, 'index')\n      .dispatch('change');\n  selection.select('.contents')\n      .call(box.updateFormValue, '')\n      .on('input', function () {\n        const valid = dialogFormValid(selection, fields);\n        selection.select('.submit').property('disabled', !valid);\n      });\n  selection.select('.submit').property('disabled', true);\n}\n\n\nconst formatterGen = {\n  checkbox: () => (() => false),\n  text_field: () => (() => ''),\n  template: tmp => {\n    const parseInner = (rcd, n) => {\n      const arr = n.slice(1, -1).split(':');\n      if (arr.length === 1) {\n        return rcd[arr[0]];\n      } else {\n        return d3.format(arr[1])(rcd[arr[0]]);\n      }\n    };\n    const inner = tmp.match(/\\{.+?\\}/g) || [];\n    const outer = tmp.split(/\\{.+?\\}/g);\n    return rcd => {\n      const ic = inner.slice();\n      const oc = outer.slice();\n      const txtarr = [oc.shift()];\n      while (ic.length) {\n        txtarr.push(parseInner(rcd, ic.shift()));\n        txtarr.push(oc.shift());\n      }\n      return txtarr.join('').replace(/(?:\\r\\n|\\r|\\n)/g, '<br />');\n    };\n  }\n};\n\n\nfunction keyNoDup(selection, fields) {\n  const value = box.formValue(selection);\n  return !fields.map(e => e.key).includes(value);\n}\n\n\nfunction contentsValid(selection, tmpFields) {\n  const value = box.formValue(selection);\n  const valid = box.formValid(selection);\n  const outer = value.split(/\\{.+?\\}/g);\n  const inner = (value.match(/\\{.+?\\}/g) || []).map(e => e.slice(1, -1));\n  const validKey = inner.some(n => {\n    const ns = n.split(':');\n    if (!tmpFields.map(e => e.key).includes(ns[0])) return false;\n    if (ns.length > 2) return false;\n    if (ns.length === 1) return true;\n    return scale.isD3Format(ns[1]);\n  });\n  const validFormat = outer.concat(inner)\n    .every(n => !n.includes('{') && !n.includes('}'));\n  return valid && validKey && validFormat;\n}\n\nfunction dialogFormValid(selection, fields) {\n  const isTmp = box.formValue(selection.select('.type')) === 'template';\n  const keyv = box.formValid(selection.select('.key'));\n  const noDup = keyNoDup(selection.select('.key'), fields);\n  const tmpFields = fields.filter(e => misc.sortType(e.format) !== 'none');\n  const contv = contentsValid(selection.select('.contents'), tmpFields);\n  return keyv && noDup && (!isTmp || contv);\n}\n\n\nfunction value(selection) {\n  const key = box.formValue(selection.select('.key'));\n  const typeField = lbox.selectedRecord(selection.select('.type'));\n  const cont = box.formValue(selection.select('.contents'));\n  return {\n    field: {key: key, name: key, format: typeField.format},\n    converter: formatterGen[typeField.key](cont)\n  };\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module dialog/formGroup */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as button} from '../component/button.js';\nimport {default as dropdown} from '../component/dropdown.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\n\n\n/**\n * Render color range control box group\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction queryMolGroup(selection) {\n  // Query format\n  selection\n      .classed('mb-3', true);\n  selection.append('div')\n      .classed('format', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Format')\n      .call(lbox.updateSelectBoxOptions,\n            [\n              {key: 'molfile', name: 'MDL Molfile'},\n              {key: 'dbid', name: 'Compound ID'}\n            ])\n      .on('change', function () {\n        const value = box.formValue(d3.select(this));\n        selection.select('.source .form-control')\n            .property('disabled', value !== 'dbid');\n        selection.select('.textquery')\n            .property('hidden', value !== 'dbid');\n        selection.select('.areaquery')\n            .property('hidden', value !== 'molfile');\n      });\n\n  // Query ID source\n  selection.append('div')\n      .classed('source', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Source');\n\n  // Database ID query input\n  const queryBox = selection.append('div')\n      .classed('textquery', true)\n      .classed('mb-1', true)\n      .call(box.textBox, 'Query');\n  queryBox.select('.form-control')\n      .attr('required', 'required');\n  queryBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage, 'Please provide a valid query');\n\n  // CTAB format structure query input\n  const ctabBox = selection.append('div')\n      .classed('areaquery', true)\n      .classed('mb-1', true)\n      .attr('required', 'required')\n      .call(box.textareaBox, 'Query', 6, null);\n  ctabBox.select('.form-control')\n      .attr('required', 'required');\n  ctabBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage,\n            'Please provide a valid CTAB format text (.sdf or .mol)');\n\n  // Preview popover\n  $(function () {\n    $('[data-toggle=\"popover\"]')\n      .popover({html: true, trigger: 'focus'});\n  });\n  selection.append('div')\n      .classed('form-row', true)\n      .classed('justify-content-end', true)\n    .append('button')\n      .classed('preview', true)\n      .attr('data-toggle', 'popover')\n      .attr('data-html', 'true')\n      .attr('data-content', '<div id=\"previmg\"></div>')\n      .call(button.menuButton, 'Structure preview', 'primary')\n      .on('click', function () {\n        const query = queryMolValues(selection);\n        return fetcher.get('strprev', query)\n          .then(fetcher.text)\n          .then(res => d3.select('#previmg').html(res), fetcher.error);\n      });\n}\n\nfunction updateQueryMolResources(selection, resources) {\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  selection.select('.source')\n      .call(lbox.updateSelectBoxOptions, res);\n}\n\nfunction updateQueryMolValues(selection, values) {\n  selection.select('.format')\n      .call(box.updateFormValue, values.format)\n      .dispatch('change');\n  selection.select('.source')\n      .call(box.updateFormValue, values.source);\n  selection.select('.textquery')\n      .call(box.updateFormValue,\n            values.format === 'dbid' ? values.value : null);\n  selection.select('.areaquery')\n      .call(box.updateFormValue,\n            values.format === 'molfile' ? values.value : null);\n}\n\nfunction queryMolValues(selection) {\n  const format = box.formValue(selection.select('.format'));\n  const source = box.formValue(selection.select('.source'));\n  const textquery = box.formValue(selection.select('.textquery'));\n  const areaquery = box.textareaBoxLines(selection.select('.areaquery'));\n  return {\n    format: format,\n    source: format === 'dbid' ? source : null,\n    value: format === 'molfile' ? areaquery : textquery\n  };\n}\n\nfunction queryMolValid(selection) {\n  const format = box.formValue(selection.select('.format'));\n  const textValid = box.formValid(selection.select('.textquery'));\n  const ctabValid = box.textareaValid(selection.select('.areaquery'));\n  return format === 'molfile' ? ctabValid : textValid;\n}\n\n\nfunction simOptionGroup(selection) {\n  const collapse = selection.append('div')\n      .call(dropdown.dropdownFormGroup, 'Optional parameters')\n    .select('.card-body');\n\n  // Ignore H flag\n  collapse.append('div')\n      .classed('ignoreh', true)\n      .classed('mb-1', true)\n      .call(box.checkBox, 'Ignore explicit hydrogens');\n\n  // Timeout\n  const timeoutBox = collapse.append('div')\n      .classed('timeout', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Timeout')\n      .call(box.updateNumberRange, 1, 999, 1);\n  timeoutBox.select('.form-control')\n      .attr('required', 'required');\n  timeoutBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage,\n            'Please provide a valid number (1 to 999)');\n\n  // Diameter\n  const diamBox = collapse.append('div')\n      .classed('diam', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Diameter (MCS-DR/GLS)')\n      .call(box.updateNumberRange, 4, 999, 1);\n  diamBox.select('.form-control')\n      .attr('required', 'required');\n  diamBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage,\n            'Please provide a valid number (4 to 999)');\n\n  // Custom layout\n  collapse.selectAll('label.col-form-label')\n      .classed('col-4', false)\n      .classed('col-6', true);\n  collapse.selectAll('input.form-control')\n      .classed('col-8', false)\n      .classed('col-6', true);\n}\n\n\nfunction updateSimOptionValues(selection, values) {\n  selection.select('.ignoreh')\n      .call(box.updateCheckBox, values.ignoreHs);\n  if (values.hasOwnProperty('timeout')) {\n    selection.select('.timeout')\n        .call(box.updateFormValue, values.timeout);\n  }\n  if (values.hasOwnProperty('diameter')) {\n    selection.select('.diam')\n        .call(box.updateFormValue, values.diameter);\n  }\n}\n\n\nfunction simOptionValues(selection) {\n  const timeout = selection.select('.timeout');\n  const diam = selection.select('.diam');\n  const query = {\n    ignoreHs: box.checkBoxValue(selection.select('.ignoreh'))\n  };\n  if (!timeout.select('.form-control').property('disabled')) {\n    query.timeout = box.formValue(timeout);\n  }\n  if (!diam.select('.form-control').property('disabled')) {\n    query.diameter = box.formValue(diam);\n  }\n  return query;\n}\n\nfunction simOptionValid(selection) {\n  const timeoutValid = box.formValid(selection.select('.timeout'));\n  const diamValid = box.formValid(selection.select('.diam'));\n  return timeoutValid && diamValid;\n}\n\n\nexport default {\n  queryMolGroup, updateQueryMolResources, updateQueryMolValues,\n  queryMolValues, queryMolValid,\n  simOptionGroup, updateSimOptionValues, simOptionValues, simOptionValid\n};\n","\n/** @module dialog/networkgen */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as group} from './formGroup.js';\n\n\nconst id = 'networkgen-dialog';\nconst title = 'Generate similarity network';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-network');\n}\n\n\nfunction body(selection) {\n  const mbody = selection.call(modal.submitDialog, id, title)\n      .select('.modal-body');\n\n  // Similarity measure\n  mbody.append('div')\n      .classed('measure', true)\n      .call(lbox.selectBox, 'Measure')\n      .on('change', function () {\n        const value = box.formValue(d3.select(this));\n        selection.select('.diam input')\n            .property('disabled', value !== 'gls');\n        selection.select('.timeout input')\n            .property('disabled', !['gls', 'rdfmcs'].includes(value));\n      });\n\n  // Threshold\n  const thldBox = mbody.append('div')\n      .classed('thld', true)\n      .call(box.numberBox, 'Threshold')\n      .call(box.updateNumberRange, 0.01, 1, 0.01)\n      .on('input', function() {\n        const valid = dialogFormValid(selection);\n        selection.select('.submit').property('disabled', !valid);\n      });\n  thldBox.select('.form-control')\n      .attr('required', 'required');\n  thldBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage,\n            'Please provide a valid number (0.01 to 1.00)');\n\n  // Similarity search options\n  mbody.append('div')\n      .classed('option', true)\n      .call(group.simOptionGroup)\n      .on('input', function() {\n        const valid = dialogFormValid(selection);\n        selection.select('.submit').property('disabled', !valid);\n      });\n}\n\n\nfunction updateBody(selection, rdk) {\n  // Similarity measure\n  const measures = [\n    {key: 'gls', name: 'Graph-based local similarity(GLS)'}\n  ];\n  if (rdk) {\n    measures.push({key: 'rdmorgan', name: 'RDKit Morgan similarity'});\n    measures.push({key: 'rdfmcs', name: 'RDKit FMCS'});\n  }\n  selection.select('.measure')\n      .call(lbox.updateSelectBoxOptions, measures)\n      .call(box.updateFormValue, 'gls');\n  selection.select('.thld').call(box.updateFormValue, 0.5);\n  selection.select('.option')\n      .call(group.updateSimOptionValues,\n            {ignoreHs: true, timeout: 2, diameter: 8});\n}\n\n\nfunction dialogFormValid(selection) {\n  const thldValid = box.formValid(selection.select('.thld'));\n  const simOptionValid = group.simOptionValid(selection.select('.option'));\n  return thldValid && simOptionValid;\n}\n\n\nfunction execute(selection, rcds) {\n  const measure = selection.select('.measure');\n  const thld = selection.select('.thld');\n  const params = group.simOptionValues(selection.select('.option'));\n  if (!measure.select('select').property('disabled')) {\n    params.measure = box.formValue(measure);\n  }\n  if (!thld.select('input').property('disabled')) {\n    params.threshold = box.formValue(thld);\n  }\n  const formData = new FormData();\n  // TODO: need updates in flashflood query schema\n  formData.append('params', JSON.stringify(params));\n  formData.append('contents', new Blob([JSON.stringify(rcds)]));\n  return fetcher.post(`${params.measure}net`, formData)\n    .then(fetcher.json);\n}\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module dialog/rename */\n\nimport d3 from 'd3';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'rename-dialog';\nconst title = 'Rename';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-edittext');\n}\n\n\nfunction body(selection) {\n  const renameBox = selection.call(modal.submitDialog, id, title)\n    .select('.modal-body').append('div')\n      .classed('rename', true)\n      .call(box.textBox, 'New name');\n  renameBox.select('.form-control')\n      .attr('required', 'required');\n  renameBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage, 'Please provide a valid name');\n}\n\n\nfunction updateBody(selection, name) {\n  selection.select('.rename')\n      .call(box.updateFormValue, name)\n      .on('input', function () {\n        const valid = box.formValid(d3.select(this));\n        selection.select('.submit').property('disabled', !valid);\n      })\n      .dispatch('input');\n}\n\n\nfunction value(selection) {\n  return box.formValue(selection.select('.rename'));\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module datagridApp */\n\nimport d3 from 'd3';\n\nimport {default as client} from './common/client.js';\nimport {default as fetcher} from './common/fetcher.js';\nimport {default as hfile} from './common/file.js';\nimport {default as idb} from './common/idb.js';\nimport {default as misc} from './common/misc.js';\n\nimport {default as badge} from './component/badge.js';\nimport {default as button} from './component/button.js';\nimport {default as modal} from './component/modal.js';\n\nimport {default as fieldConfigDialog} from './dialog/fieldConfig.js';\nimport {default as fieldFetchDialog} from './dialog/fieldFetch.js';\nimport {default as fieldFileDialog} from './dialog/fieldFile.js';\nimport {default as fieldInputDialog} from './dialog/fieldInput.js';\nimport {default as networkgenDialog} from './dialog/networkgen.js';\nimport {default as renameDialog} from './dialog/rename.js';\n\nimport DatagridState from './datagrid/state.js';\nimport {default as rowf} from './datagrid/rowFilter.js';\nimport {default as sort} from './datagrid/sort.js';\nimport {default as dg} from './datagrid/component.js';\n\n\nfunction app(view, coll) {\n  const menubar = d3.select('#menubar')\n      .classed('my-1', true);\n  menubar.selectAll('div,span,a').remove();  // Clean up\n  const dialogs = d3.select('#dialogs');\n  dialogs.selectAll('div').remove();  // Clean up\n\n  const state = new DatagridState(view, coll);\n\n  // Datagrid view control\n  const menu = menubar.append('div')\n      .call(button.dropdownMenuButton, 'Menu', 'primary', 'table-white')\n      .select('.dropdown-menu');\n  menu.append('a').call(fieldConfigDialog.menuLink);\n  menu.append('a')\n      .classed('online-command', true)\n      .call(fieldFetchDialog.menuLink);\n  menu.append('a').call(fieldFileDialog.menuLink);\n  menu.append('a').call(fieldInputDialog.menuLink);\n  menu.append('a')\n      .call(button.dropdownMenuItem, 'Generate tile view', 'menu-tiles')\n      .on('click', function () {\n        d3.select('#menubar .loading-circle').style('display', 'inline-block');\n        const viewID = misc.uuidv4().slice(0, 8);\n        return idb.appendView(state.instance, state.viewID, {\n          $schema: \"https://mojaie.github.io/kiwiii/specs/tile_v1.0.json\",\n          viewID: viewID,\n          name: `${state.name}_tiles`,\n          viewType: 'tile',\n          items: state.rows.collectionID,\n          rowCount: 5,\n          columnCount: 5,\n          tileContent: {field: 'structure', visible: true}\n        }).then(() => {\n          d3.select('#menubar .loading-circle').style('display', 'none');\n          window.open(\n            `tile.html?instance=${state.instance}&view=${viewID}`, '_blank');\n        });\n      });\n  menu.append('a')\n      .classed('online-command', true)\n      .call(networkgenDialog.menuLink);\n  menu.append('a').call(renameDialog.menuLink);\n  menu.append('a')\n      .call(button.dropdownMenuItem, 'Save', 'menu-save')\n      .on('click', function () {\n        return state.save()\n          .then(() => menubar.select('.notify-saved').call(badge.notify));\n      });\n  menu.append('a')\n      .classed('online-command', true)\n      .call(button.dropdownMenuItem, 'Download Excel', 'menu-exportexcel')\n      .on('click', () => {\n        d3.select('#menubar .loading-circle').style('display', 'inline-block');\n        const coll = state.rows.export();\n        const formData = new FormData();\n        formData.append('contents', new Blob([JSON.stringify(coll)]));\n        return fetcher.post('xlsx', formData)\n          .then(fetcher.blob)\n          .then(blob => {\n            d3.select('#menubar .loading-circle').style('display', 'none');\n            hfile.downloadDataFile(blob, `${state.name}.xlsx`);\n          });\n      });\n\n  // Dashboard link\n  menubar.append('a')\n      .call(button.menuButtonLink, 'Dashboard',\n            'outline-secondary', 'status-gray')\n      .attr('href', 'dashboard.html')\n      .attr('target', '_blank');\n\n  // Fetch control\n  menubar.append('a')\n      .classed('refresh', true)\n      .call(button.menuButtonLink,\n            'Refresh', 'outline-secondary', 'refresh-gray')\n      .on('click', function () {\n        d3.select('#menubar .loading-circle').style('display', 'inline-block');\n        return state.rows.pull().then(() => {\n          state.updateContentsNotifier();\n          return updateApp(state);\n        });\n      });\n  menubar.append('a')\n      .classed('abort', true)\n      .call(button.menuButtonLink,\n            'Abort server job', 'warning', 'delete-gray')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', '#abort-dialog');\n\n  // Status\n  menubar.append('span')\n      .classed('loading-circle', true)\n      .call(badge.loadingCircle);\n  menubar.append('span')\n      .classed('notify-saved', true)\n      .call(badge.alert)\n      .call(badge.updateAlert, 'State saved', 'success', 'check-green')\n      .style('display', 'none');\n  menubar.append('span')\n      .classed('name', true);\n  menubar.append('span')\n      .classed('rows-count', true)\n      .call(badge.badge);\n  menubar.append('span')\n      .classed('fetch-status', true)\n      .call(badge.badge);\n  menubar.append('span')\n      .classed('exec-time', true)\n      .call(badge.badge);\n\n  // Dialogs\n  dialogs.append('div')\n      .classed('fieldconfd', true)\n      .call(fieldConfigDialog.body);\n  dialogs.append('div')\n      .classed('fieldfetchd', true)\n      .call(fieldFetchDialog.body);\n  dialogs.append('div')\n      .classed('fieldfiled', true)\n      .call(fieldFileDialog.body);\n  dialogs.append('div')\n      .classed('fieldinputd', true)\n      .call(fieldInputDialog.body);\n  dialogs.append('div')\n      .classed('netgend', true)\n      .call(networkgenDialog.body);\n  dialogs.append('div')\n      .classed('renamed', true)\n      .call(renameDialog.body);\n  dialogs.append('div')\n      .classed('abortd', true)\n      .call(modal.confirmDialog, 'abort-dialog');\n\n  // Contents\n  d3.select('#dg-search')\n      .call(rowf.setFilter, state);\n  d3.select('#datagrid')\n      .call(sort.setSort, state)\n      .call(dg.datagrid, state);\n\n  // Resize window\n  window.onresize = () => {\n    d3.select('#datagrid').call(dg.resize, state)\n      .call(dg.updateViewport, state, state.viewportTop);\n  };\n\n  state.updateContentsNotifier();\n  return updateApp(state);\n}\n\n\nfunction updateApp(state) {\n  // Title\n  d3.select('title').text(state.name);\n\n  // hide fetch commands\n  d3.select('#menubar').selectAll('.refresh, .abort')\n    .style('display', state.rows.ongoing() ? null : 'none');\n\n  // Status\n  d3.select('#menubar .name').text(state.name);\n\n  const onLoading = d3.select('#menubar .loading-circle');\n  const colors = {\n    done: 'green', running: 'darkorange',\n    ready: 'cornflowerblue', queued: 'cornflowerblue',\n    interrupted: 'salmon', aborted: 'salmon', failure: 'salmon'\n  };\n  const icons = {\n    done: 'check-green', running: 'running-darkorange',\n    ready: 'clock-cornflowerblue', queued: 'clock-cornflowerblue',\n    interrupted: 'caution-salmon', aborted: 'caution-salmon',\n    failure: 'caution-salmon'\n  };\n  const fstatus = state.rows.status();\n  const fstext = fstatus === 'done' ?\n    fstatus : `${fstatus} ${state.rows.progress()}%`;\n  d3.select('#menubar .rows-count')\n      .call(badge.updateBadge, `${state.rows.size()} rows`,\n            'light', 'table-gray')\n    .select('.text')\n      .style('color', 'gray');\n  d3.select('#menubar .fetch-status')\n      .call(badge.updateBadge, fstext, 'light', icons[fstatus])\n    .select('.text')\n      .style('color', colors[fstatus]);\n  d3.select('#menubar .exec-time')\n      .call(badge.updateBadge, `${state.rows.execTime()} seconds`,\n            'light', 'clock-cornflowerblue')\n    .select('.text')\n      .style('color', 'cornflowerblue');\n\n\n  // Dialogs\n  const dialogs = d3.select('#dialogs');\n\n  // Field config dialog\n  dialogs.select('.fieldconfd')\n      .call(fieldConfigDialog.updateBody, state.rows.fields)\n      .on('submit', function () {\n        const values = fieldConfigDialog.value(d3.select(this));\n        state.updateFields(values);\n        state.updateContentsNotifier();\n        return updateApp(state);\n      });\n\n  // Import fields dialog\n  dialogs.select('.fieldfiled')\n      .call(fieldFileDialog.updateBody, state.visibleFields)\n      .on('submit', function () {\n        return fieldFileDialog.readFile(d3.select(this))\n          .then(data => {\n            state.joinFields(data);\n            state.updateContentsNotifier();\n            return updateApp(state);\n          });\n      });\n\n  // Input field dialog\n  dialogs.select('.fieldinputd')\n      .call(fieldInputDialog.updateBody, state.rows.fields)\n      .on('submit', function () {\n        const values = fieldInputDialog.value(d3.select(this));\n        state.rows.addField(values.field);\n        state.rows.apply(rcd => {\n          rcd[values.field.key] = values.converter(rcd);\n        });\n        state.updateContentsNotifier();\n        return updateApp(state);\n      });\n  // Rename dialog\n  dialogs.select('.renamed')\n      .call(renameDialog.updateBody, state.name)\n      .on('submit', function () {\n        state.name = renameDialog.value(d3.select(this));\n        return updateApp(state);\n  });\n\n\n  // Server bound tasks\n  return fetcher.serverStatus().then(response => {\n    // Fetch db fields dialog\n    dialogs.select('.fieldfetchd')\n        .call(fieldFetchDialog.updateBody, response.schema, state.rows.fields)\n        .on('submit', function () {\n          const compounds = state.rows.records().map(e => e.compound_id);\n          return fieldFetchDialog\n            .execute(d3.select(this), compounds, response.schema)\n            .then(res => {\n              state.joinFields(res);\n              state.updateContentsNotifier();\n              return updateApp(state);\n            });\n        });\n\n    // Network generation dialog\n    dialogs.select('.netgend')\n        .call(networkgenDialog.updateBody, response.server.rdkit)\n        .on('submit', function () {\n          return networkgenDialog\n            .execute(d3.select(this), state.rows.records())\n            .then(data => {\n              return idb.newNetwork(\n                state.instance, state.rows.collectionID, state.name, data\n              );\n            })\n            .then(viewID => {\n              onLoading.style('display', 'none');\n              window.open(\n                `network.html?instance=${state.instance}&view=${viewID}`, '_blank');\n            });\n        });\n\n    // Abort dialog\n    dialogs.select('.abortd')\n        .call(modal.updateConfirmDialog,\n              'Are you sure you want to abort this calculation job?')\n        .on('submit', function () {\n          return state.rows.abort().then(() => {\n            state.updateContentsNotifier();\n            return updateApp(state);\n          });\n        });\n  })\n  .catch(() => {\n    // disable on-line commands\n    d3.select('#menubar').selectAll('.online-command')\n      .attr('data-target', null)\n      .classed('disabled', true)\n      .on('click', null);\n  })\n  .finally(() => {\n    onLoading.style('display', 'none');\n  });\n}\n\nfunction run() {\n  const err = client.compatibility();\n  if (err) {\n    d3.select('body')\n      .style('color', '#ff0000')\n      .text(err);\n    return;\n  }\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";  // TODO\n  const offLine = 'onLine' in navigator && !navigator.onLine;  // TODO\n  client.registerServiceWorker();\n  const instance = client.URLQuery().instance || null;\n  const viewID = client.URLQuery().view || null;\n  return idb.getView(instance, viewID)\n    .then(view => {\n      if (!view) throw('ERROR: invalid URL');\n      view.instance = instance;\n      return idb.getCollection(instance, view.rows)\n        .then(coll => {\n          coll.instance = instance;\n          app(view, coll);\n        });\n    })\n    .catch(err => {\n      console.error(err);\n      d3.select('#datagrid')\n        .style('color', 'red')\n        .text(err);\n    });\n}\n\n\nexport default {\n  run\n};\n"],"names":["URLQuery","pairs","window","location","search","substring","split","map","e","_","fromPairs","compatibility","indexedDB","registerServiceWorker","navigator","isDebugBuild","console","info","addEventListener","serviceWorker","register","registerCtrlCommand","key","callback","document","event","ctrlKey","baseURL","get","url","query","q","Object","keys","length","JSON","stringify","fetch","credentials","then","res","status","Promise","reject","Error","statusText","resolve","json","response","text","blob","post","formdata","method","body","error","err","serverStatus","server","schema","batchRequest","reqs","interval","ress","req","i","setTimeout","all","readFile","file","sizeLimit","reader","FileReader","truncated","slice","onload","target","result","onerror","readAsArrayBuffer","readAsText","parseJSON","data","compressed","pako","inflate","to","parse","downloadDataFile","name","URL","createObjectURL","Blob","a","createElement","download","href","dispatchEvent","MouseEvent","view","bubbles","cancelable","loadJSON","endsWith","fetchJSON","decoded","decodeURIComponent","arrayBuffer","downloadJSON","compress","str","gzip","sortType","fmt","includes","formatNum","value","d3format","undefined","Number","isNaN","parseFloat","d3","format","partialMatch","toString","toUpperCase","indexOf","uuidv4","replace","c","r","Math","random","statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","fields","columns","sort","id","dataType","schemaVersion","revision","records","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v10_nodes","reference","convertNetwork","edges","hasOwnProperty","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","column","domain","range","unknown","size","visible","nodeContent","structure","label","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","forEach","index","_structure","_index","source","v08_graph","nodeContentVisible","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","$schema","convertPackage","specs","now","Date","isNW","v08_nodes","width","height","convertTable","views","dataset","push","collectionID","contents","workflowID","workflow","viewID","viewType","rows","sortOrder","filterText","checkpoints","type","date","description","networkThresholdCutoff","filter","minConnThld","currentConnThld","edgeColor","color","edgeLabelColor","connect","version","createObj","request","open","onsuccess","this","onupgradeneeded","currentTarget","instance","pkgs","db","createObjectStore","keyPath","assets","clear","dbid","transaction","objectStore","getAllItems","openCursor","cursor","continue","getItem","putItem","put","updateItem","updater","obj","upd","clearAll","deleteItem","delete","getView","pkg","appendView","viewObj","item","pos","findIndex","splice","updateView","isFunction","deleteView","bin","entries","entry","getAllCollections","items","flatten","coll","getCollection","collID","addCollection","collObj","updateCollection","importItem","legacy","misc","sessionStarted","newDatagrid","toLocaleString","timeZone","addDatagrid","add384Tiles","rowCount","columnCount","chunksPerRow","newNetwork","nodesName","edgesID","getAsset","putAsset","content","assetBaseURL","iconBaseURL","badge","selection","classed","append","style","updateBadge","icon","select","attr","notify","transition","duration","ease","easeLinear","delay","on","loadingCircle","alert","updateAlert","invalidFeedback","updateInvalidMessage","msg","buttonBox","menuButton","menuButtonLink","menuModalLink","dropdownMenuButton","button","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","node","click","dropdownMenuFileValue","files","dialogBase","confirmDialog","base","call","footer","dispatch","updateConfirmDialog","message","submitDialog","title","header","html","$","modal","colorScales","colors","schemePaired","concat","schemeSet2","schemePastel2","schemeSet3","types","func","scaleLinear","scaleLog","scaleQuantize","scaleOrdinal","scaleFunction","state","cscale","mid","scaleFunc","clamp","d","isD3Format","notation","singleToMulti","mapping","newMapping","m","mappingToTable","mp","rcd","f","tableToMapping","table","ignore","row","csvToMapping","csvString","lines","shift","headerIdx","h","line","values","k","Array","apply","fd","uniqBy","Collection","[object Object]","autoIndex","addField","fs","mapper","command","fetcher","idb","sum","some","min","updateHeader","selectAll","remove","visibleFields","enter","headerCellRenderer","updateRows","recordsToShow","keyFunc","exit","merge","rowHeight","each","rowIndex","viewportTop","rowPos","rowFactory","updateViewport","scrollPos","bodyHeight","setScrollPosition","scrollTop","resize","viewport","getBoundingClientRect","top","resizeViewport","innerHeight","viewportHeight","datagrid","floor","previousViewportTop","updateContentsNotifier","applyHeader","applyData","updateFilterNotifier","setFilterText","plotCell","record","vega","View","initialize","run","plotThumbnail","vegaSpec","toImageURL","binaryToDataURI","binary","readAsDataURL","d3Format","d3_format","compoundID","image","checkbox","property","disabled","checked","textField","asyncImage","asyncHtml","txt","cellFunc","numeric","raw","compound_id","assay_id","list","plot","img","text_field","control","svg","async_image","async_html","rowCell","cell","DatagridState","sortedRecords","filteredRecords","defaultColumnHeight","none","scrollBarSpace","numViewportRows","viewportBottom","fixedViewportHeight","component","factory","position","ceil","setViewportSize","setNumViewportRows","widthfSum","reduce","widthf","assign","b","applyOrder","order","orderBy","orders","applyFilter","ki","updateFields","joinFields","ci","export","vi","formValue","formValid","checkValidity","setValidity","valid","textareaValid","test","fileInputBox","fileInputValid","updateFormValue","textBox","readonlyBox","updateReadonlyValue","readonlyValue","textareaBox","placeholder","textareaBoxLines","numberBox","updateNumberRange","max","step","checkBox","box","updateCheckBox","checkBoxValue","colorBox","stopPropagation","clearFileInput","fileInputValue","setFilter","searchBox","setSort","isAsc","setSortOrder","datum","filterTable","rowf","filterSortTable","update","updateRecords","tableRecords","extra","options","menuLink","dialog","updateBody","dgfields","d3fValid","every","n","assays","resources","flatMap","assay","value_types","copy","value_type","done","__origin","check","check_d","anyChecked","execute","compounds","targets","queries","condition","merged","monocolorBar","group","colorBar","monocolor","bicolor","grad","tricolor","categorical","sw","custom","setSize","checklistValues","setChecklistValidity","setSelectedColorScale","selected","shape","selectBox","updateSelectBoxOptions","selectedRecord","checklistBox","updateChecklistItems","listitems","form","checkRequired","updateChecklistValues","colorScaleBox","dropdown","colorScaleBoxItems","updateColorScaleBox","colorScaleBoxValue","colorScaleBoxItem","mbody","hfile","pop","tbl","lbox","leftFields","leftDefault","left","isCsv","plotCols","ps","p","himg","dropdownFormGroup","formatterGen","template","tmp","parseInner","arr","inner","match","outer","ic","oc","txtarr","join","keyNoDup","dialogFormValid","isTmp","keyv","noDup","tmpFields","contv","validKey","ns","validFormat","contentsValid","collapse","invmsg","typeField","cont","converter","queryMolValues","textquery","areaquery","queryMolGroup","queryBox","ctabBox","popover","trigger","updateQueryMolResources","updateQueryMolValues","queryMolValid","textValid","ctabValid","simOptionGroup","timeoutBox","diamBox","updateSimOptionValues","ignoreHs","timeout","diameter","simOptionValues","diam","simOptionValid","timeoutValid","diamValid","thldValid","thldBox","rdk","measures","rcds","measure","thld","formData","FormData","renameBox","updateApp","ongoing","onLoading","fstatus","fstext","running","ready","queued","interrupted","aborted","failure","dialogs","fieldConfigDialog","fieldFileDialog","fieldInputDialog","renameDialog","fieldFetchDialog","networkgenDialog","rdkit","abort","catch","finally","client","protocol","onLine","menubar","menu","tileContent","save","pull","dg","onresize","app"],"mappings":"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"}