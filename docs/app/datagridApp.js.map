{"version":3,"file":"datagridApp.js","sources":["../../src/common/client.js","../../src/common/fetcher.js","../../src/common/file.js","../../src/common/misc.js","../../src/common/legacySchema.js","../../src/common/idb.js","../../src/component/button.js","../../src/component/modal.js","../../src/common/mapper.js","../../src/common/collection.js","../../src/datagrid/component.js","../../src/common/image.js","../../src/datagrid/rowFactory.js","../../src/datagrid/state.js","../../src/component/formBox.js","../../src/datagrid/rowFilter.js","../../src/datagrid/sort.js","../../src/datagrid/table.js","../../src/dialog/fieldConfig.js","../../src/dialog/fieldFetch.js","../../src/component/shape.js","../../src/component/formListBox.js","../../src/dialog/fieldFile.js","../../src/dialog/fieldInput.js","../../src/dialog/formGroup.js","../../src/dialog/networkgen.js","../../src/dialog/rename.js","../../src/datagridApp.js"],"sourcesContent":["\n/** @module common/client */\n\nimport _ from 'lodash';\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\nfunction compatibility() {\n  try {\n    () => {};\n  } catch (err) {\n    return 'Client compatibility error: Arrow function not supported';\n  }\n  try {\n    FormData;\n  } catch (err) {\n    return 'Client compatibility error: FormData not supported';\n  }\n  try {\n    fetch;\n  } catch (err) {\n    return 'Client compatibility error: fetch API not supported';\n  }\n}\n\n\nfunction registerServiceWorker() {\n  if ('serviceWorker' in navigator) {\n    window.addEventListener('load', () => {\n      navigator.serviceWorker.register('../sw.js');  // TODO: root path option\n    });\n  } else {\n    console.info('Service worker is not supported');\n  }\n}\n\nexport default {\n  URLQuery, compatibility, registerServiceWorker\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '../req/';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\nfunction serverStatus() {\n  const response = {};\n  return get('server')\n    .then(json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => get('schema'))\n    .then(json)\n    .then(res => {\n      response.schema = res;\n    })\n    .then(() => response);\n}\n\n\nexport default {\n  get, json, text, blob, post, error, serverStatus\n};\n","\n/** @module common/file */\n\nimport pako from 'pako';\n\n\nfunction readFile(file, sizeLimit, blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    const truncated = sizeLimit ? file.slice(0, sizeLimit) : file;\n    reader.onload = event => resolve(event.target.result);\n    reader.onerror = error => reject(error);\n    if (blob) {\n      reader.readAsArrayBuffer(truncated);\n    } else {\n      reader.readAsText(truncated);\n    }\n  });\n}\n\n\nfunction parseJSON(data, compressed) {\n  const text = compressed ? pako.inflate(data, {to: 'string'}) : data;\n  return JSON.parse(text);\n}\n\n\nfunction loadJSON(file) {\n  const compressed = file.name.endsWith('c') || file.name.endsWith('.gz');\n  return readFile(file, false, compressed)\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction fetchJSON(url) {\n  const decoded = decodeURIComponent(url);\n  const compressed = decoded.endsWith('c') || decoded.endsWith('.gz');\n  return fetch(decoded)\n    .then(res => compressed ? res.arrayBuffer() : res.json())\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction downloadDataFile(data, name) {\n  try {\n    // cannot hundle large file with dataURI scheme\n    // url = 'data:application/json,' + encodeURIComponent(JSON.stringify(json))\n    const url = window.URL.createObjectURL(new Blob([data]));\n    const a = document.createElement('a');\n    a.download = name;\n    a.href = url;\n    // a.click() does not work on firefox\n    a.dispatchEvent(new MouseEvent('click', {\n      'view': window,\n      'bubbles': true,\n      'cancelable': false\n    }));\n    // window.URL.revokeObjectURL(url) does not work on firefox\n  } catch (e) {\n    // no DOM (unit testing)\n  }\n}\n\n\nfunction downloadJSON(json, name, compress=true) {\n  const str = JSON.stringify(json);\n  const data = compress ? pako.gzip(str) : str;\n  const ext = `.ap${compress ? 'c' : 'r'}`;\n  downloadDataFile(data, `${name}${ext}`);\n}\n\n\nexport default {\n  readFile, parseJSON, loadJSON, fetchJSON,\n  downloadDataFile, downloadJSON\n};\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\n\n\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  sortType, formatNum, partialMatch, uuidv4\n};\n","\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: [\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ],\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nfunction convertPackage(json) {\n  if (json.hasOwnProperty('views')) return json;\n  const now = new Date();\n  const isNW = json.hasOwnProperty('edges');\n  const data = isNW ? convertNetwork(json) : convertTable(json);\n  const nodes = isNW ? data.nodes : data;\n  const specs = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    name: data.edges.name,\n    views: [],\n    dataset: []\n  };\n  specs.dataset.push({\n    $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n    collectionID: nodes.id,\n    name: nodes.name,\n    contents: [{\n      $schema: nodes.$schema,\n      workflowID: nodes.reference.workflow,\n      name: nodes.name,\n      fields: nodes.fields,\n      records: nodes.records,\n      created: nodes.created,\n      status: nodes.status,\n      query: nodes.query,\n      execTime: nodes.execTime,\n      progress: nodes.progress\n    }]\n  });\n  specs.views.push({\n    $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n    viewID: nodes.id,\n    name: nodes.name,\n    viewType: \"datagrid\",\n    rows: nodes.id,\n    fields: nodes.fields,\n    sortOrder: null,\n    filterText: null,\n    checkpoints: [{\n      type: 'convert',\n      date: now.toString(),\n      description: 'converted from legacy format'\n    }]\n  });\n  if (isNW) {\n    specs.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: data.edges.id,\n      name: data.edges.name,\n      contents: [{\n        $schema: data.edges.$schema,\n        workflowID: data.edges.reference.workflow,\n        name: data.edges.name,\n        fields: data.edges.fields,\n        records: data.edges.records,\n        created: data.edges.created,\n        status: data.edges.status,\n        query: data.edges.query,\n        execTime: data.edges.execTime,\n        progress: data.edges.progress\n      }]\n    });\n    specs.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: data.edges.id,\n      name: data.edges.name,\n      viewType: \"network\",\n      nodes: nodes.id,\n      edges: data.edges.id,\n      nodeColor: data.edges.snapshot.nodeColor,\n      nodeSize: data.edges.snapshot.nodeSize,\n      nodeLabel: data.edges.snapshot.nodeLabel,\n      nodeLabelColor: data.edges.snapshot.nodeLabelColor,\n      edgeWidth: data.edges.snapshot.edgeWidth,\n      edgeLabel: data.edges.snapshot.edgeLabel,\n      networkThreshold: data.edges.snapshot.networkThreshold,\n      networkThresholdCutoff: data.edges.snapshot.networkThresholdCutoff,\n      fieldTransform: data.edges.snapshot.fieldTransform,\n      coords: data.edges.snapshot.coords,\n      checkpoints: [{\n        type: 'convert',\n        date: now.toString(),\n        description: 'converted from legacy format'\n      }]\n    });\n  }\n  specs.views.filter(e => e.viewType === 'network')\n    .forEach(view => {\n      view.minConnThld = view.networkThresholdCutoff;\n      view.currentConnThld = view.networkThreshold;\n      if (view.hasOwnProperty('nodeLabel')) {\n        view.nodeLabel.field = view.nodeLabel.text;\n      }\n      if (view.hasOwnProperty('edgeLabel')) {\n        view.edgeLabel.field = 'weight';\n      }\n      if (view.hasOwnProperty('edgeWidth')) {\n        view.edgeWidth.field = 'weight';\n      }\n    });\n  return specs;\n}\n\n\nexport default {\n  convertPackage\n};\n","\n/** @module common/idb */\n\nimport _ from 'lodash';\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\nimport {default as legacy} from './legacySchema.js';\n\n// TODO: need package, view and dataset tables?\nconst schema = {\n  items: 'storeID, sessionStarted'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('sessionStarted')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction importItem(data) {\n  // Legacy format converter\n  if (!data.hasOwnProperty('views')) {\n    data = legacy.convertPackage(data);\n  }\n  const now = new Date();\n  data.storeID = misc.uuidv4().slice(0, 8);\n  data.sessionStarted = now.toString();\n  return idb.items.put(data);\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} response - response data\n * @return {string} - viewID if sucessfully added\n */\nfunction newDatagrid(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const storeID = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    storeID: storeID,\n    name: viewID,  // TODO: generate from response.query\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n        viewID: viewID,\n        name: viewID,  // TODO: generate from response.query\n        viewType: \"datagrid\",\n        rows: collectionID,\n        checkpoints: [\n          {type: 'creation', date: date}\n        ]\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return idb.items.put(data)\n    .then(() => ({storeID: storeID, viewID:viewID}));\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Returns a view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @return {array} view objects\n */\nfunction getView(storeID, viewID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).views)\n    .then(views => {\n      const view = views.find(e => e.viewID === viewID);\n      if (!view) return;\n      view.storeID = storeID;\n      return view;\n    });\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object\n */\nfunction appendView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos + 1, 0, viewObj);\n  });\n}\n\n\n/**\n * Update view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object or update function\n */\nfunction updateView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    if (_.isFunction(viewObj)) {\n      viewObj(item.views[pos]);\n    } else {\n      item.views[pos] = viewObj;\n    }\n  });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteView(storeID, viewID) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos, 1);\n    // prune orphaned collections\n    const bin = {};\n    item.dataset.forEach(e => { bin[e.collectionID] = 0; });\n    item.views.forEach(view => {\n      ['rows', 'items', 'nodes', 'edges']\n        .filter(e => view.hasOwnProperty(e))\n        .forEach(e => { bin[view[e]] += 1; });\n    });\n    Object.entries(bin).forEach(entry => {\n      if (!entry[1]) {\n        const i = item.dataset.findIndex(e => e.collectionID === entry[0]);\n        item.dataset.splice(i, 1);\n      }\n    });\n  });\n}\n\n\n/**\n * Returns a collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @return {array} Collection objects\n */\nfunction getCollection(storeID, collID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).dataset)\n    .then(colls => {\n      const coll = colls.find(e => e.collectionID === collID);\n      if (!coll) return;\n      coll.storeID = storeID;\n      return coll;\n    });\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object\n */\nfunction appendCollection(storeID, collID, collObj) {\n  return updateItem(storeID, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    item.dataset.splice(pos + 1, 0, collObj);\n  });\n}\n\n\n/**\n * Update collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object or update function\n */\nfunction updateCollection(storeID, collID, collObj) {\n  return updateItem(storeID, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    if (_.isFunction(collObj)) {\n      collObj(item.dataset[pos]);\n    } else {\n      item.dataset[pos] = collObj;\n    }\n  });\n}\n\n\nexport default {\n  reset, getAllItems, getItem, importItem, newDatagrid, updateItem, deleteItem,\n  getView, appendView, updateView, deleteView,\n  getCollection, appendCollection, updateCollection\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction buttonBox(selection, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .text(label);\n}\n\n\nfunction menuButton(selection, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, target, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('label', true)\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, label, type, icon) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  const button = selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  button.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  button.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, label, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, label, target, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, label, accept, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      });\n  selection.append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  iconBaseURL, buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module component/modal */\n\nimport d3 from 'd3';\n\n\nfunction dialogBase(selection, id) {\n  selection\n      .classed('modal', true)\n      .attr('tabindex', -1)\n      .attr('role', 'dialog')\n      .attr('aria-labelledby', '')\n      .attr('aria-hidden', true)\n      .attr('id', id);\n  selection.append('div')\n      .classed('modal-dialog', true)\n      .attr('role', 'document')\n    .append('div')\n      .classed('modal-content', true);\n}\n\n\nfunction confirmDialog(selection, id) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // body\n  base.append('div')\n      .classed('modal-body', true)\n    .append('div')\n      .classed('message', true);\n  // footer\n  const footer = base.append('div')\n      .classed('modal-footer', true);\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-outline-secondary', true)\n      .classed('cancel', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Cancel');\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-warning', true)\n      .classed('ok', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('OK')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nfunction updateConfirmDialog(selection, message) {\n  selection.select('.message').text(message);\n}\n\n\nfunction submitDialog(selection, id, title) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // header\n  const header = base.append('div')\n      .classed('modal-header', true);\n  header.append('h4')\n      .classed('modal-title', true)\n      .text(title);\n  header.append('button')\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('aria-label', 'Close')\n      .classed('close', true)\n    .append('span')\n      .attr('aria-hidden', true)\n      .html('&times;');\n  // body\n  base.append('div')\n      .classed('modal-body', true);\n  // footer\n  base.append('div')\n      .classed('modal-footer', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-primary', true)\n      .classed('submit', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('Submit')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nexport default {\n  confirmDialog, updateConfirmDialog, submitDialog\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: [keyField].concat(mp.fields),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: table.fields.filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key)),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: fields,\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(mp.fields)\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/collection */\n\nimport _ from 'lodash';\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as mapper} from './mapper.js';\n\n\nexport default class Collection {\n  /**\n   * Create Collection from a flashflood response datatable\n   * If data is not specified, put datatables later by this.append(data)\n   * @param {object} coll - Collection or response object\n   */\n  constructor(coll) {\n    // Settings\n    this.autoIndex = 'index';  // enumerate records\n\n    this.collectionID = coll.collectionID || null;\n    this.storeID = coll.storeID || null;\n    this.name = coll.name || null;\n    this.contents = coll.contents || [coll];\n    this.fields = [];\n    this.contents.forEach(content => {\n      content.fields.forEach(e => this.addField(e));\n    });\n  }\n\n  /**\n   * Add fields\n   * @param {array} fs - list of fields\n   */\n  addField(field) {\n    if (this.fields.find(e => e.key === field.key)) return;\n    if (!field.hasOwnProperty('name')) field.name = field.key;\n    if (!field.hasOwnProperty('visible')) field.visible = true;\n    if (field.hasOwnProperty('d3_format')) field.format = 'd3_format';\n    if (!field.hasOwnProperty('format')) field.format = 'raw';\n    this.fields.push(field);\n  }\n\n  /**\n   * Update fields properties\n   * @param {array} fs - list of fields\n   */\n  updateFields(fs) {\n    this.fields = [];\n    fs.forEach(e => this.addField(e));\n  }\n\n  /**\n   * Join fields\n   * @param {object} mapping - column mapper object\n   */\n  joinFields(mapping) {\n    this.contents.forEach(c => {\n      mapper.apply(c, mapping);\n    });\n    if (mapping.hasOwnProperty('fields')) {\n      mapping.fields.forEach(e => this.addField(e));\n    } else {\n      this.addField(mapping.field);\n    }\n  }\n\n  /**\n   * Return all records of the collection\n   * @return {array} records\n   */\n  records() {\n    return _.flatten(this.contents.map(e => e.records));\n  }\n\n  fetch(command) {\n    const fs = this.contents\n      .filter(e => ['running', 'ready', 'interrupted', 'queued'].includes(e.status))\n      .map(content => {\n        const query = {id: content.workflowID, command: command};\n        return fetcher.get('progress', query)\n          .then(fetcher.json)\n          .then(data => {\n            return idb.updateCollection(this.storeID, this.collectionID, coll => {\n              const i = coll.contents\n                .findIndex(e => e.workflowID === query.id);\n              if (data.status === 'failure') {  // No data found on server\n                coll.contents[i].status = 'failure';\n              } else {\n                coll.contents[i] = data;\n              }\n            });\n          });\n      });\n    return Promise.all(fs)\n      .then(() => idb.getCollection(this.storeID, this.collectionID))\n      .then(coll => {\n        this.contents = coll.contents;\n      });\n  }\n\n  /**\n   * Retrieve workflows and store it into a local store.\n   * @return {Promise}\n   */\n  pull() {\n    return this.fetch('pull');\n  }\n\n  /**\n   * Retrieve workflows, abort all ongoing workflow task\n   * and store it into a local store.\n   * @return {Promise}\n   */\n  abort() {\n    return this.fetch('abort');\n  }\n\n  /**\n   * Return total number of records\n   * @return {float} total number of records\n   */\n  size() {\n    return _.sum(this.contents.map(e => e.records.length));\n  }\n\n  /**\n   * Return status\n   * @return {string} status\n   */\n  status() {\n    if (this.contents.some(e => e.status === 'interrupted')) return 'interrupted';\n    if (this.contents.some(e => e.status === 'running')) return 'running';\n    if (this.contents.some(e => e.status === 'queued')) return 'queued';\n    if (this.contents.some(e => e.status === 'ready')) return 'ready';\n    if (this.contents.some(e => e.status === 'aborted')) return 'aborted';\n    if (this.contents.some(e => e.status === 'failure')) return 'failure';\n    return 'done';\n  }\n\n  /**\n   * Return ongoing or not\n   * @return {bool} ongoing or not\n   */\n  ongoing() {\n    const s = ['ready', 'queued', 'running', 'interrupted'];\n    return s.includes(this.status());\n  }\n\n  /**\n   * Return percentage of workflow progress\n   * @return {float} progress in percent\n   */\n  progress() {\n    return _.min(this.contents.map(e => e.progress));\n  }\n\n  /**\n   * Return total execution time\n   * @return {float} total time\n   */\n  execTime() {\n    return _.sum(this.contents.map(e => e.execTime));\n  }\n\n  /**\n   * Export collection object as JSON\n   * @return {object} collection JSON\n   */\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: this.collectionID,\n      name: this.name,\n      fields: this.fields,\n      contents: this.contents\n    };\n  }\n}\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction headerCellRenderer(header) {\n  header.style('display', 'inline-block')\n    .style('width', d => `${d.width}%`)\n    .text(d => d.name);\n}\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .call(state.headerCellRenderer);\n}\n\n\nfunction updateRows(selection, state) {\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.selectAll('.dg-cell').remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', 'absolute')\n      .style('width', '100%')\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0)\n          .call(state.rowFactory(), d);\n      });\n}\n\n\nfunction updateViewport(selection, state, scrollPos) {\n  selection.select('.dg-body').style('height', `${state.bodyHeight}px`);\n  state.setScrollPosition(scrollPos);\n  selection.call(updateRows, state, scrollPos);\n  selection.select('.dg-viewport').node().scrollTop = scrollPos * state.rowHeight;\n}\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.resizeViewport(window.innerHeight - viewportTop - 5);\n  viewport.style('height', `${state.viewportHeight}px`);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(updateRows, state, pos);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyHeader();\n    selection.call(updateHeader, state);\n    selection.call(resize, state);\n    state.applyData();\n    selection.call(updateViewport, state, state.viewportTop);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    selection.call(updateViewport, state, 0);\n  };\n  state.updateContentsNotifier();  // TODO: remove\n}\n\n\n\nexport default {\n  headerCellRenderer, updateHeader, updateRows, updateViewport,\n  resize, datagrid\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nfunction binaryToDataURI(binary) {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      resolve(event.target.result);\n    };\n    reader.readAsDataURL(binary);\n  });\n}\n\n\nexport default {\n  plotCell, plotThumbnail, binaryToDataURI\n};\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction date(selection, record, field) {\n  // TODO; formatter\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  selection.html(record[field.key]);\n}\n\n\nfunction compound_id(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n}\n\nfunction textField(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'text')\n      .style('width', '90%')\n      .property('value', record[field.key])\n      .on('change', function () {\n        record[field.key] = this.value;\n      });\n}\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  date: date,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compound_id,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  text_field: textField,\n  control: call,\n  svg: html,\n  html: html\n};\n\n\nfunction rowCell(selection) {\n  selection.classed('dg-cell', true)\n    .classed('align-middle', true)\n    .classed('text-truncate', true)\n    .style('display', 'inline-block');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n          .call(rowCell)\n          .style('width', `${field.width}%`);\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compound_id, image, checkbox, textField, call,\n  rowCell, rowFactory\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport Collection from '../common/collection.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as component} from './component.js';\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(view, coll) {\n    this.storeID = view.storeID || null;\n    this.viewID = view.viewID || null;\n    this.name = view.name || null;\n    this.sortOrder = view.sortOrder || [];\n    this.filterText = view.filterText || null;\n    this.rows = new Collection(coll);\n\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    // TODO: auto adjust\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.viewportTop = 0;\n    this.previousViewportTop = null;\n    this.viewportBottom = null;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.headerCellRenderer = component.headerCellRenderer;\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n  }\n\n  /**\n   * Set viewport height and number of rows to show\n   * @param {int} height - viewport height\n   */\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n  }\n\n  /**\n   * Set range of the row indices to show\n   * @param {int} position - Index of the top row to show\n   */\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setNumViewportRows() {\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  resizeViewport(height) {\n    this.setViewportSize(height);\n    this.setNumViewportRows();\n  }\n\n  /**\n   * Apply header data\n   */\n  applyHeader() {\n    this.visibleFields = this.rows.fields.filter(e => e.visible);\n    const widthfSum = this.visibleFields.reduce((a, c) => a + (c.widthf || 1), 0);\n    this.visibleFields = this.visibleFields.map(e => {\n      const field = {\n        width: (e.widthf || 1) / widthfSum * 100,\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b, 0).height;\n  }\n\n  /**\n   * Apply row data\n   * 1. applyHeader: define fields and set rowHeight\n   * 2. resize: measure actual window size and calc viewportHeight\n   * 3. applyData: calc number of rows from rowHeight and viewportHeight\n   * 4. setScrollPosition: calc row index range\n   * 5. recordsToShow: slice rows to show\n   */\n  applyData() {\n    this.setNumViewportRows();\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.rows.records().slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.rows.records().slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  updateFields(fs) {\n    this.rows.updateFields(fs);\n  }\n\n  joinFields(mapping) {\n    this.rows.joinFields(mapping);\n    this.applyData();\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  save() {\n    return idb.updateItem(this.storeID, item => {\n      const ci = item.dataset\n        .findIndex(e => e.collectionID === this.rows.collectionID);\n      item.dataset[ci] = this.rows.export();\n      const vi = item.views.findIndex(e => e.viewID === this.viewID);\n      item.views[vi] = this.export();\n    });\n  }\n\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: this.viewID,\n      name: this.name,\n      viewType: \"datagrid\",\n      rows: this.rows.collectionID,\n      sortOrder: this.sortOrder,\n      filterText: this.filterText\n    };\n  }\n}\n","\n/** @module component/formBox */\n\n\nimport d3 from 'd3';\n\n\nfunction textBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text');\n}\n\nfunction updateTextBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction textBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction readonlyBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .property('readonly', true);\n}\n\n\nfunction textareaBox(selection, label, rows) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows);\n}\n\nfunction updateTextareaBox(selection, value) {\n  selection.select('textarea').property('value', value);\n}\n\nfunction updateTextareaPlaceholder(selection, placeholder) {\n  selection.select('textarea').attr('placeholder', placeholder);\n}\n\nfunction textareaBoxValue(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value;  // TODO: 0 is falsy\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder;\n  return '';\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n').filter(e => e.length > 0);\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder.split('\\n').filter(e => e.length > 0);\n  return [];\n}\n\n\nfunction checkBox(selection, label) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox');\n  box.append('span')\n      .text(label);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, label, min, max, step) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'number')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step);\n}\n\nfunction updateNumberBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction numberFloatValid(selection) {\n  const value = numberBoxFloatValue(selection);\n  const min = parseInt(selection.select('input').attr('min'));\n  const max = parseInt(selection.select('input').attr('max'));\n  const valid = !isNaN(value) && value >= min && value <= max;\n  selection.select('input')\n      .style('background-color', valid ? '#ffffff' : '#ffcccc');\n  return valid;\n}\n\nfunction numberBoxIntValue(selection) {\n  return parseInt(selection.select('input').property('value'));\n}\n\nfunction numberBoxFloatValue(selection) {\n  return parseFloat(selection.select('input').property('value'));\n}\n\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n}\n\n\nfunction updateColorBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\n\nfunction colorBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction fileInputBox(selection, label, accept) {\nselection\n    .classed('form-group', true)\n    .classed('form-row', true);\nselection.append('label')\n    .classed('col-form-label', true)\n    .classed('col-form-label-sm', true)\n    .classed('col-4', true)\n    .text(label);\nselection.append('input')\n    .classed('form-control', true)\n    .classed('form-control-sm', true)\n    .classed('form-control-file', true)\n    .classed('col-8', true)\n    .attr('type', 'file')\n    .attr('accept', accept);\n}\n\nfunction clearFileInput(selection) {\n  // TODO: FileList object (input.files) may be a readonly property\n  const accept = selection.select('input').attr();\n  selection.select('input').remove();\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('form-control-file', true)\n      .classed('col-8', true)\n      .attr('type', 'file')\n      .attr('accept', accept);\n}\n\nfunction fileInputBoxValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\n\nexport default {\n  textBox, updateTextBox, textBoxValue, readonlyBox,\n  textareaBox, updateTextareaBox, updateTextareaPlaceholder,\n  textareaBoxValue, textareaBoxLines,\n  checkBox, updateCheckBox, checkBoxValue,\n  numberBox, updateNumberBox, numberFloatValid,\n  numberBoxIntValue, numberBoxFloatValue,\n  colorBox, updateColorBox, colorBoxValue,\n  fileInputBox, clearFileInput, fileInputBoxValue\n};\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, 'Search');\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.textBoxValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction setSort(selection, state) {\n  state.headerCellRenderer = header => {\n    header.style('display', 'inline-block')\n      .style('width', d => `${d.width}%`)\n      .text(d => d.name)\n      .filter(d => misc.sortType(d.format) !== 'none')\n      .append('span').append('a')\n        .attr('id', d => `sort-${d.key}`)\n        .text('^v')\n        .style('display', 'inline-block')\n        .style('width', '30px')\n        .style('text-align', 'center')\n      .on('click', d => {\n        const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n        d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n        state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n        selection.call(component.updateRows, state);\n      });\n  };\n}\n\n\nexport default {\n  setSort\n};\n","\n/** @module datagrid/table */\n\nimport Collection from '../common/collection.js';\n\nimport DatagridState from './state.js';\nimport {default as component} from './component.js';\nimport {default as rowf} from './rowFilter.js';\nimport {default as sort} from './sort.js';\n\n\nfunction table(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  state.keyFunc = d => d;\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterSortTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(sort.setSort, state)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction update(selection, fields, records) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = selection.datum();\n  state.rows = new Collection(data);\n  state.updateContentsNotifier();\n}\n\n\nfunction updateRecords(selection, records) {\n  const state = selection.datum();\n  state.rows.contents[0].records = records;\n  state.updateContentsNotifier();\n}\n\n\nfunction tableRecords(selection) {\n  const state = selection.datum();\n  return state.rows.records();\n}\n\n\nexport default {\n  table, filterTable, filterSortTable, update, updateRecords, tableRecords\n};\n","\n/** @module dialog/fieldConfig */\n\nimport {default as button} from '../component/button.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\nimport {default as rowf} from '../datagrid/rowFactory.js';\n\n\nconst id = 'fieldconf-dialog';\nconst title = 'Column setting';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-edittable');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[0].width}%`)\n        .text(record.name);\n    selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[1].width}%`)\n      .append('input')\n        .attr('type', 'checkbox')\n        .property('checked', record.visible)\n        .on('click', function () {\n          record.visible = this.checked;\n        });\n    const select = selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[2].width}%`)\n      .append('select');\n    const extra = !fields[2].options.includes(record.format);\n    select.selectAll('option').data(extra ? [record.format] : fields[2].options)\n      .enter().append('option')\n        .attr('value', d => d)\n        .text(d => d);\n    select.property('value', record.format)\n        .property('disabled', extra)\n        .on('change', function () {\n          record.format = this.value;\n          selection.select('.d3f input')\n            .property('disabled', record.format !== 'd3_format');\n        });\n    selection.append('div')\n        .call(rowf.rowCell)\n        .classed('d3f', true)\n        .style('width', `${fields[3].width}%`)\n      .append('input')\n        .attr('type', 'text')\n        .style('width', '90%')\n        .property('value', record.d3_format)\n        .property('disabled', record.format !== 'd3_format')\n        .on('change', function () {\n          record.d3_format = this.value;\n        });\n  };\n}\n\n\nfunction body(selection) {\n  const fields = [\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'visible', name: 'Visible', format: 'checkbox',\n     widthf: 0.5, height: 40},\n    {key: 'format', name: 'Format', format: 'select',\n     options: ['text', 'numeric', 'd3_format', 'raw', 'compound_id'],\n     height: 40},\n    {key: 'd3_format', name: 'D3 format', format: 'text_field',\n     height: 40}\n  ];\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-dialog').classed('modal-lg', true);\n  dialog.select('.modal-body').append('div')\n    .classed('dgfields', true)\n    .call(table.table, fields, [], rowFactory, 300);\n}\n\n\nfunction updateBody(selection, dgfields) {\n  selection.select('.dgfields')\n    .call(table.updateRecords, dgfields);\n}\n\n\nfunction value(selection) {\n  return table.tableRecords(selection.select('.dgfields'));\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module dialog/fieldFetch */\n\nimport _ from 'lodash';\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as mapper} from '../common/mapper.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\n\n\nconst id = 'fieldfetch-dialog';\nconst title = 'Append assays';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addassay');\n}\n\n\nfunction body(selection) {\n  const fields = [\n    {key: 'check', name: 'Check', format: 'checkbox',\n     widthf: 0.5, height: 40, disabled: 'check_d'},\n    {key: 'assay_id', name: 'Assay ID', format: 'assay_id'},\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'value_type', name: 'Value type', format: 'text'},\n    {key: 'tags', name: 'Tags', format: 'list', widthf: 2}\n  ];\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-dialog').classed('modal-lg', true);\n  dialog.select('.modal-body').append('div')\n    .classed('assays', true)\n    .call(table.filterTable, fields, []);\n}\n\n\nfunction updateBody(selection, schema, dgfields) {\n  const assays = _.flatten(\n    schema.resources.filter(e => e.domain === 'assay').map(e => e.data)\n  );\n  const items = _.flatMap(assays, assay => {\n    return assay.value_types.map(e => {\n      const copy = Object.assign({}, assay);\n      copy.value_type = e.key;\n      delete copy.value_types;\n      return copy;\n    });\n  });\n  const done = {};\n  dgfields.filter(e => e.hasOwnProperty('__origin'))\n    .map(e => e.__origin)\n    .forEach(e => {\n      if (!done.hasOwnProperty(e.assay_id)) {\n        done[e.assay_id] = [];\n      }\n      done[e.assay_id].push(e.value_type);\n    });\n  const records = items.map(item => {\n    const d = done.hasOwnProperty(item.assay_id)\n        && done[item.assay_id].includes(item.value_type);\n    item.check = d;\n    item.check_d = d;\n    return item;\n  });\n  selection.select('.assays')\n    .call(table.updateRecords, records)\n    .on('change', function () {  // Validation\n      const anyChecked = table.tableRecords(d3.select(this))\n        .filter(e => e.check && !e.check_d).length;\n      selection.select('.submit').property('disabled', !anyChecked);\n    })\n    .dispatch('change');\n}\n\n\nfunction execute(selection, compounds, schema) {\n  const targets = schema.resources\n    .filter(e => e.domain === 'activity').map(e => e.id);\n  const queries = table.tableRecords(selection.select('.assays'))\n    .filter(e => e.check && !e.check_d)\n    .map(e => {\n      return {\n        workflow: 'activity',\n        targets: targets,\n        assay_id: e.assay_id,\n        condition: {\n          compounds: compounds,\n          value_types: [e.value_type]\n        }\n      };\n    })\n    .map(q => {\n      return fetcher.get(q.workflow, q)\n        .then(fetcher.json);\n    });\n    return Promise.all(queries).then(res => {\n      const merged = res.shift();\n      res.forEach(data => {\n        const mp = mapper.tableToMapping(\n          data, 'compound_id', ['index', 'assay_id']);\n        mapper.apply(merged, mp);\n      });\n      return mapper.tableToMapping(\n        merged, 'compound_id', ['index', 'assay_id']);\n    });\n}\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module component/shape */\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction monocolorBar(selection, colors, text) {\n  selection.attr('viewBox', '0 0 100 10')\n      .attr('preserveAspectRatio', 'none');\n  const group = selection.append('g');\n  group.append('rect')\n      .attr('x', 0).attr('y', 0)\n      .attr('width', 100).attr('height', 10)\n      .attr('fill', colors[0]);\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 10)\n      .attr('font-size', 12)\n      .text(text);\n}\n\nfunction bicolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n      .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n      .attr('offset', 1).attr('stop-color', colors[1]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction tricolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n    .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n    .attr('offset', 0.5).attr('stop-color', colors[1]);\n  grad.append('stop')\n    .attr('offset', 1).attr('stop-color', colors[2]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction categoricalBar(selection, colors, text) {\n  selection.attr('viewBox', '0 0 100 10')\n      .attr('preserveAspectRatio', 'none');\n  const sw = 100 / colors.length;\n  const group = selection.append('g');\n  colors.forEach((e, i) => {\n    group.append('rect')\n        .attr('x', sw * i).attr('y', 0)\n        .attr('width', sw).attr('height', 20)\n        .attr('fill', colors[i]);\n  });\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 20)\n      .attr('font-size', 20)\n      .text(text);\n}\n\nfunction setSize(selection, width, height) {\n  selection.attr('width', width).attr('height', height);\n}\n\n\nconst colorBar = {\n  'monocolor': monocolorBar,\n  'bicolor': bicolorBar,\n  'tricolor': tricolorBar,\n  'categorical': categoricalBar,\n  'custom': monocolorBar\n};\n\n\nexport default {\n  colorBar, setSize\n};\n","\n/** @module component/formListBox */\n\nimport d3 from 'd3';\n\nimport {default as shape} from './shape.js';\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction selectBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('select')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n}\n\nfunction selectBoxItems(selection, items) {\n  const options = selection.select('select')\n    .selectAll('option')\n      .data(items, d => d.key);\n  options.exit().remove();\n  options.enter()\n    .append('option')\n      .attr('value', d => d.key)\n      .text(d => d.name);\n}\n\nfunction updateSelectBox(selection, value) {\n  selection.select('select').property('value', value);\n}\n\nfunction selectBoxValue(selection) {\n  return selection.select('select').property('value');\n}\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction checklistBox(selection, label) {\n  // TODO: scroll\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('ul')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n}\n\nfunction checklistBoxItems(selection, items) {\n  const listitems = selection.select('ul')\n    .selectAll('li')\n      .data(items, d => d.key);\n  listitems.exit().remove();\n  const form = listitems.enter()\n    .append('li')\n      .attr('class', 'form-check')\n    .append('label')\n      .attr('class', 'form-check-label');\n  form.append('input')\n      .attr('type', 'checkbox')\n      .attr('class', 'form-check-input')\n      .property('value', d => d.key);\n  form.append('span')\n      .text(d => d.name);\n}\n\nfunction updateChecklistBox(selection, values) {\n  if (!values) return;\n  selection.selectAll('input')\n    .each(function (d) {\n      d3.select(this).property('checked', values.includes(d.key));\n    });\n}\n\nfunction checklistBoxValue(selection) {\n  return selection.selectAll('input:checked').data().map(d => d.key);\n}\n\nfunction anyChecked(selection) {\n  return checklistBoxValue(selection).length > 0;\n}\n\n\nfunction colorScaleBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label || 'Colorscale');\n  const form = selection.append('div')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n  const dropdown = form.append('div')\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  dropdown.append('button')\n      .classed('btn', true)\n      .classed(`btn-light`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  dropdown.append('div')\n      .classed('dropdown-menu', true)\n      .classed('py-0', true);\n  form.append('span')\n      .classed('selected', true);\n}\n\nfunction colorScaleBoxItems(selection, items) {\n  const listitems = selection.select('.dropdown-menu')\n    .selectAll('a')\n      .data(items, d => d);\n  listitems.exit().remove();\n  listitems.enter()\n    .append('a')\n      .classed('dropdown-item', true)\n      .classed('py-0', true)\n      .attr('href', '#')\n      .attr('title', d => d.key)\n      .on('click', function (d) {\n        selection.call(setSelectedColorScale, d);\n        selection.dispatch('change', {bubbles: true});\n      })\n    .append('svg')\n      .each(function (d) {\n        d3.select(this)\n          .call(shape.colorBar[d.type], d.colors, d.text)\n          .call(shape.setSize, 100, 10);\n      });\n}\n\nfunction setSelectedColorScale(selection, item) {\n  const selected = selection.select('.selected');\n  selected.selectAll('svg').remove();\n  selected.datum(item);  // Bind selected item record\n  selected.append('svg')\n      .call(shape.colorBar[item.type], item.colors, item.text)\n      .call(shape.setSize, 100, 10);\n}\n\nfunction updateColorScaleBox(selection, key) {\n  const data = selection.select('.dropdown-menu')\n    .selectAll('a').data();\n  const item = data.find(e => e.key === key);\n  selection.call(setSelectedColorScale, item);\n}\n\nfunction colorScaleBoxValue(selection) {\n  return selection.select('.selected').datum().key;\n}\n\nfunction colorScaleBoxItem(selection) {\n  return selection.select('.selected').datum();\n}\n\n\nexport default {\n  selectBox, selectBoxItems, updateSelectBox, selectBoxValue,\n  checklistBox, checklistBoxItems, updateChecklistBox, checklistBoxValue,\n  anyChecked,\n  colorScaleBox, colorScaleBoxItems, updateColorScaleBox,\n  colorScaleBoxValue, colorScaleBoxItem\n};\n","\n/** @module dialog/fieldFile */\n\nimport d3 from 'd3';\n\nimport {default as mapper} from '../common/mapper.js';\nimport {default as misc} from '../common/misc.js';\nimport {default as hfile} from '../common/file.js';\nimport {default as himg} from '../common/image.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\n\n\nconst id = 'fieldfile-dialog';\nconst title = 'Append JSON fields';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addfile');\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  const body = dialog.select('.modal-body');\n  body.append('div')\n      .classed('file', true)\n      .call(box.fileInputBox, 'File', '.json,.csv');\n  body.append('div')\n      .classed('left', true)\n      .call(lbox.selectBox, 'Datagrid ID');\n  body.append('div')\n      .classed('right', true)\n      .call(lbox.selectBox, 'File ID')\n    .select('select')\n      .property('disabled', true);\n  body.append('h5')\n      .classed('mt-2', true)\n      .text('Preview');\n  body.append('div')\n      .classed('preview', true)\n      .call(table.table, [], [], null, 210);\n}\n\n\nfunction updateBody(selection, fields) {\n  const leftFields = fields.filter(e => misc.sortType(e.format) !== 'none');\n  const leftDefault = leftFields\n    .find(e => e.format === 'compound_id') || leftFields[0];\n  selection.select('.left')\n      .call(lbox.selectBoxItems, leftFields)\n      .call(lbox.updateSelectBox, leftDefault.key);\n  selection.select('.preview')\n      .call(table.update, [], []);\n  selection.select('.file')\n      .call(box.clearFileInput)\n      .on('change', function () {\n        const file = box.fileInputBoxValue(d3.select(this));\n        d3.select(this).dispatch('validate');\n        const isCsv = file.name.split('.').pop() === 'csv';\n        hfile.readFile(file)\n          .then(res => {\n            const mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n            const tbl = mapper.mappingToTable(mapping);\n            selection.select('.right')\n              .call(lbox.selectBoxItems,\n                    [{key: mapping.key, name: mapping.key}])\n              .call(lbox.updateSelectBox, mapping.key);\n            selection.select('.preview')\n              .call(table.update, tbl.fields, tbl.records.slice(0, 5));\n          });\n      })\n      .on('validate', function () { // Input validation\n        const fileSelected = box.fileInputBoxValue(d3.select(this));\n        selection.select('.submit')\n          .property('disabled', !fileSelected);\n      })\n      .dispatch('validate');\n}\n\n\nfunction readFile(selection) {\n  const left = lbox.selectBoxValue(selection.select('.left'));\n  const file = box.fileInputBoxValue(selection.select('.file'));\n  const isCsv = file.name.split('.').pop() === 'csv';\n  return hfile.readFile(file)\n    .then(res => {\n      let mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n      if (mapping.hasOwnProperty('field')) {\n        mapping = mapper.singleToMulti(mapping);\n      }\n      mapping.key = left;\n      // TODO; refactor\n      const plotCols = [];\n      mapping.fields.forEach((e, i) => {\n        if (e.format === 'plot') {\n          mapping.fields[i].format = 'image';\n          plotCols.push(i);\n        }\n      });\n      if (plotCols.length > 0) {\n        const ps = [];\n        Object.entries(mapping.mapping).forEach(m => {\n          plotCols.forEach(e => {\n            const p = himg.plotThumbnail(m[1][e])\n              .then(img => {\n                mapping.mapping[m[0]][e] = img;\n              });\n            ps.push(p);\n          });\n        });\n        return Promise.all(ps).then(() => mapping);\n      } else {\n        return mapping;\n      }\n    });\n}\n\n\nexport default {\n  menuLink, body, updateBody, readFile\n};\n","\n/** @module dialog/fieldInput */\n\nimport d3 from 'd3';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'fieldinput-dialog';\nconst title = 'Append input field';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addcheckbox');\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  const body = dialog.select('.modal-body');\n  body.append('div')\n      .classed('key', true)\n      .call(box.textBox, 'Field key');\n  const options = [\n    {key: 'checkbox', name: 'Checkbox'},\n    {key: 'text_field', name: 'Text field'}\n  ];\n  body.append('div')\n      .classed('type', true)\n      .call(lbox.selectBox, 'Type')\n      .call(lbox.selectBoxItems, options);\n\n}\n\n\nfunction updateBody(selection) {\n  selection.select('.key')\n      .call(box.updateTextBox, null)\n      .on('input', function () {  // Validation\n        const keyValid = box.textBoxValue(d3.select(this)) !== '';\n        selection.select('.submit').property('disabled', !keyValid);\n      })\n      .dispatch('input');\n  selection.select('.type')\n      .call(lbox.updateSelectBox, 'checkbox');\n}\n\n\nconst defaultValues = {\n  checkbox: false,\n  text_field: ''\n};\n\n\nfunction value(selection) {\n  const key = box.textBoxValue(selection.select('.key'));\n  const type = lbox.selectBoxValue(selection.select('.type'));\n  return {\n    field: {key: key, name: key, format:type},\n    default: defaultValues[type]\n  };\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module dialog/formGroup */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\n\n\n/**\n * Render color range control box group\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction queryMolGroup(selection) {\n  selection\n      .classed('mb-3', true);\n  selection.append('div')\n      .classed('format', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Format')\n      .call(lbox.selectBoxItems,\n            [\n              {key: 'molfile', name: 'MDL Molfile'},\n              {key: 'dbid', name: 'Compound ID'}\n            ]);\n  selection.append('div')\n      .classed('source', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Source');\n  selection.append('div')\n      .classed('textquery', true)\n      .classed('mb-1', true)\n      .call(box.textBox, 'Query');\n  selection.append('div')\n      .classed('areaquery', true)\n      .classed('mb-1', true)\n      .call(box.textareaBox, 'Query', 6, null);\n  // Popover\n  $(function () {\n    $('[data-toggle=\"popover\"]')\n      .popover({html: true, trigger: 'focus'});\n  });\n  selection.append('div')\n      .classed('form-row', true)\n      .classed('justify-content-end', true)\n    .append('button')\n      .classed('preview', true)\n      .attr('data-toggle', 'popover')\n      .attr('data-html', 'true')\n      .attr('data-content', '<div id=\"previmg\"></div>')\n      .call(button.menuButton, 'Structure preview', 'primary');\n}\n\nfunction updateQueryMolGroup(selection, resources) {\n  selection.select('.format')\n      .call(lbox.updateSelectBox, 'molfile')\n      .on('change', function () {\n        const value = lbox.selectBoxValue(d3.select(this));\n        selection.select('.source')\n          .select('select')\n            .property('disabled', value !== 'dbid');\n        selection.select('.textquery')\n            .property('hidden', value !== 'dbid');\n        selection.select('.areaquery')\n            .property('hidden', value !== 'molfile');\n      })\n      .dispatch('change');\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  selection.select('.source')\n      .call(lbox.selectBoxItems, res)\n      .call(lbox.updateSelectBox, null);\n  selection.select('.preview')\n      .on('click', function () {\n        const query = queryMolGroupValue(selection);\n        return fetcher.get('strprev', query)\n          .then(fetcher.text)\n          .then(res => d3.select('#previmg').html(res), fetcher.error);\n      });\n  selection.select('.textquery')\n      .call(box.updateTextBox, '')\n      .on('input', function() {\n        selection.dispatch('validate');\n      });\n  selection.select('.areaquery')\n      .call(box.updateTextareaBox, '')\n      .on('input', function() {\n        selection.dispatch('validate');\n      });\n}\n\nfunction queryMolGroupValue(selection) {\n  const format = lbox.selectBoxValue(selection.select('.format'));\n  const source = lbox.selectBoxValue(selection.select('.source'));\n  const textquery = box.textBoxValue(selection.select('.textquery'));\n  const areaquery = box.textareaBoxLines(selection.select('.areaquery'));\n  return {\n    format: format,\n    source: format === 'dbid' ? source : null,\n    value: format === 'molfile' ? areaquery : textquery\n  };\n}\n\nfunction queryMolGroupValid(selection) {\n  const format = lbox.selectBoxValue(selection.select('.format'));\n  const textquery = box.textBoxValue(selection.select('.textquery'));\n  const areaquery = box.textareaBoxLines(selection.select('.areaquery'));\n  return format === 'molfile' ? areaquery.length : textquery !== '';\n}\n\n\nfunction simOptionGroup(selection) {\n  const id = misc.uuidv4().slice(0, 8);\n  selection\n      .classed('mb-3', true)\n    .append('p')\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-sm', true)\n      .classed('btn-outline-primary', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'collapse')\n      .attr('data-target', `#${id}-collapse`)\n      .attr('aria-expanded', 'false')\n      .attr('aria-controls', `${id}-collapse`)\n      .text('Optional parameters');\n  const collapse = selection.append('div')\n      .classed('collapse', true)\n      .attr('id', `${id}-collapse`)\n    .append('div')\n      .classed('card', true)\n      .classed('card-body', true);\n  collapse.append('div')\n      .classed('ignoreh', true)\n      .classed('mb-1', true)\n      .call(box.checkBox, 'Ignore explicit hydrogens');\n  collapse.append('div')\n      .classed('timeout', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Timeout', 1, 999, 1);\n  collapse.append('div')\n      .classed('diam', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Diameter (MCS-DR/GLS)', 4, 999, 1);\n  collapse.selectAll('label.col-form-label')\n      .classed('col-4', false)\n      .classed('col-6', true);\n  collapse.selectAll('input.form-control')\n      .classed('col-8', false)\n      .classed('col-6', true);\n}\n\n\nfunction updateSimOptionGroup(selection) {\n  selection.select('.ignoreh')\n      .call(box.updateCheckBox, true);\n  selection.select('.timeout')\n      .call(box.updateNumberBox, 2);\n  selection.select('.diam')\n      .call(box.updateNumberBox, 8);\n}\n\n\nfunction simOptionGroupValue(selection) {\n  const timeout = selection.select('.timeout');\n  const diam = selection.select('.diam');\n  const query = {\n    ignoreHs: box.checkBoxValue(selection.select('.ignoreh'))\n  };\n  if (!timeout.select('input').property('disabled')) {\n    query.timeout = box.numberBoxIntValue(timeout);\n  }\n  if (!diam.select('input').property('disabled')) {\n    query.diameter = box.numberBoxIntValue(diam);\n  }\n  return query;\n}\n\n\nexport default {\n  queryMolGroup, updateQueryMolGroup, queryMolGroupValue, queryMolGroupValid,\n  simOptionGroup, updateSimOptionGroup, simOptionGroupValue\n};\n","\n/** @module dialog/networkgen */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as group} from './formGroup.js';\n\n\nconst id = 'networkgen-dialog';\nconst title = 'Generate similarity network';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-network');\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-body').append('div')\n      .classed('measure', true)\n      .call(lbox.selectBox, 'Measure');\n  // Threshold\n  dialog.select('.modal-body').append('div')\n      .classed('thld', true)\n      .call(box.numberBox, 'Threshold', 0.5, 1, 0.01);\n  // Similarity search options\n  dialog.select('.modal-body').append('div')\n      .classed('option', true)\n      .call(group.simOptionGroup);\n}\n\n\nfunction updateBody(selection, rdk) {\n  // Similarity measure\n  const measures = [\n    {key: 'gls', name: 'Graph-based local similarity(GLS)'}\n  ];\n  if (rdk) {\n    measures.push({key: 'rdmorgan', name: 'RDKit Morgan similarity'});\n    measures.push({key: 'rdfmcs', name: 'RDKit FMCS'});\n  }\n  selection.select('.measure')\n      .call(lbox.selectBoxItems, measures)\n      .call(lbox.updateSelectBox, 'gls')\n      .on('change', function () {\n        const value = lbox.selectBoxValue(d3.select(this));\n        selection.select('.diam')\n          .select('input')\n            .property('disabled', value !== 'gls');\n        selection.select('.timeout')\n          .select('input')\n            .property('disabled', !['gls', 'rdfmcs'].includes(value));\n      });\n  selection.select('.thld')\n      .call(box.updateNumberBox, 0.5);\n  selection.select('.option')\n      .call(group.updateSimOptionGroup);\n}\n\n\nfunction execute(selection, rcds) {\n  const measure = selection.select('.measure');\n  const thld = selection.select('.thld');\n  const params = group.simOptionGroupValue(selection.select('.option'));\n  if (!measure.select('select').property('disabled')) {\n    params.measure = lbox.selectBoxValue(measure);\n  }\n  if (!thld.select('input').property('disabled')) {\n    params.threshold = box.numberBoxFloatValue(thld);\n  }\n  const formData = new FormData();\n  // TODO: need updates in flashflood query schema\n  formData.append('params', JSON.stringify(params));\n  formData.append('contents', new Blob([JSON.stringify(rcds)]));\n  return fetcher.post(`${params.measure}net`, formData)\n    .then(fetcher.json);\n}\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module dialog/rename */\n\nimport d3 from 'd3';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'rename-dialog';\nconst title = 'Rename';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-edittext');\n}\n\n\nfunction body(selection) {\n  selection.call(modal.submitDialog, id, title)\n    .select('.modal-body').append('div')\n      .classed('rename', true)\n      .call(box.textBox, 'New name');\n}\n\n\nfunction updateBody(selection, name) {\n  selection.select('.rename')\n      .call(box.updateTextBox, name)\n      .on('input', function () {  // Validation\n        const keyValid = box.textBoxValue(d3.select(this)) !== '';\n        selection.select('.submit').property('disabled', !keyValid);\n      })\n      .dispatch('input');\n}\n\n\nfunction value(selection) {\n  return box.textBoxValue(selection.select('.rename'));\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module datagridApp */\n\nimport d3 from 'd3';\n\nimport {default as client} from './common/client.js';\nimport {default as fetcher} from './common/fetcher.js';\nimport {default as hfile} from './common/file.js';\nimport {default as idb} from './common/idb.js';\nimport {default as misc} from './common/misc.js';\n\nimport {default as button} from './component/button.js';\nimport {default as modal} from './component/modal.js';\n\nimport {default as fieldConfigDialog} from './dialog/fieldConfig.js';\nimport {default as fieldFetchDialog} from './dialog/fieldFetch.js';\nimport {default as fieldFileDialog} from './dialog/fieldFile.js';\nimport {default as fieldInputDialog} from './dialog/fieldInput.js';\nimport {default as networkgenDialog} from './dialog/networkgen.js';\nimport {default as renameDialog} from './dialog/rename.js';\n\nimport DatagridState from './datagrid/state.js';\nimport {default as rowf} from './datagrid/rowFilter.js';\nimport {default as sort} from './datagrid/sort.js';\nimport {default as dg} from './datagrid/component.js';\n\n\nfunction app(view, coll) {\n  const menubar = d3.select('#menubar');\n  menubar.selectAll('div,span,a').remove();  // Clean up\n  const dialogs = d3.select('#dialogs');\n  dialogs.selectAll('div').remove();  // Clean up\n\n  const state = new DatagridState(view, coll);\n\n  // Datagrid view control\n  const menu = menubar.append('div')\n      .call(button.dropdownMenuButton, 'Datagrid', 'primary', 'table-white')\n      .select('.dropdown-menu');\n  menu.append('a').call(fieldConfigDialog.menuLink);\n  menu.append('a')\n      .classed('online-command', true)\n      .call(fieldFetchDialog.menuLink);\n  menu.append('a').call(fieldFileDialog.menuLink);\n  menu.append('a').call(fieldInputDialog.menuLink);\n  menu.append('a')\n      .call(button.dropdownMenuItem, 'Generate tile view', 'menu-tiles')\n      .on('click', function () {\n        const viewID = misc.uuidv4();\n        idb.appendView(state.storeID, state.viewID, {\n          $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n          viewID: viewID,\n          name: viewID,\n          viewType: 'tile',\n          items: state.rows.collectionID,\n          rowCount: 5,\n          columnCount: 5,\n          tileContent: {field: 'structure', visible: true}\n        }).then(() => {\n          d3.select('#loading-icon').style('display', 'none');\n          window.open(\n            `tile.html?store=${state.storeID}&view=${viewID}`, '_blank');\n        });\n      });\n  menu.append('a')\n      .classed('online-command', true)\n      .call(networkgenDialog.menuLink);\n  menu.append('a').call(renameDialog.menuLink);\n  menu.append('a')\n      .call(button.dropdownMenuItem, 'Save', 'menu-save')\n      .on('click', function () {\n        state.save().then(() => console.info('Datagrid saved'));\n      });\n  menu.append('a')\n      .classed('online-command', true)\n      .call(button.dropdownMenuItem, 'Download Excel', 'menu-exportexcel')\n      .on('click', () => {\n        const coll = state.rows.export();\n        const formData = new FormData();\n        formData.append('contents', new Blob([JSON.stringify(coll)]));\n        return fetcher.post('xlsx', formData)\n          .then(fetcher.blob)\n          .then(blob => hfile.downloadDataFile(blob, `${state.name}.xlsx`));\n      });\n  // Dashboard link\n  menubar.append('a')\n      .call(button.menuButtonLink, 'Dashboard',\n            'outline-secondary', 'status-gray')\n      .attr('href', 'dashboard.html')\n      .attr('target', '_blank');\n  // Fetch control\n  menubar.append('a')\n      .classed('refresh', true)\n      .call(button.menuButtonLink,\n            'Refresh', 'outline-secondary', 'refresh-gray')\n      .on('click', function () {\n        return state.rows.pull().then(() => {\n          state.updateContentsNotifier();\n          updateApp(state);\n        });\n      });\n  menubar.append('a')\n      .classed('abort', true)\n      .call(button.menuButtonLink,\n            'Abort server job', 'warning', 'delete-gray')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', '#abort-dialog');\n  menubar.append('span').classed('progress', true)\n    .append('progress')\n      .attr('max', 100);\n  menubar.append('span').classed('title', true);\n  menubar.append('span').classed('status', true);\n\n  // Dialogs\n  dialogs.append('div')\n      .classed('fieldconfd', true)\n      .call(fieldConfigDialog.body);\n  dialogs.append('div')\n      .classed('fieldfetchd', true)\n      .call(fieldFetchDialog.body);\n  dialogs.append('div')\n      .classed('fieldfiled', true)\n      .call(fieldFileDialog.body);\n  dialogs.append('div')\n      .classed('fieldinputd', true)\n      .call(fieldInputDialog.body);\n  dialogs.append('div')\n      .classed('netgend', true)\n      .call(networkgenDialog.body);\n  dialogs.append('div')\n      .classed('renamed', true)\n      .call(renameDialog.body);\n  dialogs.append('div')\n      .classed('abortd', true)\n      .call(modal.confirmDialog, 'abort-dialog');\n\n  // Contents\n  d3.select('#dg-search')\n      .call(rowf.setFilter, state);\n  d3.select('#datagrid')\n      .call(sort.setSort, state)\n      .call(dg.datagrid, state);\n\n  // Resize window\n  window.onresize = () => {\n    d3.select('#datagrid').call(dg.resize, state)\n      .call(dg.updateViewport, state, state.viewportTop);\n  };\n\n  updateApp(state);\n}\n\n\nfunction updateApp(state) {\n  d3.select('#loading-icon').style('display', 'none');\n\n  // Title\n  d3.select('title').text(state.name);\n\n  // Menubar\n  const menubar = d3.select('#menubar');\n  const fstatus = state.rows.status();\n  const fsize = state.rows.size();\n  const ftime = state.rows.execTime();\n  const fprog = state.rows.progress();\n  const ongoing = state.rows.ongoing();\n  menubar.select('.title').text(state.name);\n  menubar.select('.status')\n      .text(`(${fstatus} - ${fsize} records found in ${ftime} sec.)`);\n  menubar.select('.progress').select('progress')\n      .attr('value', fprog)\n      .text(`${fprog}%`);\n  // hide fetch commands\n  menubar.selectAll('.progress, .refresh, .abort')\n    .style('display', ongoing ? null : 'none');\n\n  // Dialogs\n  const dialogs = d3.select('#dialogs');\n\n  // Field config dialog\n  dialogs.select('.fieldconfd')\n      .call(fieldConfigDialog.updateBody, state.rows.fields)\n      .on('submit', function () {\n        const values = fieldConfigDialog.value(d3.select(this));\n        state.updateFields(values);\n        state.updateContentsNotifier();\n        updateApp(state);\n      });\n\n  // Import fields dialog\n  dialogs.select('.fieldfiled')\n      .call(fieldFileDialog.updateBody, state.visibleFields)\n      .on('submit', function () {\n        return fieldFileDialog.readFile(d3.select(this))\n          .then(data => {\n            state.joinFields(data);\n            state.updateContentsNotifier();\n            updateApp(state);\n          });\n      });\n\n  // Input field dialog\n  dialogs.select('.fieldinputd')\n      .call(fieldInputDialog.updateBody)\n      .on('submit', function () {\n        const value = fieldInputDialog.value(d3.select(this));\n        state.rows.addField(value.field);\n        state.rows.records().forEach(e => {\n          e[value.field.key] = value.default;\n        });\n        state.updateContentsNotifier();\n        updateApp(state);\n      });\n\n  // Rename dialog\n  dialogs.select('.renamed')\n      .call(renameDialog.updateBody, state.name)\n      .on('submit', function () {\n        state.name = renameDialog.value(d3.select(this));\n        updateApp(state);\n  });\n\n\n  // Server bound tasks\n  fetcher.serverStatus().then(response => {\n    // Fetch db fields dialog\n    dialogs.select('.fieldfetchd')\n        .call(fieldFetchDialog.updateBody, response.schema, state.rows.fields)\n        .on('submit', function () {\n          const compounds = state.rows.records().map(e => e.compound_id);\n          fieldFetchDialog\n            .execute(d3.select(this), compounds, response.schema)\n            .then(res => {\n              state.joinFields(res);\n              state.updateContentsNotifier();\n              updateApp(state);\n            });\n        });\n\n    // Network generation dialog\n    dialogs.select('.netgend')\n        .call(networkgenDialog.updateBody, response.server.rdkit)\n        .on('submit', function () {\n          networkgenDialog\n            .execute(d3.select(this), state.rows.records())\n            .then(data => {\n              const wid = data.workflowID.slice(0, 8);\n              return Promise.all([\n                idb.appendView(state.storeID, state.viewID, {\n                  $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n                  viewID: wid,\n                  name: wid,\n                  viewType: 'network',\n                  nodes: state.rows.collectionID,\n                  edges: wid,\n                  minConnThld: data.query.params.threshold\n                }),\n                idb.appendCollection(state.storeID, state.rows.collectionID, {\n                  $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n                  collectionID: wid,\n                  name: wid,\n                  contents: [data]\n                })\n              ])\n              .then(() => {\n                d3.select('#loading-icon').style('display', 'none');\n                window.open(`network.html?store=${state.storeID}&view=${wid}`, '_blank');\n              });\n            });\n        });\n\n    // Abort dialog\n    dialogs.select('.abortd')\n        .call(modal.updateConfirmDialog,\n              'Are you sure you want to abort this calculation job?')\n        .on('submit', function () {\n          state.rows.abort().then(() => {\n            state.updateContentsNotifier();\n            updateApp(state);\n          });\n        });\n  })\n  .catch(() => {\n    // disable on-line commands\n    d3.select('#menubar').selectAll('.online-command')\n      .attr('data-target', null)\n      .classed('disabled', true)\n      .on('click', null);\n  });\n}\n\nfunction run() {\n  const err = client.compatibility();\n  if (err) {\n    d3.select('body')\n      .style('color', '#ff0000')\n      .text(err);\n    return;\n  }\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";  // TODO\n  const offLine = 'onLine' in navigator && !navigator.onLine;  // TODO\n  client.registerServiceWorker();\n  const storeID = client.URLQuery().store || null;\n  const viewID = client.URLQuery().view || null;\n  return idb.getView(storeID, viewID)\n    .then(view => {\n      if (!view) throw('ERROR: invalid URL');\n      view.storeID = storeID;\n      return idb.getCollection(storeID, view.rows)\n        .then(coll => app(view, coll));\n    })\n    .catch(err => {\n      console.error(err);\n      d3.select('#datagrid')\n        .style('color', 'red')\n        .text(err);\n    });\n}\n\n\nexport default {\n  run\n};\n"],"names":["URLQuery","pairs","window","location","search","substring","split","map","e","_","fromPairs","compatibility","registerServiceWorker","navigator","addEventListener","serviceWorker","register","console","info","baseURL","get","url","query","q","Object","keys","length","JSON","stringify","fetch","credentials","then","res","status","Promise","reject","Error","statusText","resolve","json","response","text","blob","post","formdata","method","body","error","err","serverStatus","server","schema","readFile","file","sizeLimit","reader","FileReader","truncated","slice","onload","event","target","result","onerror","readAsArrayBuffer","readAsText","parseJSON","data","compressed","pako","inflate","to","parse","downloadDataFile","name","URL","createObjectURL","Blob","a","document","createElement","download","href","dispatchEvent","MouseEvent","view","bubbles","cancelable","loadJSON","endsWith","fetchJSON","decoded","decodeURIComponent","arrayBuffer","downloadJSON","compress","str","gzip","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","d3","format","partialMatch","toString","toUpperCase","indexOf","uuidv4","replace","c","r","Math","random","statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","fields","columns","sort","id","dataType","schemaVersion","revision","records","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v10_nodes","reference","convertNetwork","edges","hasOwnProperty","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","key","column","domain","range","unknown","size","visible","nodeContent","structure","label","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","forEach","i","index","_structure","_index","source","v08_graph","nodeContentVisible","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","$schema","convertPackage","now","Date","isNW","v08_nodes","width","height","convertTable","specs","views","dataset","push","collectionID","contents","workflowID","workflow","viewID","viewType","rows","sortOrder","filterText","checkpoints","type","date","description","networkThresholdCutoff","filter","minConnThld","currentConnThld","items","idb","Dexie","getAllItems","orderBy","reverse","toArray","updateItem","storeID","updateFunc","where","equals","modify","catch","version","stores","reset","delete","getItem","first","importItem","legacy","misc","sessionStarted","put","newDatagrid","toLocaleString","timeZone","deleteItem","getView","appendView","viewObj","item","pos","findIndex","splice","updateView","isFunction","deleteView","bin","entries","entry","getCollection","collID","colls","coll","appendCollection","collObj","updateCollection","iconBaseURL","buttonBox","selection","classed","append","menuButton","menuButtonLink","icon","attr","style","menuModalLink","dropdownMenuButton","button","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","on","select","this","node","click","dropdownMenuFileValue","files","dialogBase","confirmDialog","base","call","footer","dispatch","updateConfirmDialog","message","submitDialog","title","header","html","singleToMulti","mapping","newMapping","m","mappingToTable","mp","concat","rcd","f","tableToMapping","table","ignore","row","csvToMapping","csvString","lines","shift","headerIdx","h","line","values","k","Array","apply","fd","uniqBy","Collection","[object Object]","autoIndex","content","addField","fs","mapper","flatten","command","fetcher","all","sum","some","min","updateHeader","state","selectAll","remove","visibleFields","enter","headerCellRenderer","updateRows","recordsToShow","keyFunc","exit","merge","rowHeight","each","d","rowIndex","viewportTop","rowPos","rowFactory","updateViewport","scrollPos","bodyHeight","setScrollPosition","scrollTop","resize","viewport","getBoundingClientRect","top","resizeViewport","innerHeight","viewportHeight","datagrid","floor","previousViewportTop","updateContentsNotifier","applyHeader","applyData","updateFilterNotifier","setFilterText","plotCell","record","vega","View","initialize","run","plotThumbnail","vegaSpec","toImageURL","binaryToDataURI","binary","readAsDataURL","d3Format","d3_format","compound_id","image","checkbox","property","disabled","checked","textField","cellFunc","numeric","raw","assay_id","list","plot","img","text_field","control","svg","rowCell","cell","DatagridState","sortedRecords","filteredRecords","defaultColumnHeight","none","scrollBarSpace","numViewportRows","viewportBottom","fixedViewportHeight","component","factory","position","ceil","setViewportSize","setNumViewportRows","widthfSum","reduce","widthf","assign","b","applyOrder","order","orders","applyFilter","ki","obj","updateFields","joinFields","ci","export","vi","numberBoxFloatValue","textBox","updateTextBox","textBoxValue","readonlyBox","textareaBox","updateTextareaBox","updateTextareaPlaceholder","placeholder","textareaBoxValue","textareaBoxLines","checkBox","box","updateCheckBox","checkBoxValue","numberBox","max","step","updateNumberBox","numberFloatValid","parseInt","valid","numberBoxIntValue","colorBox","stopPropagation","updateColorBox","colorBoxValue","fileInputBox","clearFileInput","fileInputBoxValue","setFilter","searchBox","setSort","isAsc","setSortOrder","datum","filterTable","rowf","filterSortTable","update","updateRecords","tableRecords","extra","options","menuLink","dialog","modal","updateBody","dgfields","assays","resources","flatMap","assay","value_types","copy","value_type","done","__origin","check","check_d","anyChecked","execute","compounds","targets","queries","condition","merged","monocolorBar","colors","group","colorBar","monocolor","bicolor","grad","tricolor","categorical","sw","custom","setSize","checklistBoxValue","setSelectedColorScale","selected","shape","selectBox","selectBoxItems","updateSelectBox","selectBoxValue","checklistBox","checklistBoxItems","listitems","form","updateChecklistBox","colorScaleBox","dropdown","colorScaleBoxItems","updateColorScaleBox","colorScaleBoxValue","colorScaleBoxItem","lbox","leftFields","leftDefault","isCsv","pop","hfile","tbl","fileSelected","left","plotCols","ps","p","himg","defaultValues","keyValid","default","queryMolGroupValue","textquery","areaquery","queryMolGroup","$","popover","trigger","updateQueryMolGroup","queryMolGroupValid","simOptionGroup","collapse","updateSimOptionGroup","simOptionGroupValue","timeout","diam","ignoreHs","diameter","rdk","measures","rcds","measure","thld","formData","FormData","updateApp","menubar","fstatus","fsize","ftime","fprog","ongoing","dialogs","fieldConfigDialog","fieldFileDialog","fieldInputDialog","renameDialog","fieldFetchDialog","networkgenDialog","rdkit","wid","open","abort","client","protocol","onLine","store","menu","rowCount","columnCount","tileContent","save","pull","dg","onresize","app"],"mappings":";4jBA2CEA,SArCF,WACE,MAAMC,EAAQC,OAAOC,SAASC,OAAOC,UAAU,GAAGC,MAAM,KACrDC,IAAIC,GAAKA,EAAEF,MAAM,MACpB,OAAOG,EAAEC,UAAUT,IAkCTU,cA9BZ,aA8B2BC,sBAX3B,WACM,kBAAmBC,UACrBX,OAAOY,iBAAiB,OAAQ,KAC9BD,UAAUE,cAAcC,SAAS,cAGnCC,QAAQC,KAAK,qCClCjB,MAAMC,EAAU,UAEhB,SAASC,EAAIC,EAAKC,MAChB,MACMC,EADUC,OAAOC,KAAKH,GAAOI,iBACLC,KAAKC,UAAUN,KAAW,GACxD,OAAOO,SACFV,IAAUE,IAAME,KAEjBO,YAAa,YAEfC,KAAKC,GACc,MAAfA,EAAIC,OACCC,QAAQC,OAAO,IAAIC,MAAMJ,EAAIK,aAE/BH,QAAQI,QAAQN,IAI3B,SAASO,EAAKC,GACZ,OAAOA,EAASD,cAiDhBnB,IAAAA,EAAKmB,KAAAA,EAAME,KA9Cb,SAAcD,GACZ,OAAOA,EAASC,QA6CCC,KA1CnB,SAAcF,GACZ,OAAOA,EAASE,QAyCOC,KAtCzB,SAActB,EAAKuB,GACjB,OAAOf,SACFV,IAAUE,KAEXwB,OAAQ,OACRC,KAAMF,EACNd,YAAa,YAEfC,KAAKC,GACc,MAAfA,EAAIC,OACCC,QAAQC,OAAO,IAAIC,MAAMJ,EAAIK,aAE/BH,QAAQI,QAAQN,KA0BIe,MAtB/B,SAAeC,GAEb,OADA/B,QAAQ8B,MAAMC,GACP,MAoB6BC,aAjBtC,WACE,MAAMT,KACN,OAAOpB,EAAI,UACRW,KAAKQ,GACLR,KAAKC,IACJQ,EAASU,OAASlB,IAEnBD,KAAK,IAAMX,EAAI,WACfW,KAAKQ,GACLR,KAAKC,IACJQ,EAASW,OAASnB,IAEnBD,KAAK,IAAMS,KC7DhB,SAASY,EAASC,EAAMC,EAAWZ,GACjC,OAAO,IAAIR,QAAQ,CAACI,EAASH,KAC3B,MAAMoB,EAAS,IAAIC,WACbC,EAAYH,EAAYD,EAAKK,MAAM,EAAGJ,GAAaD,EACzDE,EAAOI,OAASC,CAAAA,GAAStB,EAAQsB,EAAMC,OAAOC,SAC9CP,EAAOQ,QAAUhB,CAAAA,GAASZ,EAAOY,IAC7BL,EACFa,EAAOS,kBAAkBP,GAEzBF,EAAOU,WAAWR,KAMxB,SAASS,EAAUC,EAAMC,GACvB,MAAM3B,EAAO2B,EAAaC,EAAKC,QAAQH,GAAOI,GAAI,WAAaJ,EAC/D,OAAOxC,KAAK6C,MAAM/B,GAoBpB,SAASgC,EAAiBN,EAAMO,GAC9B,IAGE,MAAMrD,EAAMnB,OAAOyE,IAAIC,gBAAgB,IAAIC,MAAMV,KAC3CW,EAAIC,SAASC,cAAc,KACjCF,EAAEG,SAAWP,EACbI,EAAEI,KAAO7D,EAETyD,EAAEK,cAAc,IAAIC,WAAW,SAC7BC,KAAQnF,OACRoF,SAAW,EACXC,YAAc,KAGhB,MAAO/E,YAeT4C,SAAAA,EAAUc,UAAAA,EAAWsB,SA9CvB,SAAkBnC,GAChB,MAAMe,EAAaf,EAAKqB,KAAKe,SAAS,MAAQpC,EAAKqB,KAAKe,SAAS,OACjE,OAAOrC,EAASC,GAAM,EAAOe,GAC1BrC,KAAKoC,GAAQD,EAAUC,EAAMC,KA2CDsB,UAvCjC,SAAmBrE,GACjB,MAAMsE,EAAUC,mBAAmBvE,GAC7B+C,EAAauB,EAAQF,SAAS,MAAQE,EAAQF,SAAS,OAC7D,OAAO5D,MAAM8D,GACV5D,KAAKC,GAAOoC,EAAapC,EAAI6D,cAAgB7D,EAAIO,QACjDR,KAAKoC,GAAQD,EAAUC,EAAMC,KAmChCK,iBAAAA,EAAkBqB,aAVpB,SAAsBvD,EAAMmC,EAAMqB,GAAS,GACzC,MAAMC,EAAMrE,KAAKC,UAAUW,GAG3BkC,EAFasB,EAAW1B,EAAK4B,KAAKD,GAAOA,KAEftB,UADRqB,EAAW,IAAM,kBC1BnCG,SAnCF,SAAkBC,GAChB,OAAK,UAAW,aAAaC,SAASD,GAAa,WAC9C,OAAQ,cAAe,WAAY,QAAQC,SAASD,GAAa,OAC/D,QAgCGE,UAvBZ,SAAmBC,EAAOC,GACxB,OAAID,MAAAA,GAAyCE,OAAOC,MAAMH,GAAe,GAClEA,GAASI,WAAWJ,GAASK,EAAGC,OAAOL,EAAVI,CAAoBL,GAASA,GAqB5CO,aAjBvB,SAAsBvF,EAAOuC,GAC3B,OAAIA,MAAAA,GAAsD,KAAXA,IAEC,IADzCA,EAAOiD,WAAWC,cACtBC,QAAQ1F,EAAMwF,WAAWC,gBAcOE,OATrC,WACE,MAAO,uCAAuCC,QAAQ,QAAS,SAASC,GACtE,IAAIC,EAAoB,GAAhBC,KAAKC,SAAgB,EAC7B,OADyC,KAALH,EAAWC,EAAS,EAAJA,EAAU,GACrDN,SAAS,QC7BtB,MAAMS,GACJC,OAAQ,QACRC,cAAe,UACfC,SAAU,UACVC,QAAS,UACTC,UAAW,OACXC,QAAS,WAGLC,GACJC,UAAW,QACXC,WAAY,SAGd,SAASC,EAAiB1F,GACxB,MAAM2F,EAAS3F,EAAK4F,QAAQ5H,IAAIC,IACf,YAAXA,EAAE4H,KACJ5H,EAAEoG,OAAS,UACS,SAAXpG,EAAE4H,KACX5H,EAAEoG,OAAS,OACS,SAAXpG,EAAE4H,OACX5H,EAAEoG,OAAS,OAENpG,IAET,OACE6H,GAAI9F,EAAK8F,GACT3D,KAAMnC,EAAKmC,KACX4D,SAAUR,EAAavF,EAAKqE,QAC5B2B,cAAe,GACfC,SAAU,EACVvG,OAAQsF,EAAWhF,EAAKN,QACxBiG,OAAQA,EACRO,QAASlG,EAAKkG,QACdnH,MAAOiB,EAAKjB,MACZoH,UAAWnG,EAAKoG,YAChBC,UAAWrG,EAAKsG,gBAAkBtG,EAAKoG,YACvCG,YAAavG,EAAKwG,YAClBC,SAA0B,IAAhBzG,EAAKyG,SACfC,SAAU1G,EAAK0G,SACfC,QAAS3G,EAAK4G,UAAY5G,EAAK6G,cAqInC,SAASC,EAAU9G,GACjB,OACE8F,GAAI9F,EAAK8F,GACT3D,KAAMnC,EAAKmC,KACX4D,SAAU/F,EAAK+F,SACfC,cAAe,OACfC,SAAUjG,EAAKiG,SACfvG,OAAQM,EAAKN,OACbiG,OAAQ3F,EAAK2F,OACbO,QAASlG,EAAKkG,QACdnH,MAAOiB,EAAKjB,MACZ0H,SAAUzG,EAAKyG,SACfC,SAAU1G,EAAK0G,SACfC,QAAS3G,EAAK2G,QACdI,cAgGJ,SAASC,EAAehH,GACtB,IAAI4B,EAAO5B,EAkBX,OAjBM4B,EAAKqF,MAAMC,eAAe,kBAAoBtF,EAAKqF,MAAMC,eAAe,aAC5EtF,EAAKuF,MAAQzB,EAAiB9D,EAAKuF,OACnCvF,EAAKqF,MAnPT,SAA0BjH,EAAMoH,GAC9B,MAAMC,GACJC,eAAgBtH,EAAKuH,SAASD,eAC9BE,cAAexH,EAAKuH,SAASC,cAC7BC,aACAC,YACAC,aACAC,SAgDF,OA9CI5H,EAAKuH,SAASL,eAAe,cAC/BG,EAAII,UAAU3B,GAAK9F,EAAKuH,SAASE,UAAU3B,GAC3CuB,EAAII,UAAUI,MAAQ7H,EAAKuH,SAASE,UAAUI,MAC9CR,EAAII,UAAUK,MAAQV,EAAWW,KAAK9J,GAAKA,EAAE+J,MAAQhI,EAAKuH,SAASE,UAAUQ,SAE7EZ,EAAII,WACF3B,GAAI,QAASgC,MAAOV,EAAW,GAC/BS,OAAQA,MAAO,SAAUK,QAAS,EAAG,GAAIC,OAAQ,QAAS,SAAUC,QAAS,SAG7EpI,EAAKuH,SAASL,eAAe,aAC/BG,EAAIK,SAAS5B,GAAK9F,EAAKuH,SAASG,SAAS5B,GACzCuB,EAAIK,SAASG,MAAQ7H,EAAKuH,SAASG,SAASG,MAC5CR,EAAIK,SAASI,MAAQV,EAAWW,KAAK9J,GAAKA,EAAE+J,MAAQhI,EAAKuH,SAASG,SAASO,SAE3EZ,EAAIK,UACF5B,GAAI,OAAQgC,MAAOV,EAAW,GAC9BS,OAAQA,MAAO,SAAUK,QAAS,EAAG,GAAIC,OAAQ,GAAI,IAAKC,QAAS,KAGnEpI,EAAKuH,SAASL,eAAe,cAC/BG,EAAIM,UAAU7B,GAAK9F,EAAKuH,SAASI,UAAU7B,GAC3CuB,EAAIM,UAAUU,KAAOrI,EAAKuH,SAASI,UAAUU,KAC7ChB,EAAIM,UAAUzH,KAAOF,EAAKuH,SAASI,UAAUzH,KAC7CmH,EAAIM,UAAUW,QAAUtI,EAAKuH,SAASI,UAAUW,QAChDjB,EAAIM,UAAUE,MAAQ7H,EAAKuH,SAASI,UAAUE,MAC9CR,EAAIM,UAAUG,MAAQV,EAAWW,KAAK9J,GAAKA,EAAE+J,MAAQhI,EAAKuH,SAASI,UAAUM,SAE7EZ,EAAIM,WACF7B,GAAI,QAASuC,KAAM,GAAInI,KAAM,QAASoI,SAAS,EAAOR,MAAOV,EAAW,GACxES,OAAQA,MAAO,SAAUK,QAAS,EAAG,GAAIC,OAAQ,QAAS,SAAUC,QAAS,SAG7EpI,EAAKuH,SAASL,eAAe,eAC/BG,EAAIkB,YAAcvI,EAAKuH,SAASgB,YAEhClB,EAAIkB,aAAeC,WAAYF,SAAS,IAEtCtI,EAAKuH,SAASL,eAAe,QAC/BG,EAAIO,KAAO5H,EAAKuH,SAASK,KAEzBP,EAAIO,MACF9B,GAAI,QAAS2C,OAAQJ,KAAM,GAAIC,SAAS,GAAQA,SAAS,EACzDT,OAAQA,MAAO,SAAUK,QAAS,EAAG,GAAIC,OAAQ,EAAG,GAAIC,QAAS,KAInEtC,GAAI9F,EAAK8F,GACT3D,KAAMnC,EAAKmC,KACX4D,SAAUR,EAAavF,EAAKqE,QAC5B2B,cAAe,GACfC,SAAU,EACVc,WACEI,MAAOnH,EAAK0I,aAEdhJ,OAAQsF,EAAWhF,EAAKN,QACxBiG,SACGqC,IAAO,WACPA,IAAO,WACPA,IAAO,WAEV9B,QAASlG,EAAKkG,QACdnH,MAAOiB,EAAKjB,MACZ4J,iBAAkB3I,EAAK2I,iBACvBxC,UAAWnG,EAAKoG,YAChBC,UAAWrG,EAAKsG,gBAAkBtG,EAAKoG,YACvCG,YAAavG,EAAKwG,YAClBC,SAA0B,IAAhBzG,EAAKyG,SACfC,SAAU1G,EAAK0G,SACfC,QAAS3G,EAAK4G,UAAY5G,EAAK6G,aAC/BU,SAAUF,GAoKGuB,CAAiBhH,EAAKqF,MAAOrF,EAAKuF,MAAMxB,SAEvB,OAA5B/D,EAAKqF,MAAMjB,eAAuD,KAA7BpE,EAAKqF,MAAMjB,iBAClDpE,EAjJJ,SAAmB5B,GAIjB,GAHKA,EAAKiH,MAAMC,eAAe,eAC7BlH,EAAKiH,MAAMF,WAAaI,MAAOnH,EAAKiH,MAAM4B,UAExC7I,EAAKmH,MAAMxB,OAAOoC,KAAK9J,GAAe,WAAVA,EAAE+J,KAAmB,CACnD,MAAMc,KACN9I,EAAKmH,MAAMjB,QAAQ6C,QAAQ,CAAC9K,EAAG+K,KAC3B/K,EAAEgL,MAAQD,EACV/K,EAAEuK,UAAYvK,EAAEiL,WAChBJ,EAAc7K,EAAEkL,QAAUlL,EAAEgL,aACrBhL,EAAEkL,cACFlL,EAAEiL,aAEblJ,EAAKiH,MAAMf,QAAQ6C,QAAQ9K,IACvBA,EAAEmL,OAASN,EAAc7K,EAAEmL,QAC3BnL,EAAEqD,OAASwH,EAAc7K,EAAEqD,UAE/BtB,EAAKmH,MAAMxB,OAAOoD,QAAQ9K,IACV,WAAVA,EAAE+J,MAAkB/J,EAAE+J,IAAM,SAClB,eAAV/J,EAAE+J,MAAsB/J,EAAE+J,IAAM,aACrB,YAAX/J,EAAE4H,OAAoB5H,EAAEoG,OAAS,WACtB,SAAXpG,EAAE4H,OAAiB5H,EAAEoG,OAAS,QACnB,SAAXpG,EAAE4H,OAAiB5H,EAAEoG,OAAS,SAGtC,OAAOrE,EAwHEqJ,CAAUzH,IACZuF,MAAQL,EAAUlF,EAAKuF,OAC5BvF,EAAKqF,MApGT,SAAmBjH,GACjB,MAAMuH,GACJoB,iBAAkB3I,EAAK2I,kBA+CzB,OA7CApB,EAAS+B,mBAAqBtJ,EAAKuH,SAASgB,YAAYC,UAAUF,QAClEf,EAASE,UAAYzH,EAAKuH,SAASE,UAAUI,UACzCN,EAASE,UAAUK,QACrBP,EAASE,UAAUK,MAAQ9H,EAAKuH,SAASE,UAAUK,MAAME,IACxB,WAA7BT,EAASE,UAAUK,QACrBP,EAASE,UAAUK,MAAQ,UAGE,YAA7BP,EAASE,UAAUI,QACrBN,EAASE,UAAUU,MAAQ/D,EAAGmF,kBAEhChC,EAASG,SAAW1H,EAAKuH,SAASG,SAASG,UACvC7H,EAAKuH,SAASG,SAASI,QACzBP,EAASG,SAASI,MAAQ9H,EAAKuH,SAASG,SAASI,MAAME,IACvB,WAA5BT,EAASG,SAASI,QACpBP,EAASG,SAASI,MAAQ,UAG9BP,EAASI,aACL3H,EAAKuH,SAASI,UAAUzH,OAC1BqH,EAASI,UAAUzH,KAAOF,EAAKuH,SAASI,UAAUzH,KAAK8H,IACvB,WAA5BT,EAASI,UAAUzH,OACrBqH,EAASI,UAAUzH,KAAO,UAG9BqH,EAASI,UAAUU,KAAOrI,EAAKuH,SAASI,UAAUU,KAClDd,EAASI,UAAUW,QAAUtI,EAAKuH,SAASI,UAAUW,QACrDf,EAASiC,eAAiBxJ,EAAKuH,SAASI,UAAUE,UAC9C7H,EAAKuH,SAASI,UAAUG,QAC1BP,EAASiC,eAAe1B,MAAQ9H,EAAKuH,SAASI,UAAUG,MAAME,IACxB,WAAlCT,EAASiC,eAAe1B,QAC1BP,EAASiC,eAAe1B,MAAQ,UAGE,YAAlCP,EAASiC,eAAe3B,QAC1BN,EAASiC,eAAerB,MAAQ/D,EAAGmF,kBAErChC,EAASkC,YAAczJ,EAAKuH,SAASK,KAAKU,QAC1Cf,EAASmC,UAAY1J,EAAKuH,SAASK,KAAKC,UACxCN,EAASoC,aACTpC,EAASoC,UAAUtB,KAAOrI,EAAKuH,SAASK,KAAKa,MAAMJ,KACnDd,EAASoC,UAAUrB,QAAUtI,EAAKuH,SAASK,KAAKa,MAAMH,QACtDf,EAASoB,iBAAmB3I,EAAK2I,kBAAoB3I,EAAKjB,MAAM6K,UAChErC,EAASsC,OAAS7J,EAAKuH,SAASC,eAG9B1B,GAAI9F,EAAK8F,GACT3D,KAAMnC,EAAKmC,KACX4D,SAAU/F,EAAK+F,SACfC,cAAe,OACfC,SAAUjG,EAAKiG,SACfvG,OAAQM,EAAKN,OACbiG,OAAQ3F,EAAK2F,OACbO,QAASlG,EAAKkG,QACdnH,OAAQ+K,OAAQ9J,EAAKjB,OACrB0H,SAAUzG,EAAKyG,SACfC,SAAU1G,EAAK0G,SACfC,QAAS3G,EAAK2G,QACdY,SAAUA,EACVR,UAAW/G,EAAK+G,WAqCHgD,CAAUnI,EAAKqF,QAEzBrF,EAAKqF,MAAMC,eAAe,oBACtBtF,EAAKuF,MAAMnB,qBACXpE,EAAKqF,MAAMjB,qBACXpE,EAAKuF,MAAMlB,gBACXrE,EAAKqF,MAAMhB,SAClBrE,EAAKuF,MAAM6C,QAAU,yEACrBpI,EAAKqF,MAAM+C,QAAU,0EAEhBpI,SA6GPqI,eAzGF,SAAwBjK,GACtB,GAAIA,EAAKkH,eAAe,SAAU,OAAOlH,EACzC,MAAMkK,EAAM,IAAIC,KACVC,EAAOpK,EAAKkH,eAAe,SAC3BtF,EAAOwI,EAAOpD,EAAehH,GAnDrC,SAAsBA,GACpB,IAAI4B,EAAO5B,EAoBX,OAnBM4B,EAAKsF,eAAe,kBAAoBtF,EAAKsF,eAAe,aAChEtF,EAAO8D,EAAiB9D,IAEA,OAAtBA,EAAKoE,gBAEPpE,EAAOkF,EADPlF,EAzIJ,SAAmB5B,GAcjB,OAbAA,EAAKkG,QAAQ6C,QAAQ,CAAC9K,EAAG+K,KACvB/K,EAAEgL,MAAQD,EACV/K,EAAEuK,UAAYvK,EAAEiL,kBACTjL,EAAEkL,cACFlL,EAAEiL,aAEXlJ,EAAK2F,OAAOoD,QAAQ9K,IACJ,WAAVA,EAAE+J,MAAkB/J,EAAE+J,IAAM,SAClB,eAAV/J,EAAE+J,MAAsB/J,EAAE+J,IAAM,aACrB,YAAX/J,EAAE4H,OAAoB5H,EAAEoG,OAAS,WACtB,SAAXpG,EAAE4H,OAAiB5H,EAAEoG,OAAS,QACnB,SAAXpG,EAAE4H,OAAiB5H,EAAEoG,OAAS,SAE7BrE,EA2HEqK,CAAUzI,KAGdA,EAAKsF,eAAe,oBAChBtF,EAAKoE,qBACLpE,EAAKqE,SACZrE,EAAKoI,QAAU,0EAEjBpI,EAAK+D,OAAOoD,QAAQ9K,IACJ,cAAVA,EAAE+J,MACJ/J,EAAEoG,OAAS,cAENpG,EAAEqM,aACFrM,EAAEsM,SAEJ3I,EA8BoC4I,CAAaxK,GAClDmH,EAAQiD,EAAOxI,EAAKuF,MAAQvF,EAC5B6I,GACJT,QAAS,0DACT7H,KAAMP,EAAKqF,MAAM9E,KACjBuI,SACAC,YA0FF,OAxFAF,EAAME,QAAQC,MACZZ,QAAS,6DACTa,aAAc1D,EAAMrB,GACpB3D,KAAMgF,EAAMhF,KACZ2I,WACEd,QAAS7C,EAAM6C,QACfe,WAAY5D,EAAMJ,UAAUiE,SAC5B7I,KAAMgF,EAAMhF,KACZwD,OAAQwB,EAAMxB,OACdO,QAASiB,EAAMjB,QACfS,QAASQ,EAAMR,QACfjH,OAAQyH,EAAMzH,OACdX,MAAOoI,EAAMpI,MACb2H,SAAUS,EAAMT,SAChBD,SAAUU,EAAMV,aAGpBgE,EAAMC,MAAME,MACVZ,QAAS,2DACTiB,OAAQ9D,EAAMrB,GACd3D,KAAMgF,EAAMhF,KACZ+I,SAAU,WACVC,KAAMhE,EAAMrB,GACZH,OAAQwB,EAAMxB,OACdyF,UAAW,KACXC,WAAY,KACZC,cACEC,KAAM,UACNC,KAAMtB,EAAI3F,WACVkH,YAAa,mCAGbrB,IACFK,EAAME,QAAQC,MACZZ,QAAS,6DACTa,aAAcjJ,EAAKqF,MAAMnB,GACzB3D,KAAMP,EAAKqF,MAAM9E,KACjB2I,WACEd,QAASpI,EAAKqF,MAAM+C,QACpBe,WAAYnJ,EAAKqF,MAAMF,UAAUiE,SACjC7I,KAAMP,EAAKqF,MAAM9E,KACjBwD,OAAQ/D,EAAKqF,MAAMtB,OACnBO,QAAStE,EAAKqF,MAAMf,QACpBS,QAAS/E,EAAKqF,MAAMN,QACpBjH,OAAQkC,EAAKqF,MAAMvH,OACnBX,MAAO6C,EAAKqF,MAAMlI,MAClB2H,SAAU9E,EAAKqF,MAAMP,SACrBD,SAAU7E,EAAKqF,MAAMR,aAGzBgE,EAAMC,MAAME,MACVZ,QAAS,0DACTiB,OAAQrJ,EAAKqF,MAAMnB,GACnB3D,KAAMP,EAAKqF,MAAM9E,KACjB+I,SAAU,UACV/D,MAAOA,EAAMrB,GACbmB,MAAOrF,EAAKqF,MAAMnB,GAClB2B,UAAW7F,EAAKqF,MAAMM,SAASE,UAC/BC,SAAU9F,EAAKqF,MAAMM,SAASG,SAC9BC,UAAW/F,EAAKqF,MAAMM,SAASI,UAC/B6B,eAAgB5H,EAAKqF,MAAMM,SAASiC,eACpCE,UAAW9H,EAAKqF,MAAMM,SAASmC,UAC/BC,UAAW/H,EAAKqF,MAAMM,SAASoC,UAC/BhB,iBAAkB/G,EAAKqF,MAAMM,SAASoB,iBACtC+C,uBAAwB9J,EAAKqF,MAAMM,SAASmE,uBAC5CpE,eAAgB1F,EAAKqF,MAAMM,SAASD,eACpCuC,OAAQjI,EAAKqF,MAAMM,SAASsC,OAC5ByB,cACEC,KAAM,UACNC,KAAMtB,EAAI3F,WACVkH,YAAa,oCAInBhB,EAAMC,MAAMiB,OAAO1N,GAAoB,YAAfA,EAAEiN,UACvBnC,QAAQjG,IACPA,EAAK8I,YAAc9I,EAAK4I,uBACxB5I,EAAK+I,gBAAkB/I,EAAK6F,iBACxB7F,EAAKoE,eAAe,eACtBpE,EAAK6E,UAAUG,MAAQhF,EAAK6E,UAAUzH,MAEpC4C,EAAKoE,eAAe,eACtBpE,EAAK6G,UAAU7B,MAAQ,UAErBhF,EAAKoE,eAAe,eACtBpE,EAAK4G,UAAU5B,MAAQ,YAGtB2C,IClZT,MAAM7J,GACJkL,MAAO,2BAGT,IAAIC,EAAM,IAAIC,EAAM,SAoBpB,SAASC,IACP,OAAOF,EAAID,MACRI,QAAQ,kBACRC,UACAC,UAoFL,SAASC,EAAWC,EAASC,GAC3B,OAAOR,EAAID,MACRU,MAAM,WACNC,OAAOH,GACPI,OAAOH,GACPI,MAAMlM,IACL/B,QAAQ8B,MAAM,0BAA2BC,KAjH/CsL,EAAIa,QAAQ,GAAGC,OAAOjM,UAmQpBkM,MA5PF,WACE,OAAOf,EAAIgB,SAASvN,KAAK,MACvBuM,EAAM,IAAIC,EAAM,UACZY,QAAQ,GAAGC,OAAOjM,MAyPjBqL,YAAAA,EAAae,QAnOtB,SAAiBV,GACf,OAAOP,EAAID,MACRU,MAAM,WACNC,OAAOH,GACPW,QACAN,MAAMlM,IACL/B,QAAQ8B,wCAAwC8L,IAAW7L,MA6NlCyM,WAnN/B,SAAoBtL,GAEbA,EAAKsF,eAAe,WACvBtF,EAAOuL,EAAOlD,eAAerI,IAE/B,MAAMsI,EAAM,IAAIC,KAGhB,OAFAvI,EAAK0K,QAAUc,EAAK1I,SAASvD,MAAM,EAAG,GACtCS,EAAKyL,eAAiBnD,EAAI3F,WACnBwH,EAAID,MAAMwB,IAAI1L,IA2MoB2L,YAlM3C,SAAqBtN,GACnB,MACMuL,GADM,IAAIrB,MACCqD,eAAe,SAAWC,SAAU,eAC/CnB,EAAUc,EAAK1I,SAASvD,MAAM,EAAG,GACjC8J,EAASmC,EAAK1I,SAASvD,MAAM,EAAG,GAChC0J,EAAe5K,EAAS8K,WAAW5J,MAAM,EAAG,GAC5CS,GACJoI,QAAS,0DACTsC,QAASA,EACTnK,KAAM8I,EACNP,QAEIV,QAAS,2DACTiB,OAAQA,EACR9I,KAAM8I,EACNC,SAAU,WACVC,KAAMN,EACNS,cACGC,KAAM,WAAYC,KAAMA,MAI/Bb,UAEIX,QAAS,6DACTa,aAAcA,EACdC,UAAW7K,KAGfoN,eAAgB7B,GAElB,OAAOO,EAAID,MAAMwB,IAAI1L,GAClBpC,KAAK,MAAQ8M,QAASA,EAASrB,OAAOA,MAkKaoB,WAAAA,EAAYqB,WAxIpE,SAAoBpB,GAClB,OAAOP,EAAID,MACRU,MAAM,WACNC,OAAOH,GACPS,UAqIHY,QA3HF,SAAiBrB,EAASrB,GACxB,OAAOgB,IACJzM,KAAKsM,GAASA,EAAM/D,KAAK9J,GAAKA,EAAEqO,UAAYA,GAAS5B,OACrDlL,KAAKkL,IACJ,MAAM5H,EAAO4H,EAAM3C,KAAK9J,GAAKA,EAAEgN,SAAWA,GAC1C,GAAKnI,EAEL,OADAA,EAAKwJ,QAAUA,EACRxJ,KAoHF8K,WAzGX,SAAoBtB,EAASrB,EAAQ4C,GACnC,OAAOxB,EAAWC,EAASwB,IACzB,MAAMC,EAAMD,EAAKpD,MAAMsD,UAAU/P,GAAKA,EAAEgN,SAAWA,GACnD6C,EAAKpD,MAAMuD,OAAOF,EAAM,EAAG,EAAGF,MAsGXK,WA3FvB,SAAoB5B,EAASrB,EAAQ4C,GACnC,OAAOxB,EAAWC,EAASwB,IACzB,MAAMC,EAAMD,EAAKpD,MAAMsD,UAAU/P,GAAKA,EAAEgN,SAAWA,GAC/C/M,EAAEiQ,WAAWN,GACfA,EAAQC,EAAKpD,MAAMqD,IAEnBD,EAAKpD,MAAMqD,GAAOF,KAqFWO,WA1EnC,SAAoB9B,EAASrB,GAC3B,OAAOoB,EAAWC,EAASwB,IACzB,MAAMC,EAAMD,EAAKpD,MAAMsD,UAAU/P,GAAKA,EAAEgN,SAAWA,GACnD6C,EAAKpD,MAAMuD,OAAOF,EAAK,GAEvB,MAAMM,KACNP,EAAKnD,QAAQ5B,QAAQ9K,IAAOoQ,EAAIpQ,EAAE4M,cAAgB,IAClDiD,EAAKpD,MAAM3B,QAAQjG,KAChB,OAAQ,QAAS,QAAS,SACxB6I,OAAO1N,GAAK6E,EAAKoE,eAAejJ,IAChC8K,QAAQ9K,IAAOoQ,EAAIvL,EAAK7E,KAAO,MAEpCgB,OAAOqP,QAAQD,GAAKtF,QAAQwF,IAC1B,IAAKA,EAAM,GAAI,CACb,MAAMvF,EAAI8E,EAAKnD,QAAQqD,UAAU/P,GAAKA,EAAE4M,eAAiB0D,EAAM,IAC/DT,EAAKnD,QAAQsD,OAAOjF,EAAG,SA4D7BwF,cA/CF,SAAuBlC,EAASmC,GAC9B,OAAOxC,IACJzM,KAAKsM,GAASA,EAAM/D,KAAK9J,GAAKA,EAAEqO,UAAYA,GAAS3B,SACrDnL,KAAKkP,IACJ,MAAMC,EAAOD,EAAM3G,KAAK9J,GAAKA,EAAE4M,eAAiB4D,GAChD,GAAKE,EAEL,OADAA,EAAKrC,QAAUA,EACRqC,KAwCIC,iBA7BjB,SAA0BtC,EAASmC,EAAQI,GACzC,OAAOxC,EAAWC,EAASwB,IACzB,MAAMC,EAAMD,EAAKnD,QAAQqD,UAAU/P,GAAKA,EAAE4M,eAAiB4D,GAC3DX,EAAKnD,QAAQsD,OAAOF,EAAM,EAAG,EAAGc,MA0BDC,iBAfnC,SAA0BxC,EAASmC,EAAQI,GACzC,OAAOxC,EAAWC,EAASwB,IACzB,MAAMC,EAAMD,EAAKnD,QAAQqD,UAAU/P,GAAKA,EAAE4M,eAAiB4D,GACvDvQ,EAAEiQ,WAAWU,GACfA,EAAQf,EAAKnD,QAAQoD,IAErBD,EAAKnD,QAAQoD,GAAOc,MCtQ1B,MAAME,EAAc,yBA4IlBA,YAAAA,EAAaC,UAzIf,SAAmBC,EAAWxG,EAAO8C,GACnC0D,EACKC,QAAQ,cAAc,GACtBA,QAAQ,QAAQ,GAClBC,OAAO,UACLD,QAAQ,OAAO,GACfA,eAAe3D,KAAQ,GACvB2D,QAAQ,UAAU,GAClBhP,KAAKuI,IAiIc2G,WA7H1B,SAAoBH,EAAWxG,EAAO8C,GACpC0D,EACKC,QAAQ,OAAO,GACfA,eAAe3D,KAAQ,GACvB2D,QAAQ,UAAU,GAClBA,QAAQ,QAAQ,GAChBhP,KAAKuI,IAuH0B4G,eAnHtC,SAAwBJ,EAAWxG,EAAO8C,EAAM+D,GAC9CL,EACKC,QAAQ,OAAO,GACfA,eAAe3D,KAAQ,GACvB2D,QAAQ,UAAU,GAClBA,QAAQ,QAAQ,GAChBK,KAAK,OAAQ,UACbA,KAAK,OAAQ,KAClBN,EAAUE,OAAO,OACZI,KAAK,MAAOD,KAAUP,IAAcO,QAAa,MACjDE,MAAM,QAAS,WACfA,MAAM,SAAU,WACrBP,EAAUE,OAAO,QACZK,MAAM,iBAAkB,UACxBtP,KAAKuI,IAqG0CgH,cAjGtD,SAAuBR,EAAW3N,EAAQmH,EAAO8C,EAAM+D,GACrDL,EACKC,QAAQ,OAAO,GACfA,eAAe3D,KAAQ,GACvB2D,QAAQ,UAAU,GAClBA,QAAQ,QAAQ,GAChBK,KAAK,OAAQ,KACbA,KAAK,OAAQ,UACbA,KAAK,cAAe,SACpBA,KAAK,kBAAmBjO,KAC7B2N,EAAUE,OAAO,OACZI,KAAK,MAAOD,KAAUP,IAAcO,QAAa,MACjDE,MAAM,QAAS,WACfA,MAAM,SAAU,WACrBP,EAAUE,OAAO,QACZD,QAAQ,SAAS,GACjBM,MAAM,iBAAkB,UACxBtP,KAAKuI,IAiFViH,mBA7EF,SAA4BT,EAAWxG,EAAO8C,EAAM+D,GAClDL,EACKC,QAAQ,aAAa,GACrBA,QAAQ,QAAQ,GACrB,MAAMS,EAASV,EAAUE,OAAO,UAC3BD,QAAQ,OAAO,GACfA,eAAe3D,KAAQ,GACvB2D,QAAQ,UAAU,GAClBA,QAAQ,mBAAmB,GAC3BK,KAAK,cAAe,YACzBI,EAAOR,OAAO,OACTI,KAAK,MAAOD,KAAUP,IAAcO,QAAa,MACjDE,MAAM,QAAS,WACfA,MAAM,SAAU,WACrBG,EAAOR,OAAO,QACTK,MAAM,iBAAkB,UACxBtP,KAAKuI,GACVwG,EAAUE,OAAO,OACZD,QAAQ,iBAAiB,IA2DVU,iBAvDtB,SAA0BX,EAAWxG,EAAO6G,GAC1CL,EAAUC,QAAQ,iBAAiB,GAC9BK,KAAK,OAAQ,KAClBN,EAAUE,OAAO,OACZI,KAAK,MAAOD,KAAUP,IAAcO,QAAa,MACjDJ,QAAQ,QAAQ,GAChBM,MAAM,QAAS,QACfA,MAAM,SAAU,QACrBP,EAAUE,OAAO,QACZjP,KAAKuI,IA8C4BoH,kBA3CxC,SAA2BZ,EAAWxG,EAAOnH,EAAQgO,GACnDL,EAAUC,QAAQ,iBAAiB,GAC9BK,KAAK,OAAQ,KACbA,KAAK,cAAe,SACpBA,KAAK,kBAAmBjO,KAC7B2N,EAAUE,OAAO,OACZI,KAAK,SAAUR,IAAcO,SAC7BJ,QAAQ,QAAQ,GAChBM,MAAM,QAAS,QACfA,MAAM,SAAU,QACrBP,EAAUE,OAAO,QACZjP,KAAKuI,IAiCVqH,iBA7BF,SAA0Bb,EAAWxG,EAAOsH,EAAQT,GAClDL,EAAUC,QAAQ,iBAAiB,GAC9BK,KAAK,OAAQ,KACbS,GAAG,QAAS,WACX5L,EAAG6L,OAAOC,MAAMD,OAAO,SAASE,OAAOC,UAE7CnB,EAAUE,OAAO,QACZK,MAAM,UAAW,QACnBL,OAAO,SACLI,KAAK,OAAQ,QACbA,KAAK,SAAUQ,GACpBd,EAAUE,OAAO,OACZI,KAAK,SAAUR,IAAcO,SAC7BJ,QAAQ,QAAQ,GAChBM,MAAM,QAAS,QACfA,MAAM,SAAU,QACrBP,EAAUE,OAAO,QACZjP,KAAKuI,IAYQ4H,sBARpB,SAA+BpB,GAC7B,OAAOA,EAAUgB,OAAO,SAASE,OAAOG,MAAM,KCtIhD,SAASC,EAAWtB,EAAWnJ,GAC7BmJ,EACKC,QAAQ,SAAS,GACjBK,KAAK,YAAa,GAClBA,KAAK,OAAQ,UACbA,KAAK,kBAAmB,IACxBA,KAAK,eAAe,GACpBA,KAAK,KAAMzJ,GAChBmJ,EAAUE,OAAO,OACZD,QAAQ,gBAAgB,GACxBK,KAAK,OAAQ,YACfJ,OAAO,OACLD,QAAQ,iBAAiB,UAiF9BsB,cA7EF,SAAuBvB,EAAWnJ,GAChC,MAAM2K,EAAOxB,EAAUyB,KAAKH,EAAYzK,GACnCmK,OAAO,kBAEZQ,EAAKtB,OAAO,OACPD,QAAQ,cAAc,GACxBC,OAAO,OACLD,QAAQ,WAAW,GAExB,MAAMyB,EAASF,EAAKtB,OAAO,OACtBD,QAAQ,gBAAgB,GAC7ByB,EAAOxB,OAAO,UACTD,QAAQ,OAAO,GACfA,QAAQ,yBAAyB,GACjCA,QAAQ,UAAU,GAClBK,KAAK,OAAQ,UACbA,KAAK,eAAgB,SACrBrP,KAAK,UACVyQ,EAAOxB,OAAO,UACTD,QAAQ,OAAO,GACfA,QAAQ,eAAe,GACvBA,QAAQ,MAAM,GACdK,KAAK,OAAQ,UACbA,KAAK,eAAgB,SACrBA,KAAK,iBAAkBzJ,YACvB5F,KAAK,MACL8P,GAAG,QAAS,KACX5L,EAAG6L,OAAO,iBAAiBT,MAAM,UAAW,UAC5CP,EAAU2B,SAAS,aAiDVC,oBA5CjB,SAA6B5B,EAAW6B,GACtC7B,EAAUgB,OAAO,YAAY/P,KAAK4Q,IA2CEC,aAvCtC,SAAsB9B,EAAWnJ,EAAIkL,GACnC,MAAMP,EAAOxB,EAAUyB,KAAKH,EAAYzK,GACnCmK,OAAO,kBAENgB,EAASR,EAAKtB,OAAO,OACtBD,QAAQ,gBAAgB,GAC7B+B,EAAO9B,OAAO,MACTD,QAAQ,eAAe,GACvBhP,KAAK8Q,GACVC,EAAO9B,OAAO,UACTI,KAAK,OAAQ,UACbA,KAAK,eAAgB,SACrBA,KAAK,aAAc,SACnBL,QAAQ,SAAS,GACnBC,OAAO,QACLI,KAAK,eAAe,GACpB2B,KAAK,WAEVT,EAAKtB,OAAO,OACPD,QAAQ,cAAc,GAE3BuB,EAAKtB,OAAO,OACPD,QAAQ,gBAAgB,GAC1BC,OAAO,UACLD,QAAQ,OAAO,GACfA,QAAQ,eAAe,GACvBA,QAAQ,UAAU,GAClBK,KAAK,OAAQ,UACbA,KAAK,eAAgB,SACrBA,KAAK,iBAAkBzJ,YACvB5F,KAAK,UACL8P,GAAG,QAAS,KACX5L,EAAG6L,OAAO,iBAAiBT,MAAM,UAAW,UAC5CP,EAAU2B,SAAS,cClF3B,SAASO,EAAcC,GACrB,MAAMC,KAIN,OAHApS,OAAOqP,QAAQ8C,EAAQA,SAASrI,QAAQuI,IACtCD,EAAWC,EAAE,KAAOA,EAAE,OAGtB3K,QAASyK,EAAQzK,QACjBhB,QAASyL,EAAQtJ,OACjBE,IAAKoJ,EAAQpJ,IACboJ,QAASC,UA2GXF,cAAAA,EAAeI,eAjGjB,SAAwBH,GACtB,MAAMI,EAAKJ,EAAQlK,eAAe,SAAWiK,EAAcC,GAAWA,EAatE,OAVEzL,SAFgBqC,IAAKwJ,EAAGxJ,IAAK3D,OAAQ,SAElBoN,OAAOD,EAAG7L,QAC7BO,QAASjH,OAAOqP,QAAQkD,EAAGJ,SAASpT,IAAIuQ,IACtC,MAAMmD,KAKN,OAJAA,EAAIF,EAAGxJ,KAAOuG,EAAM,GACpBiD,EAAG7L,OAAOoD,QAAQ,CAAC4I,EAAG3I,KACpB0I,EAAIC,EAAE3J,KAAOuG,EAAM,GAAGvF,KAEjB0I,MAsFoBE,eAzEjC,SAAwBC,EAAO7J,EAAK8J,GAAQ,UAC1C,MACMV,GACJzK,SAFU,IAAIwD,MAED5F,WACboB,OAAQkM,EAAMlM,OAAOgG,OAAO1N,GAAKA,EAAE+J,MAAQA,GACxC2D,OAAO1N,IAAM6T,EAAOjO,SAAS5F,EAAE+J,MAClCA,IAAKA,EACLoJ,YAKF,OAHAS,EAAM3L,QAAQ6C,QAAQgJ,IACpBX,EAAQA,QAAQW,EAAI/J,IAAQoJ,EAAQzL,OAAO3H,IAAIC,GAAK8T,EAAI9T,EAAE+J,QAErDoJ,GA6DwCY,aApDjD,SAAsBC,GACpB,MAAMC,EAAQD,EAAUlU,MAAM,cACxBkT,EAASiB,EAAMC,QAAQpU,MAAM,KAC7BiK,EAAMiJ,EAAOkB,QACbjI,EAAM,IAAIC,KACViI,KACAzM,KACNsL,EAAOlI,QAAQ,CAACsJ,EAAGrJ,KACP,KAANqJ,IACJD,EAAUxH,KAAK5B,GACfrD,EAAOiF,MAAM5C,IAAKqK,EAAGhO,OAAQ,YAE/B,MAAM+M,GACJzK,QAASuD,EAAI3F,WACboB,OAAQA,EACRqC,IAAKA,EACLoJ,YAUF,OARAc,EAAMnJ,QAAQuJ,IACZ,MAAMC,EAASD,EAAKvU,MAAM,KACpByU,EAAID,EAAOJ,QACjBf,EAAQA,QAAQoB,GAAKC,MAAML,EAAUjT,QACrCiT,EAAUrJ,QAAQC,IAChBoI,EAAQA,QAAQoB,GAAGxJ,GAAKuJ,EAAOvJ,OAG5BoI,GA0BsDsB,MAhB/D,SAAe9Q,EAAMwP,GACnB,MAAMI,EAAKJ,EAAQlK,eAAe,SAAWiK,EAAcC,GAAWA,EACtExP,EAAKsE,QACFyF,OAAO+F,GAAOF,EAAGJ,QAAQlK,eAAewK,EAAIF,EAAGxJ,OAC/Ce,QAAQ2I,IACPF,EAAG7L,OAAOoD,QAAQ,CAAC4J,EAAI3J,KACrB0I,EAAIiB,EAAG3K,KAAOwJ,EAAGJ,QAAQM,EAAIF,EAAGxJ,MAAMgB,OAG5CpH,EAAK+D,OAAUzH,EAAE0D,EAAK+D,QACnB8L,OAAOD,EAAG7L,QACViN,OAAO,OACP7O,gBCjHgB8O,EAMnBC,YAAYnE,GAEVuB,KAAK6C,UAAY,QAEjB7C,KAAKrF,aAAe8D,EAAK9D,cAAgB,KACzCqF,KAAK5D,QAAUqC,EAAKrC,SAAW,KAC/B4D,KAAK/N,KAAOwM,EAAKxM,MAAQ,KACzB+N,KAAKpF,SAAW6D,EAAK7D,WAAa6D,GAClCuB,KAAKvK,UACLuK,KAAKpF,SAAS/B,QAAQiK,IACpBA,EAAQrN,OAAOoD,QAAQ9K,GAAKiS,KAAK+C,SAAShV,MAQ9C6U,SAAShL,GACHoI,KAAKvK,OAAOoC,KAAK9J,GAAKA,EAAE+J,MAAQF,EAAME,OACrCF,EAAMZ,eAAe,UAASY,EAAM3F,KAAO2F,EAAME,KACjDF,EAAMZ,eAAe,aAAYY,EAAMQ,SAAU,GAClDR,EAAMZ,eAAe,eAAcY,EAAMzD,OAAS,aACjDyD,EAAMZ,eAAe,YAAWY,EAAMzD,OAAS,OACpD6L,KAAKvK,OAAOiF,KAAK9C,IAOnBgL,aAAaI,GACXhD,KAAKvK,UACLuN,EAAGnK,QAAQ9K,GAAKiS,KAAK+C,SAAShV,IAOhC6U,WAAW1B,GACTlB,KAAKpF,SAAS/B,QAAQnE,IACpBuO,EAAOT,MAAM9N,EAAGwM,KAEdA,EAAQlK,eAAe,UACzBkK,EAAQzL,OAAOoD,QAAQ9K,GAAKiS,KAAK+C,SAAShV,IAE1CiS,KAAK+C,SAAS7B,EAAQtJ,OAQ1BgL,UACE,OAAO5U,EAAEkV,QAAQlD,KAAKpF,SAAS9M,IAAIC,GAAKA,EAAEiI,UAG5C4M,MAAMO,GACJ,MAAMH,EAAKhD,KAAKpF,SACba,OAAO1N,IAAM,UAAW,QAAS,cAAe,UAAU4F,SAAS5F,EAAEyB,SACrE1B,IAAIgV,IACH,MAAMjU,GAAS+G,GAAIkN,EAAQjI,WAAYsI,QAASA,GAChD,OAAOC,EAAQzU,IAAI,WAAYE,GAC5BS,KAAK8T,EAAQtT,MACbR,KAAKoC,GACGmK,EAAI+C,iBAAiBoB,KAAK5D,QAAS4D,KAAKrF,aAAc8D,IAC3D,MAAM3F,EAAI2F,EAAK7D,SACZkD,UAAU/P,GAAKA,EAAE8M,aAAehM,EAAM+G,IACrB,YAAhBlE,EAAKlC,OACPiP,EAAK7D,SAAS9B,GAAGtJ,OAAS,UAE1BiP,EAAK7D,SAAS9B,GAAKpH,OAK/B,OAAOjC,QAAQ4T,IAAIL,GAChB1T,KAAK,IAAMuM,EAAIyC,cAAc0B,KAAK5D,QAAS4D,KAAKrF,eAChDrL,KAAKmP,IACJuB,KAAKpF,SAAW6D,EAAK7D,WAQ3BgI,OACE,OAAO5C,KAAK5Q,MAAM,QAQpBwT,QACE,OAAO5C,KAAK5Q,MAAM,SAOpBwT,OACE,OAAO5U,EAAEsV,IAAItD,KAAKpF,SAAS9M,IAAIC,GAAKA,EAAEiI,QAAQ/G,SAOhD2T,SACE,OAAI5C,KAAKpF,SAAS2I,KAAKxV,GAAkB,gBAAbA,EAAEyB,QAAkC,cAC5DwQ,KAAKpF,SAAS2I,KAAKxV,GAAkB,YAAbA,EAAEyB,QAA8B,UACxDwQ,KAAKpF,SAAS2I,KAAKxV,GAAkB,WAAbA,EAAEyB,QAA6B,SACvDwQ,KAAKpF,SAAS2I,KAAKxV,GAAkB,UAAbA,EAAEyB,QAA4B,QACtDwQ,KAAKpF,SAAS2I,KAAKxV,GAAkB,YAAbA,EAAEyB,QAA8B,UACxDwQ,KAAKpF,SAAS2I,KAAKxV,GAAkB,YAAbA,EAAEyB,QAA8B,UACrD,OAOToT,UAEE,OADW,QAAS,SAAU,UAAW,eAChCjP,SAASqM,KAAKxQ,UAOzBoT,WACE,OAAO5U,EAAEwV,IAAIxD,KAAKpF,SAAS9M,IAAIC,GAAKA,EAAEwI,WAOxCqM,WACE,OAAO5U,EAAEsV,IAAItD,KAAKpF,SAAS9M,IAAIC,GAAKA,EAAEyI,WAOxCoM,SACE,OACE9I,QAAS,6DACTa,aAAcqF,KAAKrF,aACnB1I,KAAM+N,KAAK/N,KACXwD,OAAQuK,KAAKvK,OACbmF,SAAUoF,KAAKpF,WClKrB,SAAS6I,EAAa1E,EAAW2E,GAC/B,MAAM3C,EAAShC,EAAUgB,OAAO,cAChCgB,EAAO4C,UAAU,aAAaC,SAC9B7C,EAAO4C,UAAU,aAAajS,KAAKgS,EAAMG,eACtCC,QAAQ7E,OAAO,OACbD,QAAQ,YAAY,GACpBwB,KAAKkD,EAAMK,oBAIlB,SAASC,EAAWjF,EAAW2E,GAC7B,MAAMzI,EAAO8D,EAAUgB,OAAO,YAC3B4D,UAAU,WACRjS,KAAKgS,EAAMO,gBAAiBP,EAAMQ,SACvCjJ,EAAKkJ,OAAOP,SACZ3I,EAAK0I,UAAU,YAAYC,SAC3B3I,EAAK6I,QACF7E,OAAO,OACLI,KAAK,QAAS,UACdC,MAAM,WAAY,YAClBA,MAAM,QAAS,QACjB8E,MAAMnJ,GACJqE,MAAM,YAAaoE,EAAMW,eACzBC,KAAK,SAAUC,EAAGzL,GACjB,MAAM0L,EAAWd,EAAMe,YAAc3L,EAC/B4L,EAASF,EAAWd,EAAMW,UAChCnQ,EAAG6L,OAAOC,MACPV,MAAM,8BAA+BoF,QACrC1F,QAAQ,MAAO,EAAa,GAAM,GAClCwB,KAAKkD,EAAMiB,aAAcJ,KAKpC,SAASK,EAAe7F,EAAW2E,EAAOmB,GACxC9F,EAAUgB,OAAO,YAAYT,MAAM,YAAaoE,EAAMoB,gBACtDpB,EAAMqB,kBAAkBF,GACxB9F,EAAUyB,KAAKwD,EAAYN,EAAOmB,GAClC9F,EAAUgB,OAAO,gBAAgBE,OAAO+E,UAAYH,EAAYnB,EAAMW,UAIxE,SAASY,EAAOlG,EAAW2E,GACzB,MAAMwB,EAAWnG,EAAUgB,OAAO,gBAC5B0E,EAAcS,EAASjF,OAAOkF,wBAAwBC,IAC5D1B,EAAM2B,eAAe5X,OAAO6X,YAAcb,EAAc,GACxDS,EAAS5F,MAAM,YAAaoE,EAAM6B,2BAqClCxB,mBA1FF,SAA4BhD,GAC1BA,EAAOzB,MAAM,UAAW,gBACrBA,MAAM,QAASiF,MAAQA,EAAEnK,UACzBpK,KAAKuU,GAAKA,EAAEtS,OAuFKwR,aAAAA,EAAcO,WAAAA,EAAYY,eAAAA,EAC9CK,OAAAA,EAAQO,SAlCV,SAAkBzG,EAAW2E,GAC3B3E,EAAUE,OAAO,OACZD,QAAQ,aAAa,GAC1BD,EAAUE,OAAO,OACZD,QAAQ,eAAe,GACvBM,MAAM,aAAc,QACpBQ,GAAG,SAAU,WACZ,MAAMjC,EAAMjJ,KAAK6Q,MAAMzF,KAAKgF,UAAYtB,EAAMW,WAC1CxG,IAAQ6F,EAAMgC,sBAChBhC,EAAMqB,kBAAkBlH,GACxBkB,EAAUyB,KAAKwD,EAAYN,EAAO7F,MAGvCoB,OAAO,OACLD,QAAQ,WAAW,GACnBM,MAAM,WAAY,YACvBoE,EAAMiC,uBAAyB,MAC7BjC,EAAMkC,cACN7G,EAAUyB,KAAKiD,EAAcC,GAC7B3E,EAAUyB,KAAKyE,EAAQvB,GACvBA,EAAMmC,YACN9G,EAAUyB,KAAKoE,EAAgBlB,EAAOA,EAAMe,eAE9Cf,EAAMoC,qBAAuBjS,CAAAA,IAC3B6P,EAAMqC,cAAclS,GACpBkL,EAAUyB,KAAKoE,EAAgBlB,EAAO,KAExCA,EAAMiC,kCC3DNK,SAzBF,SAAkBjH,EAAWkH,EAAQrO,GACnC,IAAIsO,EAAKC,KAAKD,EAAKnU,MAAMkU,EAAOrO,EAAME,OACnCsO,WAAWrH,EAAUkB,QACrBoG,OAsBOC,cAlBZ,SAAuBC,GAErB,OADa,IAAIL,EAAKC,KAAKD,EAAKnU,MAAMwU,IAC1BC,WAAW,QAgBEC,gBAZ3B,SAAyBC,GACvB,OAAO,IAAIjX,QAAQI,IACjB,MAAMiB,EAAS,IAAIC,WACnBD,EAAOI,OAASC,CAAAA,IACdtB,EAAQsB,EAAMC,OAAOC,UAEvBP,EAAO6V,cAAcD,OClBzB,SAASE,EAAS7H,EAAWkH,EAAQrO,GACnCmH,EAAU/O,KAAKkN,EAAKtJ,UAAUqS,EAAOrO,EAAME,KAAMF,EAAMiP,YAIzD,SAAS7W,EAAK+O,EAAWkH,EAAQrO,GAC/BmH,EAAU/O,KAAKiW,EAAOrO,EAAME,MAU9B,SAASkJ,EAAKjC,EAAWkH,EAAQrO,GAC/BmH,EAAUiC,KAAKiF,EAAOrO,EAAME,MAI9B,SAASgP,EAAY/H,EAAWkH,EAAQrO,GACtCmH,EAAUE,OAAO,KACZI,KAAK,gCAAgC4G,EAAOrO,EAAME,QAClDuH,KAAK,SAAU,UACfrP,KAAKiW,EAAOrO,EAAME,MAIzB,SAASiP,EAAMhI,EAAWkH,EAAQrO,GAChCmH,EAAUE,OAAO,OACZI,KAAK,QAAS,KACdA,KAAK,SAAU,KACfA,KAAK,MAAO4G,EAAOrO,EAAME,MAGhC,SAASkP,EAASjI,EAAWkH,EAAQrO,GACnCmH,EAAUE,OAAO,SACZI,KAAK,OAAQ,YACb4H,SAAS,UAAWhB,EAAOrO,EAAME,MACjCmP,SAAS,aAAYrP,EAAMsP,UAAWjB,EAAOrO,EAAMsP,WACnDpH,GAAG,QAAS,WACXmG,EAAOrO,EAAME,KAAOkI,KAAKmH,UAIjC,SAASC,EAAUrI,EAAWkH,EAAQrO,GACpCmH,EAAUE,OAAO,SACZI,KAAK,OAAQ,QACbC,MAAM,QAAS,OACf2H,SAAS,QAAShB,EAAOrO,EAAME,MAC/BgI,GAAG,SAAU,WACZmG,EAAOrO,EAAME,KAAOkI,KAAKnM,QAIjC,SAAS2M,EAAKzB,EAAWlL,GACvBkL,EAAUyB,KAAK3M,GAIjB,MAAMwT,GACJC,QAAStX,EACTA,KAAMA,EACNsL,KAtDF,SAAcyD,EAAWkH,EAAQrO,GAE/BmH,EAAU/O,KAAKiW,EAAOrO,EAAME,OAqD5ByP,IAAKvX,EACL6W,UAAWD,EACXE,YAAaA,EACbU,SAAUxX,EACVyX,KAAMzX,EACN0X,KAAMC,EAAI3B,SACVe,MAAOA,EACPC,SAAUA,EACVY,WAAYR,EACZS,QAASrH,EACTsH,IAAK9G,EACLA,KAAMA,GAIR,SAAS+G,EAAQhJ,GACfA,EAAUC,QAAQ,WAAW,GAC1BA,QAAQ,gBAAgB,GACxBA,QAAQ,iBAAiB,GACzBM,MAAM,UAAW,uBAkBpBsH,SAAAA,OAAU5W,EAAMgR,KAAAA,EAAM8F,YAAAA,EAAaC,MAAAA,EAAOC,SAAAA,EAAUI,UAAAA,EAAW5G,KAAAA,EAC/DuH,QAAAA,EAASpD,WAfX,SAAoBlP,GAClB,MAAO,CAACsJ,EAAWkH,KACjBxQ,EAAOoD,QAAQjB,IACb,MAAMoQ,EAAOjJ,EAAUE,OAAO,OACzBuB,KAAKuH,GACLzI,MAAM,WAAY1H,EAAMwC,UACxB6L,EAAOjP,eAAeY,EAAME,MACjCkQ,EAAKxH,KAAK6G,EAASzP,EAAMzD,QAAS8R,EAAQrO,cCzF3BqQ,EACnBrF,YAAYhQ,EAAM6L,GAChBuB,KAAK5D,QAAUxJ,EAAKwJ,SAAW,KAC/B4D,KAAKjF,OAASnI,EAAKmI,QAAU,KAC7BiF,KAAK/N,KAAOW,EAAKX,MAAQ,KACzB+N,KAAK9E,UAAYtI,EAAKsI,cACtB8E,KAAK7E,WAAavI,EAAKuI,YAAc,KACrC6E,KAAK/E,KAAO,IAAI0H,EAAWlE,GAE3BuB,KAAK6D,cAAgB,KACrB7D,KAAKkI,cAAgB,KACrBlI,KAAKmI,gBAAkB,KAGvBnI,KAAKoI,qBACHd,QAAS,GACTtX,KAAM,GACNqY,KAAM,KAERrI,KAAKsI,eAAiB,GACtBtI,KAAKkE,QAAUK,CAAAA,GAAKA,EAAExL,OAGtBiH,KAAKqE,UAAY,KACjBrE,KAAK8E,WAAa,KAGlB9E,KAAKuF,eAAiB,KACtBvF,KAAKuI,gBAAkB,KACvBvI,KAAKyE,YAAc,EACnBzE,KAAK0F,oBAAsB,KAC3B1F,KAAKwI,eAAiB,KAEtBxI,KAAKyI,oBAAsB,KAG3BzI,KAAK2F,uBAAyB,KAC9B3F,KAAK8F,qBAAuB,KAE5B9F,KAAK+D,mBAAqB2E,EAAU3E,mBACpC/D,KAAK2E,WAAa,KAAMgE,EAAQhE,WAAW3E,KAAK6D,gBAOlDjB,gBAAgBvI,GACd2F,KAAKuF,eAAiBvF,KAAKyI,qBAAuBpO,EAOpDuI,kBAAkBgG,GAChB5I,KAAK0F,oBAAsB1F,KAAKyE,YAChCzE,KAAKyE,YAAcmE,EACnB5I,KAAKwI,eAAiB5T,KAAK4O,IACzBxD,KAAKyE,YAAczE,KAAKuI,gBAAiBvI,KAAKmI,gBAAgBlZ,QAGlE2T,qBACE5C,KAAKuI,gBAAkB3T,KAAKiU,KAAK7I,KAAKuF,eAAiBvF,KAAKqE,WAAa,EAG3EzB,eAAevI,GACb2F,KAAK8I,gBAAgBzO,GACrB2F,KAAK+I,qBAMPnG,cACE5C,KAAK6D,cAAgB7D,KAAK/E,KAAKxF,OAAOgG,OAAO1N,GAAKA,EAAEqK,SACpD,MAAM4Q,EAAYhJ,KAAK6D,cAAcoF,OAAO,CAAC5W,EAAGqC,IAAMrC,GAAKqC,EAAEwU,QAAU,GAAI,GAC3ElJ,KAAK6D,cAAgB7D,KAAK6D,cAAc/V,IAAIC,IAC1C,MAAM6J,GACJwC,OAAQrM,EAAEmb,QAAU,GAAKF,EAAY,IACrC3O,OAAQtM,EAAEsM,QAAU2F,KAAKoI,oBAAoBlL,EAAKzJ,SAAS1F,EAAEoG,UAE/D,OAAOpF,OAAOoa,OAAOvR,EAAO7J,KAE9BiS,KAAKqE,UAAYrE,KAAK6D,cACnBoF,OAAO,CAAC5W,EAAG+W,IAAM/W,EAAEgI,OAAS+O,EAAE/O,OAAShI,EAAI+W,EAAG,GAAG/O,OAWtDuI,YACE5C,KAAK+I,qBACL/I,KAAKqJ,aAGPzG,WAAW9K,EAAKwR,GACd,GAAIxR,EACFkI,KAAKkI,cAAgBla,EAAEgO,QAAQgE,KAAK/E,KAAKjF,UAAU/E,SAAU6G,IAAOwR,QAC/D,CACL,MAAMta,EAAOgR,KAAK9E,UAAUpN,IAAIC,GAAKA,EAAE+J,KACjCyR,EAASvJ,KAAK9E,UAAUpN,IAAIC,GAAKA,EAAEub,OACrCta,IACFgR,KAAKkI,cAAgBla,EAAEgO,QAAQgE,KAAK/E,KAAKjF,UAAU/E,QAASjC,EAAMua,IAGtEvJ,KAAKwJ,cAGP5G,cACE,GAAwB,OAApB5C,KAAK7E,WACP6E,KAAKmI,gBAAkBnI,KAAKkI,cAAcjX,YACrC,CACL,MAAMwE,EAASuK,KAAK6D,cACjBpI,OAAO1N,GAAiC,SAA5BmP,EAAKzJ,SAAS1F,EAAEoG,SAC5BrG,IAAIC,GAAKA,EAAE+J,KACdkI,KAAKmI,gBAAkBnI,KAAKkI,cAAczM,OAAOoG,GACxCpM,EAAO8N,KAAK9B,GAAKvE,EAAK9I,aAAa4L,KAAK7E,WAAY0G,EAAIJ,MAGnEzB,KAAK8E,WAAa9E,KAAKmI,gBAAgBlZ,OAAS+Q,KAAKqE,UAGvDzB,aAAa9K,EAAKwR,GAChB,MAAMG,EAAMzJ,KAAK9E,UAAU4C,UAAU/P,GAAKA,EAAE+J,KACtC4R,GAAO5R,IAAKA,EAAKwR,MAAOA,IAClB,IAARG,GAAWzJ,KAAK9E,UAAU6C,OAAO0L,EAAI,GACzCzJ,KAAK9E,UAAU6C,OAAO,EAAG,EAAG2L,GAC5B1J,KAAKqJ,WAAWvR,EAAKwR,GAGvB1G,cAAc5S,GACZgQ,KAAK7E,WAAanL,EAClBgQ,KAAKwJ,cAGP5G,aAAaI,GACXhD,KAAK/E,KAAK0O,aAAa3G,GAGzBJ,WAAW1B,GACTlB,KAAK/E,KAAK2O,WAAW1I,GACrBlB,KAAK6F,YAGPjD,gBACE,OAAO5C,KAAKmI,gBAAgBlX,MAAM+O,KAAKyE,YAAazE,KAAKwI,gBAG3D5F,OACE,OAAO/G,EAAIM,WAAW6D,KAAK5D,QAASwB,IAClC,MAAMiM,EAAKjM,EAAKnD,QACbqD,UAAU/P,GAAKA,EAAE4M,eAAiBqF,KAAK/E,KAAKN,cAC/CiD,EAAKnD,QAAQoP,GAAM7J,KAAK/E,KAAK6O,SAC7B,MAAMC,EAAKnM,EAAKpD,MAAMsD,UAAU/P,GAAKA,EAAEgN,SAAWiF,KAAKjF,QACvD6C,EAAKpD,MAAMuP,GAAM/J,KAAK8J,WAI1BlH,SACE,OACE9I,QAAS,2DACTiB,OAAQiF,KAAKjF,OACb9I,KAAM+N,KAAK/N,KACX+I,SAAU,WACVC,KAAM+E,KAAK/E,KAAKN,aAChBO,UAAW8E,KAAK9E,UAChBC,WAAY6E,KAAK7E,aC9BvB,SAAS6O,EAAoBjL,GAC3B,OAAO9K,WAAW8K,EAAUgB,OAAO,SAASkH,SAAS,iBAmFrDgD,QAxOF,SAAiBlL,EAAWxG,GAC1BwG,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhP,KAAKuI,GACVwG,EAAUE,OAAO,SACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,GACjBK,KAAK,OAAQ,SA0NT6K,cAvNX,SAAuBnL,EAAWlL,GAChCkL,EAAUgB,OAAO,SAASkH,SAAS,QAASpT,IAsNpBsW,aAnN1B,SAAsBpL,GACpB,OAAOA,EAAUgB,OAAO,SAASkH,SAAS,UAkNJmD,YA9MxC,SAAqBrL,EAAWxG,GAC9BwG,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhP,KAAKuI,GACVwG,EAAUE,OAAO,SACZD,QAAQ,0BAA0B,GAClCA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,GACjBK,KAAK,OAAQ,QACb4H,SAAS,YAAY,IAgM1BoD,YA5LF,SAAqBtL,EAAWxG,EAAO0C,GACrC8D,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACzBD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhP,KAAKuI,GACVwG,EAAUE,OAAO,YACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,GACjBK,KAAK,OAAQpE,IA+KLqP,kBA5Kf,SAA2BvL,EAAWlL,GACpCkL,EAAUgB,OAAO,YAAYkH,SAAS,QAASpT,IA2Kf0W,0BAxKlC,SAAmCxL,EAAWyL,GAC5CzL,EAAUgB,OAAO,YAAYV,KAAK,cAAemL,IAwKjDC,iBArKF,SAA0B1L,GACxB,MAAMlL,EAAQkL,EAAUgB,OAAO,YAAYkH,SAAS,SACpD,GAAIpT,EAAO,OAAOA,EAClB,MAAM2W,EAAczL,EAAUgB,OAAO,YAAYV,KAAK,eACtD,OAAImL,GACG,IAgKWE,iBA7JpB,SAA0B3L,GACxB,MAAMlL,EAAQkL,EAAUgB,OAAO,YAAYkH,SAAS,SACpD,GAAIpT,EAAO,OAAOA,EAAMhG,MAAM,MAAM4N,OAAO1N,GAAKA,EAAEkB,OAAS,GAC3D,MAAMub,EAAczL,EAAUgB,OAAO,YAAYV,KAAK,eACtD,OAAImL,EAAoBA,EAAY3c,MAAM,MAAM4N,OAAO1N,GAAKA,EAAEkB,OAAS,OA0JvE0b,SArJF,SAAkB5L,EAAWxG,GAC3B,MAAMqS,EAAM7L,EACPC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,cAAc,GACxBC,OAAO,SACLD,QAAQ,oBAAoB,GAC5BA,QAAQ,qBAAqB,GAClC4L,EAAI3L,OAAO,SACND,QAAQ,oBAAoB,GAC5BK,KAAK,OAAQ,YAClBuL,EAAI3L,OAAO,QACNjP,KAAKuI,IAyIAsS,eAtIZ,SAAwB9L,EAAWoI,GACjCpI,EAAUgB,OAAO,SAASkH,SAAS,UAAWE,IAqIpB2D,cAlI5B,SAAuB/L,GACrB,OAAOA,EAAUgB,OAAO,SAASkH,SAAS,YAkI1C8D,UA9HF,SAAmBhM,EAAWxG,EAAOiL,EAAKwH,EAAKC,GAC7ClM,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhP,KAAKuI,GACVwG,EAAUE,OAAO,SACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,GACjBK,KAAK,OAAQ,UACbA,KAAK,MAAOmE,GACZnE,KAAK,MAAO2L,GACZ3L,KAAK,OAAQ4L,IA6GPC,gBA1Gb,SAAyBnM,EAAWlL,GAClCkL,EAAUgB,OAAO,SAASkH,SAAS,QAASpT,IAyGhBsX,iBAtG9B,SAA0BpM,GACxB,MAAMlL,EAAQmW,EAAoBjL,GAC5ByE,EAAM4H,SAASrM,EAAUgB,OAAO,SAASV,KAAK,QAC9C2L,EAAMI,SAASrM,EAAUgB,OAAO,SAASV,KAAK,QAC9CgM,GAASrX,MAAMH,IAAUA,GAAS2P,GAAO3P,GAASmX,EAGxD,OAFAjM,EAAUgB,OAAO,SACZT,MAAM,mBAAoB+L,EAAQ,UAAY,WAC5CA,GAgGPC,kBA7FF,SAA2BvM,GACzB,OAAOqM,SAASrM,EAAUgB,OAAO,SAASkH,SAAS,WA4FhC+C,oBAAAA,EACnBuB,SAjFF,SAAkBxM,EAAWxG,GAC3BwG,EACKC,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GAC9Bc,GAAG,SAAU,KAEZ5L,EAAG/C,MAAMqa,oBAEfzM,EAAUE,OAAO,OACZD,QAAQ,cAAc,GACtBA,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBA,QAAQ,QAAQ,GAChBhP,KAAKuI,GACVwG,EAAUE,OAAO,OACZD,QAAQ,cAAc,GACtBA,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBA,QAAQ,QAAQ,GAClBC,OAAO,SACLD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BK,KAAK,OAAQ,UAyDRoM,eArDZ,SAAwB1M,EAAWlL,GACjCkL,EAAUgB,OAAO,SAASkH,SAAS,QAASpT,IAoDlB6X,cAhD5B,SAAuB3M,GACrB,OAAOA,EAAUgB,OAAO,SAASkH,SAAS,UAgD1C0E,aA5CF,SAAsB5M,EAAWxG,EAAOsH,GACxCd,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACzBD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhP,KAAKuI,GACVwG,EAAUE,OAAO,SACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBK,KAAK,OAAQ,QACbA,KAAK,SAAUQ,IA6BJ+L,eA1BhB,SAAwB7M,GAEtB,MAAMc,EAASd,EAAUgB,OAAO,SAASV,OACzCN,EAAUgB,OAAO,SAAS6D,SAC1B7E,EAAUE,OAAO,SACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBK,KAAK,OAAQ,QACbA,KAAK,SAAUQ,IAgBUgM,kBAbhC,SAA2B9M,GACzB,OAAOA,EAAUgB,OAAO,SAASkH,SAAS,SAAS,aCpNnD6E,UAhBF,SAAmB/M,EAAW2E,GAC5B,MAAMqI,EAAYhN,EACbC,QAAQ,OAAO,GACfA,QAAQ,uBAAuB,GACjCC,OAAO,OACLD,QAAQ,SAAS,GACjBwB,KAAKoK,EAAIX,QAAS,UACvB8B,EAAUhM,OAAO,SAASf,QAAQ,cAAc,GAChD+M,EAAUhM,OAAO,SACdD,GAAG,QAAS,WACX4D,EAAMoC,qBAAqB8E,EAAIT,aAAa4B,gBCgBhDC,QAvBF,SAAiBjN,EAAW2E,GAC1BA,EAAMK,mBAAqBhD,CAAAA,IACzBA,EAAOzB,MAAM,UAAW,gBACrBA,MAAM,QAASiF,MAAQA,EAAEnK,UACzBpK,KAAKuU,GAAKA,EAAEtS,MACZwJ,OAAO8I,GAAiC,SAA5BrH,EAAKzJ,SAAS8Q,EAAEpQ,SAC5B8K,OAAO,QAAQA,OAAO,KACpBI,KAAK,KAAMkF,WAAaA,EAAEzM,OAC1B9H,KAAK,MACLsP,MAAM,UAAW,gBACjBA,MAAM,QAAS,QACfA,MAAM,aAAc,UACtBQ,GAAG,QAASyE,IACX,MAAM0H,EAA+C,MAAvC/X,EAAG6L,gBAAgBwE,EAAEzM,OAAO9H,OAC1CkE,EAAG6L,gBAAgBwE,EAAEzM,OAAO9H,KAAKic,EAAQ,IAAM,KAC/CvI,EAAMwI,aAAa3H,EAAEzM,IAAKmU,EAAQ,OAAS,OAC3ClN,EAAUyB,KAAKkI,EAAU1E,WAAYN,iBCsE3C/B,MApFF,SAAe5C,EAAWtJ,EAAQO,EAAS2O,EAAYtK,GACrD,MAIMqJ,EAAQ,IAAIuE,MAHhBxS,OAAQA,EACRO,QAASA,IAGX0N,EAAMQ,QAAUK,CAAAA,GAAKA,GACjBI,IACFjB,EAAMiB,WAAa,KAAMA,EAAWjB,EAAMG,iBAE5CH,EAAM+E,oBAAsBpO,GAAU,IACtC0E,EAAUE,OAAO,OACdD,QAAQ,SAAS,GACjBwB,KAAKkI,EAAUlD,SAAU9B,GAC5B3E,EAAUoN,MAAMzI,IAsET0I,YAlET,SAAqBrN,EAAWtJ,EAAQO,EAAS2O,EAAYtK,GAC3D,MAIMqJ,EAAQ,IAAIuE,MAHhBxS,OAAQA,EACRO,QAASA,IAGP2O,IACFjB,EAAMiB,WAAa,KAAMA,EAAWjB,EAAMG,iBAE5CH,EAAM+E,oBAAsBpO,GAAU,IACtC0E,EAAUE,OAAO,OACdD,QAAQ,UAAU,GAClBwB,KAAK6L,GAAKP,UAAWpI,GACxB3E,EAAUE,OAAO,OACdD,QAAQ,SAAS,GACjBwB,KAAKkI,EAAUlD,SAAU9B,GAC5B3E,EAAUoN,MAAMzI,IAkDI4I,gBA9CtB,SAAyBvN,EAAWtJ,EAAQO,EAAS2O,EAAYtK,GAC/D,MAIMqJ,EAAQ,IAAIuE,MAHhBxS,OAAQA,EACRO,QAASA,IAGP2O,IACFjB,EAAMiB,WAAa,KAAMA,EAAWjB,EAAMG,iBAE5CH,EAAM+E,oBAAsBpO,GAAU,IACtC0E,EAAUE,OAAO,OACdD,QAAQ,UAAU,GAClBwB,KAAK6L,GAAKP,UAAWpI,GACxB3E,EAAUE,OAAO,OACdD,QAAQ,SAAS,GACjBwB,KAAK7K,GAAKqW,QAAStI,GACnBlD,KAAKkI,EAAUlD,SAAU9B,GAC5B3E,EAAUoN,MAAMzI,IA6BqB6I,OAzBvC,SAAgBxN,EAAWtJ,EAAQO,GACjC,MAAMtE,GACJ+D,OAAQA,EACRO,QAASA,GAEL0N,EAAQ3E,EAAUoN,QACxBzI,EAAMzI,KAAO,IAAI0H,EAAWjR,GAC5BgS,EAAMiC,0BAkBuC6G,cAd/C,SAAuBzN,EAAW/I,GAChC,MAAM0N,EAAQ3E,EAAUoN,QACxBzI,EAAMzI,KAAKL,SAAS,GAAG5E,QAAUA,EACjC0N,EAAMiC,0BAWsD8G,aAP9D,SAAsB1N,GAEpB,OADcA,EAAUoN,QACXlR,KAAKjF,YChFpB,MAAMJ,GAAK,mBACLkL,GAAQ,iBAQd,SAAS6D,GAAWlP,GAClB,MAAO,CAACsJ,EAAWkH,KACjBlH,EAAUE,OAAO,OACZuB,KAAK6L,EAAKtE,SACVzI,MAAM,WAAY7J,EAAO,GAAG2E,UAC5BpK,KAAKiW,EAAOhU,MACjB8M,EAAUE,OAAO,OACZuB,KAAK6L,EAAKtE,SACVzI,MAAM,WAAY7J,EAAO,GAAG2E,UAC9B6E,OAAO,SACLI,KAAK,OAAQ,YACb4H,SAAS,UAAWhB,EAAO7N,SAC3B0H,GAAG,QAAS,WACXmG,EAAO7N,QAAU4H,KAAKmH,UAE5B,MAAMpH,EAAShB,EAAUE,OAAO,OAC3BuB,KAAK6L,EAAKtE,SACVzI,MAAM,WAAY7J,EAAO,GAAG2E,UAC9B6E,OAAO,UACJyN,GAASjX,EAAO,GAAGkX,QAAQhZ,SAASsS,EAAO9R,QACjD4L,EAAO4D,UAAU,UAAUjS,KAAKgb,GAASzG,EAAO9R,QAAUsB,EAAO,GAAGkX,SACjE7I,QAAQ7E,OAAO,UACbI,KAAK,QAASkF,GAAKA,GACnBvU,KAAKuU,GAAKA,GACfxE,EAAOkH,SAAS,QAAShB,EAAO9R,QAC3B8S,SAAS,WAAYyF,GACrB5M,GAAG,SAAU,WACZmG,EAAO9R,OAAS6L,KAAKnM,MACrBkL,EAAUgB,OAAO,cACdkH,SAAS,WAA8B,cAAlBhB,EAAO9R,UAErC4K,EAAUE,OAAO,OACZuB,KAAK6L,EAAKtE,SACV/I,QAAQ,OAAO,GACfM,MAAM,WAAY7J,EAAO,GAAG2E,UAC9B6E,OAAO,SACLI,KAAK,OAAQ,QACbC,MAAM,QAAS,OACf2H,SAAS,QAAShB,EAAOY,WACzBI,SAAS,WAA8B,cAAlBhB,EAAO9R,QAC5B2L,GAAG,SAAU,WACZmG,EAAOY,UAAY7G,KAAKnM,iBAqChC+Y,SAnFF,SAAkB7N,GAChBA,EAAUyB,KAAKf,EAAOE,kBAAmBmB,GAAOlL,GAAI,mBAkF1CvF,KA/BZ,SAAc0O,GACZ,MAUM8N,EAAS9N,EAAUyB,KAAKsM,EAAMjM,aAAcjL,GAAIkL,IACtD+L,EAAO9M,OAAO,iBAAiBf,QAAQ,YAAY,GACnD6N,EAAO9M,OAAO,eAAed,OAAO,OACjCD,QAAQ,YAAY,GACpBwB,KAAKmB,GAAMA,QAbX7J,IAAK,OAAQ7F,KAAM,OAAQkC,OAAQ,SACnC2D,IAAK,UAAW7F,KAAM,UAAWkC,OAAQ,WACzC+U,OAAQ,GAAK7O,OAAQ,KACrBvC,IAAK,SAAU7F,KAAM,SAAUkC,OAAQ,SACvCwY,SAAU,OAAQ,UAAW,YAAa,MAAO,eACjDtS,OAAQ,KACRvC,IAAK,YAAa7F,KAAM,YAAakC,OAAQ,aAC7CkG,OAAQ,QAMsBsK,GAAY,MAgB7BoI,WAZlB,SAAoBhO,EAAWiO,GAC7BjO,EAAUgB,OAAO,aACdS,KAAKmB,GAAM6K,cAAeQ,IAUDnZ,MAN9B,SAAekL,GACb,OAAO4C,GAAM8K,aAAa1N,EAAUgB,OAAO,gBC7E7C,MAAMnK,GAAK,oBACLkL,GAAQ,iCAGd,SAAkB/B,GAChBA,EAAUyB,KAAKf,EAAOE,kBAAmBmB,GAAOlL,GAAI,uBAItD,SAAcmJ,GACZ,MAQM8N,EAAS9N,EAAUyB,KAAKsM,EAAMjM,aAAcjL,GAAIkL,IACtD+L,EAAO9M,OAAO,iBAAiBf,QAAQ,YAAY,GACnD6N,EAAO9M,OAAO,eAAed,OAAO,OACjCD,QAAQ,UAAU,GAClBwB,KAAKmB,GAAMyK,cAXXtU,IAAK,QAAS7F,KAAM,QAASkC,OAAQ,WACrC+U,OAAQ,GAAK7O,OAAQ,GAAI6M,SAAU,YACnCpP,IAAK,WAAY7F,KAAM,WAAYkC,OAAQ,aAC3C2D,IAAK,OAAQ7F,KAAM,OAAQkC,OAAQ,SACnC2D,IAAK,aAAc7F,KAAM,aAAckC,OAAQ,SAC/C2D,IAAK,OAAQ7F,KAAM,OAAQkC,OAAQ,OAAQ+U,OAAQ,oBAUxD,SAAoBnK,EAAWrO,EAAQsc,GACrC,MAAMC,EAASjf,EAAEkV,QACfxS,EAAOwc,UAAUzR,OAAO1N,GAAkB,UAAbA,EAAEiK,QAAoBlK,IAAIC,GAAKA,EAAE2D,OAE1DkK,EAAQ5N,EAAEmf,QAAQF,EAAQG,GACvBA,EAAMC,YAAYvf,IAAIC,IAC3B,MAAMuf,EAAOve,OAAOoa,UAAWiE,GAG/B,OAFAE,EAAKC,WAAaxf,EAAE+J,WACbwV,EAAKD,YACLC,KAGLE,KACNR,EAASvR,OAAO1N,GAAKA,EAAEiJ,eAAe,aACnClJ,IAAIC,GAAKA,EAAE0f,UACX5U,QAAQ9K,IACFyf,EAAKxW,eAAejJ,EAAEyZ,YACzBgG,EAAKzf,EAAEyZ,cAETgG,EAAKzf,EAAEyZ,UAAU9M,KAAK3M,EAAEwf,cAE5B,MAAMvX,EAAU4F,EAAM9N,IAAI8P,IACxB,MAAM2G,EAAIiJ,EAAKxW,eAAe4G,EAAK4J,WAC5BgG,EAAK5P,EAAK4J,UAAU7T,SAASiK,EAAK2P,YAGzC,OAFA3P,EAAK8P,MAAQnJ,EACb3G,EAAK+P,QAAUpJ,EACR3G,IAETmB,EAAUgB,OAAO,WACdS,KAAKmB,GAAM6K,cAAexW,GAC1B8J,GAAG,SAAU,WACZ,MAAM8N,EAAajM,GAAM8K,aAAavY,EAAG6L,OAAOC,OAC7CvE,OAAO1N,GAAKA,EAAE2f,QAAU3f,EAAE4f,SAAS1e,OACtC8P,EAAUgB,OAAO,WAAWkH,SAAS,YAAa2G,KAEnDlN,SAAS,WAsCgBmN,QAlC9B,SAAiB9O,EAAW+O,EAAWpd,GACrC,MAAMqd,EAAUrd,EAAOwc,UACpBzR,OAAO1N,GAAkB,aAAbA,EAAEiK,QAAuBlK,IAAIC,GAAKA,EAAE6H,IAC7CoY,EAAUrM,GAAM8K,aAAa1N,EAAUgB,OAAO,YACjDtE,OAAO1N,GAAKA,EAAE2f,QAAU3f,EAAE4f,SAC1B7f,IAAIC,KAED+M,SAAU,WACViT,QAASA,EACTvG,SAAUzZ,EAAEyZ,SACZyG,WACEH,UAAWA,EACXT,aAActf,EAAEwf,gBAIrBzf,IAAIgB,GACIsU,EAAQzU,IAAIG,EAAEgM,SAAUhM,GAC5BQ,KAAK8T,EAAQtT,OAElB,OAAOL,QAAQ4T,IAAI2K,GAAS1e,KAAKC,IAC/B,MAAM2e,EAAS3e,EAAI0S,QAMnB,OALA1S,EAAIsJ,QAAQnH,IACV,MAAM4P,EAAK2B,EAAOvB,eAChBhQ,EAAM,eAAgB,QAAS,aACjCuR,EAAOT,MAAM0L,EAAQ5M,KAEhB2B,EAAOvB,eACZwM,EAAQ,eAAgB,QAAS,iBCtGzC,SAASC,GAAapP,EAAWqP,EAAQpe,GACvC+O,EAAUM,KAAK,UAAW,cACrBA,KAAK,sBAAuB,QACjC,MAAMgP,EAAQtP,EAAUE,OAAO,KAC/BoP,EAAMpP,OAAO,QACRI,KAAK,IAAK,GAAGA,KAAK,IAAK,GACvBA,KAAK,QAAS,KAAKA,KAAK,SAAU,IAClCA,KAAK,OAAQ+O,EAAO,IACzBC,EAAMpP,OAAO,QACRI,KAAK,cAAe,UACpBA,KAAK,IAAK,IAAIA,KAAK,IAAK,IACxBA,KAAK,YAAa,IAClBrP,KAAKA,WAkEVse,UATAC,UAAaJ,GACbK,QAvDF,SAAoBzP,EAAWqP,EAAQpe,GACrC,MAAM4F,EAAKsH,EAAK1I,SAASvD,MAAM,EAAG,GAClC8N,EAAUyB,KAAK2N,GAAcC,EAAQpe,GACrC,MAAMye,EAAO1P,EAAUE,OAAO,QAC3BA,OAAO,kBACLI,KAAK,KAAMzJ,GAChB6Y,EAAKxP,OAAO,QACPI,KAAK,SAAU,GAAGA,KAAK,aAAc+O,EAAO,IACjDK,EAAKxP,OAAO,QACPI,KAAK,SAAU,GAAGA,KAAK,aAAc+O,EAAO,IACjDrP,EAAUgB,OAAO,QACZV,KAAK,eAAgBzJ,OA6C1B8Y,SA1CF,SAAqB3P,EAAWqP,EAAQpe,GACtC,MAAM4F,EAAKsH,EAAK1I,SAASvD,MAAM,EAAG,GAClC8N,EAAUyB,KAAK2N,GAAcC,EAAQpe,GACrC,MAAMye,EAAO1P,EAAUE,OAAO,QAC3BA,OAAO,kBACLI,KAAK,KAAMzJ,GAChB6Y,EAAKxP,OAAO,QACTI,KAAK,SAAU,GAAGA,KAAK,aAAc+O,EAAO,IAC/CK,EAAKxP,OAAO,QACTI,KAAK,SAAU,IAAKA,KAAK,aAAc+O,EAAO,IACjDK,EAAKxP,OAAO,QACTI,KAAK,SAAU,GAAGA,KAAK,aAAc+O,EAAO,IAC/CrP,EAAUgB,OAAO,QACZV,KAAK,eAAgBzJ,OA8B1B+Y,YA3BF,SAAwB5P,EAAWqP,EAAQpe,GACzC+O,EAAUM,KAAK,UAAW,cACrBA,KAAK,sBAAuB,QACjC,MAAMuP,EAAK,IAAMR,EAAOnf,OAClBof,EAAQtP,EAAUE,OAAO,KAC/BmP,EAAOvV,QAAQ,CAAC9K,EAAG+K,KACjBuV,EAAMpP,OAAO,QACRI,KAAK,IAAKuP,EAAK9V,GAAGuG,KAAK,IAAK,GAC5BA,KAAK,QAASuP,GAAIvP,KAAK,SAAU,IACjCA,KAAK,OAAQ+O,EAAOtV,MAE3BuV,EAAMpP,OAAO,QACRI,KAAK,cAAe,UACpBA,KAAK,IAAK,IAAIA,KAAK,IAAK,IACxBA,KAAK,YAAa,IAClBrP,KAAKA,IAaV6e,OAAUV,IAKAW,QAfZ,SAAiB/P,EAAW3E,EAAOC,GACjC0E,EAAUM,KAAK,QAASjF,GAAOiF,KAAK,SAAUhF,KCyBhD,SAAS0U,GAAkBhQ,GACzB,OAAOA,EAAU4E,UAAU,iBAAiBjS,OAAO5D,IAAIyW,GAAKA,EAAEzM,KA6DhE,SAASkX,GAAsBjQ,EAAWnB,GACxC,MAAMqR,EAAWlQ,EAAUgB,OAAO,aAClCkP,EAAStL,UAAU,OAAOC,SAC1BqL,EAAS9C,MAAMvO,GACfqR,EAAShQ,OAAO,OACXuB,KAAK0O,GAAMZ,SAAS1Q,EAAKvC,MAAOuC,EAAKwQ,OAAQxQ,EAAK5N,MAClDwQ,KAAK0O,GAAMJ,QAAS,IAAK,YAoB9BK,UA3KF,SAAmBpQ,EAAWxG,GAC5BwG,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhP,KAAKuI,GACVwG,EAAUE,OAAO,UACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,IA8JXoQ,eA3Jb,SAAwBrQ,EAAWnD,GACjC,MAAM+Q,EAAU5N,EAAUgB,OAAO,UAC9B4D,UAAU,UACRjS,KAAKkK,EAAO2I,GAAKA,EAAEzM,KACxB6U,EAAQxI,OAAOP,SACf+I,EAAQ7I,QACL7E,OAAO,UACLI,KAAK,QAASkF,GAAKA,EAAEzM,KACrB9H,KAAKuU,GAAKA,EAAEtS,OAmJUod,gBAhJ7B,SAAyBtQ,EAAWlL,GAClCkL,EAAUgB,OAAO,UAAUkH,SAAS,QAASpT,IA+IDyb,eA5I9C,SAAwBvQ,GACtB,OAAOA,EAAUgB,OAAO,UAAUkH,SAAS,UA4I3CsI,aApIF,SAAsBxQ,EAAWxG,GAE/BwG,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhP,KAAKuI,GACVwG,EAAUE,OAAO,MACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,IAsHRwQ,kBAnHhB,SAA2BzQ,EAAWnD,GACpC,MAAM6T,EAAY1Q,EAAUgB,OAAO,MAChC4D,UAAU,MACRjS,KAAKkK,EAAO2I,GAAKA,EAAEzM,KACxB2X,EAAUtL,OAAOP,SACjB,MAAM8L,EAAOD,EAAU3L,QACpB7E,OAAO,MACLI,KAAK,QAAS,cAChBJ,OAAO,SACLI,KAAK,QAAS,oBACnBqQ,EAAKzQ,OAAO,SACPI,KAAK,OAAQ,YACbA,KAAK,QAAS,oBACd4H,SAAS,QAAS1C,GAAKA,EAAEzM,KAC9B4X,EAAKzQ,OAAO,QACPjP,KAAKuU,GAAKA,EAAEtS,OAoGgB0d,mBAjGnC,SAA4B5Q,EAAWsD,GAChCA,GACLtD,EAAU4E,UAAU,SACjBW,KAAK,SAAUC,GACdrQ,EAAG6L,OAAOC,MAAMiH,SAAS,UAAW5E,EAAO1O,SAAS4Q,EAAEzM,SA6FLiX,kBAAAA,GACrDnB,WAtFF,SAAoB7O,GAClB,OAAOgQ,GAAkBhQ,GAAW9P,OAAS,GAsF7C2gB,cAlFF,SAAuB7Q,EAAWxG,GAChCwG,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhP,KAAKuI,GAAS,cACnB,MAAMmX,EAAO3Q,EAAUE,OAAO,OACzBD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,GAChB6Q,EAAWH,EAAKzQ,OAAO,OACxBD,QAAQ,aAAa,GACrBA,QAAQ,QAAQ,GACrB6Q,EAAS5Q,OAAO,UACXD,QAAQ,OAAO,GACfA,QAAQ,aAAa,GACrBA,QAAQ,UAAU,GAClBA,QAAQ,mBAAmB,GAC3BK,KAAK,cAAe,YACzBwQ,EAAS5Q,OAAO,OACXD,QAAQ,iBAAiB,GACzBA,QAAQ,QAAQ,GACrB0Q,EAAKzQ,OAAO,QACPD,QAAQ,YAAY,IAuDV8Q,mBApDjB,SAA4B/Q,EAAWnD,GACrC,MAAM6T,EAAY1Q,EAAUgB,OAAO,kBAChC4D,UAAU,KACRjS,KAAKkK,EAAO2I,GAAKA,GACtBkL,EAAUtL,OAAOP,SACjB6L,EAAU3L,QACP7E,OAAO,KACLD,QAAQ,iBAAiB,GACzBA,QAAQ,QAAQ,GAChBK,KAAK,OAAQ,KACbA,KAAK,QAASkF,GAAKA,EAAEzM,KACrBgI,GAAG,QAAS,SAAUyE,GACrBxF,EAAUyB,KAAKwO,GAAuBzK,GACtCxF,EAAU2B,SAAS,UAAW7N,SAAS,MAE1CoM,OAAO,OACLqF,KAAK,SAAUC,GACdrQ,EAAG6L,OAAOC,MACPQ,KAAK0O,GAAMZ,SAAS/J,EAAElJ,MAAOkJ,EAAE6J,OAAQ7J,EAAEvU,MACzCwQ,KAAK0O,GAAMJ,QAAS,IAAK,OAiCCiB,oBApBrC,SAA6BhR,EAAWjH,GACtC,MAEM8F,EAFOmB,EAAUgB,OAAO,kBAC3B4D,UAAU,KAAKjS,OACAmG,KAAK9J,GAAKA,EAAE+J,MAAQA,GACtCiH,EAAUyB,KAAKwO,GAAuBpR,IAiBtCoS,mBAdF,SAA4BjR,GAC1B,OAAOA,EAAUgB,OAAO,aAAaoM,QAAQrU,KAazBmY,kBAVtB,SAA2BlR,GACzB,OAAOA,EAAUgB,OAAO,aAAaoM,UChKvC,MAAMvW,GAAK,mBACLkL,GAAQ,sCAGd,SAAkB/B,GAChBA,EAAUyB,KAAKf,EAAOE,kBAAmBmB,GAAOlL,GAAI,sBAItD,SAAcmJ,GACZ,MACM1O,EADS0O,EAAUyB,KAAKsM,EAAMjM,aAAcjL,GAAIkL,IAClCf,OAAO,eAC3B1P,EAAK4O,OAAO,OACPD,QAAQ,QAAQ,GAChBwB,KAAKoK,EAAIe,aAAc,OAAQ,cACpCtb,EAAK4O,OAAO,OACPD,QAAQ,QAAQ,GAChBwB,KAAK0P,GAAKf,UAAW,eAC1B9e,EAAK4O,OAAO,OACPD,QAAQ,SAAS,GACjBwB,KAAK0P,GAAKf,UAAW,WACvBpP,OAAO,UACLkH,SAAS,YAAY,GAC1B5W,EAAK4O,OAAO,MACPD,QAAQ,QAAQ,GAChBhP,KAAK,WACVK,EAAK4O,OAAO,OACPD,QAAQ,WAAW,GACnBwB,KAAKmB,GAAMA,YAAe,KAAM,iBAIvC,SAAoB5C,EAAWtJ,GAC7B,MAAM0a,EAAa1a,EAAOgG,OAAO1N,GAAiC,SAA5BmP,EAAKzJ,SAAS1F,EAAEoG,SAChDic,EAAcD,EACjBtY,KAAK9J,GAAkB,gBAAbA,EAAEoG,SAA6Bgc,EAAW,GACvDpR,EAAUgB,OAAO,SACZS,KAAK0P,GAAKd,eAAgBe,GAC1B3P,KAAK0P,GAAKb,gBAAiBe,EAAYtY,KAC5CiH,EAAUgB,OAAO,YACZS,KAAKmB,GAAM4K,cAChBxN,EAAUgB,OAAO,SACZS,KAAKoK,EAAIgB,gBACT9L,GAAG,SAAU,WACZ,MAAMlP,EAAOga,EAAIiB,kBAAkB3X,EAAG6L,OAAOC,OAC7C9L,EAAG6L,OAAOC,MAAMU,SAAS,YACzB,MAAM2P,EAAuC,QAA/Bzf,EAAKqB,KAAKpE,MAAM,KAAKyiB,MACnCC,EAAM5f,SAASC,GACZtB,KAAKC,IACJ,MAAM2R,EAAUmP,EAAQpN,EAAOnB,aAAavS,GAAOL,KAAK6C,MAAMxC,GACxDihB,EAAMvN,EAAO5B,eAAeH,GAClCnC,EAAUgB,OAAO,UACdS,KAAK0P,GAAKd,iBACHtX,IAAKoJ,EAAQpJ,IAAK7F,KAAMiP,EAAQpJ,OACvC0I,KAAK0P,GAAKb,gBAAiBnO,EAAQpJ,KACtCiH,EAAUgB,OAAO,YACdS,KAAKmB,GAAM4K,OAAQiE,EAAI/a,OAAQ+a,EAAIxa,QAAQ/E,MAAM,EAAG,QAG5D6O,GAAG,WAAY,WACd,MAAM2Q,EAAe7F,EAAIiB,kBAAkB3X,EAAG6L,OAAOC,OACrDjB,EAAUgB,OAAO,WACdkH,SAAS,YAAawJ,KAE1B/P,SAAS,sBAIhB,SAAkB3B,GAChB,MAAM2R,EAAOR,GAAKZ,eAAevQ,EAAUgB,OAAO,UAC5CnP,EAAOga,EAAIiB,kBAAkB9M,EAAUgB,OAAO,UAC9CsQ,EAAuC,QAA/Bzf,EAAKqB,KAAKpE,MAAM,KAAKyiB,MACnC,OAAOC,EAAM5f,SAASC,GACnBtB,KAAKC,IACJ,IAAI2R,EAAUmP,EAAQpN,EAAOnB,aAAavS,GAAOL,KAAK6C,MAAMxC,GACxD2R,EAAQlK,eAAe,WACzBkK,EAAU+B,EAAOhC,cAAcC,IAEjCA,EAAQpJ,IAAM4Y,EAEd,MAAMC,KAON,GANAzP,EAAQzL,OAAOoD,QAAQ,CAAC9K,EAAG+K,KACR,SAAb/K,EAAEoG,SACJ+M,EAAQzL,OAAOqD,GAAG3E,OAAS,QAC3Bwc,EAASjW,KAAK5B,MAGd6X,EAAS1hB,OAAS,EAAG,CACvB,MAAM2hB,KAUN,OATA7hB,OAAOqP,QAAQ8C,EAAQA,SAASrI,QAAQuI,IACtCuP,EAAS9X,QAAQ9K,IACf,MAAM8iB,EAAIC,EAAKxK,cAAclF,EAAE,GAAGrT,IAC/BuB,KAAKqY,IACJzG,EAAQA,QAAQE,EAAE,IAAIrT,GAAK4Z,IAE/BiJ,EAAGlW,KAAKmW,OAGLphB,QAAQ4T,IAAIuN,GAAIthB,KAAK,IAAM4R,GAElC,OAAOA,MC3Gf,MAAMtL,GAAK,oBACLkL,GAAQ,qBAuCd,MAAMiQ,IACJ/J,UAAU,EACVY,WAAY,qBAtCd,SAAkB7I,GAChBA,EAAUyB,KAAKf,EAAOE,kBAAmBmB,GAAOlL,GAAI,0BAItD,SAAcmJ,GACZ,MACM1O,EADS0O,EAAUyB,KAAKsM,EAAMjM,aAAcjL,GAAIkL,IAClCf,OAAO,eAC3B1P,EAAK4O,OAAO,OACPD,QAAQ,OAAO,GACfwB,KAAKoK,EAAIX,QAAS,aAKvB5Z,EAAK4O,OAAO,OACPD,QAAQ,QAAQ,GAChBwB,KAAK0P,GAAKf,UAAW,QACrB3O,KAAK0P,GAAKd,iBANZtX,IAAK,WAAY7F,KAAM,aACvB6F,IAAK,aAAc7F,KAAM,4BAU9B,SAAoB8M,GAClBA,EAAUgB,OAAO,QACZS,KAAKoK,EAAIV,cAAe,MACxBpK,GAAG,QAAS,WACX,MAAMkR,EAAiD,KAAtCpG,EAAIT,aAAajW,EAAG6L,OAAOC,OAC5CjB,EAAUgB,OAAO,WAAWkH,SAAS,YAAa+J,KAEnDtQ,SAAS,SACd3B,EAAUgB,OAAO,SACZS,KAAK0P,GAAKb,gBAAiB,mBAUlC,SAAetQ,GACb,MAAMjH,EAAM8S,EAAIT,aAAapL,EAAUgB,OAAO,SACxC1E,EAAO6U,GAAKZ,eAAevQ,EAAUgB,OAAO,UAClD,OACEnI,OAAQE,IAAKA,EAAK7F,KAAM6F,EAAK3D,OAAOkH,GACpC4V,QAASF,GAAc1V,MCgC3B,SAAS6V,GAAmBnS,GAC1B,MAAM5K,EAAS+b,GAAKZ,eAAevQ,EAAUgB,OAAO,YAC9C7G,EAASgX,GAAKZ,eAAevQ,EAAUgB,OAAO,YAC9CoR,EAAYvG,EAAIT,aAAapL,EAAUgB,OAAO,eAC9CqR,EAAYxG,EAAIF,iBAAiB3L,EAAUgB,OAAO,eACxD,OACE5L,OAAQA,EACR+E,OAAmB,SAAX/E,EAAoB+E,EAAS,KACrCrF,MAAkB,YAAXM,EAAuBid,EAAYD,WAiF5CE,cAtKF,SAAuBtS,GACrBA,EACKC,QAAQ,QAAQ,GACrBD,EAAUE,OAAO,OACZD,QAAQ,UAAU,GAClBA,QAAQ,QAAQ,GAChBwB,KAAK0P,GAAKf,UAAW,UACrB3O,KAAK0P,GAAKd,iBAEFtX,IAAK,UAAW7F,KAAM,gBACtB6F,IAAK,OAAQ7F,KAAM,iBAEhC8M,EAAUE,OAAO,OACZD,QAAQ,UAAU,GAClBA,QAAQ,QAAQ,GAChBwB,KAAK0P,GAAKf,UAAW,UAC1BpQ,EAAUE,OAAO,OACZD,QAAQ,aAAa,GACrBA,QAAQ,QAAQ,GAChBwB,KAAKoK,EAAIX,QAAS,SACvBlL,EAAUE,OAAO,OACZD,QAAQ,aAAa,GACrBA,QAAQ,QAAQ,GAChBwB,KAAKoK,EAAIP,YAAa,QAAS,EAAG,MAEvCiH,EAAE,WACAA,EAAE,2BACCC,SAASvQ,MAAM,EAAMwQ,QAAS,YAEnCzS,EAAUE,OAAO,OACZD,QAAQ,YAAY,GACpBA,QAAQ,uBAAuB,GACjCC,OAAO,UACLD,QAAQ,WAAW,GACnBK,KAAK,cAAe,WACpBA,KAAK,YAAa,QAClBA,KAAK,eAAgB,4BACrBmB,KAAKf,EAAOP,WAAY,oBAAqB,YAiInCuS,oBA9HjB,SAA6B1S,EAAWmO,GACtCnO,EAAUgB,OAAO,WACZS,KAAK0P,GAAKb,gBAAiB,WAC3BvP,GAAG,SAAU,WACZ,MAAMjM,EAAQqc,GAAKZ,eAAepb,EAAG6L,OAAOC,OAC5CjB,EAAUgB,OAAO,WACdA,OAAO,UACLkH,SAAS,WAAsB,SAAVpT,GAC1BkL,EAAUgB,OAAO,cACZkH,SAAS,SAAoB,SAAVpT,GACxBkL,EAAUgB,OAAO,cACZkH,SAAS,SAAoB,YAAVpT,KAEzB6M,SAAS,UACd,MAAMnR,EAAM2d,EAAUpf,IAAIyW,KAAOzM,IAAKyM,EAAE3O,GAAI3D,KAAMsS,EAAEtS,QACpD8M,EAAUgB,OAAO,WACZS,KAAK0P,GAAKd,eAAgB7f,GAC1BiR,KAAK0P,GAAKb,gBAAiB,MAChCtQ,EAAUgB,OAAO,YACZD,GAAG,QAAS,WACX,MAAMjR,EAAQqiB,GAAmBnS,GACjC,OAAOqE,EAAQzU,IAAI,UAAWE,GAC3BS,KAAK8T,EAAQpT,MACbV,KAAKC,GAAO2E,EAAG6L,OAAO,YAAYiB,KAAKzR,GAAM6T,EAAQ9S,SAE9DyO,EAAUgB,OAAO,cACZS,KAAKoK,EAAIV,cAAe,IACxBpK,GAAG,QAAS,WACXf,EAAU2B,SAAS,cAEzB3B,EAAUgB,OAAO,cACZS,KAAKoK,EAAIN,kBAAmB,IAC5BxK,GAAG,QAAS,WACXf,EAAU2B,SAAS,eA6FWwQ,mBAAAA,GAAoBQ,mBA7E1D,SAA4B3S,GAC1B,MAAM5K,EAAS+b,GAAKZ,eAAevQ,EAAUgB,OAAO,YAC9CoR,EAAYvG,EAAIT,aAAapL,EAAUgB,OAAO,eAC9CqR,EAAYxG,EAAIF,iBAAiB3L,EAAUgB,OAAO,eACxD,MAAkB,YAAX5L,EAAuBid,EAAUniB,OAAuB,KAAdkiB,GA0EjDQ,eAtEF,SAAwB5S,GACtB,MAAMnJ,EAAKsH,EAAK1I,SAASvD,MAAM,EAAG,GAClC8N,EACKC,QAAQ,QAAQ,GAClBC,OAAO,KACPA,OAAO,UACLD,QAAQ,OAAO,GACfA,QAAQ,UAAU,GAClBA,QAAQ,uBAAuB,GAC/BA,QAAQ,mBAAmB,GAC3BK,KAAK,cAAe,YACpBA,KAAK,kBAAmBzJ,cACxByJ,KAAK,gBAAiB,SACtBA,KAAK,mBAAoBzJ,cACzB5F,KAAK,uBACV,MAAM4hB,EAAW7S,EAAUE,OAAO,OAC7BD,QAAQ,YAAY,GACpBK,KAAK,QAASzJ,cAChBqJ,OAAO,OACLD,QAAQ,QAAQ,GAChBA,QAAQ,aAAa,GAC1B4S,EAAS3S,OAAO,OACXD,QAAQ,WAAW,GACnBA,QAAQ,QAAQ,GAChBwB,KAAKoK,EAAID,SAAU,6BACxBiH,EAAS3S,OAAO,OACXD,QAAQ,WAAW,GACnBA,QAAQ,QAAQ,GAChBwB,KAAKoK,EAAIG,UAAW,UAAW,EAAG,IAAK,GAC5C6G,EAAS3S,OAAO,OACXD,QAAQ,QAAQ,GAChBA,QAAQ,QAAQ,GAChBwB,KAAKoK,EAAIG,UAAW,wBAAyB,EAAG,IAAK,GAC1D6G,EAASjO,UAAU,wBACd3E,QAAQ,SAAS,GACjBA,QAAQ,SAAS,GACtB4S,EAASjO,UAAU,sBACd3E,QAAQ,SAAS,GACjBA,QAAQ,SAAS,IAgCN6S,qBA5BlB,SAA8B9S,GAC5BA,EAAUgB,OAAO,YACZS,KAAKoK,EAAIC,gBAAgB,GAC9B9L,EAAUgB,OAAO,YACZS,KAAKoK,EAAIM,gBAAiB,GAC/BnM,EAAUgB,OAAO,SACZS,KAAKoK,EAAIM,gBAAiB,IAsBO4G,oBAlBxC,SAA6B/S,GAC3B,MAAMgT,EAAUhT,EAAUgB,OAAO,YAC3BiS,EAAOjT,EAAUgB,OAAO,SACxBlR,GACJojB,SAAUrH,EAAIE,cAAc/L,EAAUgB,OAAO,cAQ/C,OANKgS,EAAQhS,OAAO,SAASkH,SAAS,cACpCpY,EAAMkjB,QAAUnH,EAAIU,kBAAkByG,IAEnCC,EAAKjS,OAAO,SAASkH,SAAS,cACjCpY,EAAMqjB,SAAWtH,EAAIU,kBAAkB0G,IAElCnjB,ICnKT,MAAM+G,GAAK,oBACLkL,GAAQ,+CAGd,SAAkB/B,GAChBA,EAAUyB,KAAKf,EAAOE,kBAAmBmB,GAAOlL,GAAI,sBAItD,SAAcmJ,GACZ,MAAM8N,EAAS9N,EAAUyB,KAAKsM,EAAMjM,aAAcjL,GAAIkL,IACtD+L,EAAO9M,OAAO,eAAed,OAAO,OAC/BD,QAAQ,WAAW,GACnBwB,KAAK0P,GAAKf,UAAW,WAE1BtC,EAAO9M,OAAO,eAAed,OAAO,OAC/BD,QAAQ,QAAQ,GAChBwB,KAAKoK,EAAIG,UAAW,YAAa,GAAK,EAAG,KAE9C8B,EAAO9M,OAAO,eAAed,OAAO,OAC/BD,QAAQ,UAAU,GAClBwB,KAAK6N,GAAMsD,4BAIlB,SAAoB5S,EAAWoT,GAE7B,MAAMC,IACHta,IAAK,MAAO7F,KAAM,sCAEjBkgB,IACFC,EAAS1X,MAAM5C,IAAK,WAAY7F,KAAM,4BACtCmgB,EAAS1X,MAAM5C,IAAK,SAAU7F,KAAM,gBAEtC8M,EAAUgB,OAAO,YACZS,KAAK0P,GAAKd,eAAgBgD,GAC1B5R,KAAK0P,GAAKb,gBAAiB,OAC3BvP,GAAG,SAAU,WACZ,MAAMjM,EAAQqc,GAAKZ,eAAepb,EAAG6L,OAAOC,OAC5CjB,EAAUgB,OAAO,SACdA,OAAO,SACLkH,SAAS,WAAsB,QAAVpT,GAC1BkL,EAAUgB,OAAO,YACdA,OAAO,SACLkH,SAAS,aAAc,MAAO,UAAUtT,SAASE,MAE5DkL,EAAUgB,OAAO,SACZS,KAAKoK,EAAIM,gBAAiB,IAC/BnM,EAAUgB,OAAO,WACZS,KAAK6N,GAAMwD,+BAIlB,SAAiB9S,EAAWsT,GAC1B,MAAMC,EAAUvT,EAAUgB,OAAO,YAC3BwS,EAAOxT,EAAUgB,OAAO,SACxBnG,EAASyU,GAAMyD,oBAAoB/S,EAAUgB,OAAO,YACrDuS,EAAQvS,OAAO,UAAUkH,SAAS,cACrCrN,EAAO0Y,QAAUpC,GAAKZ,eAAegD,IAElCC,EAAKxS,OAAO,SAASkH,SAAS,cACjCrN,EAAOF,UAAYkR,EAAIZ,oBAAoBuI,IAE7C,MAAMC,EAAW,IAAIC,SAIrB,OAFAD,EAASvT,OAAO,SAAU/P,KAAKC,UAAUyK,IACzC4Y,EAASvT,OAAO,WAAY,IAAI7M,MAAMlD,KAAKC,UAAUkjB,MAC9CjP,EAAQlT,QAAQ0J,EAAO0Y,aAAcE,GACzCljB,KAAK8T,EAAQtT,QCzElB,MAAM8F,GAAK,gBACLkL,GAAQ,0BAGd,SAAkB/B,GAChBA,EAAUyB,KAAKf,EAAOE,kBAAmBmB,GAAOlL,GAAI,uBAItD,SAAcmJ,GACZA,EAAUyB,KAAKsM,EAAMjM,aAAcjL,GAAIkL,IACpCf,OAAO,eAAed,OAAO,OAC3BD,QAAQ,UAAU,GAClBwB,KAAKoK,EAAIX,QAAS,wBAIzB,SAAoBlL,EAAW9M,GAC7B8M,EAAUgB,OAAO,WACZS,KAAKoK,EAAIV,cAAejY,GACxB6N,GAAG,QAAS,WACX,MAAMkR,EAAiD,KAAtCpG,EAAIT,aAAajW,EAAG6L,OAAOC,OAC5CjB,EAAUgB,OAAO,WAAWkH,SAAS,YAAa+J,KAEnDtQ,SAAS,gBAIhB,SAAe3B,GACb,OAAO6L,EAAIT,aAAapL,EAAUgB,OAAO,cCkH3C,SAAS2S,GAAUhP,GACjBxP,EAAG6L,OAAO,iBAAiBT,MAAM,UAAW,QAG5CpL,EAAG6L,OAAO,SAAS/P,KAAK0T,EAAMzR,MAG9B,MAAM0gB,EAAUze,EAAG6L,OAAO,YACpB6S,EAAUlP,EAAMzI,KAAKzL,SACrBqjB,EAAQnP,EAAMzI,KAAK9C,OACnB2a,EAAQpP,EAAMzI,KAAKzE,WACnBuc,EAAQrP,EAAMzI,KAAK1E,WACnByc,EAAUtP,EAAMzI,KAAK+X,UAC3BL,EAAQ5S,OAAO,UAAU/P,KAAK0T,EAAMzR,MACpC0gB,EAAQ5S,OAAO,WACV/P,SAAS4iB,OAAaC,sBAA0BC,WACrDH,EAAQ5S,OAAO,aAAaA,OAAO,YAC9BV,KAAK,QAAS0T,GACd/iB,QAAQ+iB,MAEbJ,EAAQhP,UAAU,+BACfrE,MAAM,UAAW0T,EAAU,KAAO,QAGrC,MAAMC,EAAU/e,EAAG6L,OAAO,YAG1BkT,EAAQlT,OAAO,eACVS,KAAK0S,GAAkBnG,WAAYrJ,EAAMzI,KAAKxF,QAC9CqK,GAAG,SAAU,WACZ,MAAMuC,EAAS6Q,GAAkBrf,MAAMK,EAAG6L,OAAOC,OACjD0D,EAAMiG,aAAatH,GACnBqB,EAAMiC,yBACN+M,GAAUhP,KAIhBuP,EAAQlT,OAAO,eACVS,KAAK2S,GAAgBpG,WAAYrJ,EAAMG,eACvC/D,GAAG,SAAU,WACZ,OAAOqT,GAAgBxiB,SAASuD,EAAG6L,OAAOC,OACvC1Q,KAAKoC,IACJgS,EAAMkG,WAAWlY,GACjBgS,EAAMiC,yBACN+M,GAAUhP,OAKpBuP,EAAQlT,OAAO,gBACVS,KAAK4S,GAAiBrG,YACtBjN,GAAG,SAAU,WACZ,MAAMjM,EAAQuf,GAAiBvf,MAAMK,EAAG6L,OAAOC,OAC/C0D,EAAMzI,KAAK8H,SAASlP,EAAM+D,OAC1B8L,EAAMzI,KAAKjF,UAAU6C,QAAQ9K,IAC3BA,EAAE8F,EAAM+D,MAAME,KAAOjE,EAAMod,UAE7BvN,EAAMiC,yBACN+M,GAAUhP,KAIhBuP,EAAQlT,OAAO,YACVS,KAAK6S,GAAatG,WAAYrJ,EAAMzR,MACpC6N,GAAG,SAAU,WACZ4D,EAAMzR,KAAOohB,GAAaxf,MAAMK,EAAG6L,OAAOC,OAC1C0S,GAAUhP,KAKhBN,EAAQ5S,eAAelB,KAAKS,IAE1BkjB,EAAQlT,OAAO,gBACVS,KAAK8S,GAAiBvG,WAAYhd,EAASW,OAAQgT,EAAMzI,KAAKxF,QAC9DqK,GAAG,SAAU,WACZ,MAAMgO,EAAYpK,EAAMzI,KAAKjF,UAAUlI,IAAIC,GAAKA,EAAE+Y,aAClDwM,GACGzF,QAAQ3Z,EAAG6L,OAAOC,MAAO8N,EAAW/d,EAASW,QAC7CpB,KAAKC,IACJmU,EAAMkG,WAAWra,GACjBmU,EAAMiC,yBACN+M,GAAUhP,OAKpBuP,EAAQlT,OAAO,YACVS,KAAK+S,GAAiBxG,WAAYhd,EAASU,OAAO+iB,OAClD1T,GAAG,SAAU,WACZyT,GACG1F,QAAQ3Z,EAAG6L,OAAOC,MAAO0D,EAAMzI,KAAKjF,WACpC1G,KAAKoC,IACJ,MAAM+hB,EAAM/hB,EAAKmJ,WAAW5J,MAAM,EAAG,GACrC,OAAOxB,QAAQ4T,KACbxH,EAAI6B,WAAWgG,EAAMtH,QAASsH,EAAM3I,QAClCjB,QAAS,0DACTiB,OAAQ0Y,EACRxhB,KAAMwhB,EACNzY,SAAU,UACV/D,MAAOyM,EAAMzI,KAAKN,aAClB5D,MAAO0c,EACP/X,YAAahK,EAAK7C,MAAM+K,OAAOF,YAEjCmC,EAAI6C,iBAAiBgF,EAAMtH,QAASsH,EAAMzI,KAAKN,cAC7Cb,QAAS,6DACTa,aAAc8Y,EACdxhB,KAAMwhB,EACN7Y,UAAWlJ,OAGdpC,KAAK,KACJ4E,EAAG6L,OAAO,iBAAiBT,MAAM,UAAW,QAC5C7R,OAAOimB,2BAA2BhQ,EAAMtH,gBAAgBqX,IAAO,gBAM3ER,EAAQlT,OAAO,WACVS,KAAKsM,EAAMnM,oBACN,wDACLb,GAAG,SAAU,WACZ4D,EAAMzI,KAAK0Y,QAAQrkB,KAAK,KACtBoU,EAAMiC,yBACN+M,GAAUhP,SAInBjH,MAAM,KAELvI,EAAG6L,OAAO,YAAY4D,UAAU,mBAC7BtE,KAAK,cAAe,MACpBL,QAAQ,YAAY,GACpBc,GAAG,QAAS,eAmCjBuG,IA/BF,WACE,MAAM9V,EAAMqjB,EAAO1lB,gBACnB,GAAIqC,EAIF,YAHA2D,EAAG6L,OAAO,QACPT,MAAM,QAAS,WACftP,KAAKO,GAIQ+B,SAAS5E,SAASmmB,SACpB,WAAYzlB,WAAcA,UAAU0lB,OACpDF,EAAOzlB,wBACP,MAAMiO,EAAUwX,EAAOrmB,WAAWwmB,OAAS,KACrChZ,EAAS6Y,EAAOrmB,WAAWqF,MAAQ,KACzC,OAAOiJ,EAAI4B,QAAQrB,EAASrB,GACzBzL,KAAKsD,IACJ,IAAKA,EAAM,0BAEX,OADAA,EAAKwJ,QAAUA,EACRP,EAAIyC,cAAclC,EAASxJ,EAAKqI,MACpC3L,KAAKmP,IA3Rd,SAAa7L,EAAM6L,GACjB,MAAMkU,EAAUze,EAAG6L,OAAO,YAC1B4S,EAAQhP,UAAU,cAAcC,SAChC,MAAMqP,EAAU/e,EAAG6L,OAAO,YAC1BkT,EAAQtP,UAAU,OAAOC,SAEzB,MAAMF,EAAQ,IAAIuE,EAAcrV,EAAM6L,GAGhCuV,EAAOrB,EAAQ1T,OAAO,OACvBuB,KAAKf,EAAOD,mBAAoB,WAAY,UAAW,eACvDO,OAAO,kBACZiU,EAAK/U,OAAO,KAAKuB,KAAK0S,GAAkBtG,UACxCoH,EAAK/U,OAAO,KACPD,QAAQ,kBAAkB,GAC1BwB,KAAK8S,GAAiB1G,UAC3BoH,EAAK/U,OAAO,KAAKuB,KAAK2S,GAAgBvG,UACtCoH,EAAK/U,OAAO,KAAKuB,KAAK4S,GAAiBxG,UACvCoH,EAAK/U,OAAO,KACPuB,KAAKf,EAAOC,iBAAkB,qBAAsB,cACpDI,GAAG,QAAS,WACX,MAAM/E,EAASmC,EAAK1I,SACpBqH,EAAI6B,WAAWgG,EAAMtH,QAASsH,EAAM3I,QAClCjB,QAAS,0DACTiB,OAAQA,EACR9I,KAAM8I,EACNC,SAAU,OACVY,MAAO8H,EAAMzI,KAAKN,aAClBsZ,SAAU,EACVC,YAAa,EACbC,aAAcvc,MAAO,YAAaQ,SAAS,KAC1C9I,KAAK,KACN4E,EAAG6L,OAAO,iBAAiBT,MAAM,UAAW,QAC5C7R,OAAOimB,wBACchQ,EAAMtH,gBAAgBrB,IAAU,cAG7DiZ,EAAK/U,OAAO,KACPD,QAAQ,kBAAkB,GAC1BwB,KAAK+S,GAAiB3G,UAC3BoH,EAAK/U,OAAO,KAAKuB,KAAK6S,GAAazG,UACnCoH,EAAK/U,OAAO,KACPuB,KAAKf,EAAOC,iBAAkB,OAAQ,aACtCI,GAAG,QAAS,WACX4D,EAAM0Q,OAAO9kB,KAAK,IAAMd,QAAQC,KAAK,qBAE3CulB,EAAK/U,OAAO,KACPD,QAAQ,kBAAkB,GAC1BwB,KAAKf,EAAOC,iBAAkB,iBAAkB,oBAChDI,GAAG,QAAS,KACX,MAAMrB,EAAOiF,EAAMzI,KAAK6O,SAClB0I,EAAW,IAAIC,SAErB,OADAD,EAASvT,OAAO,WAAY,IAAI7M,MAAMlD,KAAKC,UAAUsP,MAC9C2E,EAAQlT,KAAK,OAAQsiB,GACzBljB,KAAK8T,EAAQnT,MACbX,KAAKW,GAAQsgB,EAAMve,iBAAiB/B,KAASyT,EAAMzR,gBAG5D0gB,EAAQ1T,OAAO,KACVuB,KAAKf,EAAON,eAAgB,YACvB,oBAAqB,eAC1BE,KAAK,OAAQ,kBACbA,KAAK,SAAU,UAEpBsT,EAAQ1T,OAAO,KACVD,QAAQ,WAAW,GACnBwB,KAAKf,EAAON,eACP,UAAW,oBAAqB,gBACrCW,GAAG,QAAS,WACX,OAAO4D,EAAMzI,KAAKoZ,OAAO/kB,KAAK,KAC5BoU,EAAMiC,yBACN+M,GAAUhP,OAGlBiP,EAAQ1T,OAAO,KACVD,QAAQ,SAAS,GACjBwB,KAAKf,EAAON,eACP,mBAAoB,UAAW,eACpCE,KAAK,cAAe,SACpBA,KAAK,cAAe,iBACzBsT,EAAQ1T,OAAO,QAAQD,QAAQ,YAAY,GACxCC,OAAO,YACLI,KAAK,MAAO,KACjBsT,EAAQ1T,OAAO,QAAQD,QAAQ,SAAS,GACxC2T,EAAQ1T,OAAO,QAAQD,QAAQ,UAAU,GAGzCiU,EAAQhU,OAAO,OACVD,QAAQ,cAAc,GACtBwB,KAAK0S,GAAkB7iB,MAC5B4iB,EAAQhU,OAAO,OACVD,QAAQ,eAAe,GACvBwB,KAAK8S,GAAiBjjB,MAC3B4iB,EAAQhU,OAAO,OACVD,QAAQ,cAAc,GACtBwB,KAAK2S,GAAgB9iB,MAC1B4iB,EAAQhU,OAAO,OACVD,QAAQ,eAAe,GACvBwB,KAAK4S,GAAiB/iB,MAC3B4iB,EAAQhU,OAAO,OACVD,QAAQ,WAAW,GACnBwB,KAAK+S,GAAiBljB,MAC3B4iB,EAAQhU,OAAO,OACVD,QAAQ,WAAW,GACnBwB,KAAK6S,GAAahjB,MACvB4iB,EAAQhU,OAAO,OACVD,QAAQ,UAAU,GAClBwB,KAAKsM,EAAMxM,cAAe,gBAG/BpM,EAAG6L,OAAO,cACLS,KAAK6L,GAAKP,UAAWpI,GAC1BxP,EAAG6L,OAAO,aACLS,KAAK7K,GAAKqW,QAAStI,GACnBlD,KAAK8T,EAAG9O,SAAU9B,GAGvBjW,OAAO8mB,SAAW,MAChBrgB,EAAG6L,OAAO,aAAaS,KAAK8T,EAAGrP,OAAQvB,GACpClD,KAAK8T,EAAG1P,eAAgBlB,EAAOA,EAAMe,eAG1CiO,GAAUhP,IAiKU8Q,CAAI5hB,EAAM6L,MAE3BhC,MAAMlM,IACL/B,QAAQ8B,MAAMC,GACd2D,EAAG6L,OAAO,aACPT,MAAM,QAAS,OACftP,KAAKO"}