{"version":3,"file":"datagridApp.js","sources":["../../src/common/client.js","../../src/common/fetcher.js","../../src/common/file.js","../../src/common/misc.js","../../src/common/legacySchema.js","../../src/common/idb.js","../../src/component/badge.js","../../src/component/button.js","../../src/component/modal.js","../../src/common/scale.js","../../src/common/mapper.js","../../src/common/collection.js","../../src/datagrid/component.js","../../src/common/image.js","../../src/datagrid/rowFactory.js","../../src/datagrid/state.js","../../src/component/formBox.js","../../src/datagrid/rowFilter.js","../../src/datagrid/sort.js","../../src/datagrid/table.js","../../src/dialog/fieldConfig.js","../../src/dialog/fieldFetch.js","../../src/component/shape.js","../../src/component/formListBox.js","../../src/dialog/fieldFile.js","../../src/component/dropdown.js","../../src/dialog/fieldInput.js","../../src/dialog/formGroup.js","../../src/dialog/networkgen.js","../../src/dialog/rename.js","../../src/datagridApp.js"],"sourcesContent":["\n/** @module common/client */\n\nimport _ from 'lodash';\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\nfunction compatibility() {\n  try {\n    () => {};\n  } catch (err) {\n    return 'Client compatibility error: Arrow function not supported';\n  }\n  try {\n    FormData;\n  } catch (err) {\n    return 'Client compatibility error: FormData not supported';\n  }\n  try {\n    fetch;\n  } catch (err) {\n    return 'Client compatibility error: fetch API not supported';\n  }\n}\n\n\nfunction registerServiceWorker() {\n  if ('serviceWorker' in navigator) {\n    if (!isDebugBuild) {  // Grobal isDebugBuild (see rollup.js)\n      window.addEventListener('load', () => {\n        navigator.serviceWorker.register('../sw.js');  // TODO: root path option\n      });\n    } else {\n      console.info('Service worker is disabled for debugging');\n    }\n  } else {\n    console.info('Service worker is not supported');\n  }\n}\n\n\nfunction registerCtrlCommand(key, callback) {\n  document.addEventListener('keydown', event => {\n    if (event.ctrlKey && event.key === key) {\n      callback();\n    }\n  });\n}\n\n\nexport default {\n  URLQuery, compatibility, registerServiceWorker, registerCtrlCommand\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '../req/';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\nfunction serverStatus() {\n  const response = {};\n  return get('server')\n    .then(json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => get('schema'))\n    .then(json)\n    .then(res => {\n      response.schema = res;\n    })\n    .then(() => response);\n}\n\n\nexport default {\n  get, json, text, blob, post, error, serverStatus\n};\n","\n/** @module common/file */\n\nimport pako from 'pako';\n\n\nfunction readFile(file, sizeLimit, blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    const truncated = sizeLimit ? file.slice(0, sizeLimit) : file;\n    reader.onload = event => resolve(event.target.result);\n    reader.onerror = error => reject(error);\n    if (blob) {\n      reader.readAsArrayBuffer(truncated);\n    } else {\n      reader.readAsText(truncated);\n    }\n  });\n}\n\n\nfunction parseJSON(data, compressed) {\n  const text = compressed ? pako.inflate(data, {to: 'string'}) : data;\n  return JSON.parse(text);\n}\n\n\nfunction loadJSON(file) {\n  const compressed = file.name.endsWith('c') || file.name.endsWith('.gz');\n  return readFile(file, false, compressed)\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction fetchJSON(url) {\n  const decoded = decodeURIComponent(url);\n  const compressed = decoded.endsWith('c') || decoded.endsWith('.gz');\n  return fetch(decoded)\n    .then(res => compressed ? res.arrayBuffer() : res.json())\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction downloadDataFile(data, name) {\n  try {\n    // cannot hundle large file with dataURI scheme\n    // url = 'data:application/json,' + encodeURIComponent(JSON.stringify(json))\n    const url = window.URL.createObjectURL(new Blob([data]));\n    const a = document.createElement('a');\n    a.download = name;\n    a.href = url;\n    // a.click() does not work on firefox\n    a.dispatchEvent(new MouseEvent('click', {\n      'view': window,\n      'bubbles': true,\n      'cancelable': false\n    }));\n    // window.URL.revokeObjectURL(url) does not work on firefox\n  } catch (e) {\n    // no DOM (unit testing)\n  }\n}\n\n\nfunction downloadJSON(json, name, compress=true) {\n  const str = JSON.stringify(json);\n  const data = compress ? pako.gzip(str) : str;\n  const ext = `.ap${compress ? 'c' : 'r'}`;\n  downloadDataFile(data, `${name}${ext}`);\n}\n\n\nexport default {\n  readFile, parseJSON, loadJSON, fetchJSON,\n  downloadDataFile, downloadJSON\n};\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\n\n\n// TODO: re-define\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  if (['text_field', 'checkbox', 'html'].includes(fmt)) return 'html';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  sortType, formatNum, partialMatch, uuidv4\n};\n","\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: [\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ],\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nfunction convertPackage(json) {\n  let specs = {};\n  if (!json.hasOwnProperty('views')) {\n    const now = new Date();\n    const isNW = json.hasOwnProperty('edges');\n    const data = isNW ? convertNetwork(json) : convertTable(json);\n    const nodes = isNW ? data.nodes : data;\n    specs = {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n      name: data.edges.name,\n      views: [],\n      dataset: []\n    };\n    specs.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: nodes.id,\n      name: nodes.name,\n      contents: [{\n        $schema: nodes.$schema,\n        workflowID: nodes.reference.workflow,\n        name: nodes.name,\n        fields: nodes.fields,\n        records: nodes.records,\n        created: nodes.created,\n        status: nodes.status,\n        query: nodes.query,\n        execTime: nodes.execTime,\n        progress: nodes.progress\n      }]\n    });\n    specs.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: nodes.id,\n      name: nodes.name,\n      viewType: \"datagrid\",\n      rows: nodes.id,\n      fields: nodes.fields,\n      sortOrder: null,\n      filterText: null,\n      checkpoints: [{\n        type: 'convert',\n        date: now.toString(),\n        description: 'converted from legacy format'\n      }]\n    });\n    if (isNW) {\n      specs.dataset.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: data.edges.id,\n        name: data.edges.name,\n        contents: [{\n          $schema: data.edges.$schema,\n          workflowID: data.edges.reference.workflow,\n          name: data.edges.name,\n          fields: data.edges.fields,\n          records: data.edges.records,\n          created: data.edges.created,\n          status: data.edges.status,\n          query: data.edges.query,\n          execTime: data.edges.execTime,\n          progress: data.edges.progress\n        }]\n      });\n      specs.views.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n        viewID: data.edges.id,\n        name: data.edges.name,\n        viewType: \"network\",\n        nodes: nodes.id,\n        edges: data.edges.id,\n        nodeColor: data.edges.snapshot.nodeColor,\n        nodeSize: data.edges.snapshot.nodeSize,\n        nodeLabel: data.edges.snapshot.nodeLabel,\n        nodeLabelColor: data.edges.snapshot.nodeLabelColor,\n        edgeWidth: data.edges.snapshot.edgeWidth,\n        edgeLabel: data.edges.snapshot.edgeLabel,\n        networkThreshold: data.edges.snapshot.networkThreshold,\n        networkThresholdCutoff: data.edges.snapshot.networkThresholdCutoff,\n        fieldTransform: data.edges.snapshot.fieldTransform,\n        coords: data.edges.snapshot.coords,\n        checkpoints: [{\n          type: 'convert',\n          date: now.toString(),\n          description: 'converted from legacy format'\n        }]\n      });\n    }\n    specs.views.filter(e => e.viewType === 'network')\n      .forEach(view => {\n        view.minConnThld = view.networkThresholdCutoff;\n        view.currentConnThld = view.networkThreshold;\n        if (view.hasOwnProperty('nodeLabel')) {\n          view.nodeLabel.field = view.nodeLabel.text;\n        }\n        if (view.hasOwnProperty('edgeLabel')) {\n          view.edgeLabel.field = 'weight';\n        }\n        if (view.hasOwnProperty('edgeWidth')) {\n          view.edgeWidth.field = 'weight';\n        }\n      });\n  } else {\n    specs = json;\n  }\n  specs.views.filter(e => e.viewType === 'network')\n    .forEach(view => {\n      if (!view.nodeColor.field) { view.nodeColor.field = 'index' ;}\n      if (!view.nodeSize.field) { view.nodeSize.field = 'index' ;}\n      if (!view.nodeLabel.field) { view.nodeLabel.field = 'index' ;}\n      if (!view.nodeLabelColor.field) { view.nodeLabelColor.field = 'index' ;}\n      if (!view.edgeColor) {\n        view.edgeColor = {\n          field: 'weight', color: 'monogray',\n          scale: 'linear', domain: [0, 1],\n          range: ['#999999', '#999999'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeColor.field) { view.edgeColor.field = 'weight' ;}\n      if (!view.edgeWidth.field) { view.edgeWidth.field = 'weight' ;}\n      if (!view.edgeLabel.field) { view.edgeLabel.field = 'weight' ;}\n      if (!view.edgeLabelColor) {\n        view.edgeLabelColor = {\n          field: 'weight', color: 'monoblack',\n          scale: 'linear', domain: [1, 1],\n          range: ['#333333', '#333333'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeLabelColor.field) { view.edgeLabelColor.field = 'weight' ;}\n    });\n  return specs;\n}\n\n\nexport default {\n  convertPackage\n};\n","\n/** @module common/idb */\n\nimport _ from 'lodash';\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\nimport {default as legacy} from './legacySchema.js';\n\n// TODO: need package, view and dataset tables?\nconst schema = {\n  items: 'storeID, sessionStarted'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('sessionStarted')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Returns a view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @return {array} view objects\n */\nfunction getView(storeID, viewID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).views)\n    .then(views => {\n      const view = views.find(e => e.viewID === viewID);\n      if (!view) return;\n      view.storeID = storeID;\n      return view;\n    });\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object\n */\nfunction appendView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos + 1, 0, viewObj);\n  });\n}\n\n\n/**\n * Update view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object or update function\n */\nfunction updateView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    if (_.isFunction(viewObj)) {\n      viewObj(item.views[pos]);\n    } else {\n      item.views[pos] = viewObj;\n    }\n  });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteView(storeID, viewID) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos, 1);\n    // prune orphaned collections\n    const bin = {};\n    item.dataset.forEach(e => { bin[e.collectionID] = 0; });\n    item.views.forEach(view => {\n      ['rows', 'items', 'nodes', 'edges']\n        .filter(e => view.hasOwnProperty(e))\n        .forEach(e => { bin[view[e]] += 1; });\n    });\n    Object.entries(bin).forEach(entry => {\n      if (!entry[1]) {\n        const i = item.dataset.findIndex(e => e.collectionID === entry[0]);\n        item.dataset.splice(i, 1);\n      }\n    });\n  });\n}\n\n\n/**\n * Returns all collections in the store\n * @return {array} Collection objects\n */\nfunction getAllCollections() {\n  return getAllItems()\n    .then(items => _.flatten(\n      items.map(item => {\n        return item.dataset.map(coll => {\n          coll.storeID = item.storeID;\n          return coll;\n        });\n      })\n    ));\n}\n\n\n/**\n * Returns a collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @return {array} Collection objects\n */\nfunction getCollection(storeID, collID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).dataset)\n    .then(colls => {\n      const coll = colls.find(e => e.collectionID === collID);\n      if (!coll) return;\n      coll.storeID = storeID;\n      return coll;\n    });\n}\n\n\n/**\n * Update collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object or update function\n */\nfunction updateCollection(storeID, collID, collObj) {\n  return updateItem(storeID, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    if (_.isFunction(collObj)) {\n      collObj(item.dataset[pos]);\n    } else {\n      item.dataset[pos] = collObj;\n    }\n  });\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction importItem(data) {\n  // Legacy format converter\n  data = legacy.convertPackage(data);\n\n  const now = new Date();\n  data.storeID = misc.uuidv4().slice(0, 8);\n  data.sessionStarted = now.toString();\n  return idb.items.put(data);\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} response - response data\n * @return {string} - viewID if sucessfully added\n */\nfunction newDatagrid(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const storeID = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    storeID: storeID,\n    name: response.name,\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n        viewID: viewID,\n        name: response.name,\n        viewType: \"datagrid\",\n        rows: collectionID,\n        checkpoints: [\n          {type: 'creation', date: date}\n        ]\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        name: response.name,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return idb.items.put(data)\n    .then(() => ({storeID: storeID, viewID:viewID}));\n}\n\n\n/**\n * Store new network view\n * @param {string} storeID - Store ID\n * @param {string} nodesID - ID of nodes collection\n * @param {string} nodesName - Name of nodes collection\n * @param {object} response - Response object\n */\nfunction newNetwork(storeID, nodesID, nodesName, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const edgesID = response.workflowID.slice(0, 8);\n  return updateItem(storeID, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: viewID,\n      name: `${nodesName}_${response.name}`,\n      viewType: 'network',\n      nodes: nodesID,\n      edges: edgesID,\n      minConnThld: response.query.params.threshold\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: edgesID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\nexport default {\n  reset, getAllItems, getItem, updateItem, deleteItem,\n  getView, appendView, updateView, deleteView,\n  getAllCollections, getCollection, updateCollection,\n  importItem, newDatagrid, newNetwork\n};\n","\n/** @module component/badge */\n\nimport d3 from 'd3';\n\nconst assetBaseURL = '../assets/';\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction badge(selection) {\n  selection.classed('badge', true);\n  selection.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('text', true);\n}\n\n\nfunction updateBadge(selection, text, type, icon) {\n  selection.classed(`badge-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nfunction notify(selection) {\n  selection\n    .style('opacity', 0)\n    .style('display', 'inline')\n    .transition()\n      .duration(500)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 1.0)\n    .transition()\n      .delay(3000)\n      .duration(1000)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 0)\n      .on('end', function () {\n        selection.style('display', 'none');\n      });\n}\n\n\nfunction loadingCircle(selection) {\n  selection\n      .style('display', 'none')\n    .append('img')\n      .attr('src', `${assetBaseURL}loading1.gif`)\n      .style('width', '2rem')\n      .style('height', '2rem');\n}\n\n\nfunction alert(selection) {\n  selection.classed('alert', true)\n      .classed('px-1', true)\n      .classed('py-0', true);\n  selection.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('text', true)\n      .style('font-size', '75%');\n}\n\n\nfunction updateAlert(selection, text, type, icon) {\n  selection.classed(`alert-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nfunction invalidFeedback(selection) {\n  selection.classed('invalid-feedback', true)\n      .style('display', 'none');\n  selection.append('img')\n      .classed('icon', true)\n      .attr('src', `${iconBaseURL}caution-salmon.svg`)\n      .style('width', '1rem')\n      .style('height', '1rem');\n  selection.append('span')\n      .classed('invalid-msg', true);\n}\n\nfunction updateInvalidMessage(selection, msg) {\n  selection.select('.invalid-msg')\n      .text(msg);\n}\n\n\nexport default {\n  badge, updateBadge, notify, loadingCircle,\n  alert, updateAlert, invalidFeedback, updateInvalidMessage\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction buttonBox(selection, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .text(label);\n}\n\n\nfunction menuButton(selection, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, target, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('label', true)\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, label, type, icon) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  const button = selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  button.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  button.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, label, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, label, target, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, label, accept, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      });\n  selection.append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  iconBaseURL, buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module component/modal */\n\nimport d3 from 'd3';\n\n\nfunction dialogBase(selection, id) {\n  selection\n      .classed('modal', true)\n      .attr('tabindex', -1)\n      .attr('role', 'dialog')\n      .attr('aria-labelledby', '')\n      .attr('aria-hidden', true)\n      .attr('id', id);\n  selection.append('div')\n      .classed('modal-dialog', true)\n      .attr('role', 'document')\n    .append('div')\n      .classed('modal-content', true);\n}\n\n\nfunction confirmDialog(selection, id) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // body\n  base.append('div')\n      .classed('modal-body', true)\n    .append('div')\n      .classed('message', true);\n  // footer\n  const footer = base.append('div')\n      .classed('modal-footer', true);\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-outline-secondary', true)\n      .classed('cancel', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Cancel');\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-warning', true)\n      .classed('ok', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('OK')\n      .on('click', () => {\n        selection.dispatch('submit');\n      });\n}\n\n\nfunction updateConfirmDialog(selection, message) {\n  selection.select('.message').text(message);\n}\n\n\nfunction submitDialog(selection, id, title) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // header\n  const header = base.append('div')\n      .classed('modal-header', true);\n  header.append('h4')\n      .classed('modal-title', true)\n      .text(title);\n  header.append('button')\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('aria-label', 'Close')\n      .classed('close', true)\n    .append('span')\n      .attr('aria-hidden', true)\n      .html('&times;');\n  // body\n  base.append('div')\n      .classed('modal-body', true);\n  // footer\n  base.append('div')\n      .classed('modal-footer', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-primary', true)\n      .classed('submit', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Submit')\n      .on('click', () => {\n        // Dismiss before submit\n        // Submit event can update the modal itself\n        // (ex. disable submit button before onSubmit call has completed)\n        $(`#${id}`).modal('hide');\n        selection.dispatch('submit');\n      });\n}\n\n\nexport default {\n  confirmDialog, updateConfirmDialog, submitDialog\n};\n","\n/** @module common/scale */\n\nimport d3 from 'd3';\n\n\nconst colorScales = [\n  {key: 'monoblack', type: 'monocolor', colors: ['#333333'], unknown: '#333333'},\n  {key: 'monogray', type: 'monocolor', colors: ['#cccccc'], unknown: '#cccccc'},\n  {key: 'nodeDefault', type: 'monocolor', colors: ['#7fffd4'], unknown: '#7fffd4'},\n  {key: 'aquamarine', type: 'bicolor',\n   colors: ['#778899', '#7fffd4'], unknown: '#f0f0f0'},\n  {key: 'chartreuse', type: 'bicolor',\n   colors: ['#778899', '#7fff00'], unknown: '#f0f0f0'},\n  {key: 'salmon', type: 'bicolor',\n   colors: ['#778899', '#fa8072'], unknown: '#f0f0f0'},\n  {key: 'violet', type: 'bicolor',\n   colors: ['#778899', '#ee82ee'], unknown: '#f0f0f0'},\n  {key: 'temperature', type: 'tricolor',\n   colors: ['#87ceeb', '#fff5ee', '#fa8072'], unknown: '#f0f0f0'},\n  {key: 'spectrum', type: 'tricolor',\n   colors: ['#6495ed', '#ccff66', '#ffa500'], unknown: '#f0f0f0'},\n  {key: 'category10', type: 'categorical',\n   colors: ['#8dd3c7','#ffffb3','#bebada','#fb8072','#80b1d3','#fdb462',\n    '#b3de69','#fccde5','#bc80bd','#ccebc5'], unknown: '#f0f0f0'},\n  {key: 'cbsafe', type: 'categorical',\n   colors: ['#543005','#8c510a','#bf812d','#dfc27d','#f6e8c3','#c7eae5',\n   '#80cdc1','#35978f','#01665e','#003c30'], unknown: '#f0f0f0'},\n  {key: 'category20', type: 'categorical',\n   colors: d3.schemePaired.concat(d3.schemeSet2), unknown: '#f0f0f0'},\n  {key: 'category40', type: 'categorical',\n   colors: d3.schemePaired.concat(d3.schemePastel2, d3.schemeSet2, d3.schemeSet3),\n   unknown: '#f0f0f0'},\n  {key: 'custom', type: 'custom', colors: ['#ffffff'], text: 'custom'}\n];\n\n\nconst types = [\n  {key: 'linear', name: 'Linear', func: d3.scaleLinear},\n  {key: 'log', name: 'Log', func: d3.scaleLog},\n  {key: 'quantize', name: 'Quantize', func: d3.scaleQuantize},\n  {key: 'ordinal', name: 'Ordinal', func: d3.scaleOrdinal}\n];\n\n\nfunction scaleFunction(state) {\n  const cscale = colorScales.find(e => e.key === state.color);\n  let range;\n  let unknown;\n  if (cscale && cscale.key !== 'custom') {\n      range = cscale.colors;\n      unknown = cscale.unknown;\n  } else {\n    range = state.range;\n    unknown = state.unknown;\n  }\n  let domain = null;\n  if (range.length === 3) {\n    const mid = (parseFloat(state.domain[0]) + parseFloat(state.domain[1])) / 2;\n    domain = [state.domain[0], mid, state.domain[1]];\n  } else {\n    domain = state.domain;\n  }\n  // Build\n  let scaleFunc = types.find(e => e.key === state.scale).func();\n  scaleFunc = scaleFunc.domain(domain);\n  scaleFunc = scaleFunc.range(range);\n  if (['linear', 'log'].includes(state.scale)) {\n    scaleFunc = scaleFunc.clamp(true);\n  }\n\n  return d => {\n    // Sanitize\n    if (d === '' || typeof d === 'undefined' || d === null) {\n      return unknown;  // invalid values\n    }\n    if (['linear', 'log'].includes(state.scale) && parseFloat(d) != d) {\n      return unknown;  // texts\n    }\n    if (state.scale === 'log' && d <= 0) {\n      return unknown;  // negative values in log scale\n    }\n    // Apply function\n    const result = scaleFunc(d);\n    if (result === undefined) {\n      return unknown;  // TODO: specify unexpected behavior\n    }\n    return result;\n  };\n}\n\n\nfunction isD3Format(notation) {\n  try {\n    d3.format(notation);\n  } catch (err) {\n    return false;\n  }\n  return true;\n}\n\n\nexport default {\n  colorScales, types, scaleFunction, isD3Format\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: [keyField].concat(mp.fields),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: table.fields.filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key)),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: fields,\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(mp.fields)\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/collection */\n\nimport _ from 'lodash';\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as mapper} from './mapper.js';\n\n\nexport default class Collection {\n  /**\n   * Create Collection from a flashflood response datatable\n   * If data is not specified, put datatables later by this.append(data)\n   * @param {object} coll - Collection or response object\n   */\n  constructor(coll) {\n    // Settings\n    this.autoIndex = 'index';  // enumerate records\n\n    this.collectionID = coll.collectionID || null;\n    this.storeID = coll.storeID || null;\n    this.name = coll.name || null;\n    if (coll.records) {\n      this.contents = [coll];\n      this.fields = [];\n    } else {\n      this.contents = coll.contents;\n      this.fields = coll.fields || [];\n    }\n    this.contents.forEach(content => {\n      content.fields.forEach(e => this.addField(e));\n    });\n  }\n\n  /**\n   * Add fields\n   * @param {array} fs - list of fields\n   */\n  addField(field) {\n    if (this.fields.find(e => e.key === field.key)) return;\n    if (!field.hasOwnProperty('name')) field.name = field.key;\n    if (!field.hasOwnProperty('visible')) field.visible = true;\n    if (field.hasOwnProperty('d3_format')) field.format = 'd3_format';\n    if (!field.hasOwnProperty('format')) field.format = 'raw';\n    this.fields.push(field);\n  }\n\n  /**\n   * Update fields properties\n   * @param {array} fs - list of fields\n   */\n  updateFields(fs) {\n    this.fields = [];\n    fs.forEach(e => this.addField(e));\n  }\n\n  /**\n   * Join fields\n   * @param {object} mapping - column mapper object\n   */\n  joinFields(mapping) {\n    this.contents.forEach(c => {\n      mapper.apply(c, mapping);\n    });\n    if (mapping.hasOwnProperty('fields')) {\n      mapping.fields.forEach(e => this.addField(e));\n    } else {\n      this.addField(mapping.field);\n    }\n  }\n\n  /**\n   * Apply function to the original data records\n   * new fields should be manually added by Collection.addField\n   * @param {function} func - function to be applied\n   */\n  apply(func) {\n    this.contents.forEach(content => {\n      content.records.forEach(rcd => {\n        func(rcd);\n      });\n    });\n  }\n\n  /**\n   * Return all records of the collection\n   * @return {array} records\n   */\n  records() {\n    return _.flatten(this.contents.map(e => e.records));\n  }\n\n  fetch(command) {\n    const fs = this.contents\n      .filter(e => ['running', 'ready', 'interrupted', 'queued'].includes(e.status))\n      .map(content => {\n        const query = {id: content.workflowID, command: command};\n        return fetcher.get('progress', query)\n          .then(fetcher.json)\n          .then(data => {\n            return idb.updateCollection(this.storeID, this.collectionID, coll => {\n              const i = coll.contents\n                .findIndex(e => e.workflowID === query.id);\n              if (data.status === 'failure') {  // No data found on server\n                coll.contents[i].status = 'failure';\n              } else {\n                coll.contents[i] = data;\n              }\n            });\n          });\n      });\n    return Promise.all(fs)\n      .then(() => idb.getCollection(this.storeID, this.collectionID))\n      .then(coll => {\n        this.contents = coll.contents;\n      });\n  }\n\n  /**\n   * Retrieve workflows and store it into a local store.\n   * @return {Promise}\n   */\n  pull() {\n    return this.fetch('pull');\n  }\n\n  /**\n   * Retrieve workflows, abort all ongoing workflow task\n   * and store it into a local store.\n   * @return {Promise}\n   */\n  abort() {\n    return this.fetch('abort');\n  }\n\n  /**\n   * Return total number of records\n   * @return {float} total number of records\n   */\n  size() {\n    return _.sum(this.contents.map(e => e.records.length));\n  }\n\n  /**\n   * Return status\n   * @return {string} status\n   */\n  status() {\n    if (this.contents.some(e => e.status === 'interrupted')) return 'interrupted';\n    if (this.contents.some(e => e.status === 'running')) return 'running';\n    if (this.contents.some(e => e.status === 'queued')) return 'queued';\n    if (this.contents.some(e => e.status === 'ready')) return 'ready';\n    if (this.contents.some(e => e.status === 'aborted')) return 'aborted';\n    if (this.contents.some(e => e.status === 'failure')) return 'failure';\n    return 'done';\n  }\n\n  /**\n   * Return ongoing or not\n   * @return {bool} ongoing or not\n   */\n  ongoing() {\n    const s = ['ready', 'queued', 'running', 'interrupted'];\n    return s.includes(this.status());\n  }\n\n  /**\n   * Return percentage of workflow progress\n   * @return {float} progress in percent\n   */\n  progress() {\n    return _.min(this.contents.map(e => e.progress));\n  }\n\n  /**\n   * Return total execution time\n   * @return {float} total time\n   */\n  execTime() {\n    return _.sum(this.contents.map(e => e.execTime));\n  }\n\n  /**\n   * Export collection object as JSON\n   * @return {object} collection JSON\n   */\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: this.collectionID,\n      name: this.name,\n      fields: this.fields,\n      contents: this.contents\n    };\n  }\n}\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction headerCellRenderer(header) {\n  header.style('display', 'inline-block')\n    .style('width', d => `${d.width}%`)\n    .text(d => d.name);\n}\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .call(state.headerCellRenderer);\n}\n\n\nfunction updateRows(selection, state) {\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.selectAll('.dg-cell').remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', 'absolute')\n      .style('width', '100%')\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0)\n          .call(state.rowFactory(), d);\n      });\n}\n\n\nfunction updateViewport(selection, state, scrollPos) {\n  selection.select('.dg-body').style('height', `${state.bodyHeight}px`);\n  state.setScrollPosition(scrollPos);\n  selection.call(updateRows, state, scrollPos);\n  selection.select('.dg-viewport').node().scrollTop = scrollPos * state.rowHeight;\n}\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.resizeViewport(window.innerHeight - viewportTop - 5);\n  viewport.style('height', `${state.viewportHeight}px`);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(updateRows, state, pos);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyHeader();\n    selection.call(updateHeader, state);\n    selection.call(resize, state);\n    state.applyData();\n    selection.call(updateViewport, state, state.viewportTop);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    selection.call(updateViewport, state, 0);\n  };\n}\n\n\n\nexport default {\n  headerCellRenderer, updateHeader, updateRows, updateViewport,\n  resize, datagrid\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nfunction binaryToDataURI(binary) {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      resolve(event.target.result);\n    };\n    reader.readAsDataURL(binary);\n  });\n}\n\n\nexport default {\n  plotCell, plotThumbnail, binaryToDataURI\n};\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction date(selection, record, field) {\n  // TODO; formatter\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  // TODO: Check vulnerabilities\n  selection.html(record[field.key]);\n}\n\n\nfunction compound_id(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n}\n\nfunction textField(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'text')\n      .style('width', '90%')\n      .property('value', record[field.key])\n      .on('change', function () {\n        record[field.key] = this.value;\n      });\n}\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  date: date,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compound_id,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  text_field: textField,\n  control: call,\n  svg: html,\n  html: html\n};\n\n\nfunction rowCell(selection) {\n  selection.classed('dg-cell', true)\n    .classed('align-middle', true)\n    .classed('text-truncate', true)\n    .style('display', 'inline-block');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n          .call(rowCell)\n          .style('width', `${field.width}%`);\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compound_id, image, checkbox, textField, call,\n  rowCell, rowFactory\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport Collection from '../common/collection.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as component} from './component.js';\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(view, coll) {\n    this.storeID = view.storeID || null;\n    this.viewID = view.viewID || null;\n    this.name = view.name || null;\n    this.sortOrder = view.sortOrder || [];\n    this.filterText = view.filterText || null;\n    this.rows = new Collection(coll);\n\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    // TODO: auto adjust\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      html: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.viewportTop = 0;\n    this.previousViewportTop = null;\n    this.viewportBottom = null;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.headerCellRenderer = component.headerCellRenderer;\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n  }\n\n  /**\n   * Set viewport height and number of rows to show\n   * @param {int} height - viewport height\n   */\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n  }\n\n  /**\n   * Set range of the row indices to show\n   * @param {int} position - Index of the top row to show\n   */\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setNumViewportRows() {\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  resizeViewport(height) {\n    this.setViewportSize(height);\n    this.setNumViewportRows();\n  }\n\n  /**\n   * Apply header data\n   */\n  applyHeader() {\n    this.visibleFields = this.rows.fields.filter(e => e.visible);\n    const widthfSum = this.visibleFields.reduce((a, c) => a + (c.widthf || 1), 0);\n    this.visibleFields = this.visibleFields.map(e => {\n      const field = {\n        width: (e.widthf || 1) / widthfSum * 100,\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b, 0).height;\n  }\n\n  /**\n   * Apply row data\n   * 1. applyHeader: define fields and set rowHeight\n   * 2. resize: measure actual window size and calc viewportHeight\n   * 3. applyData: calc number of rows from rowHeight and viewportHeight\n   * 4. setScrollPosition: calc row index range\n   * 5. recordsToShow: slice rows to show\n   */\n  applyData() {\n    this.setNumViewportRows();\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.rows.records().slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.rows.records().slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  updateFields(fs) {\n    this.rows.updateFields(fs);\n  }\n\n  joinFields(mapping) {\n    this.rows.joinFields(mapping);\n    this.applyData();\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  save() {\n    return idb.updateItem(this.storeID, item => {\n      const ci = item.dataset\n        .findIndex(e => e.collectionID === this.rows.collectionID);\n      item.dataset[ci] = this.rows.export();\n      const vi = item.views.findIndex(e => e.viewID === this.viewID);\n      item.views[vi] = this.export();\n    });\n  }\n\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: this.viewID,\n      name: this.name,\n      viewType: \"datagrid\",\n      rows: this.rows.collectionID,\n      sortOrder: this.sortOrder,\n      filterText: this.filterText\n    };\n  }\n}\n","\n/** @module component/formBox */\n\nimport d3 from 'd3';\n\nimport {default as badge} from './badge.js';\n\n\nfunction updateFormValue(selection, value) {\n  selection.select('.form-control').property('value', value);\n  selection.call(setValidity, true);  // Clear validity state\n}\n\n\nfunction formValue(selection) {\n  return selection.select('.form-control').property('value');\n}\n\n\nfunction formValid(selection) {\n  return selection.select('.form-control').node().checkValidity();\n}\n\n\nfunction setValidity(selection, valid) {\n  selection.select('.invalid-feedback')\n      .style('display', valid ? 'none': 'inherit');\n  selection.select('.form-control')\n      .style('background-color', valid ? null : '#ffcccc');\n}\n\n\nfunction textBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .on('input', function () {\n        const valid = formValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\n\nfunction readonlyBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .attr('readonly', 'readonly');\n}\n\nfunction updateReadonlyValue(selection, value) {\n  selection.select('.form-control-plaintext').property('value', value);\n}\n\nfunction readonlyValue(selection) {\n  return selection.select('.form-control-plaintext').property('value');\n}\n\n\nfunction textareaBox(selection, label, rows, placeholder) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  const formLabel = selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  formLabel.append('div')\n      .call(badge.invalidFeedback);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows)\n      .attr('placeholder', placeholder)\n      .on('input', function () {\n        const valid = textareaValid(selection);\n        selection.call(setValidity, valid);\n      });\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n')\n    .map(e => e.replace(/^\\s+|\\s+$/g, ''))  // strip spaces\n    .filter(e => e.length > 0);\n  return [];\n}\n\nfunction textareaValid(selection) {\n  return /\\s*?\\w\\s*?/.test(formValue(selection));\n}\n\n\nfunction checkBox(selection, label) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox');\n  box.append('span')\n      .text(label);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'number')\n      .on('input', function () {\n        const valid = formValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\nfunction updateNumberRange(selection, min, max, step) {\n  selection.select('.form-control')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step)\n      .dispatch('input', {bubbles: true});\n}\n\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n}\n\n\nfunction fileInputBox(selection, label, accept) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('form-control-file', true)\n      .classed('col-8', true)\n      .attr('type', 'file')\n      .attr('accept', accept)\n      .on('change', function () {\n        const valid = fileInputValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\nfunction clearFileInput(selection) {\n  // TODO: FileList object (input.files) may be a readonly property\n  const label = selection.select('label').text();\n  const accept = selection.select('input').attr('accept');\n  selection.selectAll('*').remove();\n  selection.call(fileInputBox, label, accept);\n}\n\nfunction fileInputValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\nfunction fileInputValid(selection) {\n  // TODO: attribute 'require' does not work with input type=file\n  return selection.select('input').property('files').length > 0;\n}\n\n\nexport default {\n  updateFormValue, formValue, formValid, setValidity,\n  textBox, readonlyBox, updateReadonlyValue, readonlyValue,\n  textareaBox, textareaBoxLines, textareaValid,\n  numberBox, updateNumberRange,\n  checkBox, updateCheckBox, checkBoxValue,\n  colorBox,\n  fileInputBox, clearFileInput, fileInputValue, fileInputValid\n};\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, 'Search');\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.formValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction setSort(selection, state) {\n  state.headerCellRenderer = header => {\n    header.style('display', 'inline-block')\n      .style('width', d => `${d.width}%`)\n      .text(d => d.name)\n      .filter(d => misc.sortType(d.format) !== 'none')\n      .append('span').append('a')\n        .attr('id', d => `sort-${d.key}`)\n        .text('^v')\n        .style('display', 'inline-block')\n        .style('width', '30px')\n        .style('text-align', 'center')\n      .on('click', d => {\n        const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n        d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n        state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n        selection.call(component.updateRows, state);\n      });\n  };\n}\n\n\nexport default {\n  setSort\n};\n","\n/** @module datagrid/table */\n\nimport Collection from '../common/collection.js';\n\nimport DatagridState from './state.js';\nimport {default as component} from './component.js';\nimport {default as rowf} from './rowFilter.js';\nimport {default as sort} from './sort.js';\n\n\nfunction table(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  state.keyFunc = d => d;\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterSortTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(sort.setSort, state)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction update(selection, fields, records) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = selection.datum();\n  state.rows = new Collection(data);\n  state.updateContentsNotifier();\n}\n\n\nfunction updateRecords(selection, records) {\n  const state = selection.datum();\n  state.rows.contents[0].records = records;\n  state.updateContentsNotifier();\n}\n\n\nfunction tableRecords(selection) {\n  const state = selection.datum();\n  return state.rows.records();\n}\n\n\nexport default {\n  table, filterTable, filterSortTable, update, updateRecords, tableRecords\n};\n","\n/** @module dialog/fieldConfig */\n\nimport d3 from 'd3';\n\nimport {default as scale} from '../common/scale.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\nimport {default as rowf} from '../datagrid/rowFactory.js';\n\n\nconst id = 'fieldconf-dialog';\nconst title = 'Column setting';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-edittable');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[0].width}%`)\n        .text(record.name);\n    selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[1].width}%`)\n      .append('input')\n        .attr('type', 'checkbox')\n        .property('checked', record.visible)\n        .on('change', function () {\n          record.visible = this.checked;\n        });\n    const select = selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[2].width}%`)\n      .append('select');\n    const extra = !fields[2].options.includes(record.format);\n    select.selectAll('option').data(extra ? [record.format] : fields[2].options)\n      .enter().append('option')\n        .attr('value', d => d)\n        .text(d => d);\n    select.property('value', record.format)\n        .property('disabled', extra)\n        .on('change', function () {\n          record.format = this.value;\n          selection.select('.d3f input')\n            .property('disabled', record.format !== 'd3_format');\n        });\n    selection.append('div')\n        .call(rowf.rowCell)\n        .classed('d3f', true)\n        .style('width', `${fields[3].width}%`)\n      .append('input')\n        .attr('type', 'text')\n        .style('width', '90%')\n        .property('value', record.d3_format)\n        .property('disabled', record.format !== 'd3_format')\n        .on('input', function () {\n          const valid = scale.isD3Format(this.value);\n          d3.select(this)\n              .style('background-color', valid ? '#ffffff' : '#ffcccc');\n          if (valid) {\n            record.d3_format = this.value;\n            selection.dispatch('change', {bubbles: true});\n          }\n        });\n  };\n}\n\n\nfunction body(selection) {\n  const fields = [\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'visible', name: 'Visible', format: 'checkbox',\n     widthf: 0.5, height: 40},\n    {key: 'format', name: 'Format', format: 'select',\n     options: ['text', 'numeric', 'd3_format', 'raw', 'compound_id'],\n     height: 40},\n    {key: 'd3_format', name: 'D3 format', format: 'text_field',\n     height: 40}\n  ];\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-dialog').classed('modal-lg', true);\n  dialog.select('.modal-body').append('div')\n      .classed('dgfields', true)\n      .call(table.table, fields, [], rowFactory, 300);\n}\n\n\nfunction updateBody(selection, dgfields) {\n  selection.select('.dgfields')\n      .call(table.updateRecords, dgfields)\n      .on('change', function () {\n        const d3fValid = d3.select(this).selectAll('.d3f input')\n          .nodes().map(e => e.value)\n          .every(n => scale.isD3Format(n));\n        selection.select('.submit')\n            .property('disabled', !d3fValid);\n      });\n}\n\n\nfunction value(selection) {\n  return table.tableRecords(selection.select('.dgfields'));\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module dialog/fieldFetch */\n\nimport _ from 'lodash';\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as mapper} from '../common/mapper.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\n\n\nconst id = 'fieldfetch-dialog';\nconst title = 'Fetch assays';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addassay');\n}\n\n\nfunction body(selection) {\n  const fields = [\n    {key: 'check', name: 'Check', format: 'checkbox',\n     widthf: 0.5, height: 40, disabled: 'check_d'},\n    {key: 'assay_id', name: 'Assay ID', format: 'assay_id'},\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'value_type', name: 'Value type', format: 'text'},\n    {key: 'tags', name: 'Tags', format: 'list', widthf: 2}\n  ];\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-dialog').classed('modal-lg', true);\n  dialog.select('.modal-body').append('div')\n    .classed('assays', true)\n    .call(table.filterTable, fields, []);\n}\n\n\nfunction updateBody(selection, schema, dgfields) {\n  const assays = _.flatten(\n    schema.resources.filter(e => e.domain === 'assay').map(e => e.data)\n  );\n  const items = _.flatMap(assays, assay => {\n    return assay.value_types.map(e => {\n      const copy = Object.assign({}, assay);\n      copy.value_type = e.key;\n      delete copy.value_types;\n      return copy;\n    });\n  });\n  const done = {};\n  dgfields.filter(e => e.hasOwnProperty('__origin'))\n    .map(e => e.__origin)\n    .forEach(e => {\n      if (!done.hasOwnProperty(e.assay_id)) {\n        done[e.assay_id] = [];\n      }\n      done[e.assay_id].push(e.value_type);\n    });\n  const records = items.map(item => {\n    const d = done.hasOwnProperty(item.assay_id)\n        && done[item.assay_id].includes(item.value_type);\n    item.check = d;\n    item.check_d = d;\n    return item;\n  });\n  selection.select('.assays')\n    .call(table.updateRecords, records)\n    .on('change', function () {  // Validation\n      const anyChecked = table.tableRecords(d3.select(this))\n        .filter(e => e.check && !e.check_d).length;\n      selection.select('.submit').property('disabled', !anyChecked);\n    })\n    .dispatch('change');\n}\n\n\nfunction execute(selection, compounds, schema) {\n  const targets = schema.resources\n    .filter(e => e.domain === 'activity').map(e => e.id);\n  const queries = table.tableRecords(selection.select('.assays'))\n    .filter(e => e.check && !e.check_d)\n    .map(e => {\n      return {\n        workflow: 'activity',\n        targets: targets,\n        assay_id: e.assay_id,\n        condition: {\n          compounds: compounds,\n          value_types: [e.value_type]\n        }\n      };\n    })\n    .map(q => {\n      return fetcher.get(q.workflow, q)\n        .then(fetcher.json);\n    });\n    return Promise.all(queries).then(res => {\n      const merged = res.shift();\n      res.forEach(data => {\n        const mp = mapper.tableToMapping(\n          data, 'compound_id', ['index', 'assay_id']);\n        mapper.apply(merged, mp);\n      });\n      return mapper.tableToMapping(\n        merged, 'compound_id', ['index', 'assay_id']);\n    });\n}\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module component/shape */\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction monocolorBar(selection, colors, text) {\n  selection.attr('viewBox', '0 0 100 10')\n      .attr('preserveAspectRatio', 'none');\n  const group = selection.append('g');\n  group.append('rect')\n      .attr('x', 0).attr('y', 0)\n      .attr('width', 100).attr('height', 10)\n      .attr('fill', colors[0]);\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 10)\n      .attr('font-size', 12)\n      .text(text);\n}\n\nfunction bicolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n      .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n      .attr('offset', 1).attr('stop-color', colors[1]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction tricolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n    .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n    .attr('offset', 0.5).attr('stop-color', colors[1]);\n  grad.append('stop')\n    .attr('offset', 1).attr('stop-color', colors[2]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction categoricalBar(selection, colors, text) {\n  selection.attr('viewBox', '0 0 100 10')\n      .attr('preserveAspectRatio', 'none');\n  const sw = 100 / colors.length;\n  const group = selection.append('g');\n  colors.forEach((e, i) => {\n    group.append('rect')\n        .attr('x', sw * i).attr('y', 0)\n        .attr('width', sw).attr('height', 20)\n        .attr('fill', colors[i]);\n  });\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 20)\n      .attr('font-size', 20)\n      .text(text);\n}\n\nfunction setSize(selection, width, height) {\n  selection.attr('width', width).attr('height', height);\n}\n\n\nconst colorBar = {\n  'monocolor': monocolorBar,\n  'bicolor': bicolorBar,\n  'tricolor': tricolorBar,\n  'categorical': categoricalBar,\n  'custom': monocolorBar\n};\n\n\nexport default {\n  colorBar, setSize\n};\n","\n/** @module component/formListBox */\n\nimport d3 from 'd3';\n\nimport {default as badge} from './badge.js';\nimport {default as box} from './formBox.js';\nimport {default as shape} from './shape.js';\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction selectBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('select')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .on('input', function () {\n        const valid = box.formValid(selection);\n        selection.call(box.setValidity, valid);\n      });\n}\n\nfunction updateSelectBoxOptions(selection, items) {\n  const options = selection.select('select')\n    .selectAll('option')\n      .data(items, d => d.key);\n  options.exit().remove();\n  options.enter()\n    .append('option')\n      .attr('value', d => d.key)\n      .text(d => d.name);\n}\n\nfunction selectedRecord(selection) {\n  const value = box.formValue(selection);\n  return selection.selectAll('select option').data()\n      .find(e => e.key === value);\n}\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction checklistBox(selection, label) {\n  // TODO: scroll\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  const formLabel = selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  formLabel.append('div')\n      .call(badge.invalidFeedback);\n  selection.append('ul')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n}\n\nfunction updateChecklistItems(selection, items) {\n  const listitems = selection.select('ul')\n    .selectAll('li')\n      .data(items, d => d.key);\n  listitems.exit().remove();\n  const form = listitems.enter()\n    .append('li')\n      .attr('class', 'form-check')\n    .append('label')\n      .attr('class', 'form-check-label');\n  form.append('input')\n      .attr('type', 'checkbox')\n      .attr('class', 'form-check-input')\n      .property('value', d => d.key);\n  form.append('span')\n      .text(d => d.name);\n}\n\nfunction checkRequired(selection) {\n  selection.selectAll('input')\n      .on('change', function () {\n        const valid = anyChecked(selection);\n        selection.call(setChecklistValidity, valid);\n      });\n}\n\nfunction updateChecklistValues(selection, values) {\n  selection.selectAll('input')\n    .each(function (d) {\n      d3.select(this).property('checked', values.includes(d.key));\n    });\n  selection.call(setChecklistValidity, true);  // Clear validity state\n}\n\nfunction checklistValues(selection) {\n  return selection.selectAll('input:checked').data().map(d => d.key);\n}\n\nfunction anyChecked(selection) {\n  return checklistValues(selection).length > 0;\n}\n\nfunction setChecklistValidity(selection, valid) {\n  selection.select('.invalid-feedback')\n      .style('display', valid ? 'none': 'inherit');\n  selection.select('.form-control')\n      .style('background-color', valid ? null : 'LightPink');\n}\n\n\nfunction colorScaleBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label || 'Colorscale');\n  const form = selection.append('div')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n  const dropdown = form.append('div')\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  dropdown.append('button')\n      .classed('btn', true)\n      .classed(`btn-light`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  dropdown.append('div')\n      .classed('dropdown-menu', true)\n      .classed('py-0', true);\n  form.append('span')\n      .classed('selected', true);\n}\n\nfunction colorScaleBoxItems(selection, items) {\n  const listitems = selection.select('.dropdown-menu')\n    .selectAll('a')\n      .data(items, d => d);\n  listitems.exit().remove();\n  listitems.enter()\n    .append('a')\n      .classed('dropdown-item', true)\n      .classed('py-0', true)\n      .attr('href', '#')\n      .attr('title', d => d.key)\n      .on('click', function (d) {\n        selection.call(setSelectedColorScale, d);\n        selection.dispatch('change', {bubbles: true});\n      })\n    .append('svg')\n      .each(function (d) {\n        d3.select(this)\n          .call(shape.colorBar[d.type], d.colors, d.text)\n          .call(shape.setSize, 100, 10);\n      });\n}\n\nfunction setSelectedColorScale(selection, item) {\n  const selected = selection.select('.selected');\n  selected.selectAll('svg').remove();\n  selected.datum(item);  // Bind selected item record\n  selected.append('svg')\n      .call(shape.colorBar[item.type], item.colors, item.text)\n      .call(shape.setSize, 100, 10);\n}\n\nfunction updateColorScaleBox(selection, key) {\n  const data = selection.select('.dropdown-menu')\n    .selectAll('a').data();\n  const item = data.find(e => e.key === key);\n  selection.call(setSelectedColorScale, item);\n}\n\nfunction colorScaleBoxValue(selection) {\n  return selection.select('.selected').datum().key;\n}\n\nfunction colorScaleBoxItem(selection) {\n  return selection.select('.selected').datum();\n}\n\n\nexport default {\n  selectBox, updateSelectBoxOptions, selectedRecord,\n  checklistBox, updateChecklistItems, checkRequired, updateChecklistValues,\n  checklistValues, anyChecked, setChecklistValidity,\n  colorScaleBox, colorScaleBoxItems, updateColorScaleBox,\n  colorScaleBoxValue, colorScaleBoxItem\n};\n","\n/** @module dialog/fieldFile */\n\nimport d3 from 'd3';\n\nimport {default as mapper} from '../common/mapper.js';\nimport {default as misc} from '../common/misc.js';\nimport {default as hfile} from '../common/file.js';\nimport {default as himg} from '../common/image.js';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\n\n\nconst id = 'fieldfile-dialog';\nconst title = 'Import fields from file';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addfile');\n}\n\n\nfunction body(selection) {\n  const mbody = selection.call(modal.submitDialog, id, title)\n      .select('.modal-body');\n\n  // File input\n  mbody.append('div')\n      .classed('file', true)\n      .call(box.fileInputBox, 'File (JSON mapping or CSV)', '.json,.csv')\n      .on('change', function () {\n        const valid = box.fileInputValid(d3.select(this));\n        selection.select('.submit').property('disabled', !valid);\n        if (!valid) return;\n        const file = box.fileInputValue(d3.select(this));\n        return hfile.readFile(file)\n          .then(res => {\n            const isCsv = file.name.split('.').pop() === 'csv';\n            const mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n            const tbl = mapper.mappingToTable(mapping);\n            selection.select('.right')\n              .call(lbox.updateSelectBoxOptions,\n                    [{key: mapping.key, name: mapping.key}])\n              .call(box.updateFormValue, mapping.key);\n            selection.select('.preview')\n              .call(table.update, tbl.fields, tbl.records.slice(0, 5));\n          });\n      });\n\n  // Left join key\n  mbody.append('div')\n      .classed('left', true)\n      .call(lbox.selectBox, 'Datagrid ID');\n\n  // Right join key\n  mbody.append('div')\n      .classed('right', true)\n      .call(lbox.selectBox, 'File ID')\n    .select('select')\n      .property('disabled', true);\n\n  // Preview\n  mbody.append('h5')\n      .classed('mt-2', true)\n      .text('Preview');\n  mbody.append('div')\n      .classed('preview', true)\n      .call(table.table, [], [], null, 210);\n}\n\n\nfunction updateBody(selection, fields) {\n  const leftFields = fields.filter(e => misc.sortType(e.format) !== 'none');\n  const leftDefault = leftFields\n    .find(e => e.format === 'compound_id') || leftFields[0];\n  selection.select('.left')\n      .call(lbox.updateSelectBoxOptions, leftFields)\n      .call(box.updateFormValue, leftDefault.key);\n  selection.select('.preview')\n      .call(table.update, [], []);\n  selection.select('.file')\n      .call(box.clearFileInput)\n      .call(badge.updateInvalidMessage, 'Please choose a valid file');\n  selection.select('.submit').property('disabled', true);\n}\n\n\nfunction readFile(selection) {\n  const left = box.formValue(selection.select('.left'));\n  const file = box.fileInputBoxValue(selection.select('.file'));\n  const isCsv = file.name.split('.').pop() === 'csv';\n  return hfile.readFile(file)\n    .then(res => {\n      let mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n      if (mapping.hasOwnProperty('field')) {\n        mapping = mapper.singleToMulti(mapping);\n      }\n      mapping.key = left;\n      // TODO; refactor\n      const plotCols = [];\n      mapping.fields.forEach((e, i) => {\n        if (e.format === 'plot') {\n          mapping.fields[i].format = 'image';\n          plotCols.push(i);\n        }\n      });\n      if (plotCols.length > 0) {\n        const ps = [];\n        Object.entries(mapping.mapping).forEach(m => {\n          plotCols.forEach(e => {\n            const p = himg.plotThumbnail(m[1][e])\n              .then(img => {\n                mapping.mapping[m[0]][e] = img;\n              });\n            ps.push(p);\n          });\n        });\n        return Promise.all(ps).then(() => mapping);\n      } else {\n        return mapping;\n      }\n    });\n}\n\n\nexport default {\n  menuLink, body, updateBody, readFile\n};\n","\n/** @module component/dropdown */\n\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction dropdownFormGroup(selection, label) {\n  const id = misc.uuidv4().slice(0, 8);\n  selection.classed('mb-3', true)\n    .append('div')\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('justify-content-end', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-sm', true)\n      .classed('btn-outline-primary', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'collapse')\n      .attr('data-target', `#${id}-collapse`)\n      .attr('aria-expanded', 'false')\n      .attr('aria-controls', `${id}-collapse`)\n      .text(label);\n  selection.append('div')\n      .classed('collapse', true)\n      .attr('id', `${id}-collapse`)\n    .append('div')\n      .classed('card', true)\n      .classed('card-body', true);\n}\n\n\nexport default {\n  dropdownFormGroup\n};\n","\n/** @module dialog/fieldInput */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as scale} from '../common/scale.js';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as button} from '../component/button.js';\nimport {default as dropdown} from '../component/dropdown.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'fieldinput-dialog';\nconst title = 'Add custom field';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addcheckbox');\n}\n\n\nfunction body(selection) {\n  const mbody = selection.call(modal.submitDialog, id, title)\n      .select('.modal-body');\n\n  // Custom field name\n  mbody.append('div')\n      .classed('key', true)\n      .call(box.textBox, 'Field key')\n    .select('.form-control')\n      .attr('required', 'required');\n\n  // Field type\n  const options = [\n    {key: 'checkbox', name: 'Checkbox', format: 'checkbox'},\n    {key: 'text_field', name: 'Text field', format: 'text_field'},\n    {key: 'template', name: 'Template', format: 'html'}\n  ];\n  mbody.append('div')\n      .classed('type', true)\n      .call(lbox.selectBox, 'Type')\n      .call(lbox.updateSelectBoxOptions, options)\n      .on('change',  function () {\n        const type = box.formValue(d3.select(this));\n        const custom = type === 'template';\n        selection.selectAll('.tmpbuild .form-control')\n            .property('disabled', !custom);\n      });\n\n  // Template builder\n  const collapse = mbody.append('div')\n      .call(dropdown.dropdownFormGroup, 'Template builder')\n    .select('.card-body');\n\n  // Template field\n  collapse.append('div')\n      .classed('tmpfield', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Field')\n      .on('change', function () {\n        const rcd = lbox.selectedRecord(d3.select(this));\n        const notation = rcd.d3_format ? `:${rcd.d3_format}` : '';\n        selection.select('.notation')\n            .call(box.updateReadonlyValue, `{${rcd.key}${notation}}`);\n      });\n\n  // Notation\n  collapse.append('div')\n      .classed('notation', true)\n      .call(box.readonlyBox, 'Notation');\n\n  // Template input\n  collapse.append('div')\n      .classed('contents', true)\n      .call(box.textareaBox, 'Contents', 5);\n}\n\n\nfunction updateBody(selection, fields) {\n  selection.select('.key')\n      .call(box.updateFormValue, '')\n      .on('input', function() {\n        const value = box.formValue(d3.select(this));\n        const noDup = keyNoDup(d3.select(this), fields);\n        if (!noDup) box.setValidity(d3.select(this), false);\n        const invmsg = noDup ? 'Please provide valid field name'\n          : `Key '${value}' already exsists`;\n        d3.select(this).call(badge.updateInvalidMessage, invmsg);\n        const valid = dialogFormValid(selection, fields);\n        selection.select('.submit').property('disabled', !valid);\n      });\n  selection.select('.type')\n      .call(box.updateFormValue, 'checkbox')\n      .on('change', function () {\n        const valid = dialogFormValid(selection, fields);\n        selection.select('.submit').property('disabled', !valid);\n      });\n  const tmpFields = fields.filter(e => misc.sortType(e.format) !== 'none');\n  selection.select('.tmpfield')\n      .call(lbox.updateSelectBoxOptions, tmpFields)\n      .call(box.updateFormValue, 'index')\n      .dispatch('change');\n  selection.select('.contents')\n      .call(box.updateFormValue, '')\n      .on('input', function () {\n        const valid = dialogFormValid(selection, fields);\n        selection.select('.submit').property('disabled', !valid);\n      });\n  selection.select('.submit').property('disabled', true);\n}\n\n\nconst formatterGen = {\n  checkbox: () => (() => false),\n  text_field: () => (() => ''),\n  template: tmp => {\n    const parseInner = (rcd, n) => {\n      const arr = n.slice(1, -1).split(':');\n      if (arr.length === 1) {\n        return rcd[arr[0]];\n      } else {\n        return d3.format(arr[1])(rcd[arr[0]]);\n      }\n    };\n    const inner = tmp.match(/\\{.+?\\}/g) || [];\n    const outer = tmp.split(/\\{.+?\\}/g);\n    return rcd => {\n      const ic = inner.slice();\n      const oc = outer.slice();\n      const txtarr = [oc.shift()];\n      while (ic.length) {\n        txtarr.push(parseInner(rcd, ic.shift()));\n        txtarr.push(oc.shift());\n      }\n      return txtarr.join('').replace(/(?:\\r\\n|\\r|\\n)/g, '<br />');\n    };\n  }\n};\n\n\nfunction keyNoDup(selection, fields) {\n  const value = box.formValue(selection);\n  return !fields.map(e => e.key).includes(value);\n}\n\n\nfunction contentsValid(selection, tmpFields) {\n  const value = box.formValue(selection);\n  const valid = box.formValid(selection);\n  const outer = value.split(/\\{.+?\\}/g);\n  const inner = (value.match(/\\{.+?\\}/g) || []).map(e => e.slice(1, -1));\n  const validKey = inner.some(n => {\n    const ns = n.split(':');\n    if (!tmpFields.map(e => e.key).includes(ns[0])) return false;\n    if (ns.length > 2) return false;\n    if (ns.length === 1) return true;\n    return scale.isD3Format(ns[1]);\n  });\n  const validFormat = outer.concat(inner)\n    .every(n => !n.includes('{') && !n.includes('}'));\n  return valid && validKey && validFormat;\n}\n\nfunction dialogFormValid(selection, fields) {\n  const isTmp = box.formValue(selection.select('.type')) === 'template';\n  const keyv = box.formValid(selection.select('.key'));\n  const noDup = keyNoDup(selection.select('.key'), fields);\n  const tmpFields = fields.filter(e => misc.sortType(e.format) !== 'none');\n  const contv = contentsValid(selection.select('.contents'), tmpFields);\n  return keyv && noDup && (!isTmp || contv);\n}\n\n\nfunction value(selection) {\n  const key = box.formValue(selection.select('.key'));\n  const typeField = lbox.selectedRecord(selection.select('.type'));\n  const cont = box.formValue(selection.select('.contents'));\n  return {\n    field: {key: key, name: key, format: typeField.format},\n    converter: formatterGen[typeField.key](cont)\n  };\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module dialog/formGroup */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as button} from '../component/button.js';\nimport {default as dropdown} from '../component/dropdown.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\n\n\n/**\n * Render color range control box group\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction queryMolGroup(selection) {\n  // Query format\n  selection\n      .classed('mb-3', true);\n  selection.append('div')\n      .classed('format', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Format')\n      .call(lbox.updateSelectBoxOptions,\n            [\n              {key: 'molfile', name: 'MDL Molfile'},\n              {key: 'dbid', name: 'Compound ID'}\n            ])\n      .on('change', function () {\n        const value = box.formValue(d3.select(this));\n        selection.select('.source .form-control')\n            .property('disabled', value !== 'dbid');\n        selection.select('.textquery')\n            .property('hidden', value !== 'dbid');\n        selection.select('.areaquery')\n            .property('hidden', value !== 'molfile');\n      });\n\n  // Query ID source\n  selection.append('div')\n      .classed('source', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Source');\n\n  // Database ID query input\n  const queryBox = selection.append('div')\n      .classed('textquery', true)\n      .classed('mb-1', true)\n      .call(box.textBox, 'Query');\n  queryBox.select('.form-control')\n      .attr('required', 'required');\n  queryBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage, 'Please provide a valid query');\n\n  // CTAB format structure query input\n  const ctabBox = selection.append('div')\n      .classed('areaquery', true)\n      .classed('mb-1', true)\n      .attr('required', 'required')\n      .call(box.textareaBox, 'Query', 6, null);\n  ctabBox.select('.form-control')\n      .attr('required', 'required');\n  ctabBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage,\n            'Please provide a valid CTAB format text (.sdf or .mol)');\n\n  // Preview popover\n  $(function () {\n    $('[data-toggle=\"popover\"]')\n      .popover({html: true, trigger: 'focus'});\n  });\n  selection.append('div')\n      .classed('form-row', true)\n      .classed('justify-content-end', true)\n    .append('button')\n      .classed('preview', true)\n      .attr('data-toggle', 'popover')\n      .attr('data-html', 'true')\n      .attr('data-content', '<div id=\"previmg\"></div>')\n      .call(button.menuButton, 'Structure preview', 'primary')\n      .on('click', function () {\n        const query = queryMolValues(selection);\n        return fetcher.get('strprev', query)\n          .then(fetcher.text)\n          .then(res => d3.select('#previmg').html(res), fetcher.error);\n      });\n}\n\nfunction updateQueryMolResources(selection, resources) {\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  selection.select('.source')\n      .call(lbox.updateSelectBoxOptions, res);\n}\n\nfunction updateQueryMolValues(selection, values) {\n  selection.select('.format')\n      .call(box.updateFormValue, values.format)\n      .dispatch('change');\n  selection.select('.source')\n      .call(box.updateFormValue, values.source);\n  selection.select('.textquery')\n      .call(box.updateFormValue,\n            values.format === 'dbid' ? values.value : null);\n  selection.select('.areaquery')\n      .call(box.updateFormValue,\n            values.format === 'molfile' ? values.value : null);\n}\n\nfunction queryMolValues(selection) {\n  const format = box.formValue(selection.select('.format'));\n  const source = box.formValue(selection.select('.source'));\n  const textquery = box.formValue(selection.select('.textquery'));\n  const areaquery = box.textareaBoxLines(selection.select('.areaquery'));\n  return {\n    format: format,\n    source: format === 'dbid' ? source : null,\n    value: format === 'molfile' ? areaquery : textquery\n  };\n}\n\nfunction queryMolValid(selection) {\n  const format = box.formValue(selection.select('.format'));\n  const textValid = box.formValid(selection.select('.textquery'));\n  const ctabValid = box.textareaValid(selection.select('.areaquery'));\n  return format === 'molfile' ? ctabValid : textValid;\n}\n\n\nfunction simOptionGroup(selection) {\n  const collapse = selection.append('div')\n      .call(dropdown.dropdownFormGroup, 'Optional parameters')\n    .select('.card-body');\n\n  // Ignore H flag\n  collapse.append('div')\n      .classed('ignoreh', true)\n      .classed('mb-1', true)\n      .call(box.checkBox, 'Ignore explicit hydrogens');\n\n  // Timeout\n  const timeoutBox = collapse.append('div')\n      .classed('timeout', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Timeout')\n      .call(box.updateNumberRange, 1, 999, 1);\n  timeoutBox.select('.form-control')\n      .attr('required', 'required');\n  timeoutBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage,\n            'Please provide a valid number (1 to 999)');\n\n  // Diameter\n  const diamBox = collapse.append('div')\n      .classed('diam', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Diameter (MCS-DR/GLS)')\n      .call(box.updateNumberRange, 4, 999, 1);\n  diamBox.select('.form-control')\n      .attr('required', 'required');\n  diamBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage,\n            'Please provide a valid number (4 to 999)');\n\n  // Custom layout\n  collapse.selectAll('label.col-form-label')\n      .classed('col-4', false)\n      .classed('col-6', true);\n  collapse.selectAll('input.form-control')\n      .classed('col-8', false)\n      .classed('col-6', true);\n}\n\n\nfunction updateSimOptionValues(selection, values) {\n  selection.select('.ignoreh')\n      .call(box.updateCheckBox, values.ignoreHs);\n  if (values.hasOwnProperty('timeout')) {\n    selection.select('.timeout')\n        .call(box.updateFormValue, values.timeout);\n  }\n  if (values.hasOwnProperty('diameter')) {\n    selection.select('.diam')\n        .call(box.updateFormValue, values.diameter);\n  }\n}\n\n\nfunction simOptionValues(selection) {\n  const timeout = selection.select('.timeout');\n  const diam = selection.select('.diam');\n  const query = {\n    ignoreHs: box.checkBoxValue(selection.select('.ignoreh'))\n  };\n  if (!timeout.select('.form-control').property('disabled')) {\n    query.timeout = box.formValue(timeout);\n  }\n  if (!diam.select('.form-control').property('disabled')) {\n    query.diameter = box.formValue(diam);\n  }\n  return query;\n}\n\nfunction simOptionValid(selection) {\n  const timeoutValid = box.formValid(selection.select('.timeout'));\n  const diamValid = box.formValid(selection.select('.diam'));\n  return timeoutValid && diamValid;\n}\n\n\nexport default {\n  queryMolGroup, updateQueryMolResources, updateQueryMolValues,\n  queryMolValues, queryMolValid,\n  simOptionGroup, updateSimOptionValues, simOptionValues, simOptionValid\n};\n","\n/** @module dialog/networkgen */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as group} from './formGroup.js';\n\n\nconst id = 'networkgen-dialog';\nconst title = 'Generate similarity network';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-network');\n}\n\n\nfunction body(selection) {\n  const mbody = selection.call(modal.submitDialog, id, title)\n      .select('.modal-body');\n\n  // Similarity measure\n  mbody.append('div')\n      .classed('measure', true)\n      .call(lbox.selectBox, 'Measure')\n      .on('change', function () {\n        const value = box.formValue(d3.select(this));\n        selection.select('.diam input')\n            .property('disabled', value !== 'gls');\n        selection.select('.timeout input')\n            .property('disabled', !['gls', 'rdfmcs'].includes(value));\n      });\n\n  // Threshold\n  const thldBox = mbody.append('div')\n      .classed('thld', true)\n      .call(box.numberBox, 'Threshold')\n      .call(box.updateNumberRange, 0.01, 1, 0.01)\n      .on('input', function() {\n        const valid = dialogFormValid(selection);\n        selection.select('.submit').property('disabled', !valid);\n      });\n  thldBox.select('.form-control')\n      .attr('required', 'required');\n  thldBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage,\n            'Please provide a valid number (0.01 to 1.00)');\n\n  // Similarity search options\n  mbody.append('div')\n      .classed('option', true)\n      .call(group.simOptionGroup)\n      .on('input', function() {\n        const valid = dialogFormValid(selection);\n        selection.select('.submit').property('disabled', !valid);\n      });\n}\n\n\nfunction updateBody(selection, rdk) {\n  // Similarity measure\n  const measures = [\n    {key: 'gls', name: 'Graph-based local similarity(GLS)'}\n  ];\n  if (rdk) {\n    measures.push({key: 'rdmorgan', name: 'RDKit Morgan similarity'});\n    measures.push({key: 'rdfmcs', name: 'RDKit FMCS'});\n  }\n  selection.select('.measure')\n      .call(lbox.updateSelectBoxOptions, measures)\n      .call(box.updateFormValue, 'gls');\n  selection.select('.thld').call(box.updateFormValue, 0.5);\n  selection.select('.option')\n      .call(group.updateSimOptionValues,\n            {ignoreHs: true, timeout: 2, diameter: 8});\n}\n\n\nfunction dialogFormValid(selection) {\n  const thldValid = box.formValid(selection.select('.thld'));\n  const simOptionValid = group.simOptionValid(selection.select('.option'));\n  return thldValid && simOptionValid;\n}\n\n\nfunction execute(selection, rcds) {\n  const measure = selection.select('.measure');\n  const thld = selection.select('.thld');\n  const params = group.simOptionValues(selection.select('.option'));\n  if (!measure.select('select').property('disabled')) {\n    params.measure = box.formValue(measure);\n  }\n  if (!thld.select('input').property('disabled')) {\n    params.threshold = box.formValue(thld);\n  }\n  const formData = new FormData();\n  // TODO: need updates in flashflood query schema\n  formData.append('params', JSON.stringify(params));\n  formData.append('contents', new Blob([JSON.stringify(rcds)]));\n  return fetcher.post(`${params.measure}net`, formData)\n    .then(fetcher.json);\n}\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module dialog/rename */\n\nimport d3 from 'd3';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'rename-dialog';\nconst title = 'Rename';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-edittext');\n}\n\n\nfunction body(selection) {\n  const renameBox = selection.call(modal.submitDialog, id, title)\n    .select('.modal-body').append('div')\n      .classed('rename', true)\n      .call(box.textBox, 'New name');\n  renameBox.select('.form-control')\n      .attr('required', 'required');\n  renameBox.select('.invalid-feedback')\n      .call(badge.updateInvalidMessage, 'Please provide a valid name');\n}\n\n\nfunction updateBody(selection, name) {\n  selection.select('.rename')\n      .call(box.formValue, name)\n      .on('input', function () {\n        const valid = box.formValid(d3.select(this));\n        selection.select('.submit').property('disabled', !valid);\n      })\n      .dispatch('input');\n}\n\n\nfunction value(selection) {\n  return box.formValue(selection.select('.rename'));\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module datagridApp */\n\nimport d3 from 'd3';\n\nimport {default as client} from './common/client.js';\nimport {default as fetcher} from './common/fetcher.js';\nimport {default as hfile} from './common/file.js';\nimport {default as idb} from './common/idb.js';\nimport {default as misc} from './common/misc.js';\n\nimport {default as badge} from './component/badge.js';\nimport {default as button} from './component/button.js';\nimport {default as modal} from './component/modal.js';\n\nimport {default as fieldConfigDialog} from './dialog/fieldConfig.js';\nimport {default as fieldFetchDialog} from './dialog/fieldFetch.js';\nimport {default as fieldFileDialog} from './dialog/fieldFile.js';\nimport {default as fieldInputDialog} from './dialog/fieldInput.js';\nimport {default as networkgenDialog} from './dialog/networkgen.js';\nimport {default as renameDialog} from './dialog/rename.js';\n\nimport DatagridState from './datagrid/state.js';\nimport {default as rowf} from './datagrid/rowFilter.js';\nimport {default as sort} from './datagrid/sort.js';\nimport {default as dg} from './datagrid/component.js';\n\n\nfunction app(view, coll) {\n  const menubar = d3.select('#menubar')\n      .classed('my-1', true);\n  menubar.selectAll('div,span,a').remove();  // Clean up\n  const dialogs = d3.select('#dialogs');\n  dialogs.selectAll('div').remove();  // Clean up\n\n  const state = new DatagridState(view, coll);\n\n  // Datagrid view control\n  const menu = menubar.append('div')\n      .call(button.dropdownMenuButton, 'Menu', 'primary', 'table-white')\n      .select('.dropdown-menu');\n  menu.append('a').call(fieldConfigDialog.menuLink);\n  menu.append('a')\n      .classed('online-command', true)\n      .call(fieldFetchDialog.menuLink);\n  menu.append('a').call(fieldFileDialog.menuLink);\n  menu.append('a').call(fieldInputDialog.menuLink);\n  menu.append('a')\n      .call(button.dropdownMenuItem, 'Generate tile view', 'menu-tiles')\n      .on('click', function () {\n        d3.select('#menubar .loading-circle').style('display', 'inline-block');\n        const viewID = misc.uuidv4().slice(0, 8);\n        return idb.appendView(state.storeID, state.viewID, {\n          $schema: \"https://mojaie.github.io/kiwiii/specs/tile_v1.0.json\",\n          viewID: viewID,\n          name: `${state.name}_tiles`,\n          viewType: 'tile',\n          items: state.rows.collectionID,\n          rowCount: 5,\n          columnCount: 5,\n          tileContent: {field: 'structure', visible: true}\n        }).then(() => {\n          d3.select('#menubar .loading-circle').style('display', 'none');\n          window.open(\n            `tile.html?store=${state.storeID}&view=${viewID}`, '_blank');\n        });\n      });\n  menu.append('a')\n      .classed('online-command', true)\n      .call(networkgenDialog.menuLink);\n  menu.append('a').call(renameDialog.menuLink);\n  menu.append('a')\n      .call(button.dropdownMenuItem, 'Save', 'menu-save')\n      .on('click', function () {\n        return state.save()\n          .then(() => menubar.select('.notify-saved').call(badge.notify));\n      });\n  menu.append('a')\n      .classed('online-command', true)\n      .call(button.dropdownMenuItem, 'Download Excel', 'menu-exportexcel')\n      .on('click', () => {\n        d3.select('#menubar .loading-circle').style('display', 'inline-block');\n        const coll = state.rows.export();\n        const formData = new FormData();\n        formData.append('contents', new Blob([JSON.stringify(coll)]));\n        return fetcher.post('xlsx', formData)\n          .then(fetcher.blob)\n          .then(blob => {\n            d3.select('#menubar .loading-circle').style('display', 'none');\n            hfile.downloadDataFile(blob, `${state.name}.xlsx`);\n          });\n      });\n\n  // Dashboard link\n  menubar.append('a')\n      .call(button.menuButtonLink, 'Dashboard',\n            'outline-secondary', 'status-gray')\n      .attr('href', 'dashboard.html')\n      .attr('target', '_blank');\n\n  // Fetch control\n  menubar.append('a')\n      .classed('refresh', true)\n      .call(button.menuButtonLink,\n            'Refresh', 'outline-secondary', 'refresh-gray')\n      .on('click', function () {\n        d3.select('#menubar .loading-circle').style('display', 'inline-block');\n        return state.rows.pull().then(() => {\n          state.updateContentsNotifier();\n          return updateApp(state);\n        });\n      });\n  menubar.append('a')\n      .classed('abort', true)\n      .call(button.menuButtonLink,\n            'Abort server job', 'warning', 'delete-gray')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', '#abort-dialog');\n\n  // Status\n  menubar.append('span')\n      .classed('loading-circle', true)\n      .call(badge.loadingCircle);\n  menubar.append('span')\n      .classed('notify-saved', true)\n      .call(badge.alert)\n      .call(badge.updateAlert, 'State saved', 'success', 'check-green')\n      .style('display', 'none');\n  menubar.append('span')\n      .classed('name', true);\n  menubar.append('span')\n      .classed('rows-count', true)\n      .call(badge.badge);\n  menubar.append('span')\n      .classed('fetch-status', true)\n      .call(badge.badge);\n  menubar.append('span')\n      .classed('exec-time', true)\n      .call(badge.badge);\n\n  // Dialogs\n  dialogs.append('div')\n      .classed('fieldconfd', true)\n      .call(fieldConfigDialog.body);\n  dialogs.append('div')\n      .classed('fieldfetchd', true)\n      .call(fieldFetchDialog.body);\n  dialogs.append('div')\n      .classed('fieldfiled', true)\n      .call(fieldFileDialog.body);\n  dialogs.append('div')\n      .classed('fieldinputd', true)\n      .call(fieldInputDialog.body);\n  dialogs.append('div')\n      .classed('netgend', true)\n      .call(networkgenDialog.body);\n  dialogs.append('div')\n      .classed('renamed', true)\n      .call(renameDialog.body);\n  dialogs.append('div')\n      .classed('abortd', true)\n      .call(modal.confirmDialog, 'abort-dialog');\n\n  // Contents\n  d3.select('#dg-search')\n      .call(rowf.setFilter, state);\n  d3.select('#datagrid')\n      .call(sort.setSort, state)\n      .call(dg.datagrid, state);\n\n  // Resize window\n  window.onresize = () => {\n    d3.select('#datagrid').call(dg.resize, state)\n      .call(dg.updateViewport, state, state.viewportTop);\n  };\n\n  state.updateContentsNotifier();\n  return updateApp(state);\n}\n\n\nfunction updateApp(state) {\n  // Title\n  d3.select('title').text(state.name);\n\n  // hide fetch commands\n  d3.select('#menubar').selectAll('.refresh, .abort')\n    .style('display', state.rows.ongoing() ? null : 'none');\n\n  // Status\n  d3.select('#menubar .name').text(state.name);\n\n  const onLoading = d3.select('#menubar .loading-circle');\n  const colors = {\n    done: 'green', running: 'darkorange',\n    ready: 'cornflowerblue', queued: 'cornflowerblue',\n    interrupted: 'salmon', aborted: 'salmon', failure: 'salmon'\n  };\n  const icons = {\n    done: 'check-green', running: 'running-darkorange',\n    ready: 'clock-cornflowerblue', queued: 'clock-cornflowerblue',\n    interrupted: 'caution-salmon', aborted: 'caution-salmon',\n    failure: 'caution-salmon'\n  };\n  const fstatus = state.rows.status();\n  const fstext = fstatus === 'done' ?\n    fstatus : `${fstatus} ${state.rows.progress()}%`;\n  d3.select('#menubar .rows-count')\n      .call(badge.updateBadge, `${state.rows.size()} rows`,\n            'light', 'table-gray')\n    .select('.text')\n      .style('color', 'gray');\n  d3.select('#menubar .fetch-status')\n      .call(badge.updateBadge, fstext, 'light', icons[fstatus])\n    .select('.text')\n      .style('color', colors[fstatus]);\n  d3.select('#menubar .exec-time')\n      .call(badge.updateBadge, `${state.rows.execTime()} seconds`,\n            'light', 'clock-cornflowerblue')\n    .select('.text')\n      .style('color', 'cornflowerblue');\n\n\n  // Dialogs\n  const dialogs = d3.select('#dialogs');\n\n  // Field config dialog\n  dialogs.select('.fieldconfd')\n      .call(fieldConfigDialog.updateBody, state.rows.fields)\n      .on('submit', function () {\n        const values = fieldConfigDialog.value(d3.select(this));\n        state.updateFields(values);\n        state.updateContentsNotifier();\n        return updateApp(state);\n      });\n\n  // Import fields dialog\n  dialogs.select('.fieldfiled')\n      .call(fieldFileDialog.updateBody, state.visibleFields)\n      .on('submit', function () {\n        return fieldFileDialog.readFile(d3.select(this))\n          .then(data => {\n            state.joinFields(data);\n            state.updateContentsNotifier();\n            return updateApp(state);\n          });\n      });\n\n  // Input field dialog\n  dialogs.select('.fieldinputd')\n      .call(fieldInputDialog.updateBody, state.rows.fields)\n      .on('submit', function () {\n        const values = fieldInputDialog.value(d3.select(this));\n        state.rows.addField(values.field);\n        state.rows.apply(rcd => {\n          rcd[values.field.key] = values.converter(rcd);\n        });\n        state.updateContentsNotifier();\n        return updateApp(state);\n      });\n  // Rename dialog\n  dialogs.select('.renamed')\n      .call(renameDialog.updateBody, state.name)\n      .on('submit', function () {\n        state.name = renameDialog.value(d3.select(this));\n        return updateApp(state);\n  });\n\n\n  // Server bound tasks\n  return fetcher.serverStatus().then(response => {\n    // Fetch db fields dialog\n    dialogs.select('.fieldfetchd')\n        .call(fieldFetchDialog.updateBody, response.schema, state.rows.fields)\n        .on('submit', function () {\n          const compounds = state.rows.records().map(e => e.compound_id);\n          return fieldFetchDialog\n            .execute(d3.select(this), compounds, response.schema)\n            .then(res => {\n              state.joinFields(res);\n              state.updateContentsNotifier();\n              return updateApp(state);\n            });\n        });\n\n    // Network generation dialog\n    dialogs.select('.netgend')\n        .call(networkgenDialog.updateBody, response.server.rdkit)\n        .on('submit', function () {\n          return networkgenDialog\n            .execute(d3.select(this), state.rows.records())\n            .then(data => {\n              return idb.newNetwork(\n                state.storeID, state.rows.collectionID, state.name, data\n              );\n            })\n            .then(viewID => {\n              onLoading.style('display', 'none');\n              window.open(\n                `network.html?store=${state.storeID}&view=${viewID}`, '_blank');\n            });\n        });\n\n    // Abort dialog\n    dialogs.select('.abortd')\n        .call(modal.updateConfirmDialog,\n              'Are you sure you want to abort this calculation job?')\n        .on('submit', function () {\n          return state.rows.abort().then(() => {\n            state.updateContentsNotifier();\n            return updateApp(state);\n          });\n        });\n  })\n  .catch(() => {\n    // disable on-line commands\n    d3.select('#menubar').selectAll('.online-command')\n      .attr('data-target', null)\n      .classed('disabled', true)\n      .on('click', null);\n  })\n  .finally(() => {\n    // disable commands when no records are found\n    if (!state.rows.size()) {\n      d3.select('#menubar').selectAll('.online-command')\n        .attr('data-target', null)\n        .classed('disabled', true)\n        .on('click', null);\n    }\n    onLoading.style('display', 'none');\n  });\n}\n\nfunction run() {\n  const err = client.compatibility();\n  if (err) {\n    d3.select('body')\n      .style('color', '#ff0000')\n      .text(err);\n    return;\n  }\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";  // TODO\n  const offLine = 'onLine' in navigator && !navigator.onLine;  // TODO\n  client.registerServiceWorker();\n  const storeID = client.URLQuery().store || null;\n  const viewID = client.URLQuery().view || null;\n  return idb.getView(storeID, viewID)\n    .then(view => {\n      if (!view) throw('ERROR: invalid URL');\n      view.storeID = storeID;\n      return idb.getCollection(storeID, view.rows)\n        .then(coll => app(view, coll));\n    })\n    .catch(err => {\n      console.error(err);\n      d3.select('#datagrid')\n        .style('color', 'red')\n        .text(err);\n    });\n}\n\n\nexport default {\n  run\n};\n"],"names":["URLQuery","pairs","window","location","search","substring","split","map","e","_","fromPairs","compatibility","registerServiceWorker","navigator","isDebugBuild","console","info","addEventListener","serviceWorker","register","registerCtrlCommand","key","callback","document","event","ctrlKey","baseURL","get","url","query","q","Object","keys","length","JSON","stringify","fetch","credentials","then","res","status","Promise","reject","Error","statusText","resolve","json","response","text","blob","post","formdata","method","body","error","err","serverStatus","server","schema","readFile","file","sizeLimit","reader","FileReader","truncated","slice","onload","target","result","onerror","readAsArrayBuffer","readAsText","parseJSON","data","compressed","pako","inflate","to","parse","downloadDataFile","name","URL","createObjectURL","Blob","a","createElement","download","href","dispatchEvent","MouseEvent","view","bubbles","cancelable","loadJSON","endsWith","fetchJSON","decoded","decodeURIComponent","arrayBuffer","downloadJSON","compress","str","gzip","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","d3","format","partialMatch","toString","toUpperCase","indexOf","uuidv4","replace","c","r","Math","random","statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","fields","columns","sort","id","dataType","schemaVersion","revision","records","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v10_nodes","reference","convertNetwork","edges","hasOwnProperty","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","column","domain","range","unknown","size","visible","nodeContent","structure","label","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","forEach","i","index","_structure","_index","source","v08_graph","nodeContentVisible","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","$schema","convertPackage","specs","now","Date","isNW","v08_nodes","width","height","convertTable","views","dataset","push","collectionID","contents","workflowID","workflow","viewID","viewType","rows","sortOrder","filterText","checkpoints","type","date","description","networkThresholdCutoff","filter","minConnThld","currentConnThld","edgeColor","color","edgeLabelColor","items","idb","Dexie","getAllItems","orderBy","reverse","toArray","updateItem","storeID","updateFunc","where","equals","modify","catch","version","stores","reset","delete","getItem","first","deleteItem","getView","appendView","viewObj","item","pos","findIndex","splice","updateView","isFunction","deleteView","bin","entries","entry","getAllCollections","flatten","coll","getCollection","collID","colls","updateCollection","collObj","importItem","legacy","misc","sessionStarted","put","newDatagrid","toLocaleString","timeZone","newNetwork","nodesName","edgesID","assetBaseURL","iconBaseURL","badge","selection","classed","append","style","updateBadge","icon","select","attr","notify","transition","duration","ease","easeLinear","delay","on","loadingCircle","alert","updateAlert","invalidFeedback","updateInvalidMessage","msg","buttonBox","menuButton","menuButtonLink","menuModalLink","dropdownMenuButton","button","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","this","node","click","dropdownMenuFileValue","files","dialogBase","confirmDialog","base","call","footer","dispatch","updateConfirmDialog","message","submitDialog","title","header","html","$","modal","colorScales","colors","schemePaired","concat","schemeSet2","schemePastel2","schemeSet3","types","func","scaleLinear","scaleLog","scaleQuantize","scaleOrdinal","scaleFunction","state","cscale","mid","scaleFunc","clamp","d","undefined","isD3Format","notation","singleToMulti","mapping","newMapping","m","mappingToTable","mp","rcd","f","tableToMapping","table","ignore","row","csvToMapping","csvString","lines","shift","headerIdx","h","line","values","k","Array","apply","fd","uniqBy","Collection","[object Object]","autoIndex","content","addField","fs","mapper","command","fetcher","all","sum","some","min","updateHeader","selectAll","remove","visibleFields","enter","headerCellRenderer","updateRows","recordsToShow","keyFunc","exit","merge","rowHeight","each","rowIndex","viewportTop","rowPos","rowFactory","updateViewport","scrollPos","bodyHeight","setScrollPosition","scrollTop","resize","viewport","getBoundingClientRect","top","resizeViewport","innerHeight","viewportHeight","datagrid","floor","previousViewportTop","updateContentsNotifier","applyHeader","applyData","updateFilterNotifier","setFilterText","plotCell","record","vega","View","initialize","run","plotThumbnail","vegaSpec","toImageURL","binaryToDataURI","binary","readAsDataURL","d3Format","d3_format","compound_id","image","checkbox","property","disabled","checked","textField","cellFunc","numeric","raw","assay_id","list","plot","img","text_field","control","svg","rowCell","cell","DatagridState","sortedRecords","filteredRecords","defaultColumnHeight","none","scrollBarSpace","numViewportRows","viewportBottom","fixedViewportHeight","component","factory","position","ceil","setViewportSize","setNumViewportRows","widthfSum","reduce","widthf","assign","b","applyOrder","order","orders","applyFilter","ki","obj","updateFields","joinFields","ci","export","vi","formValue","formValid","checkValidity","setValidity","valid","textareaValid","test","fileInputBox","fileInputValid","updateFormValue","textBox","readonlyBox","updateReadonlyValue","readonlyValue","textareaBox","placeholder","textareaBoxLines","numberBox","updateNumberRange","max","step","checkBox","box","updateCheckBox","checkBoxValue","colorBox","stopPropagation","clearFileInput","fileInputValue","setFilter","searchBox","setSort","isAsc","setSortOrder","datum","filterTable","rowf","filterSortTable","update","updateRecords","tableRecords","extra","options","menuLink","dialog","updateBody","dgfields","d3fValid","every","n","assays","resources","flatMap","assay","value_types","copy","value_type","done","__origin","check","check_d","anyChecked","execute","compounds","targets","queries","condition","merged","monocolorBar","group","colorBar","monocolor","bicolor","grad","tricolor","categorical","sw","custom","setSize","checklistValues","setChecklistValidity","setSelectedColorScale","selected","shape","selectBox","updateSelectBoxOptions","selectedRecord","checklistBox","updateChecklistItems","listitems","form","checkRequired","updateChecklistValues","colorScaleBox","dropdown","colorScaleBoxItems","updateColorScaleBox","colorScaleBoxValue","colorScaleBoxItem","mbody","hfile","pop","tbl","lbox","leftFields","leftDefault","left","fileInputBoxValue","isCsv","plotCols","ps","p","himg","dropdownFormGroup","formatterGen","template","tmp","parseInner","arr","inner","match","outer","ic","oc","txtarr","join","keyNoDup","dialogFormValid","isTmp","keyv","noDup","tmpFields","contv","validKey","ns","validFormat","contentsValid","collapse","invmsg","typeField","cont","converter","queryMolValues","textquery","areaquery","queryMolGroup","queryBox","ctabBox","popover","trigger","updateQueryMolResources","updateQueryMolValues","queryMolValid","textValid","ctabValid","simOptionGroup","timeoutBox","diamBox","updateSimOptionValues","ignoreHs","timeout","diameter","simOptionValues","diam","simOptionValid","timeoutValid","diamValid","thldValid","thldBox","rdk","measures","rcds","measure","thld","formData","FormData","renameBox","updateApp","ongoing","onLoading","fstatus","fstext","running","ready","queued","interrupted","aborted","failure","dialogs","fieldConfigDialog","fieldFileDialog","fieldInputDialog","renameDialog","fieldFetchDialog","networkgenDialog","rdkit","open","abort","finally","client","protocol","onLine","store","menubar","menu","rowCount","columnCount","tileContent","save","pull","dg","onresize","app"],"mappings":"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"}