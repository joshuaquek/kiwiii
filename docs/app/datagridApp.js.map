{"version":3,"file":"datagridApp.js","sources":["../../src/common/client.js","../../src/common/fetcher.js","../../src/common/file.js","../../src/common/misc.js","../../src/common/legacySchema.js","../../src/common/idb.js","../../src/component/badge.js","../../src/component/button.js","../../src/component/modal.js","../../src/common/scale.js","../../src/common/mapper.js","../../src/common/collection.js","../../src/datagrid/component.js","../../src/common/image.js","../../src/datagrid/rowFactory.js","../../src/datagrid/state.js","../../src/component/formBox.js","../../src/datagrid/rowFilter.js","../../src/datagrid/sort.js","../../src/datagrid/table.js","../../src/dialog/fieldConfig.js","../../src/dialog/fieldFetch.js","../../src/component/shape.js","../../src/component/formListBox.js","../../src/dialog/fieldFile.js","../../src/dialog/fieldInput.js","../../src/dialog/formGroup.js","../../src/dialog/networkgen.js","../../src/dialog/rename.js","../../src/datagridApp.js"],"sourcesContent":["\n/** @module common/client */\n\nimport _ from 'lodash';\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\nfunction compatibility() {\n  try {\n    () => {};\n  } catch (err) {\n    return 'Client compatibility error: Arrow function not supported';\n  }\n  try {\n    FormData;\n  } catch (err) {\n    return 'Client compatibility error: FormData not supported';\n  }\n  try {\n    fetch;\n  } catch (err) {\n    return 'Client compatibility error: fetch API not supported';\n  }\n}\n\n\nfunction registerServiceWorker() {\n  if ('serviceWorker' in navigator) {\n    if (!debug) {\n      window.addEventListener('load', () => {\n        navigator.serviceWorker.register('../sw.js');  // TODO: root path option\n      });\n    } else {\n      console.info('Service worker is disabled for debugging');\n    }\n  } else {\n    console.info('Service worker is not supported');\n  }\n}\n\nexport default {\n  URLQuery, compatibility, registerServiceWorker\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '../req/';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\nfunction serverStatus() {\n  const response = {};\n  return get('server')\n    .then(json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => get('schema'))\n    .then(json)\n    .then(res => {\n      response.schema = res;\n    })\n    .then(() => response);\n}\n\n\nexport default {\n  get, json, text, blob, post, error, serverStatus\n};\n","\n/** @module common/file */\n\nimport pako from 'pako';\n\n\nfunction readFile(file, sizeLimit, blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    const truncated = sizeLimit ? file.slice(0, sizeLimit) : file;\n    reader.onload = event => resolve(event.target.result);\n    reader.onerror = error => reject(error);\n    if (blob) {\n      reader.readAsArrayBuffer(truncated);\n    } else {\n      reader.readAsText(truncated);\n    }\n  });\n}\n\n\nfunction parseJSON(data, compressed) {\n  const text = compressed ? pako.inflate(data, {to: 'string'}) : data;\n  return JSON.parse(text);\n}\n\n\nfunction loadJSON(file) {\n  const compressed = file.name.endsWith('c') || file.name.endsWith('.gz');\n  return readFile(file, false, compressed)\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction fetchJSON(url) {\n  const decoded = decodeURIComponent(url);\n  const compressed = decoded.endsWith('c') || decoded.endsWith('.gz');\n  return fetch(decoded)\n    .then(res => compressed ? res.arrayBuffer() : res.json())\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction downloadDataFile(data, name) {\n  try {\n    // cannot hundle large file with dataURI scheme\n    // url = 'data:application/json,' + encodeURIComponent(JSON.stringify(json))\n    const url = window.URL.createObjectURL(new Blob([data]));\n    const a = document.createElement('a');\n    a.download = name;\n    a.href = url;\n    // a.click() does not work on firefox\n    a.dispatchEvent(new MouseEvent('click', {\n      'view': window,\n      'bubbles': true,\n      'cancelable': false\n    }));\n    // window.URL.revokeObjectURL(url) does not work on firefox\n  } catch (e) {\n    // no DOM (unit testing)\n  }\n}\n\n\nfunction downloadJSON(json, name, compress=true) {\n  const str = JSON.stringify(json);\n  const data = compress ? pako.gzip(str) : str;\n  const ext = `.ap${compress ? 'c' : 'r'}`;\n  downloadDataFile(data, `${name}${ext}`);\n}\n\n\nexport default {\n  readFile, parseJSON, loadJSON, fetchJSON,\n  downloadDataFile, downloadJSON\n};\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\n\n\n// TODO: re-define\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  if (['text_field', 'checkbox', 'html'].includes(fmt)) return 'html';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  sortType, formatNum, partialMatch, uuidv4\n};\n","\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: [\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ],\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nfunction convertPackage(json) {\n  let specs = {};\n  if (!json.hasOwnProperty('views')) {\n    const now = new Date();\n    const isNW = json.hasOwnProperty('edges');\n    const data = isNW ? convertNetwork(json) : convertTable(json);\n    const nodes = isNW ? data.nodes : data;\n    specs = {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n      name: data.edges.name,\n      views: [],\n      dataset: []\n    };\n    specs.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: nodes.id,\n      name: nodes.name,\n      contents: [{\n        $schema: nodes.$schema,\n        workflowID: nodes.reference.workflow,\n        name: nodes.name,\n        fields: nodes.fields,\n        records: nodes.records,\n        created: nodes.created,\n        status: nodes.status,\n        query: nodes.query,\n        execTime: nodes.execTime,\n        progress: nodes.progress\n      }]\n    });\n    specs.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: nodes.id,\n      name: nodes.name,\n      viewType: \"datagrid\",\n      rows: nodes.id,\n      fields: nodes.fields,\n      sortOrder: null,\n      filterText: null,\n      checkpoints: [{\n        type: 'convert',\n        date: now.toString(),\n        description: 'converted from legacy format'\n      }]\n    });\n    if (isNW) {\n      specs.dataset.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: data.edges.id,\n        name: data.edges.name,\n        contents: [{\n          $schema: data.edges.$schema,\n          workflowID: data.edges.reference.workflow,\n          name: data.edges.name,\n          fields: data.edges.fields,\n          records: data.edges.records,\n          created: data.edges.created,\n          status: data.edges.status,\n          query: data.edges.query,\n          execTime: data.edges.execTime,\n          progress: data.edges.progress\n        }]\n      });\n      specs.views.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n        viewID: data.edges.id,\n        name: data.edges.name,\n        viewType: \"network\",\n        nodes: nodes.id,\n        edges: data.edges.id,\n        nodeColor: data.edges.snapshot.nodeColor,\n        nodeSize: data.edges.snapshot.nodeSize,\n        nodeLabel: data.edges.snapshot.nodeLabel,\n        nodeLabelColor: data.edges.snapshot.nodeLabelColor,\n        edgeWidth: data.edges.snapshot.edgeWidth,\n        edgeLabel: data.edges.snapshot.edgeLabel,\n        networkThreshold: data.edges.snapshot.networkThreshold,\n        networkThresholdCutoff: data.edges.snapshot.networkThresholdCutoff,\n        fieldTransform: data.edges.snapshot.fieldTransform,\n        coords: data.edges.snapshot.coords,\n        checkpoints: [{\n          type: 'convert',\n          date: now.toString(),\n          description: 'converted from legacy format'\n        }]\n      });\n    }\n    specs.views.filter(e => e.viewType === 'network')\n      .forEach(view => {\n        view.minConnThld = view.networkThresholdCutoff;\n        view.currentConnThld = view.networkThreshold;\n        if (view.hasOwnProperty('nodeLabel')) {\n          view.nodeLabel.field = view.nodeLabel.text;\n        }\n        if (view.hasOwnProperty('edgeLabel')) {\n          view.edgeLabel.field = 'weight';\n        }\n        if (view.hasOwnProperty('edgeWidth')) {\n          view.edgeWidth.field = 'weight';\n        }\n      });\n  } else {\n    specs = json;\n  }\n  specs.views.filter(e => e.viewType === 'network')\n    .forEach(view => {\n      if (!view.nodeColor.field) { view.nodeColor.field = 'index' ;}\n      if (!view.nodeSize.field) { view.nodeSize.field = 'index' ;}\n      if (!view.nodeLabel.field) { view.nodeLabel.field = 'index' ;}\n      if (!view.nodeLabelColor.field) { view.nodeLabelColor.field = 'index' ;}\n      if (!view.edgeColor) {\n        view.edgeColor = {\n          field: 'weight', color: 'monogray',\n          scale: 'linear', domain: [0, 1],\n          range: ['#999999', '#999999'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeColor.field) { view.edgeColor.field = 'weight' ;}\n      if (!view.edgeWidth.field) { view.edgeWidth.field = 'weight' ;}\n      if (!view.edgeLabel.field) { view.edgeLabel.field = 'weight' ;}\n      if (!view.edgeLabelColor) {\n        view.edgeLabelColor = {\n          field: 'weight', color: 'monoblack',\n          scale: 'linear', domain: [1, 1],\n          range: ['#333333', '#333333'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeLabelColor.field) { view.edgeLabelColor.field = 'weight' ;}\n    });\n  return specs;\n}\n\n\nexport default {\n  convertPackage\n};\n","\n/** @module common/idb */\n\nimport _ from 'lodash';\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\nimport {default as legacy} from './legacySchema.js';\n\n// TODO: need package, view and dataset tables?\nconst schema = {\n  items: 'storeID, sessionStarted'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('sessionStarted')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Returns a view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @return {array} view objects\n */\nfunction getView(storeID, viewID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).views)\n    .then(views => {\n      const view = views.find(e => e.viewID === viewID);\n      if (!view) return;\n      view.storeID = storeID;\n      return view;\n    });\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object\n */\nfunction appendView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos + 1, 0, viewObj);\n  });\n}\n\n\n/**\n * Update view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object or update function\n */\nfunction updateView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    if (_.isFunction(viewObj)) {\n      viewObj(item.views[pos]);\n    } else {\n      item.views[pos] = viewObj;\n    }\n  });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteView(storeID, viewID) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos, 1);\n    // prune orphaned collections\n    const bin = {};\n    item.dataset.forEach(e => { bin[e.collectionID] = 0; });\n    item.views.forEach(view => {\n      ['rows', 'items', 'nodes', 'edges']\n        .filter(e => view.hasOwnProperty(e))\n        .forEach(e => { bin[view[e]] += 1; });\n    });\n    Object.entries(bin).forEach(entry => {\n      if (!entry[1]) {\n        const i = item.dataset.findIndex(e => e.collectionID === entry[0]);\n        item.dataset.splice(i, 1);\n      }\n    });\n  });\n}\n\n\n/**\n * Returns all collections in the store\n * @return {array} Collection objects\n */\nfunction getAllCollections() {\n  return getAllItems()\n    .then(items => _.flatten(\n      items.map(item => {\n        return item.dataset.map(coll => {\n          coll.storeID = item.storeID;\n          return coll;\n        });\n      })\n    ));\n}\n\n\n/**\n * Returns a collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @return {array} Collection objects\n */\nfunction getCollection(storeID, collID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).dataset)\n    .then(colls => {\n      const coll = colls.find(e => e.collectionID === collID);\n      if (!coll) return;\n      coll.storeID = storeID;\n      return coll;\n    });\n}\n\n\n/**\n * Update collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object or update function\n */\nfunction updateCollection(storeID, collID, collObj) {\n  return updateItem(storeID, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    if (_.isFunction(collObj)) {\n      collObj(item.dataset[pos]);\n    } else {\n      item.dataset[pos] = collObj;\n    }\n  });\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction importItem(data) {\n  // Legacy format converter\n  data = legacy.convertPackage(data);\n\n  const now = new Date();\n  data.storeID = misc.uuidv4().slice(0, 8);\n  data.sessionStarted = now.toString();\n  return idb.items.put(data);\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} response - response data\n * @return {string} - viewID if sucessfully added\n */\nfunction newDatagrid(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const storeID = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    storeID: storeID,\n    name: response.name,\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n        viewID: viewID,\n        name: response.name,\n        viewType: \"datagrid\",\n        rows: collectionID,\n        checkpoints: [\n          {type: 'creation', date: date}\n        ]\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        name: response.name,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return idb.items.put(data)\n    .then(() => ({storeID: storeID, viewID:viewID}));\n}\n\n\n/**\n * Store new network view\n * @param {string} storeID - Store ID\n * @param {string} nodesID - ID of nodes collection\n * @param {string} nodesName - Name of nodes collection\n * @param {object} response - Response object\n */\nfunction newNetwork(storeID, nodesID, nodesName, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const edgesID = response.workflowID.slice(0, 8);\n  return updateItem(storeID, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: viewID,\n      name: `${nodesName}_${response.name}`,\n      viewType: 'network',\n      nodes: nodesID,\n      edges: edgesID,\n      minConnThld: response.query.params.threshold\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: edgesID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\nexport default {\n  reset, getAllItems, getItem, updateItem, deleteItem,\n  getView, appendView, updateView, deleteView,\n  getAllCollections, getCollection, updateCollection,\n  importItem, newDatagrid, newNetwork\n};\n","\n/** @module component/badge */\n\nimport d3 from 'd3';\n\nconst assetBaseURL = '../assets/';\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction icon(selection, icon) {\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1rem')\n      .style('height', '1rem');\n}\n\n\nfunction badge(selection) {\n  const body = selection\n      .classed('badge', true);\n  body.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  body.append('span')\n      .classed('text', true);\n}\n\n\nfunction updateBadge(selection, text, type, icon) {\n  selection.classed(`badge-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nfunction notify(selection) {\n  selection\n    .style('opacity', 0)\n    .style('display', 'inline')\n    .transition()\n      .duration(500)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 1.0)\n    .transition()\n      .delay(3000)\n      .duration(1000)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 0)\n      .on('end', function () {\n        selection.style('display', 'none');\n      });\n}\n\n\nfunction loadingCircle(selection) {\n  selection.append('img')\n      .attr('src', `${assetBaseURL}loading1.gif`)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.style('display', 'none');\n}\n\n\nfunction alert(selection) {\n  const body = selection\n      .classed('alert', true)\n      .classed('px-1', true)\n      .classed('py-0', true);\n  body.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  body.append('span')\n      .classed('text', true)\n      .style('font-size', '75%');\n}\n\n\nfunction updateAlert(selection, text, type, icon) {\n  selection.classed(`alert-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nexport default {\n  icon, badge, updateBadge, notify, loadingCircle,\n  alert, updateAlert\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction buttonBox(selection, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .text(label);\n}\n\n\nfunction menuButton(selection, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, target, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('label', true)\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, label, type, icon) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  const button = selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  button.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  button.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, label, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, label, target, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, label, accept, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      });\n  selection.append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  iconBaseURL, buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module component/modal */\n\nimport d3 from 'd3';\n\n\nfunction dialogBase(selection, id) {\n  selection\n      .classed('modal', true)\n      .attr('tabindex', -1)\n      .attr('role', 'dialog')\n      .attr('aria-labelledby', '')\n      .attr('aria-hidden', true)\n      .attr('id', id);\n  selection.append('div')\n      .classed('modal-dialog', true)\n      .attr('role', 'document')\n    .append('div')\n      .classed('modal-content', true);\n}\n\n\nfunction confirmDialog(selection, id) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // body\n  base.append('div')\n      .classed('modal-body', true)\n    .append('div')\n      .classed('message', true);\n  // footer\n  const footer = base.append('div')\n      .classed('modal-footer', true);\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-outline-secondary', true)\n      .classed('cancel', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Cancel');\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-warning', true)\n      .classed('ok', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('OK')\n      .on('click', () => {\n        selection.dispatch('submit');\n      });\n}\n\n\nfunction updateConfirmDialog(selection, message) {\n  selection.select('.message').text(message);\n}\n\n\nfunction submitDialog(selection, id, title) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // header\n  const header = base.append('div')\n      .classed('modal-header', true);\n  header.append('h4')\n      .classed('modal-title', true)\n      .text(title);\n  header.append('button')\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('aria-label', 'Close')\n      .classed('close', true)\n    .append('span')\n      .attr('aria-hidden', true)\n      .html('&times;');\n  // body\n  base.append('div')\n      .classed('modal-body', true);\n  // footer\n  base.append('div')\n      .classed('modal-footer', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-primary', true)\n      .classed('submit', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Submit')\n      .on('click', () => {\n        // Dismiss before submit\n        // Submit event can update the modal itself\n        // (ex. disable submit button before onSubmit call has completed)\n        $(`#${id}`).modal('hide');\n        selection.dispatch('submit');\n      });\n}\n\n\nexport default {\n  confirmDialog, updateConfirmDialog, submitDialog\n};\n","\n/** @module common/scale */\n\nimport d3 from 'd3';\n\n\nconst colorScales = [\n  {key: 'monoblack', type: 'monocolor', colors: ['#333333'], unknown: '#333333'},\n  {key: 'monogray', type: 'monocolor', colors: ['#cccccc'], unknown: '#cccccc'},\n  {key: 'nodeDefault', type: 'monocolor', colors: ['#7fffd4'], unknown: '#7fffd4'},\n  {key: 'aquamarine', type: 'bicolor',\n   colors: ['#778899', '#7fffd4'], unknown: '#f0f0f0'},\n  {key: 'chartreuse', type: 'bicolor',\n   colors: ['#778899', '#7fff00'], unknown: '#f0f0f0'},\n  {key: 'salmon', type: 'bicolor',\n   colors: ['#778899', '#fa8072'], unknown: '#f0f0f0'},\n  {key: 'violet', type: 'bicolor',\n   colors: ['#778899', '#ee82ee'], unknown: '#f0f0f0'},\n  {key: 'temperature', type: 'tricolor',\n   colors: ['#87ceeb', '#fff5ee', '#fa8072'], unknown: '#f0f0f0'},\n  {key: 'spectrum', type: 'tricolor',\n   colors: ['#6495ed', '#ccff66', '#ffa500'], unknown: '#f0f0f0'},\n  {key: 'category10', type: 'categorical',\n   colors: ['#8dd3c7','#ffffb3','#bebada','#fb8072','#80b1d3','#fdb462',\n    '#b3de69','#fccde5','#bc80bd','#ccebc5'], unknown: '#f0f0f0'},\n  {key: 'cbsafe', type: 'categorical',\n   colors: ['#543005','#8c510a','#bf812d','#dfc27d','#f6e8c3','#c7eae5',\n   '#80cdc1','#35978f','#01665e','#003c30'], unknown: '#f0f0f0'},\n  {key: 'category20', type: 'categorical',\n   colors: d3.schemePaired.concat(d3.schemeSet2), unknown: '#f0f0f0'},\n  {key: 'category40', type: 'categorical',\n   colors: d3.schemePaired.concat(d3.schemePastel2, d3.schemeSet2, d3.schemeSet3),\n   unknown: '#f0f0f0'},\n  {key: 'custom', type: 'custom', colors: ['#ffffff'], text: 'custom'}\n];\n\n\nconst types = [\n  {key: 'linear', name: 'Linear', func: d3.scaleLinear},\n  {key: 'log', name: 'Log', func: d3.scaleLog},\n  {key: 'quantize', name: 'Quantize', func: d3.scaleQuantize},\n  {key: 'ordinal', name: 'Ordinal', func: d3.scaleOrdinal}\n];\n\n\nfunction scaleFunction(state) {\n  const cscale = colorScales.find(e => e.key === state.color);\n  let range;\n  let unknown;\n  if (cscale && cscale.key !== 'custom') {\n      range = cscale.colors;\n      unknown = cscale.unknown;\n  } else {\n    range = state.range;\n    unknown = state.unknown;\n  }\n  let domain = null;\n  if (range.length === 3) {\n    const mid = (parseFloat(state.domain[0]) + parseFloat(state.domain[1])) / 2;\n    domain = [state.domain[0], mid, state.domain[1]];\n  } else {\n    domain = state.domain;\n  }\n  // Build\n  let scaleFunc = types.find(e => e.key === state.scale).func();\n  scaleFunc = scaleFunc.domain(domain);\n  scaleFunc = scaleFunc.range(range);\n  if (['linear', 'log'].includes(state.scale)) {\n    scaleFunc = scaleFunc.clamp(true);\n  }\n\n  return d => {\n    // Sanitize\n    if (d === '' || typeof d === 'undefined' || d === null) {\n      return unknown;  // invalid values\n    }\n    if (['linear', 'log'].includes(state.scale) && parseFloat(d) != d) {\n      return unknown;  // texts\n    }\n    if (state.scale === 'log' && d <= 0) {\n      return unknown;  // negative values in log scale\n    }\n    // Apply function\n    const result = scaleFunc(d);\n    if (result === undefined) {\n      return unknown;  // TODO: specify unexpected behavior\n    }\n    return result;\n  };\n}\n\n\nfunction isD3Format(notation) {\n  try {\n    d3.format(notation);\n  } catch (err) {\n    return false;\n  }\n  return true;\n}\n\n\nexport default {\n  colorScales, types, scaleFunction, isD3Format\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: [keyField].concat(mp.fields),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: table.fields.filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key)),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: fields,\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(mp.fields)\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/collection */\n\nimport _ from 'lodash';\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as mapper} from './mapper.js';\n\n\nexport default class Collection {\n  /**\n   * Create Collection from a flashflood response datatable\n   * If data is not specified, put datatables later by this.append(data)\n   * @param {object} coll - Collection or response object\n   */\n  constructor(coll) {\n    // Settings\n    this.autoIndex = 'index';  // enumerate records\n\n    this.collectionID = coll.collectionID || null;\n    this.storeID = coll.storeID || null;\n    this.name = coll.name || null;\n    if (coll.records) {\n      this.contents = [coll];\n      this.fields = [];\n    } else {\n      this.contents = coll.contents;\n      this.fields = coll.fields || [];\n    }\n    this.contents.forEach(content => {\n      content.fields.forEach(e => this.addField(e));\n    });\n  }\n\n  /**\n   * Add fields\n   * @param {array} fs - list of fields\n   */\n  addField(field) {\n    if (this.fields.find(e => e.key === field.key)) return;\n    if (!field.hasOwnProperty('name')) field.name = field.key;\n    if (!field.hasOwnProperty('visible')) field.visible = true;\n    if (field.hasOwnProperty('d3_format')) field.format = 'd3_format';\n    if (!field.hasOwnProperty('format')) field.format = 'raw';\n    this.fields.push(field);\n  }\n\n  /**\n   * Update fields properties\n   * @param {array} fs - list of fields\n   */\n  updateFields(fs) {\n    this.fields = [];\n    fs.forEach(e => this.addField(e));\n  }\n\n  /**\n   * Join fields\n   * @param {object} mapping - column mapper object\n   */\n  joinFields(mapping) {\n    this.contents.forEach(c => {\n      mapper.apply(c, mapping);\n    });\n    if (mapping.hasOwnProperty('fields')) {\n      mapping.fields.forEach(e => this.addField(e));\n    } else {\n      this.addField(mapping.field);\n    }\n  }\n\n  /**\n   * Apply function to the original data records\n   * new fields should be manually added by Collection.addField\n   * @param {function} func - function to be applied\n   */\n  apply(func) {\n    this.contents.forEach(content => {\n      content.records.forEach(rcd => {\n        func(rcd);\n      });\n    });\n  }\n\n  /**\n   * Return all records of the collection\n   * @return {array} records\n   */\n  records() {\n    return _.flatten(this.contents.map(e => e.records));\n  }\n\n  fetch(command) {\n    const fs = this.contents\n      .filter(e => ['running', 'ready', 'interrupted', 'queued'].includes(e.status))\n      .map(content => {\n        const query = {id: content.workflowID, command: command};\n        return fetcher.get('progress', query)\n          .then(fetcher.json)\n          .then(data => {\n            return idb.updateCollection(this.storeID, this.collectionID, coll => {\n              const i = coll.contents\n                .findIndex(e => e.workflowID === query.id);\n              if (data.status === 'failure') {  // No data found on server\n                coll.contents[i].status = 'failure';\n              } else {\n                coll.contents[i] = data;\n              }\n            });\n          });\n      });\n    return Promise.all(fs)\n      .then(() => idb.getCollection(this.storeID, this.collectionID))\n      .then(coll => {\n        this.contents = coll.contents;\n      });\n  }\n\n  /**\n   * Retrieve workflows and store it into a local store.\n   * @return {Promise}\n   */\n  pull() {\n    return this.fetch('pull');\n  }\n\n  /**\n   * Retrieve workflows, abort all ongoing workflow task\n   * and store it into a local store.\n   * @return {Promise}\n   */\n  abort() {\n    return this.fetch('abort');\n  }\n\n  /**\n   * Return total number of records\n   * @return {float} total number of records\n   */\n  size() {\n    return _.sum(this.contents.map(e => e.records.length));\n  }\n\n  /**\n   * Return status\n   * @return {string} status\n   */\n  status() {\n    if (this.contents.some(e => e.status === 'interrupted')) return 'interrupted';\n    if (this.contents.some(e => e.status === 'running')) return 'running';\n    if (this.contents.some(e => e.status === 'queued')) return 'queued';\n    if (this.contents.some(e => e.status === 'ready')) return 'ready';\n    if (this.contents.some(e => e.status === 'aborted')) return 'aborted';\n    if (this.contents.some(e => e.status === 'failure')) return 'failure';\n    return 'done';\n  }\n\n  /**\n   * Return ongoing or not\n   * @return {bool} ongoing or not\n   */\n  ongoing() {\n    const s = ['ready', 'queued', 'running', 'interrupted'];\n    return s.includes(this.status());\n  }\n\n  /**\n   * Return percentage of workflow progress\n   * @return {float} progress in percent\n   */\n  progress() {\n    return _.min(this.contents.map(e => e.progress));\n  }\n\n  /**\n   * Return total execution time\n   * @return {float} total time\n   */\n  execTime() {\n    return _.sum(this.contents.map(e => e.execTime));\n  }\n\n  /**\n   * Export collection object as JSON\n   * @return {object} collection JSON\n   */\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: this.collectionID,\n      name: this.name,\n      fields: this.fields,\n      contents: this.contents\n    };\n  }\n}\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction headerCellRenderer(header) {\n  header.style('display', 'inline-block')\n    .style('width', d => `${d.width}%`)\n    .text(d => d.name);\n}\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .call(state.headerCellRenderer);\n}\n\n\nfunction updateRows(selection, state) {\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.selectAll('.dg-cell').remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', 'absolute')\n      .style('width', '100%')\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0)\n          .call(state.rowFactory(), d);\n      });\n}\n\n\nfunction updateViewport(selection, state, scrollPos) {\n  selection.select('.dg-body').style('height', `${state.bodyHeight}px`);\n  state.setScrollPosition(scrollPos);\n  selection.call(updateRows, state, scrollPos);\n  selection.select('.dg-viewport').node().scrollTop = scrollPos * state.rowHeight;\n}\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.resizeViewport(window.innerHeight - viewportTop - 5);\n  viewport.style('height', `${state.viewportHeight}px`);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(updateRows, state, pos);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyHeader();\n    selection.call(updateHeader, state);\n    selection.call(resize, state);\n    state.applyData();\n    selection.call(updateViewport, state, state.viewportTop);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    selection.call(updateViewport, state, 0);\n  };\n}\n\n\n\nexport default {\n  headerCellRenderer, updateHeader, updateRows, updateViewport,\n  resize, datagrid\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nfunction binaryToDataURI(binary) {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      resolve(event.target.result);\n    };\n    reader.readAsDataURL(binary);\n  });\n}\n\n\nexport default {\n  plotCell, plotThumbnail, binaryToDataURI\n};\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction date(selection, record, field) {\n  // TODO; formatter\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  // TODO: Check vulnerabilities\n  selection.html(record[field.key]);\n}\n\n\nfunction compound_id(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n}\n\nfunction textField(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'text')\n      .style('width', '90%')\n      .property('value', record[field.key])\n      .on('change', function () {\n        record[field.key] = this.value;\n      });\n}\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  date: date,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compound_id,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  text_field: textField,\n  control: call,\n  svg: html,\n  html: html\n};\n\n\nfunction rowCell(selection) {\n  selection.classed('dg-cell', true)\n    .classed('align-middle', true)\n    .classed('text-truncate', true)\n    .style('display', 'inline-block');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n          .call(rowCell)\n          .style('width', `${field.width}%`);\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compound_id, image, checkbox, textField, call,\n  rowCell, rowFactory\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport Collection from '../common/collection.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as component} from './component.js';\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(view, coll) {\n    this.storeID = view.storeID || null;\n    this.viewID = view.viewID || null;\n    this.name = view.name || null;\n    this.sortOrder = view.sortOrder || [];\n    this.filterText = view.filterText || null;\n    this.rows = new Collection(coll);\n\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    // TODO: auto adjust\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      html: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.viewportTop = 0;\n    this.previousViewportTop = null;\n    this.viewportBottom = null;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.headerCellRenderer = component.headerCellRenderer;\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n  }\n\n  /**\n   * Set viewport height and number of rows to show\n   * @param {int} height - viewport height\n   */\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n  }\n\n  /**\n   * Set range of the row indices to show\n   * @param {int} position - Index of the top row to show\n   */\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setNumViewportRows() {\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  resizeViewport(height) {\n    this.setViewportSize(height);\n    this.setNumViewportRows();\n  }\n\n  /**\n   * Apply header data\n   */\n  applyHeader() {\n    this.visibleFields = this.rows.fields.filter(e => e.visible);\n    const widthfSum = this.visibleFields.reduce((a, c) => a + (c.widthf || 1), 0);\n    this.visibleFields = this.visibleFields.map(e => {\n      const field = {\n        width: (e.widthf || 1) / widthfSum * 100,\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b, 0).height;\n  }\n\n  /**\n   * Apply row data\n   * 1. applyHeader: define fields and set rowHeight\n   * 2. resize: measure actual window size and calc viewportHeight\n   * 3. applyData: calc number of rows from rowHeight and viewportHeight\n   * 4. setScrollPosition: calc row index range\n   * 5. recordsToShow: slice rows to show\n   */\n  applyData() {\n    this.setNumViewportRows();\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.rows.records().slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.rows.records().slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  updateFields(fs) {\n    this.rows.updateFields(fs);\n  }\n\n  joinFields(mapping) {\n    this.rows.joinFields(mapping);\n    this.applyData();\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  save() {\n    return idb.updateItem(this.storeID, item => {\n      const ci = item.dataset\n        .findIndex(e => e.collectionID === this.rows.collectionID);\n      item.dataset[ci] = this.rows.export();\n      const vi = item.views.findIndex(e => e.viewID === this.viewID);\n      item.views[vi] = this.export();\n    });\n  }\n\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: this.viewID,\n      name: this.name,\n      viewType: \"datagrid\",\n      rows: this.rows.collectionID,\n      sortOrder: this.sortOrder,\n      filterText: this.filterText\n    };\n  }\n}\n","\n/** @module component/formBox */\n\n\nimport d3 from 'd3';\n\n\nfunction textBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text');\n}\n\nfunction updateTextBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction textBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction readonlyBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .attr('readonly', 'readonly');\n}\n\n\nfunction textareaBox(selection, label, rows) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows);\n}\n\nfunction updateTextareaBox(selection, value) {\n  selection.select('textarea').property('value', value);\n}\n\nfunction updateTextareaPlaceholder(selection, placeholder) {\n  selection.select('textarea').attr('placeholder', placeholder);\n}\n\nfunction textareaBoxValue(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value;  // TODO: 0 is falsy\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder;\n  return '';\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n').filter(e => e.length > 0);\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder.split('\\n').filter(e => e.length > 0);\n  return [];\n}\n\n\nfunction checkBox(selection, label) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox');\n  box.append('span')\n      .text(label);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, label, min, max, step) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'number')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step);\n}\n\nfunction updateNumberBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction numberIntValid(selection) {\n  const value = numberBoxIntValue(selection);\n  const min = parseInt(selection.select('input').attr('min'));\n  const max = parseInt(selection.select('input').attr('max'));\n  const valid = !isNaN(value) && value >= min && value <= max;\n  selection.select('input')\n      .style('background-color', valid ? '#ffffff' : '#ffcccc');\n  return valid;\n}\n\nfunction numberFloatValid(selection) {\n  const value = numberBoxFloatValue(selection);\n  const min = parseInt(selection.select('input').attr('min'));\n  const max = parseInt(selection.select('input').attr('max'));\n  const valid = !isNaN(value) && value >= min && value <= max;\n  selection.select('input')\n      .style('background-color', valid ? '#ffffff' : '#ffcccc');\n  return valid;\n}\n\nfunction numberBoxIntValue(selection) {\n  return parseInt(selection.select('input').property('value'));\n}\n\nfunction numberBoxFloatValue(selection) {\n  return parseFloat(selection.select('input').property('value'));\n}\n\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n}\n\n\nfunction updateColorBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\n\nfunction colorBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction fileInputBox(selection, label, accept) {\nselection\n    .classed('form-group', true)\n    .classed('form-row', true);\nselection.append('label')\n    .classed('col-form-label', true)\n    .classed('col-form-label-sm', true)\n    .classed('col-4', true)\n    .text(label);\nselection.append('input')\n    .classed('form-control', true)\n    .classed('form-control-sm', true)\n    .classed('form-control-file', true)\n    .classed('col-8', true)\n    .attr('type', 'file')\n    .attr('accept', accept);\n}\n\nfunction clearFileInput(selection) {\n  // TODO: FileList object (input.files) may be a readonly property\n  const accept = selection.select('input').attr();\n  selection.select('input').remove();\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('form-control-file', true)\n      .classed('col-8', true)\n      .attr('type', 'file')\n      .attr('accept', accept);\n}\n\nfunction fileInputBoxValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\n\nexport default {\n  textBox, updateTextBox, textBoxValue, readonlyBox,\n  textareaBox, updateTextareaBox, updateTextareaPlaceholder,\n  textareaBoxValue, textareaBoxLines,\n  checkBox, updateCheckBox, checkBoxValue,\n  numberBox, updateNumberBox, numberIntValid, numberFloatValid,\n  numberBoxIntValue, numberBoxFloatValue,\n  colorBox, updateColorBox, colorBoxValue,\n  fileInputBox, clearFileInput, fileInputBoxValue\n};\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, 'Search');\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.textBoxValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction setSort(selection, state) {\n  state.headerCellRenderer = header => {\n    header.style('display', 'inline-block')\n      .style('width', d => `${d.width}%`)\n      .text(d => d.name)\n      .filter(d => misc.sortType(d.format) !== 'none')\n      .append('span').append('a')\n        .attr('id', d => `sort-${d.key}`)\n        .text('^v')\n        .style('display', 'inline-block')\n        .style('width', '30px')\n        .style('text-align', 'center')\n      .on('click', d => {\n        const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n        d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n        state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n        selection.call(component.updateRows, state);\n      });\n  };\n}\n\n\nexport default {\n  setSort\n};\n","\n/** @module datagrid/table */\n\nimport Collection from '../common/collection.js';\n\nimport DatagridState from './state.js';\nimport {default as component} from './component.js';\nimport {default as rowf} from './rowFilter.js';\nimport {default as sort} from './sort.js';\n\n\nfunction table(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  state.keyFunc = d => d;\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterSortTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(sort.setSort, state)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction update(selection, fields, records) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = selection.datum();\n  state.rows = new Collection(data);\n  state.updateContentsNotifier();\n}\n\n\nfunction updateRecords(selection, records) {\n  const state = selection.datum();\n  state.rows.contents[0].records = records;\n  state.updateContentsNotifier();\n}\n\n\nfunction tableRecords(selection) {\n  const state = selection.datum();\n  return state.rows.records();\n}\n\n\nexport default {\n  table, filterTable, filterSortTable, update, updateRecords, tableRecords\n};\n","\n/** @module dialog/fieldConfig */\n\nimport d3 from 'd3';\n\nimport {default as scale} from '../common/scale.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\nimport {default as rowf} from '../datagrid/rowFactory.js';\n\n\nconst id = 'fieldconf-dialog';\nconst title = 'Column setting';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-edittable');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[0].width}%`)\n        .text(record.name);\n    selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[1].width}%`)\n      .append('input')\n        .attr('type', 'checkbox')\n        .property('checked', record.visible)\n        .on('change', function () {\n          record.visible = this.checked;\n        });\n    const select = selection.append('div')\n        .call(rowf.rowCell)\n        .style('width', `${fields[2].width}%`)\n      .append('select');\n    const extra = !fields[2].options.includes(record.format);\n    select.selectAll('option').data(extra ? [record.format] : fields[2].options)\n      .enter().append('option')\n        .attr('value', d => d)\n        .text(d => d);\n    select.property('value', record.format)\n        .property('disabled', extra)\n        .on('change', function () {\n          record.format = this.value;\n          selection.select('.d3f input')\n            .property('disabled', record.format !== 'd3_format');\n        });\n    selection.append('div')\n        .call(rowf.rowCell)\n        .classed('d3f', true)\n        .style('width', `${fields[3].width}%`)\n      .append('input')\n        .attr('type', 'text')\n        .style('width', '90%')\n        .property('value', record.d3_format)\n        .property('disabled', record.format !== 'd3_format')\n        .on('input', function () {\n          const valid = scale.isD3Format(this.value);\n          d3.select(this)\n              .style('background-color', valid ? '#ffffff' : '#ffcccc');\n          if (valid) {\n            record.d3_format = this.value;\n            selection.dispatch('change', {bubbles: true});\n          }\n        });\n  };\n}\n\n\nfunction body(selection) {\n  const fields = [\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'visible', name: 'Visible', format: 'checkbox',\n     widthf: 0.5, height: 40},\n    {key: 'format', name: 'Format', format: 'select',\n     options: ['text', 'numeric', 'd3_format', 'raw', 'compound_id'],\n     height: 40},\n    {key: 'd3_format', name: 'D3 format', format: 'text_field',\n     height: 40}\n  ];\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-dialog').classed('modal-lg', true);\n  dialog.select('.modal-body').append('div')\n      .classed('dgfields', true)\n      .call(table.table, fields, [], rowFactory, 300);\n}\n\n\nfunction updateBody(selection, dgfields) {\n  selection.select('.dgfields')\n      .call(table.updateRecords, dgfields)\n      .on('change', function () {\n        const d3fValid = d3.select(this).selectAll('.d3f input')\n          .nodes().map(e => e.value)\n          .every(n => scale.isD3Format(n));\n        selection.select('.submit')\n            .property('disabled', !d3fValid);\n      });\n}\n\n\nfunction value(selection) {\n  return table.tableRecords(selection.select('.dgfields'));\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module dialog/fieldFetch */\n\nimport _ from 'lodash';\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as mapper} from '../common/mapper.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\n\n\nconst id = 'fieldfetch-dialog';\nconst title = 'Fetch assays';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addassay');\n}\n\n\nfunction body(selection) {\n  const fields = [\n    {key: 'check', name: 'Check', format: 'checkbox',\n     widthf: 0.5, height: 40, disabled: 'check_d'},\n    {key: 'assay_id', name: 'Assay ID', format: 'assay_id'},\n    {key: 'name', name: 'Name', format: 'text'},\n    {key: 'value_type', name: 'Value type', format: 'text'},\n    {key: 'tags', name: 'Tags', format: 'list', widthf: 2}\n  ];\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-dialog').classed('modal-lg', true);\n  dialog.select('.modal-body').append('div')\n    .classed('assays', true)\n    .call(table.filterTable, fields, []);\n}\n\n\nfunction updateBody(selection, schema, dgfields) {\n  const assays = _.flatten(\n    schema.resources.filter(e => e.domain === 'assay').map(e => e.data)\n  );\n  const items = _.flatMap(assays, assay => {\n    return assay.value_types.map(e => {\n      const copy = Object.assign({}, assay);\n      copy.value_type = e.key;\n      delete copy.value_types;\n      return copy;\n    });\n  });\n  const done = {};\n  dgfields.filter(e => e.hasOwnProperty('__origin'))\n    .map(e => e.__origin)\n    .forEach(e => {\n      if (!done.hasOwnProperty(e.assay_id)) {\n        done[e.assay_id] = [];\n      }\n      done[e.assay_id].push(e.value_type);\n    });\n  const records = items.map(item => {\n    const d = done.hasOwnProperty(item.assay_id)\n        && done[item.assay_id].includes(item.value_type);\n    item.check = d;\n    item.check_d = d;\n    return item;\n  });\n  selection.select('.assays')\n    .call(table.updateRecords, records)\n    .on('change', function () {  // Validation\n      const anyChecked = table.tableRecords(d3.select(this))\n        .filter(e => e.check && !e.check_d).length;\n      selection.select('.submit').property('disabled', !anyChecked);\n    })\n    .dispatch('change');\n}\n\n\nfunction execute(selection, compounds, schema) {\n  const targets = schema.resources\n    .filter(e => e.domain === 'activity').map(e => e.id);\n  const queries = table.tableRecords(selection.select('.assays'))\n    .filter(e => e.check && !e.check_d)\n    .map(e => {\n      return {\n        workflow: 'activity',\n        targets: targets,\n        assay_id: e.assay_id,\n        condition: {\n          compounds: compounds,\n          value_types: [e.value_type]\n        }\n      };\n    })\n    .map(q => {\n      return fetcher.get(q.workflow, q)\n        .then(fetcher.json);\n    });\n    return Promise.all(queries).then(res => {\n      const merged = res.shift();\n      res.forEach(data => {\n        const mp = mapper.tableToMapping(\n          data, 'compound_id', ['index', 'assay_id']);\n        mapper.apply(merged, mp);\n      });\n      return mapper.tableToMapping(\n        merged, 'compound_id', ['index', 'assay_id']);\n    });\n}\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module component/shape */\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction monocolorBar(selection, colors, text) {\n  selection.attr('viewBox', '0 0 100 10')\n      .attr('preserveAspectRatio', 'none');\n  const group = selection.append('g');\n  group.append('rect')\n      .attr('x', 0).attr('y', 0)\n      .attr('width', 100).attr('height', 10)\n      .attr('fill', colors[0]);\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 10)\n      .attr('font-size', 12)\n      .text(text);\n}\n\nfunction bicolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n      .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n      .attr('offset', 1).attr('stop-color', colors[1]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction tricolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n    .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n    .attr('offset', 0.5).attr('stop-color', colors[1]);\n  grad.append('stop')\n    .attr('offset', 1).attr('stop-color', colors[2]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction categoricalBar(selection, colors, text) {\n  selection.attr('viewBox', '0 0 100 10')\n      .attr('preserveAspectRatio', 'none');\n  const sw = 100 / colors.length;\n  const group = selection.append('g');\n  colors.forEach((e, i) => {\n    group.append('rect')\n        .attr('x', sw * i).attr('y', 0)\n        .attr('width', sw).attr('height', 20)\n        .attr('fill', colors[i]);\n  });\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 20)\n      .attr('font-size', 20)\n      .text(text);\n}\n\nfunction setSize(selection, width, height) {\n  selection.attr('width', width).attr('height', height);\n}\n\n\nconst colorBar = {\n  'monocolor': monocolorBar,\n  'bicolor': bicolorBar,\n  'tricolor': tricolorBar,\n  'categorical': categoricalBar,\n  'custom': monocolorBar\n};\n\n\nexport default {\n  colorBar, setSize\n};\n","\n/** @module component/formListBox */\n\nimport d3 from 'd3';\n\nimport {default as shape} from './shape.js';\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction selectBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('select')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n}\n\nfunction selectBoxItems(selection, items) {\n  const options = selection.select('select')\n    .selectAll('option')\n      .data(items, d => d.key);\n  options.exit().remove();\n  options.enter()\n    .append('option')\n      .attr('value', d => d.key)\n      .text(d => d.name);\n}\n\nfunction updateSelectBox(selection, value) {\n  selection.select('select').property('value', value);\n}\n\nfunction selectBoxValue(selection) {\n  return selection.select('select').property('value');\n}\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction checklistBox(selection, label) {\n  // TODO: scroll\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('ul')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n}\n\nfunction checklistBoxItems(selection, items) {\n  const listitems = selection.select('ul')\n    .selectAll('li')\n      .data(items, d => d.key);\n  listitems.exit().remove();\n  const form = listitems.enter()\n    .append('li')\n      .attr('class', 'form-check')\n    .append('label')\n      .attr('class', 'form-check-label');\n  form.append('input')\n      .attr('type', 'checkbox')\n      .attr('class', 'form-check-input')\n      .property('value', d => d.key);\n  form.append('span')\n      .text(d => d.name);\n}\n\nfunction updateChecklistBox(selection, values) {\n  if (!values) return;\n  selection.selectAll('input')\n    .each(function (d) {\n      d3.select(this).property('checked', values.includes(d.key));\n    });\n}\n\nfunction checklistBoxValue(selection) {\n  return selection.selectAll('input:checked').data().map(d => d.key);\n}\n\nfunction anyChecked(selection) {\n  return checklistBoxValue(selection).length > 0;\n}\n\n\nfunction colorScaleBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label || 'Colorscale');\n  const form = selection.append('div')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n  const dropdown = form.append('div')\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  dropdown.append('button')\n      .classed('btn', true)\n      .classed(`btn-light`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  dropdown.append('div')\n      .classed('dropdown-menu', true)\n      .classed('py-0', true);\n  form.append('span')\n      .classed('selected', true);\n}\n\nfunction colorScaleBoxItems(selection, items) {\n  const listitems = selection.select('.dropdown-menu')\n    .selectAll('a')\n      .data(items, d => d);\n  listitems.exit().remove();\n  listitems.enter()\n    .append('a')\n      .classed('dropdown-item', true)\n      .classed('py-0', true)\n      .attr('href', '#')\n      .attr('title', d => d.key)\n      .on('click', function (d) {\n        selection.call(setSelectedColorScale, d);\n        selection.dispatch('change', {bubbles: true});\n      })\n    .append('svg')\n      .each(function (d) {\n        d3.select(this)\n          .call(shape.colorBar[d.type], d.colors, d.text)\n          .call(shape.setSize, 100, 10);\n      });\n}\n\nfunction setSelectedColorScale(selection, item) {\n  const selected = selection.select('.selected');\n  selected.selectAll('svg').remove();\n  selected.datum(item);  // Bind selected item record\n  selected.append('svg')\n      .call(shape.colorBar[item.type], item.colors, item.text)\n      .call(shape.setSize, 100, 10);\n}\n\nfunction updateColorScaleBox(selection, key) {\n  const data = selection.select('.dropdown-menu')\n    .selectAll('a').data();\n  const item = data.find(e => e.key === key);\n  selection.call(setSelectedColorScale, item);\n}\n\nfunction colorScaleBoxValue(selection) {\n  return selection.select('.selected').datum().key;\n}\n\nfunction colorScaleBoxItem(selection) {\n  return selection.select('.selected').datum();\n}\n\n\nexport default {\n  selectBox, selectBoxItems, updateSelectBox, selectBoxValue,\n  checklistBox, checklistBoxItems, updateChecklistBox, checklistBoxValue,\n  anyChecked,\n  colorScaleBox, colorScaleBoxItems, updateColorScaleBox,\n  colorScaleBoxValue, colorScaleBoxItem\n};\n","\n/** @module dialog/fieldFile */\n\nimport d3 from 'd3';\n\nimport {default as mapper} from '../common/mapper.js';\nimport {default as misc} from '../common/misc.js';\nimport {default as hfile} from '../common/file.js';\nimport {default as himg} from '../common/image.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as table} from '../datagrid/table.js';\n\n\nconst id = 'fieldfile-dialog';\nconst title = 'Import fields from file';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addfile');\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  const body = dialog.select('.modal-body');\n  body.append('div')\n      .classed('file', true)\n      .call(box.fileInputBox, 'File', '.json,.csv');\n  body.append('div')\n      .classed('left', true)\n      .call(lbox.selectBox, 'Datagrid ID');\n  body.append('div')\n      .classed('right', true)\n      .call(lbox.selectBox, 'File ID')\n    .select('select')\n      .property('disabled', true);\n  body.append('h5')\n      .classed('mt-2', true)\n      .text('Preview');\n  body.append('div')\n      .classed('preview', true)\n      .call(table.table, [], [], null, 210);\n}\n\n\nfunction updateBody(selection, fields) {\n  const leftFields = fields.filter(e => misc.sortType(e.format) !== 'none');\n  const leftDefault = leftFields\n    .find(e => e.format === 'compound_id') || leftFields[0];\n  selection.select('.left')\n      .call(lbox.selectBoxItems, leftFields)\n      .call(lbox.updateSelectBox, leftDefault.key);\n  selection.select('.preview')\n      .call(table.update, [], []);\n  selection.select('.file')\n      .call(box.clearFileInput)\n      .on('change', function () {\n        const file = box.fileInputBoxValue(d3.select(this));\n        d3.select(this).dispatch('validate');\n        const isCsv = file.name.split('.').pop() === 'csv';\n        hfile.readFile(file)\n          .then(res => {\n            const mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n            const tbl = mapper.mappingToTable(mapping);\n            selection.select('.right')\n              .call(lbox.selectBoxItems,\n                    [{key: mapping.key, name: mapping.key}])\n              .call(lbox.updateSelectBox, mapping.key);\n            selection.select('.preview')\n              .call(table.update, tbl.fields, tbl.records.slice(0, 5));\n          });\n      })\n      .on('validate', function () { // Input validation\n        const fileSelected = box.fileInputBoxValue(d3.select(this));\n        selection.select('.submit')\n          .property('disabled', !fileSelected);\n      })\n      .dispatch('validate');\n}\n\n\nfunction readFile(selection) {\n  const left = lbox.selectBoxValue(selection.select('.left'));\n  const file = box.fileInputBoxValue(selection.select('.file'));\n  const isCsv = file.name.split('.').pop() === 'csv';\n  return hfile.readFile(file)\n    .then(res => {\n      let mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n      if (mapping.hasOwnProperty('field')) {\n        mapping = mapper.singleToMulti(mapping);\n      }\n      mapping.key = left;\n      // TODO; refactor\n      const plotCols = [];\n      mapping.fields.forEach((e, i) => {\n        if (e.format === 'plot') {\n          mapping.fields[i].format = 'image';\n          plotCols.push(i);\n        }\n      });\n      if (plotCols.length > 0) {\n        const ps = [];\n        Object.entries(mapping.mapping).forEach(m => {\n          plotCols.forEach(e => {\n            const p = himg.plotThumbnail(m[1][e])\n              .then(img => {\n                mapping.mapping[m[0]][e] = img;\n              });\n            ps.push(p);\n          });\n        });\n        return Promise.all(ps).then(() => mapping);\n      } else {\n        return mapping;\n      }\n    });\n}\n\n\nexport default {\n  menuLink, body, updateBody, readFile\n};\n","\n/** @module dialog/fieldInput */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'fieldinput-dialog';\nconst title = 'Add custom field';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-addcheckbox');\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  const body = dialog.select('.modal-body');\n  body.append('div')\n      .classed('key', true)\n      .call(box.textBox, 'Field key');\n  const options = [\n    {key: 'checkbox', name: 'Checkbox', format: 'checkbox'},\n    {key: 'text_field', name: 'Text field', format: 'text_field'},\n    {key: 'template', name: 'Template', format: 'html'}\n  ];\n  body.append('div')\n      .classed('type', true)\n      .call(lbox.selectBox, 'Type')\n      .call(lbox.selectBoxItems, options);\n  // Template builder\n  const coid = misc.uuidv4().slice(0, 8);\n  const tmpBox = body.append('div')\n      .classed('mb-3', true);\n  tmpBox.append('p')\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-sm', true)\n      .classed('btn-outline-primary', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'collapse')\n      .attr('data-target', `#${coid}-collapse`)\n      .attr('aria-expanded', 'false')\n      .attr('aria-controls', `${coid}-collapse`)\n      .text('Template builder');\n  const collapse = tmpBox.append('div')\n      .classed('collapse', true)\n      .attr('id', `${coid}-collapse`)\n    .append('div')\n      .classed('card', true)\n      .classed('card-body', true);\n  collapse.append('div')\n      .classed('tmpfield', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Field');\n  collapse.append('div')\n      .classed('notation', true)\n      .call(box.readonlyBox, 'Notation');\n  collapse.append('div')\n      .classed('contents', true)\n      .call(box.textareaBox, 'Contents', 5);\n}\n\n\nfunction updateBody(selection, fields) {\n  selection.select('.key')\n      .call(box.updateTextBox, '')\n      .on('input', function () {\n        selection.select('.submit')\n            .property('disabled', !valid(selection, fields));\n      });\n  selection.select('.type')\n      .call(lbox.updateSelectBox, 'checkbox')\n      .on('change',  function () {\n        const type = lbox.selectBoxValue(selection.select('.type'));\n        const custom = type === 'template';\n        selection.selectAll('.tmpfield, .notation, .contents')\n            .selectAll('select, input, textarea')\n            .property('disabled', !custom)\n            .style('opacity',  custom ? null : 0.3);\n        selection.select('.submit')\n            .property('disabled', !valid(selection, fields));\n      })\n      .dispatch('change');\n  const tmpFields = fields.filter(e => misc.sortType(e.format) !== 'none');\n  selection.select('.tmpfield')\n      .call(lbox.selectBoxItems, tmpFields)\n      .call(lbox.updateSelectBox, 'index')\n      .on('change', function () {\n        const field = d3.select(this).select('select').property('value');\n        const frcd = d3.select(this).selectAll('option').data()\n          .find(e => e.key === field);\n        const notation = frcd.d3_format ? `:${frcd.d3_format}` : '';\n        selection.select('.notation').select('input')\n              .property('value', `{${frcd.key}${notation}}`);\n      })\n      .dispatch('change');\n  selection.select('.contents')\n      .call(box.updateTextareaBox, '')\n      .on('input', function () {\n        selection.select('.submit')\n            .property('disabled', !valid(selection, fields));\n      });\n}\n\n\nconst formatterGen = {\n  checkbox: () => (() => false),\n  text_field: () => (() => ''),\n  template: tmp => {\n    const parseInner = (rcd, n) => {\n      const arr = n.slice(1, -1).split(':');\n      if (arr.length === 1) {\n        return rcd[arr[0]];\n      } else {\n        return d3.format(arr[1])(rcd[arr[0]]);\n      }\n    };\n    const inner = tmp.match(/\\{.+?\\}/g) || [];\n    const outer = tmp.split(/\\{.+?\\}/g);\n    return rcd => {\n      const ic = inner.slice();\n      const oc = outer.slice();\n      const txtarr = [oc.shift()];\n      while (ic.length) {\n        txtarr.push(parseInner(rcd, ic.shift()));\n        txtarr.push(oc.shift());\n      }\n      return txtarr.join('').replace(/(?:\\r\\n|\\r|\\n)/g, '<br />');\n    };\n  }\n};\n\n\nfunction valid(selection, fields) {\n  const key = box.textBoxValue(selection.select('.key'));\n  const keyValid = key !== '' && !fields.map(e => e.key).includes(key);\n  selection.select('.key').select('input')\n    .style('background-color', keyValid ? '#ffffff' : '#ffcccc');\n  const tmpFields = fields.filter(e => misc.sortType(e.format) !== 'none');\n  const cont = box.textareaBoxValue(selection.select('.contents'));\n  const contEmpty = cont === '';\n  const contOuter = cont.split(/\\{.+?\\}/g);\n  const contInner = (cont.match(/\\{.+?\\}/g) || []).map(e => e.slice(1, -1));\n  const contInvalidKey = contInner\n    .some(n => {\n      const ns = n.split(':');\n      if (!tmpFields.map(e => e.key).includes(ns[0])) return true;\n      if (ns.length > 2) return true;\n      if (ns.length === 1) return false;\n      try {\n        d3.format(ns[1]);\n      } catch(err) {\n        return true;\n      }\n      return false;\n    });\n  const contInvalidFormat = contOuter.concat(contInner)\n    .some(n => n.includes('{') || n.includes('}'));\n  const contValid = !(contEmpty || contInvalidKey || contInvalidFormat);\n  selection.select('.contents').select('textarea')\n    .style('background-color', contValid ? '#ffffff' : '#ffcccc');\n  if (!keyValid) return false;\n  if (lbox.selectBoxValue(selection.select('.type')) !== 'template') {\n    return true;\n  }\n  return contValid;\n}\n\n\nfunction value(selection) {\n  const key = box.textBoxValue(selection.select('.key'));\n  const type = lbox.selectBoxValue(selection.select('.type'));\n  const format = selection.select('.type').selectAll('option').data()\n    .find(e => e.key === type).format;\n  const cont = box.textareaBoxValue(selection.select('.contents'));\n  return {\n    field: {key: key, name: key, format: format},\n    converter: formatterGen[type](cont)\n  };\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module dialog/formGroup */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\n\n\n/**\n * Render color range control box group\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction queryMolGroup(selection) {\n  selection\n      .classed('mb-3', true);\n  selection.append('div')\n      .classed('format', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Format')\n      .call(lbox.selectBoxItems,\n            [\n              {key: 'molfile', name: 'MDL Molfile'},\n              {key: 'dbid', name: 'Compound ID'}\n            ]);\n  selection.append('div')\n      .classed('source', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Source');\n  selection.append('div')\n      .classed('textquery', true)\n      .classed('mb-1', true)\n      .call(box.textBox, 'Query');\n  selection.append('div')\n      .classed('areaquery', true)\n      .classed('mb-1', true)\n      .call(box.textareaBox, 'Query', 6, null);\n  // Popover\n  $(function () {\n    $('[data-toggle=\"popover\"]')\n      .popover({html: true, trigger: 'focus'});\n  });\n  selection.append('div')\n      .classed('form-row', true)\n      .classed('justify-content-end', true)\n    .append('button')\n      .classed('preview', true)\n      .attr('data-toggle', 'popover')\n      .attr('data-html', 'true')\n      .attr('data-content', '<div id=\"previmg\"></div>')\n      .call(button.menuButton, 'Structure preview', 'primary');\n}\n\nfunction updateQueryMolGroup(selection, resources) {\n  selection.select('.format')\n      .call(lbox.updateSelectBox, 'molfile')\n      .on('change', function () {\n        const value = lbox.selectBoxValue(d3.select(this));\n        selection.select('.source')\n          .select('select')\n            .property('disabled', value !== 'dbid');\n        selection.select('.textquery')\n            .property('hidden', value !== 'dbid');\n        selection.select('.areaquery')\n            .property('hidden', value !== 'molfile');\n      })\n      .dispatch('change');\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  selection.select('.source')\n      .call(lbox.selectBoxItems, res)\n      .call(lbox.updateSelectBox, null);\n  selection.select('.preview')\n      .on('click', function () {\n        const query = queryMolGroupValue(selection);\n        return fetcher.get('strprev', query)\n          .then(fetcher.text)\n          .then(res => d3.select('#previmg').html(res), fetcher.error);\n      });\n  selection.select('.textquery')\n      .call(box.updateTextBox, '')\n      .on('input', function() {\n        selection.dispatch('validate');\n      });\n  selection.select('.areaquery')\n      .call(box.updateTextareaBox, '')\n      .on('input', function() {\n        selection.dispatch('validate');\n      });\n}\n\nfunction queryMolGroupValue(selection) {\n  const format = lbox.selectBoxValue(selection.select('.format'));\n  const source = lbox.selectBoxValue(selection.select('.source'));\n  const textquery = box.textBoxValue(selection.select('.textquery'));\n  const areaquery = box.textareaBoxLines(selection.select('.areaquery'));\n  return {\n    format: format,\n    source: format === 'dbid' ? source : null,\n    value: format === 'molfile' ? areaquery : textquery\n  };\n}\n\nfunction queryMolGroupValid(selection) {\n  const format = lbox.selectBoxValue(selection.select('.format'));\n  const textquery = box.textBoxValue(selection.select('.textquery'));\n  const areaquery = box.textareaBoxLines(selection.select('.areaquery'));\n  return format === 'molfile' ? areaquery.length : textquery !== '';\n}\n\n\nfunction simOptionGroup(selection) {\n  const id = misc.uuidv4().slice(0, 8);\n  selection\n      .classed('mb-3', true)\n    .append('p')\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-sm', true)\n      .classed('btn-outline-primary', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'collapse')\n      .attr('data-target', `#${id}-collapse`)\n      .attr('aria-expanded', 'false')\n      .attr('aria-controls', `${id}-collapse`)\n      .text('Optional parameters');\n  const collapse = selection.append('div')\n      .classed('collapse', true)\n      .attr('id', `${id}-collapse`)\n    .append('div')\n      .classed('card', true)\n      .classed('card-body', true);\n  collapse.append('div')\n      .classed('ignoreh', true)\n      .classed('mb-1', true)\n      .call(box.checkBox, 'Ignore explicit hydrogens');\n  collapse.append('div')\n      .classed('timeout', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Timeout', 1, 999, 1);\n  collapse.append('div')\n      .classed('diam', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Diameter (MCS-DR/GLS)', 4, 999, 1);\n  collapse.selectAll('label.col-form-label')\n      .classed('col-4', false)\n      .classed('col-6', true);\n  collapse.selectAll('input.form-control')\n      .classed('col-8', false)\n      .classed('col-6', true);\n}\n\n\nfunction updateSimOptionGroup(selection) {\n  selection.select('.ignoreh')\n      .call(box.updateCheckBox, true);\n  selection.select('.timeout')\n      .call(box.updateNumberBox, 2);\n  selection.select('.diam')\n      .call(box.updateNumberBox, 8);\n}\n\n\nfunction simOptionGroupValue(selection) {\n  const timeout = selection.select('.timeout');\n  const diam = selection.select('.diam');\n  const query = {\n    ignoreHs: box.checkBoxValue(selection.select('.ignoreh'))\n  };\n  if (!timeout.select('input').property('disabled')) {\n    query.timeout = box.numberBoxIntValue(timeout);\n  }\n  if (!diam.select('input').property('disabled')) {\n    query.diameter = box.numberBoxIntValue(diam);\n  }\n  return query;\n}\n\n\nexport default {\n  queryMolGroup, updateQueryMolGroup, queryMolGroupValue, queryMolGroupValid,\n  simOptionGroup, updateSimOptionGroup, simOptionGroupValue\n};\n","\n/** @module dialog/networkgen */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\nimport {default as group} from './formGroup.js';\n\n\nconst id = 'networkgen-dialog';\nconst title = 'Generate similarity network';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-network');\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-body').append('div')\n      .classed('measure', true)\n      .call(lbox.selectBox, 'Measure');\n  // Threshold\n  dialog.select('.modal-body').append('div')\n      .classed('thld', true)\n      .call(box.numberBox, 'Threshold', 0.5, 1, 0.01);\n  // Similarity search options\n  dialog.select('.modal-body').append('div')\n      .classed('option', true)\n      .call(group.simOptionGroup);\n}\n\n\nfunction updateBody(selection, rdk) {\n  // Similarity measure\n  const measures = [\n    {key: 'gls', name: 'Graph-based local similarity(GLS)'}\n  ];\n  if (rdk) {\n    measures.push({key: 'rdmorgan', name: 'RDKit Morgan similarity'});\n    measures.push({key: 'rdfmcs', name: 'RDKit FMCS'});\n  }\n  selection.select('.measure')\n      .call(lbox.selectBoxItems, measures)\n      .call(lbox.updateSelectBox, 'gls')\n      .on('change', function () {\n        const value = lbox.selectBoxValue(d3.select(this));\n        selection.select('.diam')\n          .select('input')\n            .property('disabled', value !== 'gls');\n        selection.select('.timeout')\n          .select('input')\n            .property('disabled', !['gls', 'rdfmcs'].includes(value));\n      });\n  selection.select('.thld')\n      .call(box.updateNumberBox, 0.5);\n  selection.select('.option')\n      .call(group.updateSimOptionGroup);\n}\n\n\nfunction execute(selection, rcds) {\n  const measure = selection.select('.measure');\n  const thld = selection.select('.thld');\n  const params = group.simOptionGroupValue(selection.select('.option'));\n  if (!measure.select('select').property('disabled')) {\n    params.measure = lbox.selectBoxValue(measure);\n  }\n  if (!thld.select('input').property('disabled')) {\n    params.threshold = box.numberBoxFloatValue(thld);\n  }\n  const formData = new FormData();\n  // TODO: need updates in flashflood query schema\n  formData.append('params', JSON.stringify(params));\n  formData.append('contents', new Blob([JSON.stringify(rcds)]));\n  return fetcher.post(`${params.measure}net`, formData)\n    .then(fetcher.json);\n}\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module dialog/rename */\n\nimport d3 from 'd3';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'rename-dialog';\nconst title = 'Rename';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-edittext');\n}\n\n\nfunction body(selection) {\n  selection.call(modal.submitDialog, id, title)\n    .select('.modal-body').append('div')\n      .classed('rename', true)\n      .call(box.textBox, 'New name');\n}\n\n\nfunction updateBody(selection, name) {\n  selection.select('.rename')\n      .call(box.updateTextBox, name)\n      .on('input', function () {  // Validation\n        const keyValid = box.textBoxValue(d3.select(this)) !== '';\n        selection.select('.submit').property('disabled', !keyValid);\n      })\n      .dispatch('input');\n}\n\n\nfunction value(selection) {\n  return box.textBoxValue(selection.select('.rename'));\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module datagridApp */\n\nimport d3 from 'd3';\n\nimport {default as client} from './common/client.js';\nimport {default as fetcher} from './common/fetcher.js';\nimport {default as hfile} from './common/file.js';\nimport {default as idb} from './common/idb.js';\nimport {default as misc} from './common/misc.js';\n\nimport {default as badge} from './component/badge.js';\nimport {default as button} from './component/button.js';\nimport {default as modal} from './component/modal.js';\n\nimport {default as fieldConfigDialog} from './dialog/fieldConfig.js';\nimport {default as fieldFetchDialog} from './dialog/fieldFetch.js';\nimport {default as fieldFileDialog} from './dialog/fieldFile.js';\nimport {default as fieldInputDialog} from './dialog/fieldInput.js';\nimport {default as networkgenDialog} from './dialog/networkgen.js';\nimport {default as renameDialog} from './dialog/rename.js';\n\nimport DatagridState from './datagrid/state.js';\nimport {default as rowf} from './datagrid/rowFilter.js';\nimport {default as sort} from './datagrid/sort.js';\nimport {default as dg} from './datagrid/component.js';\n\n\nfunction app(view, coll) {\n  const menubar = d3.select('#menubar')\n      .classed('my-1', true);\n  menubar.selectAll('div,span,a').remove();  // Clean up\n  const dialogs = d3.select('#dialogs');\n  dialogs.selectAll('div').remove();  // Clean up\n\n  const state = new DatagridState(view, coll);\n\n  // Datagrid view control\n  const menu = menubar.append('div')\n      .call(button.dropdownMenuButton, 'Menu', 'primary', 'table-white')\n      .select('.dropdown-menu');\n  menu.append('a').call(fieldConfigDialog.menuLink);\n  menu.append('a')\n      .classed('online-command', true)\n      .call(fieldFetchDialog.menuLink);\n  menu.append('a').call(fieldFileDialog.menuLink);\n  menu.append('a').call(fieldInputDialog.menuLink);\n  menu.append('a')\n      .call(button.dropdownMenuItem, 'Generate tile view', 'menu-tiles')\n      .on('click', function () {\n        d3.select('#menubar .loading-circle').style('display', 'inline-block');\n        const viewID = misc.uuidv4().slice(0, 8);\n        return idb.appendView(state.storeID, state.viewID, {\n          $schema: \"https://mojaie.github.io/kiwiii/specs/tile_v1.0.json\",\n          viewID: viewID,\n          name: `${state.name}_tiles`,\n          viewType: 'tile',\n          items: state.rows.collectionID,\n          rowCount: 5,\n          columnCount: 5,\n          tileContent: {field: 'structure', visible: true}\n        }).then(() => {\n          d3.select('#menubar .loading-circle').style('display', 'none');\n          window.open(\n            `tile.html?store=${state.storeID}&view=${viewID}`, '_blank');\n        });\n      });\n  menu.append('a')\n      .classed('online-command', true)\n      .call(networkgenDialog.menuLink);\n  menu.append('a').call(renameDialog.menuLink);\n  menu.append('a')\n      .call(button.dropdownMenuItem, 'Save', 'menu-save')\n      .on('click', function () {\n        return state.save()\n          .then(() => menubar.select('.notify-saved').call(badge.notify));\n      });\n  menu.append('a')\n      .classed('online-command', true)\n      .call(button.dropdownMenuItem, 'Download Excel', 'menu-exportexcel')\n      .on('click', () => {\n        d3.select('#menubar .loading-circle').style('display', 'inline-block');\n        const coll = state.rows.export();\n        const formData = new FormData();\n        formData.append('contents', new Blob([JSON.stringify(coll)]));\n        return fetcher.post('xlsx', formData)\n          .then(fetcher.blob)\n          .then(blob => {\n            d3.select('#menubar .loading-circle').style('display', 'none');\n            hfile.downloadDataFile(blob, `${state.name}.xlsx`);\n          });\n      });\n\n  // Dashboard link\n  menubar.append('a')\n      .call(button.menuButtonLink, 'Dashboard',\n            'outline-secondary', 'status-gray')\n      .attr('href', 'dashboard.html')\n      .attr('target', '_blank');\n\n  // Fetch control\n  menubar.append('a')\n      .classed('refresh', true)\n      .call(button.menuButtonLink,\n            'Refresh', 'outline-secondary', 'refresh-gray')\n      .on('click', function () {\n        d3.select('#menubar .loading-circle').style('display', 'inline-block');\n        return state.rows.pull().then(() => {\n          state.updateContentsNotifier();\n          return updateApp(state);\n        });\n      });\n  menubar.append('a')\n      .classed('abort', true)\n      .call(button.menuButtonLink,\n            'Abort server job', 'warning', 'delete-gray')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', '#abort-dialog');\n\n  // Status\n  menubar.append('span')\n      .classed('loading-circle', true)\n      .call(badge.loadingCircle);\n  menubar.append('span')\n      .classed('notify-saved', true)\n      .call(badge.alert)\n      .call(badge.updateAlert, 'State saved', 'success', 'check-green')\n      .style('display', 'none');\n  menubar.append('span')\n      .classed('name', true);\n  menubar.append('span')\n      .classed('rows-count', true)\n      .call(badge.badge);\n  menubar.append('span')\n      .classed('fetch-status', true)\n      .call(badge.badge);\n  menubar.append('span')\n      .classed('exec-time', true)\n      .call(badge.badge);\n\n  // Dialogs\n  dialogs.append('div')\n      .classed('fieldconfd', true)\n      .call(fieldConfigDialog.body);\n  dialogs.append('div')\n      .classed('fieldfetchd', true)\n      .call(fieldFetchDialog.body);\n  dialogs.append('div')\n      .classed('fieldfiled', true)\n      .call(fieldFileDialog.body);\n  dialogs.append('div')\n      .classed('fieldinputd', true)\n      .call(fieldInputDialog.body);\n  dialogs.append('div')\n      .classed('netgend', true)\n      .call(networkgenDialog.body);\n  dialogs.append('div')\n      .classed('renamed', true)\n      .call(renameDialog.body);\n  dialogs.append('div')\n      .classed('abortd', true)\n      .call(modal.confirmDialog, 'abort-dialog');\n\n  // Contents\n  d3.select('#dg-search')\n      .call(rowf.setFilter, state);\n  d3.select('#datagrid')\n      .call(sort.setSort, state)\n      .call(dg.datagrid, state);\n\n  // Resize window\n  window.onresize = () => {\n    d3.select('#datagrid').call(dg.resize, state)\n      .call(dg.updateViewport, state, state.viewportTop);\n  };\n\n  state.updateContentsNotifier();\n  return updateApp(state);\n}\n\n\nfunction updateApp(state) {\n  // Title\n  d3.select('title').text(state.name);\n\n  // hide fetch commands\n  d3.select('#menubar').selectAll('.refresh, .abort')\n    .style('display', state.rows.ongoing() ? null : 'none');\n\n  // Status\n  d3.select('#menubar .name').text(state.name);\n\n  const onLoading = d3.select('#menubar .loading-circle');\n  const colors = {\n    done: 'green', running: 'darkorange',\n    ready: 'cornflowerblue', queued: 'cornflowerblue',\n    interrupted: 'salmon', aborted: 'salmon', failure: 'salmon'\n  };\n  const icons = {\n    done: 'check-green', running: 'running-darkorange',\n    ready: 'clock-cornflowerblue', queued: 'clock-cornflowerblue',\n    interrupted: 'caution-salmon', aborted: 'caution-salmon',\n    failure: 'caution-salmon'\n  };\n  const fstatus = state.rows.status();\n  const fstext = fstatus === 'done' ?\n    fstatus : `${fstatus} ${state.rows.progress()}%`;\n  d3.select('#menubar .rows-count')\n      .call(badge.updateBadge, `${state.rows.size()} rows`,\n            'light', 'table-gray')\n    .select('.text')\n      .style('color', 'gray');\n  d3.select('#menubar .fetch-status')\n      .call(badge.updateBadge, fstext, 'light', icons[fstatus])\n    .select('.text')\n      .style('color', colors[fstatus]);\n  d3.select('#menubar .exec-time')\n      .call(badge.updateBadge, `${state.rows.execTime()} seconds`,\n            'light', 'clock-cornflowerblue')\n    .select('.text')\n      .style('color', 'cornflowerblue');\n\n\n  // Dialogs\n  const dialogs = d3.select('#dialogs');\n\n  // Field config dialog\n  dialogs.select('.fieldconfd')\n      .call(fieldConfigDialog.updateBody, state.rows.fields)\n      .on('submit', function () {\n        const values = fieldConfigDialog.value(d3.select(this));\n        state.updateFields(values);\n        state.updateContentsNotifier();\n        return updateApp(state);\n      });\n\n  // Import fields dialog\n  dialogs.select('.fieldfiled')\n      .call(fieldFileDialog.updateBody, state.visibleFields)\n      .on('submit', function () {\n        return fieldFileDialog.readFile(d3.select(this))\n          .then(data => {\n            state.joinFields(data);\n            state.updateContentsNotifier();\n            return updateApp(state);\n          });\n      });\n\n  // Input field dialog\n  dialogs.select('.fieldinputd')\n      .call(fieldInputDialog.updateBody, state.rows.fields)\n      .on('submit', function () {\n        const values = fieldInputDialog.value(d3.select(this));\n        state.rows.addField(values.field);\n        state.rows.apply(rcd => {\n          rcd[values.field.key] = values.converter(rcd);\n        });\n        state.updateContentsNotifier();\n        return updateApp(state);\n      });\n  // Rename dialog\n  dialogs.select('.renamed')\n      .call(renameDialog.updateBody, state.name)\n      .on('submit', function () {\n        state.name = renameDialog.value(d3.select(this));\n        return updateApp(state);\n  });\n\n\n  // Server bound tasks\n  return fetcher.serverStatus().then(response => {\n    // Fetch db fields dialog\n    dialogs.select('.fieldfetchd')\n        .call(fieldFetchDialog.updateBody, response.schema, state.rows.fields)\n        .on('submit', function () {\n          const compounds = state.rows.records().map(e => e.compound_id);\n          return fieldFetchDialog\n            .execute(d3.select(this), compounds, response.schema)\n            .then(res => {\n              state.joinFields(res);\n              state.updateContentsNotifier();\n              return updateApp(state);\n            });\n        });\n\n    // Network generation dialog\n    dialogs.select('.netgend')\n        .call(networkgenDialog.updateBody, response.server.rdkit)\n        .on('submit', function () {\n          return networkgenDialog\n            .execute(d3.select(this), state.rows.records())\n            .then(data => {\n              return idb.newNetwork(\n                state.storeID, state.rows.collectionID, state.name, data\n              );\n            })\n            .then(viewID => {\n              onLoading.style('display', 'none');\n              window.open(\n                `network.html?store=${state.storeID}&view=${viewID}`, '_blank');\n            });\n        });\n\n    // Abort dialog\n    dialogs.select('.abortd')\n        .call(modal.updateConfirmDialog,\n              'Are you sure you want to abort this calculation job?')\n        .on('submit', function () {\n          return state.rows.abort().then(() => {\n            state.updateContentsNotifier();\n            return updateApp(state);\n          });\n        });\n  })\n  .catch(() => {\n    // disable on-line commands\n    d3.select('#menubar').selectAll('.online-command')\n      .attr('data-target', null)\n      .classed('disabled', true)\n      .on('click', null);\n  })\n  .finally(() => {\n    // disable commands when no records are found\n    if (!state.rows.size()) {\n      d3.select('#menubar').selectAll('.online-command')\n        .attr('data-target', null)\n        .classed('disabled', true)\n        .on('click', null);\n    }\n    onLoading.style('display', 'none');\n  });\n}\n\nfunction run() {\n  const err = client.compatibility();\n  if (err) {\n    d3.select('body')\n      .style('color', '#ff0000')\n      .text(err);\n    return;\n  }\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";  // TODO\n  const offLine = 'onLine' in navigator && !navigator.onLine;  // TODO\n  client.registerServiceWorker();\n  const storeID = client.URLQuery().store || null;\n  const viewID = client.URLQuery().view || null;\n  return idb.getView(storeID, viewID)\n    .then(view => {\n      if (!view) throw('ERROR: invalid URL');\n      view.storeID = storeID;\n      return idb.getCollection(storeID, view.rows)\n        .then(coll => app(view, coll));\n    })\n    .catch(err => {\n      console.error(err);\n      d3.select('#datagrid')\n        .style('color', 'red')\n        .text(err);\n    });\n}\n\n\nexport default {\n  run\n};\n"],"names":["URLQuery","pairs","window","location","search","substring","split","map","e","_","fromPairs","compatibility","registerServiceWorker","navigator","debug","console","info","addEventListener","serviceWorker","register","baseURL","get","url","query","q","Object","keys","length","JSON","stringify","fetch","credentials","then","res","status","Promise","reject","Error","statusText","resolve","json","response","text","blob","post","formdata","method","body","error","err","serverStatus","server","schema","readFile","file","sizeLimit","reader","FileReader","truncated","slice","onload","event","target","result","onerror","readAsArrayBuffer","readAsText","parseJSON","data","compressed","pako","inflate","to","parse","downloadDataFile","name","URL","createObjectURL","Blob","a","document","createElement","download","href","dispatchEvent","MouseEvent","view","bubbles","cancelable","loadJSON","endsWith","fetchJSON","decoded","decodeURIComponent","arrayBuffer","downloadJSON","compress","str","gzip","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","d3","format","partialMatch","toString","toUpperCase","indexOf","uuidv4","replace","c","r","Math","random","statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","fields","columns","sort","id","dataType","schemaVersion","revision","records","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v10_nodes","reference","convertNetwork","edges","hasOwnProperty","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","key","column","domain","range","unknown","size","visible","nodeContent","structure","label","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","forEach","i","index","_structure","_index","source","v08_graph","nodeContentVisible","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","$schema","convertPackage","specs","now","Date","isNW","v08_nodes","width","height","convertTable","views","dataset","push","collectionID","contents","workflowID","workflow","viewID","viewType","rows","sortOrder","filterText","checkpoints","type","date","description","networkThresholdCutoff","filter","minConnThld","currentConnThld","edgeColor","color","edgeLabelColor","items","idb","Dexie","getAllItems","orderBy","reverse","toArray","updateItem","storeID","updateFunc","where","equals","modify","catch","version","stores","reset","delete","getItem","first","deleteItem","getView","appendView","viewObj","item","pos","findIndex","splice","updateView","isFunction","deleteView","bin","entries","entry","getAllCollections","flatten","coll","getCollection","collID","colls","updateCollection","collObj","importItem","legacy","misc","sessionStarted","put","newDatagrid","toLocaleString","timeZone","newNetwork","nodesName","edgesID","assetBaseURL","iconBaseURL","icon","selection","append","attr","style","badge","classed","updateBadge","select","notify","transition","duration","ease","easeLinear","delay","on","loadingCircle","alert","updateAlert","buttonBox","menuButton","menuButtonLink","menuModalLink","dropdownMenuButton","button","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","this","node","click","dropdownMenuFileValue","files","dialogBase","confirmDialog","base","call","footer","dispatch","updateConfirmDialog","message","submitDialog","title","header","html","$","modal","colorScales","colors","schemePaired","concat","schemeSet2","schemePastel2","schemeSet3","types","func","scaleLinear","scaleLog","scaleQuantize","scaleOrdinal","scaleFunction","state","cscale","mid","scaleFunc","clamp","d","undefined","isD3Format","notation","singleToMulti","mapping","newMapping","m","mappingToTable","mp","rcd","f","tableToMapping","table","ignore","row","csvToMapping","csvString","lines","shift","headerIdx","h","line","values","k","Array","apply","fd","uniqBy","Collection","[object Object]","autoIndex","content","addField","fs","mapper","command","fetcher","all","sum","some","min","updateHeader","selectAll","remove","visibleFields","enter","headerCellRenderer","updateRows","recordsToShow","keyFunc","exit","merge","rowHeight","each","rowIndex","viewportTop","rowPos","rowFactory","updateViewport","scrollPos","bodyHeight","setScrollPosition","scrollTop","resize","viewport","getBoundingClientRect","top","resizeViewport","innerHeight","viewportHeight","datagrid","floor","previousViewportTop","updateContentsNotifier","applyHeader","applyData","updateFilterNotifier","setFilterText","plotCell","record","vega","View","initialize","run","plotThumbnail","vegaSpec","toImageURL","binaryToDataURI","binary","readAsDataURL","d3Format","d3_format","compound_id","image","checkbox","property","disabled","checked","textField","cellFunc","numeric","raw","assay_id","list","plot","img","text_field","control","svg","rowCell","cell","DatagridState","sortedRecords","filteredRecords","defaultColumnHeight","none","scrollBarSpace","numViewportRows","viewportBottom","fixedViewportHeight","component","factory","position","ceil","setViewportSize","setNumViewportRows","widthfSum","reduce","widthf","assign","b","applyOrder","order","orders","applyFilter","ki","obj","updateFields","joinFields","ci","export","vi","numberBoxIntValue","parseInt","numberBoxFloatValue","textBox","updateTextBox","textBoxValue","readonlyBox","textareaBox","updateTextareaBox","updateTextareaPlaceholder","placeholder","textareaBoxValue","textareaBoxLines","checkBox","box","updateCheckBox","checkBoxValue","numberBox","max","step","updateNumberBox","numberIntValid","valid","numberFloatValid","colorBox","stopPropagation","updateColorBox","colorBoxValue","fileInputBox","clearFileInput","fileInputBoxValue","setFilter","searchBox","setSort","isAsc","setSortOrder","datum","filterTable","rowf","filterSortTable","update","updateRecords","tableRecords","extra","options","menuLink","dialog","updateBody","dgfields","d3fValid","every","n","assays","resources","flatMap","assay","value_types","copy","value_type","done","__origin","check","check_d","anyChecked","execute","compounds","targets","queries","condition","merged","monocolorBar","group","colorBar","monocolor","bicolor","grad","tricolor","categorical","sw","custom","setSize","checklistBoxValue","setSelectedColorScale","selected","shape","selectBox","selectBoxItems","updateSelectBox","selectBoxValue","checklistBox","checklistBoxItems","listitems","form","updateChecklistBox","colorScaleBox","dropdown","colorScaleBoxItems","updateColorScaleBox","colorScaleBoxValue","colorScaleBoxItem","lbox","leftFields","leftDefault","isCsv","pop","hfile","tbl","fileSelected","left","plotCols","ps","p","himg","formatterGen","template","tmp","parseInner","arr","inner","match","outer","ic","oc","txtarr","join","keyValid","tmpFields","cont","contEmpty","contOuter","contInner","contInvalidKey","ns","contInvalidFormat","contValid","coid","tmpBox","collapse","frcd","converter","queryMolGroupValue","textquery","areaquery","queryMolGroup","popover","trigger","updateQueryMolGroup","queryMolGroupValid","simOptionGroup","updateSimOptionGroup","simOptionGroupValue","timeout","diam","ignoreHs","diameter","rdk","measures","rcds","measure","thld","formData","FormData","updateApp","ongoing","onLoading","fstatus","fstext","running","ready","queued","interrupted","aborted","failure","dialogs","fieldConfigDialog","fieldFileDialog","fieldInputDialog","renameDialog","fieldFetchDialog","networkgenDialog","rdkit","open","abort","finally","client","protocol","onLine","store","menubar","menu","rowCount","columnCount","tileContent","save","pull","dg","onresize","app"],"mappings":"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"}