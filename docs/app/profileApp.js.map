{"version":3,"file":"profileApp.js","sources":["../../src/common/client.js","../../src/common/fetcher.js","../../src/component/button.js","../../src/common/misc.js","../../src/common/legacySchema.js","../../src/common/idb.js","../../src/common/mapper.js","../../src/common/collection.js","../../src/datagrid/component.js","../../src/datagrid/rowFactory.js","../../src/common/image.js","../../src/datagrid/state.js","../../src/component/formBox.js","../../src/datagrid/rowFilter.js","../../src/datagrid/sort.js","../../src/datagrid/table.js","../../src/profileApp.js"],"sourcesContent":["\n/** @module common/client */\n\nimport _ from 'lodash';\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\nfunction compatibility() {\n  try {\n    () => {};\n  } catch (err) {\n    return 'Client compatibility error: Arrow function not supported';\n  }\n  try {\n    FormData;\n  } catch (err) {\n    return 'Client compatibility error: FormData not supported';\n  }\n  try {\n    fetch;\n  } catch (err) {\n    return 'Client compatibility error: fetch API not supported';\n  }\n}\n\n\nfunction registerServiceWorker() {\n  if ('serviceWorker' in navigator) {\n    window.addEventListener('load', () => {\n      navigator.serviceWorker.register('../sw.js');  // TODO: root path option\n    });\n  } else {\n    console.info('Service worker is not supported');\n  }\n}\n\nexport default {\n  URLQuery, compatibility, registerServiceWorker\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '../req/';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\nfunction serverStatus() {\n  const response = {};\n  return get('server')\n    .then(json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => get('schema'))\n    .then(json)\n    .then(res => {\n      response.schema = res;\n    })\n    .then(() => response);\n}\n\n\nexport default {\n  get, json, text, blob, post, error, serverStatus\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction buttonBox(selection, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .text(label);\n}\n\n\nfunction menuButton(selection, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, target, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('label', true)\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, label, type, icon) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  const button = selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  button.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  button.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, label, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, label, target, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, label, accept, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      });\n  selection.append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  iconBaseURL, buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\n\n\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  sortType, formatNum, partialMatch, uuidv4\n};\n","\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: [\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ],\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nfunction convertPackage(json) {\n  if (json.hasOwnProperty('views')) return json;\n  const now = new Date();\n  const isNW = json.hasOwnProperty('edges');\n  const data = isNW ? convertNetwork(json) : convertTable(json);\n  const nodes = isNW ? data.nodes : data;\n  const specs = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    name: data.edges.name,\n    views: [],\n    dataset: []\n  };\n  specs.dataset.push({\n    $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n    collectionID: nodes.id,\n    name: nodes.name,\n    contents: [{\n      $schema: nodes.$schema,\n      workflowID: nodes.reference.workflow,\n      name: nodes.name,\n      fields: nodes.fields,\n      records: nodes.records,\n      created: nodes.created,\n      status: nodes.status,\n      query: nodes.query,\n      execTime: nodes.execTime,\n      progress: nodes.progress\n    }]\n  });\n  specs.views.push({\n    $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n    viewID: nodes.id,\n    name: nodes.name,\n    viewType: \"datagrid\",\n    rows: nodes.id,\n    fields: nodes.fields,\n    sortOrder: null,\n    filterText: null,\n    checkpoints: [{\n      type: 'convert',\n      date: now.toString(),\n      description: 'converted from legacy format'\n    }]\n  });\n  if (isNW) {\n    specs.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: data.edges.id,\n      name: data.edges.name,\n      contents: [{\n        $schema: data.edges.$schema,\n        workflowID: data.edges.reference.workflow,\n        name: data.edges.name,\n        fields: data.edges.fields,\n        records: data.edges.records,\n        created: data.edges.created,\n        status: data.edges.status,\n        query: data.edges.query,\n        execTime: data.edges.execTime,\n        progress: data.edges.progress\n      }]\n    });\n    specs.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: data.edges.id,\n      name: data.edges.name,\n      viewType: \"network\",\n      nodes: nodes.id,\n      edges: data.edges.id,\n      nodeColor: data.edges.snapshot.nodeColor,\n      nodeSize: data.edges.snapshot.nodeSize,\n      nodeLabel: data.edges.snapshot.nodeLabel,\n      nodeLabelColor: data.edges.snapshot.nodeLabelColor,\n      edgeWidth: data.edges.snapshot.edgeWidth,\n      edgeLabel: data.edges.snapshot.edgeLabel,\n      networkThreshold: data.edges.snapshot.networkThreshold,\n      networkThresholdCutoff: data.edges.snapshot.networkThresholdCutoff,\n      fieldTransform: data.edges.snapshot.fieldTransform,\n      coords: data.edges.snapshot.coords,\n      checkpoints: [{\n        type: 'convert',\n        date: now.toString(),\n        description: 'converted from legacy format'\n      }]\n    });\n  }\n  specs.views.filter(e => e.viewType === 'network')\n    .forEach(view => {\n      view.minConnThld = view.networkThresholdCutoff;\n      view.currentConnThld = view.networkThreshold;\n      if (view.hasOwnProperty('nodeLabel')) {\n        view.nodeLabel.field = view.nodeLabel.text;\n      }\n      if (view.hasOwnProperty('edgeLabel')) {\n        view.edgeLabel.field = 'weight';\n      }\n      if (view.hasOwnProperty('edgeWidth')) {\n        view.edgeWidth.field = 'weight';\n      }\n    });\n  return specs;\n}\n\n\nexport default {\n  convertPackage\n};\n","\n/** @module common/idb */\n\nimport _ from 'lodash';\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\nimport {default as legacy} from './legacySchema.js';\n\n// TODO: need package, view and dataset tables?\nconst schema = {\n  items: 'storeID, sessionStarted'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('sessionStarted')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction importItem(data) {\n  // Legacy format converter\n  if (!data.hasOwnProperty('views')) {\n    data = legacy.convertPackage(data);\n  }\n  const now = new Date();\n  data.storeID = misc.uuidv4().slice(0, 8);\n  data.sessionStarted = now.toString();\n  return idb.items.put(data);\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} response - response data\n * @return {string} - viewID if sucessfully added\n */\nfunction newDatagrid(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const storeID = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    storeID: storeID,\n    name: viewID,  // TODO: generate from response.query\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n        viewID: viewID,\n        name: viewID,  // TODO: generate from response.query\n        viewType: \"datagrid\",\n        rows: collectionID,\n        checkpoints: [\n          {type: 'creation', date: date}\n        ]\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return idb.items.put(data)\n    .then(() => ({storeID: storeID, viewID:viewID}));\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Returns a view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @return {array} view objects\n */\nfunction getView(storeID, viewID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).views)\n    .then(views => {\n      const view = views.find(e => e.viewID === viewID);\n      if (!view) return;\n      view.storeID = storeID;\n      return view;\n    });\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object\n */\nfunction appendView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos + 1, 0, viewObj);\n  });\n}\n\n\n/**\n * Update view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object or update function\n */\nfunction updateView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    if (_.isFunction(viewObj)) {\n      viewObj(item.views[pos]);\n    } else {\n      item.views[pos] = viewObj;\n    }\n  });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteView(storeID, viewID) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos, 1);\n    // prune orphaned collections\n    const bin = {};\n    item.dataset.forEach(e => { bin[e.collectionID] = 0; });\n    item.views.forEach(view => {\n      ['rows', 'items', 'nodes', 'edges']\n        .filter(e => view.hasOwnProperty(e))\n        .forEach(e => { bin[view[e]] += 1; });\n    });\n    Object.entries(bin).forEach(entry => {\n      if (!entry[1]) {\n        const i = item.dataset.findIndex(e => e.collectionID === entry[0]);\n        item.dataset.splice(i, 1);\n      }\n    });\n  });\n}\n\n\n/**\n * Returns a collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @return {array} Collection objects\n */\nfunction getCollection(storeID, collID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).dataset)\n    .then(colls => {\n      const coll = colls.find(e => e.collectionID === collID);\n      if (!coll) return;\n      coll.storeID = storeID;\n      return coll;\n    });\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object\n */\nfunction appendCollection(storeID, collID, collObj) {\n  return updateItem(storeID, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    item.dataset.splice(pos + 1, 0, collObj);\n  });\n}\n\n\n/**\n * Update collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object or update function\n */\nfunction updateCollection(storeID, collID, collObj) {\n  return updateItem(storeID, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    if (_.isFunction(collObj)) {\n      collObj(item.dataset[pos]);\n    } else {\n      item.dataset[pos] = collObj;\n    }\n  });\n}\n\n\nexport default {\n  reset, getAllItems, getItem, importItem, newDatagrid, updateItem, deleteItem,\n  getView, appendView, updateView, deleteView,\n  getCollection, appendCollection, updateCollection\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: [keyField].concat(mp.fields),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: table.fields.filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key)),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: fields,\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(mp.fields)\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/collection */\n\nimport _ from 'lodash';\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as mapper} from './mapper.js';\n\n\nexport default class Collection {\n  /**\n   * Create Collection from a flashflood response datatable\n   * If data is not specified, put datatables later by this.append(data)\n   * @param {object} coll - Collection or response object\n   */\n  constructor(coll) {\n    // Settings\n    this.autoIndex = 'index';  // enumerate records\n\n    this.collectionID = coll.collectionID || null;\n    this.storeID = coll.storeID || null;\n    this.name = coll.name || null;\n    this.contents = coll.contents || [coll];\n    this.fields = [];\n    this.contents.forEach(content => {\n      content.fields.forEach(e => this.addField(e));\n    });\n  }\n\n  /**\n   * Add fields\n   * @param {array} fs - list of fields\n   */\n  addField(field) {\n    if (this.fields.find(e => e.key === field.key)) return;\n    if (!field.hasOwnProperty('name')) field.name = field.key;\n    if (!field.hasOwnProperty('visible')) field.visible = true;\n    if (field.hasOwnProperty('d3_format')) field.format = 'd3_format';\n    if (!field.hasOwnProperty('format')) field.format = 'raw';\n    this.fields.push(field);\n  }\n\n  /**\n   * Update fields properties\n   * @param {array} fs - list of fields\n   */\n  updateFields(fs) {\n    this.fields = [];\n    fs.forEach(e => this.addField(e));\n  }\n\n  /**\n   * Join fields\n   * @param {object} mapping - column mapper object\n   */\n  joinFields(mapping) {\n    this.contents.forEach(c => {\n      mapper.apply(c, mapping);\n    });\n    if (mapping.hasOwnProperty('fields')) {\n      mapping.fields.forEach(e => this.addField(e));\n    } else {\n      this.addField(mapping.field);\n    }\n  }\n\n  /**\n   * Return all records of the collection\n   * @return {array} records\n   */\n  records() {\n    return _.flatten(this.contents.map(e => e.records));\n  }\n\n  fetch(command) {\n    const fs = this.contents\n      .filter(e => ['running', 'ready', 'interrupted', 'queued'].includes(e.status))\n      .map(content => {\n        const query = {id: content.workflowID, command: command};\n        return fetcher.get('progress', query)\n          .then(fetcher.json)\n          .then(data => {\n            return idb.updateCollection(this.storeID, this.collectionID, coll => {\n              const i = coll.contents\n                .findIndex(e => e.workflowID === query.id);\n              if (data.status === 'failure') {  // No data found on server\n                coll.contents[i].status = 'failure';\n              } else {\n                coll.contents[i] = data;\n              }\n            });\n          });\n      });\n    return Promise.all(fs)\n      .then(() => idb.getCollection(this.storeID, this.collectionID))\n      .then(coll => {\n        this.contents = coll.contents;\n      });\n  }\n\n  /**\n   * Retrieve workflows and store it into a local store.\n   * @return {Promise}\n   */\n  pull() {\n    return this.fetch('pull');\n  }\n\n  /**\n   * Retrieve workflows, abort all ongoing workflow task\n   * and store it into a local store.\n   * @return {Promise}\n   */\n  abort() {\n    return this.fetch('abort');\n  }\n\n  /**\n   * Return total number of records\n   * @return {float} total number of records\n   */\n  size() {\n    return _.sum(this.contents.map(e => e.records.length));\n  }\n\n  /**\n   * Return status\n   * @return {string} status\n   */\n  status() {\n    if (this.contents.some(e => e.status === 'interrupted')) return 'interrupted';\n    if (this.contents.some(e => e.status === 'running')) return 'running';\n    if (this.contents.some(e => e.status === 'queued')) return 'queued';\n    if (this.contents.some(e => e.status === 'ready')) return 'ready';\n    if (this.contents.some(e => e.status === 'aborted')) return 'aborted';\n    if (this.contents.some(e => e.status === 'failure')) return 'failure';\n    return 'done';\n  }\n\n  /**\n   * Return ongoing or not\n   * @return {bool} ongoing or not\n   */\n  ongoing() {\n    const s = ['ready', 'queued', 'running', 'interrupted'];\n    return s.includes(this.status());\n  }\n\n  /**\n   * Return percentage of workflow progress\n   * @return {float} progress in percent\n   */\n  progress() {\n    return _.min(this.contents.map(e => e.progress));\n  }\n\n  /**\n   * Return total execution time\n   * @return {float} total time\n   */\n  execTime() {\n    return _.sum(this.contents.map(e => e.execTime));\n  }\n\n  /**\n   * Export collection object as JSON\n   * @return {object} collection JSON\n   */\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: this.collectionID,\n      name: this.name,\n      fields: this.fields,\n      contents: this.contents\n    };\n  }\n}\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction headerCellRenderer(header) {\n  header.style('display', 'inline-block')\n    .style('width', d => `${d.width}%`)\n    .text(d => d.name);\n}\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .call(state.headerCellRenderer);\n}\n\n\nfunction updateRows(selection, state) {\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.selectAll('.dg-cell').remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', 'absolute')\n      .style('width', '100%')\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0)\n          .call(state.rowFactory(), d);\n      });\n}\n\n\nfunction updateViewport(selection, state, scrollPos) {\n  selection.select('.dg-body').style('height', `${state.bodyHeight}px`);\n  state.setScrollPosition(scrollPos);\n  selection.call(updateRows, state, scrollPos);\n  selection.select('.dg-viewport').node().scrollTop = scrollPos * state.rowHeight;\n}\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.resizeViewport(window.innerHeight - viewportTop - 5);\n  viewport.style('height', `${state.viewportHeight}px`);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(updateRows, state, pos);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyHeader();\n    selection.call(updateHeader, state);\n    selection.call(resize, state);\n    state.applyData();\n    selection.call(updateViewport, state, state.viewportTop);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    selection.call(updateViewport, state, 0);\n  };\n  state.updateContentsNotifier();  // TODO: remove\n}\n\n\n\nexport default {\n  headerCellRenderer, updateHeader, updateRows, updateViewport,\n  resize, datagrid\n};\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction date(selection, record, field) {\n  // TODO; formatter\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  selection.html(record[field.key]);\n}\n\n\nfunction compound_id(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n}\n\nfunction textField(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'text')\n      .style('width', '90%')\n      .property('value', record[field.key])\n      .on('change', function () {\n        record[field.key] = this.value;\n      });\n}\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  date: date,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compound_id,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  text_field: textField,\n  control: call,\n  svg: html,\n  html: html\n};\n\n\nfunction rowCell(selection) {\n  selection.classed('dg-cell', true)\n    .classed('align-middle', true)\n    .classed('text-truncate', true)\n    .style('display', 'inline-block');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n          .call(rowCell)\n          .style('width', `${field.width}%`);\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compound_id, image, checkbox, textField, call,\n  rowCell, rowFactory\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nfunction binaryToDataURI(binary) {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      resolve(event.target.result);\n    };\n    reader.readAsDataURL(binary);\n  });\n}\n\n\nexport default {\n  plotCell, plotThumbnail, binaryToDataURI\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport Collection from '../common/collection.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as component} from './component.js';\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(view, coll) {\n    this.storeID = view.storeID || null;\n    this.viewID = view.viewID || null;\n    this.name = view.name || null;\n    this.sortOrder = view.sortOrder || [];\n    this.filterText = view.filterText || null;\n    this.rows = new Collection(coll);\n\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    // TODO: auto adjust\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.viewportTop = 0;\n    this.previousViewportTop = null;\n    this.viewportBottom = null;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.headerCellRenderer = component.headerCellRenderer;\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n  }\n\n  /**\n   * Set viewport height and number of rows to show\n   * @param {int} height - viewport height\n   */\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n  }\n\n  /**\n   * Set range of the row indices to show\n   * @param {int} position - Index of the top row to show\n   */\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setNumViewportRows() {\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  resizeViewport(height) {\n    this.setViewportSize(height);\n    this.setNumViewportRows();\n  }\n\n  /**\n   * Apply header data\n   */\n  applyHeader() {\n    this.visibleFields = this.rows.fields.filter(e => e.visible);\n    const widthfSum = this.visibleFields.reduce((a, c) => a + (c.widthf || 1), 0);\n    this.visibleFields = this.visibleFields.map(e => {\n      const field = {\n        width: (e.widthf || 1) / widthfSum * 100,\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b, 0).height;\n  }\n\n  /**\n   * Apply row data\n   * 1. applyHeader: define fields and set rowHeight\n   * 2. resize: measure actual window size and calc viewportHeight\n   * 3. applyData: calc number of rows from rowHeight and viewportHeight\n   * 4. setScrollPosition: calc row index range\n   * 5. recordsToShow: slice rows to show\n   */\n  applyData() {\n    this.setNumViewportRows();\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.rows.records().slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.rows.records().slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  updateFields(fs) {\n    this.rows.updateFields(fs);\n  }\n\n  joinFields(mapping) {\n    this.rows.joinFields(mapping);\n    this.applyData();\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  save() {\n    return idb.updateItem(this.storeID, item => {\n      const ci = item.dataset\n        .findIndex(e => e.collectionID === this.rows.collectionID);\n      item.dataset[ci] = this.rows.export();\n      const vi = item.views.findIndex(e => e.viewID === this.viewID);\n      item.views[vi] = this.export();\n    });\n  }\n\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: this.viewID,\n      name: this.name,\n      viewType: \"datagrid\",\n      rows: this.rows.collectionID,\n      sortOrder: this.sortOrder,\n      filterText: this.filterText\n    };\n  }\n}\n","\n/** @module component/formBox */\n\n\nimport d3 from 'd3';\n\n\nfunction textBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text');\n}\n\nfunction updateTextBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction textBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction readonlyBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .property('readonly', true);\n}\n\n\nfunction textareaBox(selection, label, rows) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows);\n}\n\nfunction updateTextareaBox(selection, value) {\n  selection.select('textarea').property('value', value);\n}\n\nfunction updateTextareaPlaceholder(selection, placeholder) {\n  selection.select('textarea').attr('placeholder', placeholder);\n}\n\nfunction textareaBoxValue(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value;  // TODO: 0 is falsy\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder;\n  return '';\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n').filter(e => e.length > 0);\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder.split('\\n').filter(e => e.length > 0);\n  return [];\n}\n\n\nfunction checkBox(selection, label) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox');\n  box.append('span')\n      .text(label);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, label, min, max, step) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'number')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step);\n}\n\nfunction updateNumberBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction numberFloatValid(selection) {\n  const value = numberBoxFloatValue(selection);\n  const min = parseInt(selection.select('input').attr('min'));\n  const max = parseInt(selection.select('input').attr('max'));\n  const valid = !isNaN(value) && value >= min && value <= max;\n  selection.select('input')\n      .style('background-color', valid ? '#ffffff' : '#ffcccc');\n  return valid;\n}\n\nfunction numberBoxIntValue(selection) {\n  return parseInt(selection.select('input').property('value'));\n}\n\nfunction numberBoxFloatValue(selection) {\n  return parseFloat(selection.select('input').property('value'));\n}\n\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n}\n\n\nfunction updateColorBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\n\nfunction colorBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction fileInputBox(selection, label, accept) {\nselection\n    .classed('form-group', true)\n    .classed('form-row', true);\nselection.append('label')\n    .classed('col-form-label', true)\n    .classed('col-form-label-sm', true)\n    .classed('col-4', true)\n    .text(label);\nselection.append('input')\n    .classed('form-control', true)\n    .classed('form-control-sm', true)\n    .classed('form-control-file', true)\n    .classed('col-8', true)\n    .attr('type', 'file')\n    .attr('accept', accept);\n}\n\nfunction clearFileInput(selection) {\n  // TODO: FileList object (input.files) may be a readonly property\n  const accept = selection.select('input').attr();\n  selection.select('input').remove();\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('form-control-file', true)\n      .classed('col-8', true)\n      .attr('type', 'file')\n      .attr('accept', accept);\n}\n\nfunction fileInputBoxValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\n\nexport default {\n  textBox, updateTextBox, textBoxValue, readonlyBox,\n  textareaBox, updateTextareaBox, updateTextareaPlaceholder,\n  textareaBoxValue, textareaBoxLines,\n  checkBox, updateCheckBox, checkBoxValue,\n  numberBox, updateNumberBox, numberFloatValid,\n  numberBoxIntValue, numberBoxFloatValue,\n  colorBox, updateColorBox, colorBoxValue,\n  fileInputBox, clearFileInput, fileInputBoxValue\n};\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, 'Search');\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.textBoxValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction setSort(selection, state) {\n  state.headerCellRenderer = header => {\n    header.style('display', 'inline-block')\n      .style('width', d => `${d.width}%`)\n      .text(d => d.name)\n      .filter(d => misc.sortType(d.format) !== 'none')\n      .append('span').append('a')\n        .attr('id', d => `sort-${d.key}`)\n        .text('^v')\n        .style('display', 'inline-block')\n        .style('width', '30px')\n        .style('text-align', 'center')\n      .on('click', d => {\n        const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n        d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n        state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n        selection.call(component.updateRows, state);\n      });\n  };\n}\n\n\nexport default {\n  setSort\n};\n","\n/** @module datagrid/table */\n\nimport Collection from '../common/collection.js';\n\nimport DatagridState from './state.js';\nimport {default as component} from './component.js';\nimport {default as rowf} from './rowFilter.js';\nimport {default as sort} from './sort.js';\n\n\nfunction table(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  state.keyFunc = d => d;\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterSortTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(sort.setSort, state)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction update(selection, fields, records) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = selection.datum();\n  state.rows = new Collection(data);\n  state.updateContentsNotifier();\n}\n\n\nfunction updateRecords(selection, records) {\n  const state = selection.datum();\n  state.rows.contents[0].records = records;\n  state.updateContentsNotifier();\n}\n\n\nfunction tableRecords(selection) {\n  const state = selection.datum();\n  return state.rows.records();\n}\n\n\nexport default {\n  table, filterTable, filterSortTable, update, updateRecords, tableRecords\n};\n","\n/** @module profile */\n\nimport d3 from 'd3';\n\nimport {default as client} from './common/client.js';\nimport {default as fetcher} from './common/fetcher.js';\n\nimport {default as button} from './component/button.js';\n\nimport {default as table} from './datagrid/table.js';\n\n\nfunction fetchProfile(compoundID, resources) {\n  const profile = {};\n  // Compound properties\n  const cmpdQuery = {\n    workflow: 'search',\n    targets: resources.filter(e => e.domain === 'chemical').map(e => e.id),\n    key: 'compound_id',\n    values: [compoundID]\n  };\n  return fetcher.get(cmpdQuery.workflow, cmpdQuery)\n    .then(fetcher.json)\n    .then(res => {\n      profile.compound = {\n        fields: [\n          {key: 'key', name: 'key', format: 'text'},\n          {key: 'value', name: 'value', format: 'text'}\n        ],\n        records: [\n          {key: 'Formula', value: res.records[0]._formula},\n          {key: 'Molecular weight', value: res.records[0]._mw},\n          {key: 'Wildman-Crippen logP', value: res.records[0]._logp},\n          {key: 'Non-hydrogen atom count', value: res.records[0]._nonH}\n        ]\n      };\n      profile.cid = res.records[0].compound_id;\n      profile.name = res.records[0].name;\n      profile.src = res.records[0].__source;\n      profile.struct = res.records[0].structure;\n    })\n    .then(() => {\n      const aliasQuery = {\n        workflow: 'exact',\n        targets: resources.filter(e => e.domain === 'chemical').map(e => e.id),\n        queryMol: {\n          format: 'dbid',\n          source: profile.src,\n          value: profile.cid\n        },\n        params: {ignoreHs: true}\n      };\n      return fetcher.get(aliasQuery.workflow, aliasQuery);\n    })\n    .then(fetcher.json)\n    .then(res => {\n      profile.aliases = res;\n      profile.aliases.fields = [\n        {key: 'index', name: 'Index', format: 'd3_format', d3_format: 'd'},\n        {key: 'compound_id', name: 'Compound ID', format: 'compound_id'},\n        {key: 'name', name: 'Name', format: 'text'},\n        {key: '__source', name: 'Source', format: 'text'}\n      ];\n    })\n    .then(() => {\n      const assayQuery = {\n        workflow: 'profile',\n        compound_id: compoundID,\n        targets: resources.filter(e => e.domain === 'activity').map(e => e.id),\n      };\n      return fetcher.get(assayQuery.workflow, assayQuery);\n    })\n    .then(fetcher.json)\n    .then(res => {\n      profile.assays = res;\n      profile.assays.fields = [\n        {key: 'index', name: 'Index', format: 'd3_format', d3_format: 'd'},\n        {key: 'assay_id', name: 'Assay ID', format: 'assay_id'},\n        {key: 'value_type', name: 'Value type', format: 'text'},\n        {key: 'value', name: 'Value', format: 'numeric'}\n      ];\n      return profile;\n    });\n}\n\n\nfunction render(compoundID) {\n  fetcher.get('schema')\n    .then(fetcher.json)\n    .then(schema => fetchProfile(compoundID, schema.resources))\n    .catch(() => {\n      console.info('Server did not respond');\n      return {\n        aliases: {},\n        assays: {},\n        compound: {}\n      };\n    })\n    .then(res => {\n      const contents = d3.select('#contents')\n          .style('padding-left', '10%')\n          .style('padding-right', '10%');\n      contents.append('h2').classed('mt-5', true).text('Compound ID');\n      contents.append('div').classed('mb-5', true).text(res.cid);\n      contents.append('h2').classed('mt-5', true).text('Name');\n      contents.append('div').classed('mb-5', true).text(res.name);\n      contents.append('h2').classed('mt-5', true).text('Source');\n      contents.append('div').classed('mb-5', true).text(res.src);\n      contents.append('h2').classed('mt-5', true).text('Structure');\n      contents.append('div').classed('mb-5', true).html(res.struct);\n\n      contents.append('h2').classed('mt-5', true).text('Chemical properties');\n      contents.append('div').classed('mb-5', true)\n        .call(table.table, res.compound.fields, res.compound.records,\n              null, 150);\n\n      contents.append('h2').classed('mt-5', true).text('Aliases');\n      contents.append('div').classed('mb-5', true)\n        .call(table.table, res.aliases.fields, res.aliases.records,\n              null, 150);\n\n      contents.append('h2').classed('mt-5', true).text('Assay results');\n      contents.append('div').classed('mb-5', true)\n        .call(table.filterSortTable, res.assays.fields, res.assays.records,\n              null, 400);\n    });\n}\n\n\nfunction run() {\n  const err = client.compatibility();\n  if (err) {\n    d3.select('body')\n      .style('color', '#ff0000')\n      .text(err);\n    return;\n  }\n  // Menubar\n  const menubar = d3.select('#menubar');\n  menubar.append('a')\n      .call(button.menuButtonLink, 'Dashboard', 'outline-secondary', 'db-gray')\n      .attr('href', 'dashboard.html')\n      .attr('target', '_blank');\n  const compoundID = client.URLQuery().compound || null;\n  if (!compoundID) return;\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";\n  const offLine = 'onLine' in navigator && !navigator.onLine;  client.registerServiceWorker();\n  return render(compoundID);\n}\n\n\nexport default {\n  run\n};\n"],"names":["URLQuery","pairs","window","location","search","substring","split","map","e","_","fromPairs","compatibility","registerServiceWorker","navigator","addEventListener","serviceWorker","register","console","info","baseURL","get","url","query","q","Object","keys","length","JSON","stringify","fetch","credentials","then","res","status","Promise","reject","Error","statusText","resolve","json","response","text","blob","post","formdata","method","body","error","err","serverStatus","server","schema","iconBaseURL","buttonBox","selection","label","type","classed","append","menuButton","menuButtonLink","icon","attr","style","menuModalLink","target","dropdownMenuButton","button","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","on","d3","select","this","node","click","dropdownMenuFileValue","files","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","format","partialMatch","toString","toUpperCase","indexOf","uuidv4","replace","c","r","Math","random","statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","fields","columns","sort","id","name","dataType","schemaVersion","revision","records","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v10_nodes","reference","convertNetwork","data","edges","hasOwnProperty","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","key","column","domain","range","unknown","size","visible","nodeContent","structure","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","forEach","i","index","_structure","_index","source","v08_graph","nodeContentVisible","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","$schema","convertPackage","now","Date","isNW","v08_nodes","width","height","convertTable","specs","views","dataset","push","collectionID","contents","workflowID","workflow","viewID","viewType","rows","sortOrder","filterText","checkpoints","date","description","networkThresholdCutoff","filter","view","minConnThld","currentConnThld","items","idb","Dexie","getAllItems","orderBy","reverse","toArray","updateItem","storeID","updateFunc","where","equals","modify","catch","version","stores","reset","delete","getItem","first","importItem","legacy","misc","slice","sessionStarted","put","newDatagrid","toLocaleString","timeZone","deleteItem","getView","appendView","viewObj","item","pos","findIndex","splice","updateView","isFunction","deleteView","bin","entries","entry","getCollection","collID","colls","coll","appendCollection","collObj","updateCollection","singleToMulti","mapping","newMapping","m","mappingToTable","mp","concat","rcd","f","tableToMapping","table","ignore","row","csvToMapping","csvString","lines","header","shift","headerIdx","h","line","values","k","Array","apply","fd","uniqBy","Collection","[object Object]","autoIndex","content","addField","fs","mapper","flatten","command","fetcher","all","sum","some","min","updateHeader","state","selectAll","remove","visibleFields","enter","call","headerCellRenderer","updateRows","recordsToShow","keyFunc","exit","merge","rowHeight","each","d","rowIndex","viewportTop","rowPos","rowFactory","updateViewport","scrollPos","bodyHeight","setScrollPosition","scrollTop","resize","viewport","getBoundingClientRect","top","resizeViewport","innerHeight","viewportHeight","datagrid","floor","previousViewportTop","updateContentsNotifier","applyHeader","applyData","updateFilterNotifier","setFilterText","d3Format","record","d3_format","html","compound_id","image","checkbox","property","disabled","checked","textField","cellFunc","numeric","raw","assay_id","list","plot","plotCell","vega","View","parse","initialize","run","plotThumbnail","vegaSpec","toImageURL","binaryToDataURI","binary","reader","FileReader","onload","event","result","readAsDataURL","text_field","control","svg","rowCell","cell","DatagridState","sortedRecords","filteredRecords","defaultColumnHeight","none","scrollBarSpace","numViewportRows","viewportBottom","fixedViewportHeight","component","factory","position","ceil","setViewportSize","setNumViewportRows","widthfSum","reduce","a","widthf","assign","b","applyOrder","order","orders","applyFilter","ki","obj","updateFields","joinFields","ci","export","vi","numberBoxFloatValue","textBox","updateTextBox","textBoxValue","readonlyBox","textareaBox","updateTextareaBox","updateTextareaPlaceholder","placeholder","textareaBoxValue","textareaBoxLines","checkBox","box","updateCheckBox","checkBoxValue","numberBox","max","step","updateNumberBox","numberFloatValid","parseInt","valid","numberBoxIntValue","colorBox","stopPropagation","updateColorBox","colorBoxValue","fileInputBox","clearFileInput","fileInputBoxValue","setFilter","searchBox","setSort","isAsc","setSortOrder","datum","filterTable","rowf","filterSortTable","update","updateRecords","tableRecords","render","compoundID","resources","profile","cmpdQuery","targets","compound","_formula","_mw","_logp","_nonH","cid","src","__source","struct","aliasQuery","queryMol","ignoreHs","aliases","assayQuery","assays","fetchProfile","client","document","protocol","onLine"],"mappings":"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"}