{"version":3,"file":"profileApp.js","sources":["../../src/common/client.js","../../src/common/fetcher.js","../../src/component/button.js","../../src/common/misc.js","../../src/common/legacySchema.js","../../src/common/idb.js","../../src/common/mapper.js","../../src/common/collection.js","../../src/datagrid/component.js","../../src/datagrid/rowFactory.js","../../src/common/image.js","../../src/datagrid/state.js","../../src/component/badge.js","../../src/component/formBox.js","../../src/datagrid/rowFilter.js","../../src/datagrid/sort.js","../../src/datagrid/table.js","../../src/profileApp.js"],"sourcesContent":["\n/** @module common/client */\n\nimport _ from 'lodash';\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\nfunction compatibility() {\n  if (!window.indexedDB) {\n    return 'Client compatibility error: IndexedDB not supported';\n  }\n  try {\n    () => {};\n  } catch (err) {\n    return 'Client compatibility error: Arrow function not supported';\n  }\n  try {\n    FormData;\n  } catch (err) {\n    return 'Client compatibility error: FormData not supported';\n  }\n  try {\n    fetch;\n  } catch (err) {\n    return 'Client compatibility error: fetch API not supported';\n  }\n}\n\n\nfunction registerServiceWorker() {\n  if ('serviceWorker' in navigator) {\n    if (!isDebugBuild) {  // Grobal isDebugBuild (see rollup.js)\n      window.addEventListener('load', () => {\n        navigator.serviceWorker.register('../sw.js');  // TODO: root path option\n      });\n    } else {\n      console.info('Service worker is disabled for debugging');\n    }\n  } else {\n    console.info('Service worker is not supported');\n  }\n}\n\n\nfunction registerCtrlCommand(key, callback) {\n  document.addEventListener('keydown', event => {\n    if (event.ctrlKey && event.key === key) {\n      callback();\n    }\n  });\n}\n\n\nexport default {\n  URLQuery, compatibility, registerServiceWorker, registerCtrlCommand\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '../req/';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\nfunction serverStatus() {\n  const response = {};\n  return get('server')\n    .then(json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => get('schema'))\n    .then(json)\n    .then(res => {\n      response.schema = res;\n    })\n    .then(() => response);\n}\n\n\nfunction batchRequest(reqs, interval) {\n  const ress = reqs.map((req, i) => {\n    return new Promise(resolve => {\n      setTimeout(() => resolve(req()), i * interval * 1000);\n    });\n  });\n  return Promise.all(ress);\n}\n\n\nfunction sequentialBatchRequest(reqs, interval) {\n  const ress = [];\n  const batch = reqs.reduce((a, b) => {\n    return a\n      .then(res => {\n        if (res) ress.push(res);\n        return new Promise(resolve => {\n          setTimeout(() => resolve(b()), interval * 1000);\n        });\n      });\n  }, Promise.resolve());\n  return batch.then(() => ress);\n}\n\n\n\nexport default {\n  get, json, text, blob, post, error, serverStatus, batchRequest\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction buttonBox(selection, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .text(label);\n}\n\n\nfunction menuButton(selection, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, target, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('label', true)\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, label, type, icon) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  const button = selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  button.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  button.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, label, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, label, target, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, label, accept, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      });\n  selection.append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  iconBaseURL, buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\n\n\n// TODO: re-define\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  if (['text_field', 'checkbox', 'html'].includes(fmt)) return 'html';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  sortType, formatNum, partialMatch, uuidv4\n};\n","\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: [\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ],\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nfunction convertPackage(json) {\n  let specs = {};\n  if (!json.hasOwnProperty('views')) {\n    const now = new Date();\n    const isNW = json.hasOwnProperty('edges');\n    const data = isNW ? convertNetwork(json) : convertTable(json);\n    const nodes = isNW ? data.nodes : data;\n    specs = {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n      name: data.edges.name,\n      views: [],\n      dataset: []\n    };\n    specs.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: nodes.id,\n      name: nodes.name,\n      contents: [{\n        $schema: nodes.$schema,\n        workflowID: nodes.reference.workflow,\n        name: nodes.name,\n        fields: nodes.fields,\n        records: nodes.records,\n        created: nodes.created,\n        status: nodes.status,\n        query: nodes.query,\n        execTime: nodes.execTime,\n        progress: nodes.progress\n      }]\n    });\n    specs.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: nodes.id,\n      name: nodes.name,\n      viewType: \"datagrid\",\n      rows: nodes.id,\n      fields: nodes.fields,\n      sortOrder: null,\n      filterText: null,\n      checkpoints: [{\n        type: 'convert',\n        date: now.toString(),\n        description: 'converted from legacy format'\n      }]\n    });\n    if (isNW) {\n      specs.dataset.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: data.edges.id,\n        name: data.edges.name,\n        contents: [{\n          $schema: data.edges.$schema,\n          workflowID: data.edges.reference.workflow,\n          name: data.edges.name,\n          fields: data.edges.fields,\n          records: data.edges.records,\n          created: data.edges.created,\n          status: data.edges.status,\n          query: data.edges.query,\n          execTime: data.edges.execTime,\n          progress: data.edges.progress\n        }]\n      });\n      specs.views.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n        viewID: data.edges.id,\n        name: data.edges.name,\n        viewType: \"network\",\n        nodes: nodes.id,\n        edges: data.edges.id,\n        nodeColor: data.edges.snapshot.nodeColor,\n        nodeSize: data.edges.snapshot.nodeSize,\n        nodeLabel: data.edges.snapshot.nodeLabel,\n        nodeLabelColor: data.edges.snapshot.nodeLabelColor,\n        edgeWidth: data.edges.snapshot.edgeWidth,\n        edgeLabel: data.edges.snapshot.edgeLabel,\n        networkThreshold: data.edges.snapshot.networkThreshold,\n        networkThresholdCutoff: data.edges.snapshot.networkThresholdCutoff,\n        fieldTransform: data.edges.snapshot.fieldTransform,\n        coords: data.edges.snapshot.coords,\n        checkpoints: [{\n          type: 'convert',\n          date: now.toString(),\n          description: 'converted from legacy format'\n        }]\n      });\n    }\n    specs.views.filter(e => e.viewType === 'network')\n      .forEach(view => {\n        view.minConnThld = view.networkThresholdCutoff;\n        view.currentConnThld = view.networkThreshold;\n        if (view.hasOwnProperty('nodeLabel')) {\n          view.nodeLabel.field = view.nodeLabel.text;\n        }\n        if (view.hasOwnProperty('edgeLabel')) {\n          view.edgeLabel.field = 'weight';\n        }\n        if (view.hasOwnProperty('edgeWidth')) {\n          view.edgeWidth.field = 'weight';\n        }\n      });\n  } else {\n    specs = json;\n  }\n  specs.views.filter(e => e.viewType === 'network')\n    .forEach(view => {\n      if (!view.nodeColor.field) { view.nodeColor.field = 'index' ;}\n      if (!view.nodeSize.field) { view.nodeSize.field = 'index' ;}\n      if (!view.nodeLabel.field) { view.nodeLabel.field = 'index' ;}\n      if (!view.nodeLabelColor.field) { view.nodeLabelColor.field = 'index' ;}\n      if (!view.edgeColor) {\n        view.edgeColor = {\n          field: 'weight', color: 'monogray',\n          scale: 'linear', domain: [0, 1],\n          range: ['#999999', '#999999'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeColor.field) { view.edgeColor.field = 'weight' ;}\n      if (!view.edgeWidth.field) { view.edgeWidth.field = 'weight' ;}\n      if (!view.edgeLabel.field) { view.edgeLabel.field = 'weight' ;}\n      if (!view.edgeLabelColor) {\n        view.edgeLabelColor = {\n          field: 'weight', color: 'monoblack',\n          scale: 'linear', domain: [1, 1],\n          range: ['#333333', '#333333'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeLabelColor.field) { view.edgeLabelColor.field = 'weight' ;}\n    });\n  return specs;\n}\n\n\nexport default {\n  convertPackage\n};\n","\n/** @module common/idb */\n\nimport _ from 'lodash';\n\nimport {default as misc} from './misc.js';\nimport {default as legacy} from './legacySchema.js';\n\n\n// Increment versions if IDB schema has updated.\nconst pkgStoreVersion = 2;\nconst assetStoreVersion = 1;\n\n\nfunction connect(name, version, createObj) {\n  return new Promise((resolve, reject) => {\n    const request = window.indexedDB.open(name, version);\n    request.onsuccess = function () {\n      resolve(this.result);\n    };\n    request.onerror = event => reject(event);\n    request.onupgradeneeded = event => {\n      createObj(event.currentTarget.result);\n    };\n  });\n}\n\n\nconst instance = {\n  pkgs: connect(\"Packages\", pkgStoreVersion, db => {\n    db.createObjectStore(\"Packages\", {keyPath: 'id'});\n  }),\n  assets: connect(\"Assets\", assetStoreVersion, db => {\n    db.createObjectStore(\"Assets\", {keyPath: 'key'});\n  })\n};\n\n\n/**\n * Clear database\n * @param {string} dbid - database ID\n */\nfunction clear(dbid) {\n  return new Promise((resolve, reject) => {\n    return instance[dbid].then(db => {\n      const req = db.transaction(db.name, 'readwrite')\n          .objectStore(db.name).clear();\n        req.onsuccess = () => resolve();\n        req.onerror = event => reject(event);\n    });\n  });\n}\n\n\n/**\n * Delete all data in the local storage\n */\nfunction clearAll() {\n  return Promise.all([clear('pkgs'), clear('assets')]);\n}\n\n\n/**\n * Returns all packages\n * @return {Promise} Promise of list of packages\n */\nfunction getAllItems() {\n  return new Promise(resolve => {\n    const res = [];\n    return instance.pkgs.then(db => {\n      db.transaction(db.name)\n        .objectStore(db.name).openCursor()\n        .onsuccess = event => {\n          const cursor = event.target.result;\n          if (cursor) {\n            res.push(cursor.value);\n            cursor.continue();\n          } else {\n            resolve(res);\n          }\n        };\n    });\n  });\n}\n\n\n/**\n * Get packages by instance ID\n * @param {string} id - Package instance ID\n * @return {array} data store object\n */\nfunction getItem(id) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const req = db.transaction(db.name)\n        .objectStore(db.name).get(id);\n      req.onsuccess = event => resolve(event.target.result);\n      req.onerror = event => reject(event);\n    });\n  });\n}\n\n\n/**\n * Put data object in the store\n * @param {string} value - value to store\n */\nfunction putItem(value) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const obj = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name);\n      const req = obj.put(value);\n      req.onerror = event => reject(event);\n      req.onsuccess = () => resolve();\n    });\n  });\n}\n\n\n/**\n * Update package in the store\n * @param {string} id - Package instance ID\n * @param {function} updater - update function\n */\nfunction updateItem(id, updater) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const obj = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name);\n      const req = obj.get(id);\n      req.onerror = event => reject(event);\n      req.onsuccess = event => {\n        const res = event.target.result;\n        updater(res);\n        const upd = obj.put(res);\n        upd.onsuccess = () => resolve();\n        upd.onerror = event => reject(event);\n      };\n    });\n  });\n}\n\n\n/**\n * Delete a package\n * @param {string} id - Package instance ID\n */\nfunction deleteItem(id) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const req = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name).delete(id);\n      req.onerror = event => reject(event);\n      req.onsuccess = () => resolve();\n    });\n  });\n}\n\n\n/**\n * Returns a view\n * @param {string} id - Package instance ID\n * @param {string} viewID - view ID\n * @return {array} view objects\n */\nfunction getView(id, viewID) {\n  return getItem(id)\n    .then(pkg => pkg.views.find(e => e.viewID === viewID));\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} id - Package instance ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object\n */\nfunction appendView(id, viewID, viewObj) {\n  return updateItem(id, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos + 1, 0, viewObj);\n  });\n}\n\n\n/**\n * Update view\n * @param {string} id - Package instance ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object or update function\n */\nfunction updateView(id, viewID, viewObj) {\n  return updateItem(id, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    if (_.isFunction(viewObj)) {\n      viewObj(item.views[pos]);\n    } else {\n      item.views[pos] = viewObj;\n    }\n  });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} id - Package instance ID\n * @return {integer} - number of deleted items\n */\nfunction deleteView(id, viewID) {\n  return updateItem(id, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos, 1);\n    // prune orphaned collections\n    const bin = {};\n    item.dataset.forEach(e => { bin[e.collectionID] = 0; });\n    item.views.forEach(view => {\n      ['rows', 'items', 'nodes', 'edges']\n        .filter(e => view.hasOwnProperty(e))\n        .forEach(e => { bin[view[e]] += 1; });\n    });\n    Object.entries(bin).forEach(entry => {\n      if (!entry[1]) {\n        const i = item.dataset.findIndex(e => e.collectionID === entry[0]);\n        item.dataset.splice(i, 1);\n      }\n    });\n  });\n}\n\n\n/**\n * Returns all collections in the store\n * @return {array} Collection objects\n */\nfunction getAllCollections() {\n  return getAllItems()\n    .then(items => _.flatten(\n      items.map(item => {\n        return item.dataset.map(coll => {\n          coll.instance = item.id;\n          return coll;\n        });\n      })\n    ));\n}\n\n\n/**\n * Returns a collection\n * @param {string} id - Package instance ID\n * @param {string} collID - Collection ID\n * @return {array} Collection objects\n */\nfunction getCollection(id, collID) {\n  return getItem(id)\n    .then(pkg => pkg.dataset.find(e => e.collectionID === collID));\n}\n\n\nfunction addCollection(id, collID, collObj) {\n  return updateItem(id, item => {\n    item.dataset.push(collObj);\n  });\n}\n\n/**\n * Update collection\n * @param {string} id - Package instance ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object or update function\n */\nfunction updateCollection(id, collID, collObj) {\n  return updateItem(id, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    if (_.isFunction(collObj)) {\n      collObj(item.dataset[pos]);\n    } else {\n      item.dataset[pos] = collObj;\n    }\n  });\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - id if sucessfully added\n */\nfunction importItem(data) {\n  // Legacy format converter\n  data = legacy.convertPackage(data);\n\n  const now = new Date();\n  data.id = misc.uuidv4().slice(0, 8);\n  data.sessionStarted = now.toString();\n  return putItem(data);\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} response - response data\n * @return {string} - viewID if sucessfully added\n */\nfunction newDatagrid(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const instance = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    id: instance,\n    name: response.name,\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n        viewID: viewID,\n        name: response.name,\n        viewType: \"datagrid\",\n        rows: collectionID,\n        checkpoints: [\n          {type: 'creation', date: date}\n        ]\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        name: response.name,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return putItem(data)\n    .then(() => ({instance: instance, viewID:viewID}));\n}\n\n\nfunction addDatagrid(instance, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  return updateItem(instance, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: viewID,\n      name: response.name,\n      viewType: \"datagrid\",\n      rows: collectionID,\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: collectionID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\nfunction new384Tiles(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const instance = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    id: instance,\n    name: response.name,\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/tile_v1.0.json\",\n        viewID: viewID,\n        name: `${response.name}_tiles`,\n        viewType: 'tile',\n        items: collectionID,\n        rowCount: 16,\n        columnCount: 24\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        name: response.name,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return putItem(data)\n    .then(() => ({instance: instance, viewID:viewID}));\n}\n\n\nfunction add384Tiles(instance, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  return updateItem(instance, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/tile_v1.0.json\",\n      viewID: viewID,\n      name: `${response.name}_tiles`,\n      viewType: 'tile',\n      items: collectionID,\n      rowCount: 16,\n      columnCount: 24,\n      chunksPerRow: 10\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: collectionID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\n/**\n * Store new network view\n * @param {string} instance - Package instance ID\n * @param {string} nodesID - ID of nodes collection\n * @param {string} nodesName - Name of nodes collection\n * @param {object} response - Response object\n */\nfunction newNetwork(instance, nodesID, nodesName, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const edgesID = response.workflowID.slice(0, 8);\n  return updateItem(instance, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: viewID,\n      name: `${nodesName}_${response.name}`,\n      viewType: 'network',\n      nodes: nodesID,\n      edges: edgesID,\n      minConnThld: response.query.params.threshold\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: edgesID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\n/**\n * Get asset by a key\n * @param {string} key - key\n * @return {array} asset object (if not found, resolve with undefined)\n */\nfunction getAsset(key) {\n  return new Promise((resolve, reject) => {\n    return instance.assets.then(db => {\n      const req = db.transaction(db.name)\n        .objectStore(db.name).get(key);\n      req.onsuccess = event => {\n        const undef = event.target.result === undefined;\n        const value = undef ? undefined : event.target.result.value;\n        resolve(value);\n      };\n      req.onerror = event => reject(event);\n    });\n  });\n}\n\n/**\n * Put asset object with a key\n * @param {string} key - key\n * @param {string} content - asset to store\n */\nfunction putAsset(key, content) {\n  return new Promise((resolve, reject) => {\n    return instance.assets.then(db => {\n      const obj = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name);\n      const req = obj.put({key: key, value: content});\n      req.onerror = event => reject(event);\n      req.onsuccess = () => resolve();\n    });\n  });\n}\n\n\nexport default {\n  clear, clearAll, getAllItems, getItem, updateItem, deleteItem,\n  getView, appendView, updateView, deleteView,\n  getAllCollections, getCollection, addCollection, updateCollection,\n  importItem, newDatagrid, addDatagrid, add384Tiles, newNetwork,\n  getAsset, putAsset\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: [keyField].concat(mp.fields),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: table.fields.filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key)),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: fields,\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(mp.fields)\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/collection */\n\nimport _ from 'lodash';\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as mapper} from './mapper.js';\n\n\nexport default class Collection {\n  /**\n   * Create Collection from a flashflood response datatable\n   * If data is not specified, put datatables later by this.append(data)\n   * @param {object} coll - Collection or response object\n   */\n  constructor(coll) {\n    // Settings\n    this.autoIndex = 'index';  // enumerate records\n\n    this.collectionID = coll.collectionID || null;\n    this.instance = coll.instance || null;\n    this.name = coll.name || null;\n    if (coll.records) {\n      this.contents = [coll];\n      this.fields = [];\n    } else {\n      this.contents = coll.contents;\n      this.fields = coll.fields || [];\n    }\n    this.contents.forEach(content => {\n      content.fields.forEach(e => this.addField(e));\n    });\n  }\n\n  /**\n   * Add fields\n   * @param {array} fs - list of fields\n   */\n  addField(field) {\n    if (this.fields.find(e => e.key === field.key)) return;\n    if (!field.hasOwnProperty('name')) field.name = field.key;\n    if (!field.hasOwnProperty('visible')) field.visible = true;\n    if (field.hasOwnProperty('d3_format')) field.format = 'd3_format';\n    if (!field.hasOwnProperty('format')) field.format = 'raw';\n    this.fields.push(field);\n  }\n\n  /**\n   * Update fields properties\n   * @param {array} fs - list of fields\n   */\n  updateFields(fs) {\n    this.fields = [];\n    fs.forEach(e => this.addField(e));\n  }\n\n  /**\n   * Join fields\n   * @param {object} mapping - column mapper object\n   */\n  joinFields(mapping) {\n    this.contents.forEach(c => {\n      mapper.apply(c, mapping);\n    });\n    if (mapping.hasOwnProperty('fields')) {\n      mapping.fields.forEach(e => this.addField(e));\n    } else {\n      this.addField(mapping.field);\n    }\n  }\n\n  /**\n   * Apply function to the original data records\n   * new fields should be manually added by Collection.addField\n   * @param {function} func - function to be applied\n   */\n  apply(func) {\n    this.contents.forEach(content => {\n      content.records.forEach(rcd => {\n        func(rcd);\n      });\n    });\n  }\n\n  /**\n   * Return all records of the collection\n   * @return {array} records\n   */\n  records() {\n    return _.flatten(this.contents.map(e => e.records));\n  }\n\n  fetch(command) {\n    const fs = this.contents\n      .filter(e => ['running', 'ready', 'interrupted', 'queued'].includes(e.status))\n      .map(content => {\n        const query = {id: content.workflowID, command: command};\n        return fetcher.get('progress', query)\n          .then(fetcher.json)\n          .then(data => {\n            return idb.updateCollection(this.instance, this.collectionID, coll => {\n              const i = coll.contents\n                .findIndex(e => e.workflowID === query.id);\n              if (data.status === 'failure') {  // No data found on server\n                coll.contents[i].status = 'failure';\n              } else {\n                coll.contents[i] = data;\n              }\n            });\n          });\n      });\n    return Promise.all(fs)\n      .then(() => idb.getCollection(this.instance, this.collectionID))\n      .then(coll => {\n        this.contents = coll.contents;\n      });\n  }\n\n  /**\n   * Retrieve workflows and store it into a local store.\n   * @return {Promise}\n   */\n  pull() {\n    return this.fetch('pull');\n  }\n\n  /**\n   * Retrieve workflows, abort all ongoing workflow task\n   * and store it into a local store.\n   * @return {Promise}\n   */\n  abort() {\n    return this.fetch('abort');\n  }\n\n  /**\n   * Return total number of records\n   * @return {float} total number of records\n   */\n  size() {\n    return _.sum(this.contents.map(e => e.records.length));\n  }\n\n  /**\n   * Return status\n   * @return {string} status\n   */\n  status() {\n    if (this.contents.some(e => e.status === 'interrupted')) return 'interrupted';\n    if (this.contents.some(e => e.status === 'running')) return 'running';\n    if (this.contents.some(e => e.status === 'queued')) return 'queued';\n    if (this.contents.some(e => e.status === 'ready')) return 'ready';\n    if (this.contents.some(e => e.status === 'aborted')) return 'aborted';\n    if (this.contents.some(e => e.status === 'failure')) return 'failure';\n    return 'done';\n  }\n\n  /**\n   * Return ongoing or not\n   * @return {bool} ongoing or not\n   */\n  ongoing() {\n    const s = ['ready', 'queued', 'running', 'interrupted'];\n    return s.includes(this.status());\n  }\n\n  /**\n   * Return percentage of workflow progress\n   * @return {float} progress in percent\n   */\n  progress() {\n    return _.min(this.contents.map(e => e.progress));\n  }\n\n  /**\n   * Return total execution time\n   * @return {float} total time\n   */\n  execTime() {\n    return _.sum(this.contents.map(e => e.execTime));\n  }\n\n  /**\n   * Export collection object as JSON\n   * @return {object} collection JSON\n   */\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: this.collectionID,\n      name: this.name,\n      fields: this.fields,\n      contents: this.contents\n    };\n  }\n}\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction headerCellRenderer(header) {\n  header.style('display', 'inline-block')\n    .style('width', d => `${d.width}%`)\n    .text(d => d.name);\n}\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .call(state.headerCellRenderer);\n}\n\n\nfunction updateRows(selection, state) {\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.selectAll('.dg-cell').remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', 'absolute')\n      .style('width', '100%')\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0)\n          .call(state.rowFactory(), d);\n      });\n}\n\n\nfunction updateViewport(selection, state, scrollPos) {\n  selection.select('.dg-body').style('height', `${state.bodyHeight}px`);\n  state.setScrollPosition(scrollPos);\n  selection.call(updateRows, state, scrollPos);\n  selection.select('.dg-viewport').node().scrollTop = scrollPos * state.rowHeight;\n}\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.resizeViewport(window.innerHeight - viewportTop - 5);\n  viewport.style('height', `${state.viewportHeight}px`);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(updateRows, state, pos);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyHeader();\n    selection.call(updateHeader, state);\n    selection.call(resize, state);\n    state.applyData();\n    selection.call(updateViewport, state, state.viewportTop);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    selection.call(updateViewport, state, 0);\n  };\n}\n\n\n\nexport default {\n  headerCellRenderer, updateHeader, updateRows, updateViewport,\n  resize, datagrid\n};\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction date(selection, record, field) {\n  // TODO; formatter\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  // TODO: Check vulnerabilities\n  selection.html(record[field.key]);\n}\n\n\nfunction compoundID(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n}\n\n\nfunction textField(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'text')\n      .style('width', '90%')\n      .property('value', record[field.key])\n      .on('change', function () {\n        record[field.key] = this.value;\n      });\n}\n\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nfunction asyncImage(selection, record, field) {\n  const req = `${field.request}${record[field.key]}`;\n  idb.getAsset(req)\n    .then(res => {\n      if (res !== undefined) return res;\n      return fetch(req, { credentials: 'include' })\n        .then(res => res.blob())\n        .then(res => idb.putAsset(req, res).then(() => res));\n    })\n    .then(obj => {\n      selection.append('img')\n          .attr('width', 180)\n          .attr('height', 180)\n          .attr('src', URL.createObjectURL(obj));\n    });\n}\n\n\nfunction asyncHtml(selection, record, field) {\n  const req = `${field.request}${record[field.key]}`;\n  idb.getAsset(req)\n    .then(res => {\n      if (res !== undefined) return res;\n      return fetch(req, { credentials: 'include' })\n        .then(res => res.text())\n        .then(res => idb.putAsset(req, res).then(() => res));\n    })\n    .then(txt => {\n      selection.html(txt);\n    });\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  date: date,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compoundID,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  text_field: textField,\n  control: call,\n  svg: html,\n  html: html,\n  async_image: asyncImage,\n  async_html: asyncHtml\n};\n\n\nfunction rowCell(selection) {\n  selection.classed('dg-cell', true)\n    .classed('align-middle', true)\n    .classed('text-truncate', true)\n    .style('display', 'inline-block');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n          .call(rowCell)\n          .style('width', `${field.width}%`);\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compoundID, image, checkbox, textField, call,\n  asyncImage, asyncHtml,\n  rowCell, rowFactory\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nfunction binaryToDataURI(binary) {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      resolve(event.target.result);\n    };\n    reader.readAsDataURL(binary);\n  });\n}\n\n\nexport default {\n  plotCell, plotThumbnail, binaryToDataURI\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport Collection from '../common/collection.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as component} from './component.js';\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(view, coll) {\n    this.instance = view.instance || null;\n    this.viewID = view.viewID || null;\n    this.name = view.name || null;\n    this.sortOrder = view.sortOrder || [];\n    this.filterText = view.filterText || null;\n    this.rows = new Collection(coll);\n\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    // TODO: auto adjust\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      html: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.viewportTop = 0;\n    this.previousViewportTop = null;\n    this.viewportBottom = null;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.headerCellRenderer = component.headerCellRenderer;\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n  }\n\n  /**\n   * Set viewport height and number of rows to show\n   * @param {int} height - viewport height\n   */\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n  }\n\n  /**\n   * Set range of the row indices to show\n   * @param {int} position - Index of the top row to show\n   */\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setNumViewportRows() {\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  resizeViewport(height) {\n    this.setViewportSize(height);\n    this.setNumViewportRows();\n  }\n\n  /**\n   * Apply header data\n   */\n  applyHeader() {\n    this.visibleFields = this.rows.fields.filter(e => e.visible);\n    const widthfSum = this.visibleFields.reduce((a, c) => a + (c.widthf || 1), 0);\n    this.visibleFields = this.visibleFields.map(e => {\n      const field = {\n        width: (e.widthf || 1) / widthfSum * 100,\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b, 0).height;\n  }\n\n  /**\n   * Apply row data\n   * 1. applyHeader: define fields and set rowHeight\n   * 2. resize: measure actual window size and calc viewportHeight\n   * 3. applyData: calc number of rows from rowHeight and viewportHeight\n   * 4. setScrollPosition: calc row index range\n   * 5. recordsToShow: slice rows to show\n   */\n  applyData() {\n    this.setNumViewportRows();\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.rows.records().slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.rows.records().slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  updateFields(fs) {\n    this.rows.updateFields(fs);\n  }\n\n  joinFields(mapping) {\n    this.rows.joinFields(mapping);\n    this.applyData();\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  save() {\n    return idb.updateItem(this.instance, item => {\n      const ci = item.dataset\n        .findIndex(e => e.collectionID === this.rows.collectionID);\n      item.dataset[ci] = this.rows.export();\n      const vi = item.views.findIndex(e => e.viewID === this.viewID);\n      item.views[vi] = this.export();\n    });\n  }\n\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: this.viewID,\n      name: this.name,\n      viewType: \"datagrid\",\n      rows: this.rows.collectionID,\n      sortOrder: this.sortOrder,\n      filterText: this.filterText\n    };\n  }\n}\n","\n/** @module component/badge */\n\nimport d3 from 'd3';\n\nconst assetBaseURL = '../assets/';\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction badge(selection) {\n  selection.classed('badge', true);\n  selection.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('text', true);\n}\n\n\nfunction updateBadge(selection, text, type, icon) {\n  selection.classed(`badge-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nfunction notify(selection) {\n  selection\n    .style('opacity', 0)\n    .style('display', 'inline')\n    .transition()\n      .duration(500)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 1.0)\n    .transition()\n      .delay(3000)\n      .duration(1000)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 0)\n      .on('end', function () {\n        selection.style('display', 'none');\n      });\n}\n\n\nfunction loadingCircle(selection) {\n  selection\n      .style('display', 'none')\n    .append('img')\n      .attr('src', `${assetBaseURL}loading1.gif`)\n      .style('width', '2rem')\n      .style('height', '2rem');\n}\n\n\nfunction alert(selection) {\n  selection.classed('alert', true)\n      .classed('px-1', true)\n      .classed('py-0', true);\n  selection.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('text', true)\n      .style('font-size', '75%');\n}\n\n\nfunction updateAlert(selection, text, type, icon) {\n  selection.classed(`alert-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nfunction invalidFeedback(selection) {\n  selection.classed('invalid-feedback', true)\n      .style('display', 'none');\n  selection.append('img')\n      .classed('icon', true)\n      .attr('src', `${iconBaseURL}caution-salmon.svg`)\n      .style('width', '1rem')\n      .style('height', '1rem');\n  selection.append('span')\n      .classed('invalid-msg', true);\n}\n\nfunction updateInvalidMessage(selection, msg) {\n  selection.select('.invalid-msg')\n      .text(msg);\n}\n\n\nexport default {\n  badge, updateBadge, notify, loadingCircle,\n  alert, updateAlert, invalidFeedback, updateInvalidMessage\n};\n","\n/** @module component/formBox */\n\nimport d3 from 'd3';\n\nimport {default as badge} from './badge.js';\n\n\nfunction updateFormValue(selection, value) {\n  selection.select('.form-control').property('value', value);\n  selection.call(setValidity, true);  // Clear validity state\n}\n\n\nfunction formValue(selection) {\n  return selection.select('.form-control').property('value');\n}\n\n\nfunction formValid(selection) {\n  return selection.select('.form-control').node().checkValidity();\n}\n\n\nfunction setValidity(selection, valid) {\n  selection.select('.invalid-feedback')\n      .style('display', valid ? 'none': 'inherit');\n  selection.select('.form-control')\n      .style('background-color', valid ? null : '#ffcccc');\n}\n\n\nfunction textBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .on('input', function () {\n        const valid = formValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\n\nfunction readonlyBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .attr('readonly', 'readonly');\n}\n\nfunction updateReadonlyValue(selection, value) {\n  selection.select('.form-control-plaintext').property('value', value);\n}\n\nfunction readonlyValue(selection) {\n  return selection.select('.form-control-plaintext').property('value');\n}\n\n\nfunction textareaBox(selection, label, rows, placeholder) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  const formLabel = selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  formLabel.append('div')\n      .call(badge.invalidFeedback);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows)\n      .attr('placeholder', placeholder)\n      .on('input', function () {\n        const valid = textareaValid(selection);\n        selection.call(setValidity, valid);\n      });\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n')\n    .map(e => e.replace(/^\\s+|\\s+$/g, ''))  // strip spaces\n    .filter(e => e.length > 0);\n  return [];\n}\n\nfunction textareaValid(selection) {\n  return /\\s*?\\w\\s*?/.test(formValue(selection));\n}\n\n\nfunction checkBox(selection, label) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox');\n  box.append('span')\n      .text(label);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'number')\n      .on('input', function () {\n        const valid = formValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\nfunction updateNumberRange(selection, min, max, step) {\n  selection.select('.form-control')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step)\n      .dispatch('input', {bubbles: true});\n}\n\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n}\n\n\nfunction fileInputBox(selection, label, accept) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('form-control-file', true)\n      .classed('col-8', true)\n      .attr('type', 'file')\n      .attr('accept', accept)\n      .on('change', function () {\n        const valid = fileInputValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\nfunction clearFileInput(selection) {\n  // TODO: FileList object (input.files) may be a readonly property\n  const label = selection.select('label').text();\n  const accept = selection.select('input').attr('accept');\n  selection.selectAll('*').remove();\n  selection.call(fileInputBox, label, accept);\n}\n\nfunction fileInputValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\nfunction fileInputValid(selection) {\n  // TODO: attribute 'require' does not work with input type=file\n  return selection.select('input').property('files').length > 0;\n}\n\n\nexport default {\n  updateFormValue, formValue, formValid, setValidity,\n  textBox, readonlyBox, updateReadonlyValue, readonlyValue,\n  textareaBox, textareaBoxLines, textareaValid,\n  numberBox, updateNumberRange,\n  checkBox, updateCheckBox, checkBoxValue,\n  colorBox,\n  fileInputBox, clearFileInput, fileInputValue, fileInputValid\n};\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, 'Search');\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.formValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction setSort(selection, state) {\n  state.headerCellRenderer = header => {\n    header.style('display', 'inline-block')\n      .style('width', d => `${d.width}%`)\n      .text(d => d.name)\n      .filter(d => misc.sortType(d.format) !== 'none')\n      .append('span').append('a')\n        .attr('id', d => `sort-${d.key}`)\n        .text('^v')\n        .style('display', 'inline-block')\n        .style('width', '30px')\n        .style('text-align', 'center')\n      .on('click', d => {\n        const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n        d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n        state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n        selection.call(component.updateRows, state);\n      });\n  };\n}\n\n\nexport default {\n  setSort\n};\n","\n/** @module datagrid/table */\n\nimport Collection from '../common/collection.js';\n\nimport DatagridState from './state.js';\nimport {default as component} from './component.js';\nimport {default as rowf} from './rowFilter.js';\nimport {default as sort} from './sort.js';\n\n\nfunction table(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  state.keyFunc = d => d;\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterSortTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(sort.setSort, state)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction update(selection, fields, records) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = selection.datum();\n  state.rows = new Collection(data);\n  state.updateContentsNotifier();\n}\n\n\nfunction updateRecords(selection, records) {\n  const state = selection.datum();\n  state.rows.contents[0].records = records;\n  state.updateContentsNotifier();\n}\n\n\nfunction tableRecords(selection) {\n  const state = selection.datum();\n  return state.rows.records();\n}\n\n\nexport default {\n  table, filterTable, filterSortTable, update, updateRecords, tableRecords\n};\n","\n/** @module profile */\n\nimport d3 from 'd3';\n\nimport {default as client} from './common/client.js';\nimport {default as fetcher} from './common/fetcher.js';\n\nimport {default as button} from './component/button.js';\n\nimport {default as table} from './datagrid/table.js';\n\n\nfunction fetchProfile(compoundID, resources) {\n  const profile = {};\n  // Compound properties\n  const cmpdQuery = {\n    workflow: 'search',\n    targets: resources.filter(e => e.domain === 'chemical').map(e => e.id),\n    key: 'compound_id',\n    values: [compoundID]\n  };\n  return fetcher.get(cmpdQuery.workflow, cmpdQuery)\n    .then(fetcher.json)\n    .then(res => {\n      profile.compound = {\n        fields: [\n          {key: 'key', name: 'key', format: 'text'},\n          {key: 'value', name: 'value', format: 'text'}\n        ],\n        records: [\n          {key: 'Formula', value: res.records[0]._formula},\n          {key: 'Molecular weight', value: res.records[0]._mw},\n          {key: 'Wildman-Crippen logP', value: res.records[0]._logp},\n          {key: 'Non-hydrogen atom count', value: res.records[0]._nonH}\n        ]\n      };\n      profile.cid = res.records[0].compound_id;\n      profile.name = res.records[0].name;\n      profile.src = res.records[0].__source;\n      profile.struct = res.records[0].structure;\n    })\n    .then(() => {\n      const aliasQuery = {\n        workflow: 'exact',\n        targets: resources.filter(e => e.domain === 'chemical').map(e => e.id),\n        queryMol: {\n          format: 'dbid',\n          source: profile.src,\n          value: profile.cid\n        },\n        params: {ignoreHs: true}\n      };\n      return fetcher.get(aliasQuery.workflow, aliasQuery);\n    })\n    .then(fetcher.json)\n    .then(res => {\n      profile.aliases = res;\n      profile.aliases.fields = [\n        {key: 'index', name: 'Index', format: 'd3_format', d3_format: 'd'},\n        {key: 'compound_id', name: 'Compound ID', format: 'compound_id'},\n        {key: 'name', name: 'Name', format: 'text'},\n        {key: '__source', name: 'Source', format: 'text'}\n      ];\n    })\n    .then(() => {\n      const assayQuery = {\n        workflow: 'profile',\n        compound_id: compoundID,\n        targets: resources.filter(e => e.domain === 'activity').map(e => e.id),\n      };\n      return fetcher.get(assayQuery.workflow, assayQuery);\n    })\n    .then(fetcher.json)\n    .then(res => {\n      profile.assays = res;\n      profile.assays.fields = [\n        {key: 'index', name: 'Index', format: 'd3_format', d3_format: 'd'},\n        {key: 'assay_id', name: 'Assay ID', format: 'assay_id'},\n        {key: 'value_type', name: 'Value type', format: 'text'},\n        {key: 'value', name: 'Value', format: 'numeric'}\n      ];\n      return profile;\n    });\n}\n\n\nfunction render(compoundID) {\n  return fetcher.get('schema')\n    .then(fetcher.json)\n    .then(schema => fetchProfile(compoundID, schema.resources))\n    .catch(() => {\n      console.info('Server did not respond');\n      return {\n        aliases: {},\n        assays: {},\n        compound: {}\n      };\n    })\n    .then(res => {\n      const contents = d3.select('#contents')\n          .style('padding-left', '10%')\n          .style('padding-right', '10%');\n      contents.append('h2').classed('mt-5', true).text('Compound ID');\n      contents.append('div').classed('mb-5', true).text(res.cid);\n      contents.append('h2').classed('mt-5', true).text('Name');\n      contents.append('div').classed('mb-5', true).text(res.name);\n      contents.append('h2').classed('mt-5', true).text('Source');\n      contents.append('div').classed('mb-5', true).text(res.src);\n      contents.append('h2').classed('mt-5', true).text('Structure');\n      contents.append('div').classed('mb-5', true).html(res.struct);\n\n      contents.append('h2').classed('mt-5', true).text('Chemical properties');\n      contents.append('div').classed('mb-5', true)\n        .call(table.table, res.compound.fields, res.compound.records,\n              null, 150);\n\n      contents.append('h2').classed('mt-5', true).text('Aliases');\n      contents.append('div').classed('mb-5', true)\n        .call(table.table, res.aliases.fields, res.aliases.records,\n              null, 150);\n\n      contents.append('h2').classed('mt-5', true).text('Assay results');\n      contents.append('div').classed('mb-5', true)\n        .call(table.filterSortTable, res.assays.fields, res.assays.records,\n              null, 400);\n    });\n}\n\n\nfunction run() {\n  const err = client.compatibility();\n  if (err) {\n    d3.select('body')\n      .style('color', '#ff0000')\n      .text(err);\n    return;\n  }\n  // Menubar\n  const menubar = d3.select('#menubar')\n      .classed('my-1', true);\n  menubar.append('a')\n      .call(button.menuButtonLink, 'Dashboard', 'outline-secondary', 'db-gray')\n      .attr('href', 'dashboard.html')\n      .attr('target', '_blank');\n  const compoundID = client.URLQuery().compound || null;\n  if (!compoundID) return;\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";\n  const offLine = 'onLine' in navigator && !navigator.onLine;  client.registerServiceWorker();\n  return render(compoundID);\n}\n\n\nexport default {\n  run\n};\n"],"names":["URLQuery","pairs","window","location","search","substring","split","map","e","_","fromPairs","compatibility","indexedDB","registerServiceWorker","navigator","isDebugBuild","console","info","addEventListener","serviceWorker","register","registerCtrlCommand","key","callback","document","event","ctrlKey","baseURL","get","url","query","q","Object","keys","length","JSON","stringify","fetch","credentials","then","res","status","Promise","reject","Error","statusText","resolve","json","response","text","blob","post","formdata","method","body","error","err","serverStatus","server","schema","batchRequest","reqs","interval","ress","req","i","setTimeout","all","iconBaseURL","buttonBox","selection","label","type","classed","append","menuButton","menuButtonLink","icon","attr","style","menuModalLink","target","dropdownMenuButton","button","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","on","d3","select","this","node","click","dropdownMenuFileValue","files","sortType","fmt","includes","formatNum","value","d3format","undefined","Number","isNaN","parseFloat","format","partialMatch","toString","toUpperCase","indexOf","uuidv4","replace","c","r","Math","random","statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","fields","columns","sort","id","name","dataType","schemaVersion","revision","records","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v10_nodes","reference","convertNetwork","data","edges","hasOwnProperty","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","column","domain","range","unknown","size","visible","nodeContent","structure","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","forEach","index","_structure","_index","source","v08_graph","nodeContentVisible","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","$schema","convertPackage","specs","now","Date","isNW","v08_nodes","width","height","convertTable","views","dataset","push","collectionID","contents","workflowID","workflow","viewID","viewType","rows","sortOrder","filterText","checkpoints","date","description","networkThresholdCutoff","filter","view","minConnThld","currentConnThld","edgeColor","color","edgeLabelColor","connect","version","createObj","request","open","onsuccess","result","onerror","onupgradeneeded","currentTarget","instance","pkgs","db","createObjectStore","keyPath","assets","clear","dbid","transaction","objectStore","getAllItems","openCursor","cursor","continue","getItem","putItem","put","updateItem","updater","obj","upd","clearAll","deleteItem","delete","getView","pkg","appendView","viewObj","item","pos","findIndex","splice","updateView","isFunction","deleteView","bin","entries","entry","getAllCollections","items","flatten","coll","getCollection","collID","addCollection","collObj","updateCollection","importItem","legacy","misc","slice","sessionStarted","newDatagrid","toLocaleString","timeZone","addDatagrid","add384Tiles","rowCount","columnCount","chunksPerRow","newNetwork","nodesName","edgesID","getAsset","putAsset","content","singleToMulti","mapping","newMapping","m","mappingToTable","mp","concat","rcd","f","tableToMapping","table","ignore","row","csvToMapping","csvString","lines","header","shift","headerIdx","h","line","values","k","Array","apply","fd","uniqBy","Collection","[object Object]","autoIndex","addField","fs","mapper","func","command","fetcher","idb","sum","some","min","updateHeader","state","selectAll","remove","visibleFields","enter","call","headerCellRenderer","updateRows","recordsToShow","keyFunc","exit","merge","rowHeight","each","d","rowIndex","viewportTop","rowPos","rowFactory","updateViewport","scrollPos","bodyHeight","setScrollPosition","scrollTop","resize","viewport","getBoundingClientRect","top","resizeViewport","innerHeight","viewportHeight","datagrid","floor","previousViewportTop","updateContentsNotifier","applyHeader","applyData","updateFilterNotifier","setFilterText","d3Format","record","d3_format","html","compoundID","image","checkbox","property","disabled","checked","textField","asyncImage","URL","createObjectURL","asyncHtml","txt","cellFunc","numeric","raw","compound_id","assay_id","list","plot","plotCell","vega","View","parse","initialize","run","plotThumbnail","vegaSpec","toImageURL","binaryToDataURI","binary","reader","FileReader","onload","readAsDataURL","text_field","control","svg","async_image","async_html","rowCell","cell","DatagridState","sortedRecords","filteredRecords","defaultColumnHeight","none","scrollBarSpace","numViewportRows","viewportBottom","fixedViewportHeight","component","factory","position","ceil","setViewportSize","setNumViewportRows","widthfSum","reduce","a","widthf","assign","b","applyOrder","order","orderBy","orders","applyFilter","ki","updateFields","joinFields","ci","export","vi","assetBaseURL","badge","updateBadge","notify","transition","duration","ease","easeLinear","delay","loadingCircle","alert","updateAlert","invalidFeedback","updateInvalidMessage","msg","formValue","formValid","checkValidity","setValidity","valid","textareaValid","test","fileInputBox","fileInputValid","updateFormValue","textBox","readonlyBox","updateReadonlyValue","readonlyValue","textareaBox","placeholder","textareaBoxLines","numberBox","updateNumberRange","max","step","dispatch","bubbles","checkBox","box","updateCheckBox","checkBoxValue","colorBox","stopPropagation","clearFileInput","fileInputValue","setFilter","searchBox","setSort","isAsc","setSortOrder","datum","filterTable","rowf","filterSortTable","update","updateRecords","tableRecords","render","resources","profile","cmpdQuery","targets","compound","_formula","_mw","_logp","_nonH","cid","src","__source","struct","aliasQuery","queryMol","ignoreHs","aliases","assayQuery","assays","fetchProfile","catch","client","protocol","onLine"],"mappings":"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"}