{"version":3,"file":"profileApp.js","sources":["../../src/common/client.js","../../src/common/fetcher.js","../../src/component/button.js","../../src/common/misc.js","../../src/common/legacySchema.js","../../src/common/idb.js","../../src/common/mapper.js","../../src/common/collection.js","../../src/datagrid/component.js","../../src/datagrid/rowFactory.js","../../src/common/image.js","../../src/datagrid/state.js","../../src/component/badge.js","../../src/component/formBox.js","../../src/datagrid/rowFilter.js","../../src/datagrid/sort.js","../../src/datagrid/table.js","../../src/profileApp.js"],"sourcesContent":["\n/** @module common/client */\n\nimport _ from 'lodash';\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\nfunction compatibility() {\n  try {\n    () => {};\n  } catch (err) {\n    return 'Client compatibility error: Arrow function not supported';\n  }\n  try {\n    FormData;\n  } catch (err) {\n    return 'Client compatibility error: FormData not supported';\n  }\n  try {\n    fetch;\n  } catch (err) {\n    return 'Client compatibility error: fetch API not supported';\n  }\n}\n\n\nfunction registerServiceWorker() {\n  if ('serviceWorker' in navigator) {\n    if (!isDebugBuild) {  // Grobal isDebugBuild (see rollup.js)\n      window.addEventListener('load', () => {\n        navigator.serviceWorker.register('../sw.js');  // TODO: root path option\n      });\n    } else {\n      console.info('Service worker is disabled for debugging');\n    }\n  } else {\n    console.info('Service worker is not supported');\n  }\n}\n\n\nfunction registerCtrlCommand(key, callback) {\n  document.addEventListener('keydown', event => {\n    if (event.ctrlKey && event.key === key) {\n      callback();\n    }\n  });\n}\n\n\nexport default {\n  URLQuery, compatibility, registerServiceWorker, registerCtrlCommand\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '../req/';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\nfunction serverStatus() {\n  const response = {};\n  return get('server')\n    .then(json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => get('schema'))\n    .then(json)\n    .then(res => {\n      response.schema = res;\n    })\n    .then(() => response);\n}\n\n\nexport default {\n  get, json, text, blob, post, error, serverStatus\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction buttonBox(selection, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .text(label);\n}\n\n\nfunction menuButton(selection, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, target, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('label', true)\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, label, type, icon) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  const button = selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  button.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  button.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, label, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, label, target, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, label, accept, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      });\n  selection.append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  iconBaseURL, buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\n\n\n// TODO: re-define\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  if (['text_field', 'checkbox', 'html'].includes(fmt)) return 'html';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  sortType, formatNum, partialMatch, uuidv4\n};\n","\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: [\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ],\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nfunction convertPackage(json) {\n  let specs = {};\n  if (!json.hasOwnProperty('views')) {\n    const now = new Date();\n    const isNW = json.hasOwnProperty('edges');\n    const data = isNW ? convertNetwork(json) : convertTable(json);\n    const nodes = isNW ? data.nodes : data;\n    specs = {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n      name: data.edges.name,\n      views: [],\n      dataset: []\n    };\n    specs.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: nodes.id,\n      name: nodes.name,\n      contents: [{\n        $schema: nodes.$schema,\n        workflowID: nodes.reference.workflow,\n        name: nodes.name,\n        fields: nodes.fields,\n        records: nodes.records,\n        created: nodes.created,\n        status: nodes.status,\n        query: nodes.query,\n        execTime: nodes.execTime,\n        progress: nodes.progress\n      }]\n    });\n    specs.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: nodes.id,\n      name: nodes.name,\n      viewType: \"datagrid\",\n      rows: nodes.id,\n      fields: nodes.fields,\n      sortOrder: null,\n      filterText: null,\n      checkpoints: [{\n        type: 'convert',\n        date: now.toString(),\n        description: 'converted from legacy format'\n      }]\n    });\n    if (isNW) {\n      specs.dataset.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: data.edges.id,\n        name: data.edges.name,\n        contents: [{\n          $schema: data.edges.$schema,\n          workflowID: data.edges.reference.workflow,\n          name: data.edges.name,\n          fields: data.edges.fields,\n          records: data.edges.records,\n          created: data.edges.created,\n          status: data.edges.status,\n          query: data.edges.query,\n          execTime: data.edges.execTime,\n          progress: data.edges.progress\n        }]\n      });\n      specs.views.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n        viewID: data.edges.id,\n        name: data.edges.name,\n        viewType: \"network\",\n        nodes: nodes.id,\n        edges: data.edges.id,\n        nodeColor: data.edges.snapshot.nodeColor,\n        nodeSize: data.edges.snapshot.nodeSize,\n        nodeLabel: data.edges.snapshot.nodeLabel,\n        nodeLabelColor: data.edges.snapshot.nodeLabelColor,\n        edgeWidth: data.edges.snapshot.edgeWidth,\n        edgeLabel: data.edges.snapshot.edgeLabel,\n        networkThreshold: data.edges.snapshot.networkThreshold,\n        networkThresholdCutoff: data.edges.snapshot.networkThresholdCutoff,\n        fieldTransform: data.edges.snapshot.fieldTransform,\n        coords: data.edges.snapshot.coords,\n        checkpoints: [{\n          type: 'convert',\n          date: now.toString(),\n          description: 'converted from legacy format'\n        }]\n      });\n    }\n    specs.views.filter(e => e.viewType === 'network')\n      .forEach(view => {\n        view.minConnThld = view.networkThresholdCutoff;\n        view.currentConnThld = view.networkThreshold;\n        if (view.hasOwnProperty('nodeLabel')) {\n          view.nodeLabel.field = view.nodeLabel.text;\n        }\n        if (view.hasOwnProperty('edgeLabel')) {\n          view.edgeLabel.field = 'weight';\n        }\n        if (view.hasOwnProperty('edgeWidth')) {\n          view.edgeWidth.field = 'weight';\n        }\n      });\n  } else {\n    specs = json;\n  }\n  specs.views.filter(e => e.viewType === 'network')\n    .forEach(view => {\n      if (!view.nodeColor.field) { view.nodeColor.field = 'index' ;}\n      if (!view.nodeSize.field) { view.nodeSize.field = 'index' ;}\n      if (!view.nodeLabel.field) { view.nodeLabel.field = 'index' ;}\n      if (!view.nodeLabelColor.field) { view.nodeLabelColor.field = 'index' ;}\n      if (!view.edgeColor) {\n        view.edgeColor = {\n          field: 'weight', color: 'monogray',\n          scale: 'linear', domain: [0, 1],\n          range: ['#999999', '#999999'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeColor.field) { view.edgeColor.field = 'weight' ;}\n      if (!view.edgeWidth.field) { view.edgeWidth.field = 'weight' ;}\n      if (!view.edgeLabel.field) { view.edgeLabel.field = 'weight' ;}\n      if (!view.edgeLabelColor) {\n        view.edgeLabelColor = {\n          field: 'weight', color: 'monoblack',\n          scale: 'linear', domain: [1, 1],\n          range: ['#333333', '#333333'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeLabelColor.field) { view.edgeLabelColor.field = 'weight' ;}\n    });\n  return specs;\n}\n\n\nexport default {\n  convertPackage\n};\n","\n/** @module common/idb */\n\nimport _ from 'lodash';\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\nimport {default as legacy} from './legacySchema.js';\n\n// TODO: need package, view and dataset tables?\nconst schema = {\n  items: 'storeID, sessionStarted'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('sessionStarted')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Returns a view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @return {array} view objects\n */\nfunction getView(storeID, viewID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).views)\n    .then(views => {\n      const view = views.find(e => e.viewID === viewID);\n      if (!view) return;\n      view.storeID = storeID;\n      return view;\n    });\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object\n */\nfunction appendView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos + 1, 0, viewObj);\n  });\n}\n\n\n/**\n * Update view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object or update function\n */\nfunction updateView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    if (_.isFunction(viewObj)) {\n      viewObj(item.views[pos]);\n    } else {\n      item.views[pos] = viewObj;\n    }\n  });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteView(storeID, viewID) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos, 1);\n    // prune orphaned collections\n    const bin = {};\n    item.dataset.forEach(e => { bin[e.collectionID] = 0; });\n    item.views.forEach(view => {\n      ['rows', 'items', 'nodes', 'edges']\n        .filter(e => view.hasOwnProperty(e))\n        .forEach(e => { bin[view[e]] += 1; });\n    });\n    Object.entries(bin).forEach(entry => {\n      if (!entry[1]) {\n        const i = item.dataset.findIndex(e => e.collectionID === entry[0]);\n        item.dataset.splice(i, 1);\n      }\n    });\n  });\n}\n\n\n/**\n * Returns all collections in the store\n * @return {array} Collection objects\n */\nfunction getAllCollections() {\n  return getAllItems()\n    .then(items => _.flatten(\n      items.map(item => {\n        return item.dataset.map(coll => {\n          coll.storeID = item.storeID;\n          return coll;\n        });\n      })\n    ));\n}\n\n\n/**\n * Returns a collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @return {array} Collection objects\n */\nfunction getCollection(storeID, collID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).dataset)\n    .then(colls => {\n      const coll = colls.find(e => e.collectionID === collID);\n      if (!coll) return;\n      coll.storeID = storeID;\n      return coll;\n    });\n}\n\n\n/**\n * Update collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object or update function\n */\nfunction updateCollection(storeID, collID, collObj) {\n  return updateItem(storeID, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    if (_.isFunction(collObj)) {\n      collObj(item.dataset[pos]);\n    } else {\n      item.dataset[pos] = collObj;\n    }\n  });\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction importItem(data) {\n  // Legacy format converter\n  data = legacy.convertPackage(data);\n\n  const now = new Date();\n  data.storeID = misc.uuidv4().slice(0, 8);\n  data.sessionStarted = now.toString();\n  return idb.items.put(data);\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} response - response data\n * @return {string} - viewID if sucessfully added\n */\nfunction newDatagrid(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const storeID = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    storeID: storeID,\n    name: response.name,\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n        viewID: viewID,\n        name: response.name,\n        viewType: \"datagrid\",\n        rows: collectionID,\n        checkpoints: [\n          {type: 'creation', date: date}\n        ]\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        name: response.name,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return idb.items.put(data)\n    .then(() => ({storeID: storeID, viewID:viewID}));\n}\n\n\n/**\n * Store new network view\n * @param {string} storeID - Store ID\n * @param {string} nodesID - ID of nodes collection\n * @param {string} nodesName - Name of nodes collection\n * @param {object} response - Response object\n */\nfunction newNetwork(storeID, nodesID, nodesName, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const edgesID = response.workflowID.slice(0, 8);\n  return updateItem(storeID, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: viewID,\n      name: `${nodesName}_${response.name}`,\n      viewType: 'network',\n      nodes: nodesID,\n      edges: edgesID,\n      minConnThld: response.query.params.threshold\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: edgesID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\nexport default {\n  reset, getAllItems, getItem, updateItem, deleteItem,\n  getView, appendView, updateView, deleteView,\n  getAllCollections, getCollection, updateCollection,\n  importItem, newDatagrid, newNetwork\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: [keyField].concat(mp.fields),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: table.fields.filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key)),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: fields,\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(mp.fields)\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/collection */\n\nimport _ from 'lodash';\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as mapper} from './mapper.js';\n\n\nexport default class Collection {\n  /**\n   * Create Collection from a flashflood response datatable\n   * If data is not specified, put datatables later by this.append(data)\n   * @param {object} coll - Collection or response object\n   */\n  constructor(coll) {\n    // Settings\n    this.autoIndex = 'index';  // enumerate records\n\n    this.collectionID = coll.collectionID || null;\n    this.storeID = coll.storeID || null;\n    this.name = coll.name || null;\n    if (coll.records) {\n      this.contents = [coll];\n      this.fields = [];\n    } else {\n      this.contents = coll.contents;\n      this.fields = coll.fields || [];\n    }\n    this.contents.forEach(content => {\n      content.fields.forEach(e => this.addField(e));\n    });\n  }\n\n  /**\n   * Add fields\n   * @param {array} fs - list of fields\n   */\n  addField(field) {\n    if (this.fields.find(e => e.key === field.key)) return;\n    if (!field.hasOwnProperty('name')) field.name = field.key;\n    if (!field.hasOwnProperty('visible')) field.visible = true;\n    if (field.hasOwnProperty('d3_format')) field.format = 'd3_format';\n    if (!field.hasOwnProperty('format')) field.format = 'raw';\n    this.fields.push(field);\n  }\n\n  /**\n   * Update fields properties\n   * @param {array} fs - list of fields\n   */\n  updateFields(fs) {\n    this.fields = [];\n    fs.forEach(e => this.addField(e));\n  }\n\n  /**\n   * Join fields\n   * @param {object} mapping - column mapper object\n   */\n  joinFields(mapping) {\n    this.contents.forEach(c => {\n      mapper.apply(c, mapping);\n    });\n    if (mapping.hasOwnProperty('fields')) {\n      mapping.fields.forEach(e => this.addField(e));\n    } else {\n      this.addField(mapping.field);\n    }\n  }\n\n  /**\n   * Apply function to the original data records\n   * new fields should be manually added by Collection.addField\n   * @param {function} func - function to be applied\n   */\n  apply(func) {\n    this.contents.forEach(content => {\n      content.records.forEach(rcd => {\n        func(rcd);\n      });\n    });\n  }\n\n  /**\n   * Return all records of the collection\n   * @return {array} records\n   */\n  records() {\n    return _.flatten(this.contents.map(e => e.records));\n  }\n\n  fetch(command) {\n    const fs = this.contents\n      .filter(e => ['running', 'ready', 'interrupted', 'queued'].includes(e.status))\n      .map(content => {\n        const query = {id: content.workflowID, command: command};\n        return fetcher.get('progress', query)\n          .then(fetcher.json)\n          .then(data => {\n            return idb.updateCollection(this.storeID, this.collectionID, coll => {\n              const i = coll.contents\n                .findIndex(e => e.workflowID === query.id);\n              if (data.status === 'failure') {  // No data found on server\n                coll.contents[i].status = 'failure';\n              } else {\n                coll.contents[i] = data;\n              }\n            });\n          });\n      });\n    return Promise.all(fs)\n      .then(() => idb.getCollection(this.storeID, this.collectionID))\n      .then(coll => {\n        this.contents = coll.contents;\n      });\n  }\n\n  /**\n   * Retrieve workflows and store it into a local store.\n   * @return {Promise}\n   */\n  pull() {\n    return this.fetch('pull');\n  }\n\n  /**\n   * Retrieve workflows, abort all ongoing workflow task\n   * and store it into a local store.\n   * @return {Promise}\n   */\n  abort() {\n    return this.fetch('abort');\n  }\n\n  /**\n   * Return total number of records\n   * @return {float} total number of records\n   */\n  size() {\n    return _.sum(this.contents.map(e => e.records.length));\n  }\n\n  /**\n   * Return status\n   * @return {string} status\n   */\n  status() {\n    if (this.contents.some(e => e.status === 'interrupted')) return 'interrupted';\n    if (this.contents.some(e => e.status === 'running')) return 'running';\n    if (this.contents.some(e => e.status === 'queued')) return 'queued';\n    if (this.contents.some(e => e.status === 'ready')) return 'ready';\n    if (this.contents.some(e => e.status === 'aborted')) return 'aborted';\n    if (this.contents.some(e => e.status === 'failure')) return 'failure';\n    return 'done';\n  }\n\n  /**\n   * Return ongoing or not\n   * @return {bool} ongoing or not\n   */\n  ongoing() {\n    const s = ['ready', 'queued', 'running', 'interrupted'];\n    return s.includes(this.status());\n  }\n\n  /**\n   * Return percentage of workflow progress\n   * @return {float} progress in percent\n   */\n  progress() {\n    return _.min(this.contents.map(e => e.progress));\n  }\n\n  /**\n   * Return total execution time\n   * @return {float} total time\n   */\n  execTime() {\n    return _.sum(this.contents.map(e => e.execTime));\n  }\n\n  /**\n   * Export collection object as JSON\n   * @return {object} collection JSON\n   */\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: this.collectionID,\n      name: this.name,\n      fields: this.fields,\n      contents: this.contents\n    };\n  }\n}\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction headerCellRenderer(header) {\n  header.style('display', 'inline-block')\n    .style('width', d => `${d.width}%`)\n    .text(d => d.name);\n}\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .call(state.headerCellRenderer);\n}\n\n\nfunction updateRows(selection, state) {\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.selectAll('.dg-cell').remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', 'absolute')\n      .style('width', '100%')\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0)\n          .call(state.rowFactory(), d);\n      });\n}\n\n\nfunction updateViewport(selection, state, scrollPos) {\n  selection.select('.dg-body').style('height', `${state.bodyHeight}px`);\n  state.setScrollPosition(scrollPos);\n  selection.call(updateRows, state, scrollPos);\n  selection.select('.dg-viewport').node().scrollTop = scrollPos * state.rowHeight;\n}\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.resizeViewport(window.innerHeight - viewportTop - 5);\n  viewport.style('height', `${state.viewportHeight}px`);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(updateRows, state, pos);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyHeader();\n    selection.call(updateHeader, state);\n    selection.call(resize, state);\n    state.applyData();\n    selection.call(updateViewport, state, state.viewportTop);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    selection.call(updateViewport, state, 0);\n  };\n}\n\n\n\nexport default {\n  headerCellRenderer, updateHeader, updateRows, updateViewport,\n  resize, datagrid\n};\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction date(selection, record, field) {\n  // TODO; formatter\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  // TODO: Check vulnerabilities\n  selection.html(record[field.key]);\n}\n\n\nfunction compound_id(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n}\n\nfunction textField(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'text')\n      .style('width', '90%')\n      .property('value', record[field.key])\n      .on('change', function () {\n        record[field.key] = this.value;\n      });\n}\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  date: date,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compound_id,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  text_field: textField,\n  control: call,\n  svg: html,\n  html: html\n};\n\n\nfunction rowCell(selection) {\n  selection.classed('dg-cell', true)\n    .classed('align-middle', true)\n    .classed('text-truncate', true)\n    .style('display', 'inline-block');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n          .call(rowCell)\n          .style('width', `${field.width}%`);\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compound_id, image, checkbox, textField, call,\n  rowCell, rowFactory\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nfunction binaryToDataURI(binary) {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      resolve(event.target.result);\n    };\n    reader.readAsDataURL(binary);\n  });\n}\n\n\nexport default {\n  plotCell, plotThumbnail, binaryToDataURI\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport Collection from '../common/collection.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as component} from './component.js';\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(view, coll) {\n    this.storeID = view.storeID || null;\n    this.viewID = view.viewID || null;\n    this.name = view.name || null;\n    this.sortOrder = view.sortOrder || [];\n    this.filterText = view.filterText || null;\n    this.rows = new Collection(coll);\n\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    // TODO: auto adjust\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      html: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.viewportTop = 0;\n    this.previousViewportTop = null;\n    this.viewportBottom = null;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.headerCellRenderer = component.headerCellRenderer;\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n  }\n\n  /**\n   * Set viewport height and number of rows to show\n   * @param {int} height - viewport height\n   */\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n  }\n\n  /**\n   * Set range of the row indices to show\n   * @param {int} position - Index of the top row to show\n   */\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setNumViewportRows() {\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  resizeViewport(height) {\n    this.setViewportSize(height);\n    this.setNumViewportRows();\n  }\n\n  /**\n   * Apply header data\n   */\n  applyHeader() {\n    this.visibleFields = this.rows.fields.filter(e => e.visible);\n    const widthfSum = this.visibleFields.reduce((a, c) => a + (c.widthf || 1), 0);\n    this.visibleFields = this.visibleFields.map(e => {\n      const field = {\n        width: (e.widthf || 1) / widthfSum * 100,\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b, 0).height;\n  }\n\n  /**\n   * Apply row data\n   * 1. applyHeader: define fields and set rowHeight\n   * 2. resize: measure actual window size and calc viewportHeight\n   * 3. applyData: calc number of rows from rowHeight and viewportHeight\n   * 4. setScrollPosition: calc row index range\n   * 5. recordsToShow: slice rows to show\n   */\n  applyData() {\n    this.setNumViewportRows();\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.rows.records().slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.rows.records().slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  updateFields(fs) {\n    this.rows.updateFields(fs);\n  }\n\n  joinFields(mapping) {\n    this.rows.joinFields(mapping);\n    this.applyData();\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  save() {\n    return idb.updateItem(this.storeID, item => {\n      const ci = item.dataset\n        .findIndex(e => e.collectionID === this.rows.collectionID);\n      item.dataset[ci] = this.rows.export();\n      const vi = item.views.findIndex(e => e.viewID === this.viewID);\n      item.views[vi] = this.export();\n    });\n  }\n\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: this.viewID,\n      name: this.name,\n      viewType: \"datagrid\",\n      rows: this.rows.collectionID,\n      sortOrder: this.sortOrder,\n      filterText: this.filterText\n    };\n  }\n}\n","\n/** @module component/badge */\n\nimport d3 from 'd3';\n\nconst assetBaseURL = '../assets/';\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction badge(selection) {\n  selection.classed('badge', true);\n  selection.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('text', true);\n}\n\n\nfunction updateBadge(selection, text, type, icon) {\n  selection.classed(`badge-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nfunction notify(selection) {\n  selection\n    .style('opacity', 0)\n    .style('display', 'inline')\n    .transition()\n      .duration(500)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 1.0)\n    .transition()\n      .delay(3000)\n      .duration(1000)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 0)\n      .on('end', function () {\n        selection.style('display', 'none');\n      });\n}\n\n\nfunction loadingCircle(selection) {\n  selection\n      .style('display', 'none')\n    .append('img')\n      .attr('src', `${assetBaseURL}loading1.gif`)\n      .style('width', '2rem')\n      .style('height', '2rem');\n}\n\n\nfunction alert(selection) {\n  selection.classed('alert', true)\n      .classed('px-1', true)\n      .classed('py-0', true);\n  selection.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('text', true)\n      .style('font-size', '75%');\n}\n\n\nfunction updateAlert(selection, text, type, icon) {\n  selection.classed(`alert-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nfunction invalidFeedback(selection) {\n  selection.classed('invalid-feedback', true)\n      .style('display', 'none');\n  selection.append('img')\n      .classed('icon', true)\n      .attr('src', `${iconBaseURL}caution-salmon.svg`)\n      .style('width', '1rem')\n      .style('height', '1rem');\n  selection.append('span')\n      .classed('invalid-msg', true);\n}\n\nfunction updateInvalidMessage(selection, msg) {\n  selection.select('.invalid-msg')\n      .text(msg);\n}\n\n\nexport default {\n  badge, updateBadge, notify, loadingCircle,\n  alert, updateAlert, invalidFeedback, updateInvalidMessage\n};\n","\n/** @module component/formBox */\n\nimport d3 from 'd3';\n\nimport {default as badge} from './badge.js';\n\n\nfunction updateFormValue(selection, value) {\n  selection.select('.form-control').property('value', value);\n  selection.call(setValidity, true);  // Clear validity state\n}\n\n\nfunction formValue(selection) {\n  return selection.select('.form-control').property('value');\n}\n\n\nfunction formValid(selection) {\n  return selection.select('.form-control').node().checkValidity();\n}\n\n\nfunction setValidity(selection, valid) {\n  selection.select('.invalid-feedback')\n      .style('display', valid ? 'none': 'inherit');\n  selection.select('.form-control')\n      .style('background-color', valid ? null : '#ffcccc');\n}\n\n\nfunction textBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .on('input', function () {\n        const valid = formValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\n\nfunction readonlyBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .attr('readonly', 'readonly');\n}\n\nfunction updateReadonlyValue(selection, value) {\n  selection.select('.form-control-plaintext').property('value', value);\n}\n\nfunction readonlyValue(selection) {\n  return selection.select('.form-control-plaintext').property('value');\n}\n\n\nfunction textareaBox(selection, label, rows, placeholder) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  const formLabel = selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  formLabel.append('div')\n      .call(badge.invalidFeedback);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows)\n      .attr('placeholder', placeholder)\n      .on('input', function () {\n        const valid = textareaValid(selection);\n        selection.call(setValidity, valid);\n      });\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n')\n    .map(e => e.replace(/^\\s+|\\s+$/g, ''))  // strip spaces\n    .filter(e => e.length > 0);\n  return [];\n}\n\nfunction textareaValid(selection) {\n  return /\\s*?\\w\\s*?/.test(formValue(selection));\n}\n\n\nfunction checkBox(selection, label) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox');\n  box.append('span')\n      .text(label);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'number')\n      .on('input', function () {\n        const valid = formValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\nfunction updateNumberRange(selection, min, max, step) {\n  selection.select('.form-control')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step)\n      .dispatch('input', {bubbles: true});\n}\n\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n}\n\n\nfunction fileInputBox(selection, label, accept) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('form-control-file', true)\n      .classed('col-8', true)\n      .attr('type', 'file')\n      .attr('accept', accept)\n      .on('change', function () {\n        const valid = fileInputValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\nfunction clearFileInput(selection) {\n  // TODO: FileList object (input.files) may be a readonly property\n  const label = selection.select('label').text();\n  const accept = selection.select('input').attr('accept');\n  selection.selectAll('*').remove();\n  selection.call(fileInputBox, label, accept);\n}\n\nfunction fileInputValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\nfunction fileInputValid(selection) {\n  // TODO: attribute 'require' does not work with input type=file\n  return selection.select('input').property('files').length > 0;\n}\n\n\nexport default {\n  updateFormValue, formValue, formValid, setValidity,\n  textBox, readonlyBox, updateReadonlyValue, readonlyValue,\n  textareaBox, textareaBoxLines, textareaValid,\n  numberBox, updateNumberRange,\n  checkBox, updateCheckBox, checkBoxValue,\n  colorBox,\n  fileInputBox, clearFileInput, fileInputValue, fileInputValid\n};\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, 'Search');\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.formValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction setSort(selection, state) {\n  state.headerCellRenderer = header => {\n    header.style('display', 'inline-block')\n      .style('width', d => `${d.width}%`)\n      .text(d => d.name)\n      .filter(d => misc.sortType(d.format) !== 'none')\n      .append('span').append('a')\n        .attr('id', d => `sort-${d.key}`)\n        .text('^v')\n        .style('display', 'inline-block')\n        .style('width', '30px')\n        .style('text-align', 'center')\n      .on('click', d => {\n        const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n        d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n        state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n        selection.call(component.updateRows, state);\n      });\n  };\n}\n\n\nexport default {\n  setSort\n};\n","\n/** @module datagrid/table */\n\nimport Collection from '../common/collection.js';\n\nimport DatagridState from './state.js';\nimport {default as component} from './component.js';\nimport {default as rowf} from './rowFilter.js';\nimport {default as sort} from './sort.js';\n\n\nfunction table(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  state.keyFunc = d => d;\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterSortTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(sort.setSort, state)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction update(selection, fields, records) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = selection.datum();\n  state.rows = new Collection(data);\n  state.updateContentsNotifier();\n}\n\n\nfunction updateRecords(selection, records) {\n  const state = selection.datum();\n  state.rows.contents[0].records = records;\n  state.updateContentsNotifier();\n}\n\n\nfunction tableRecords(selection) {\n  const state = selection.datum();\n  return state.rows.records();\n}\n\n\nexport default {\n  table, filterTable, filterSortTable, update, updateRecords, tableRecords\n};\n","\n/** @module profile */\n\nimport d3 from 'd3';\n\nimport {default as client} from './common/client.js';\nimport {default as fetcher} from './common/fetcher.js';\n\nimport {default as button} from './component/button.js';\n\nimport {default as table} from './datagrid/table.js';\n\n\nfunction fetchProfile(compoundID, resources) {\n  const profile = {};\n  // Compound properties\n  const cmpdQuery = {\n    workflow: 'search',\n    targets: resources.filter(e => e.domain === 'chemical').map(e => e.id),\n    key: 'compound_id',\n    values: [compoundID]\n  };\n  return fetcher.get(cmpdQuery.workflow, cmpdQuery)\n    .then(fetcher.json)\n    .then(res => {\n      profile.compound = {\n        fields: [\n          {key: 'key', name: 'key', format: 'text'},\n          {key: 'value', name: 'value', format: 'text'}\n        ],\n        records: [\n          {key: 'Formula', value: res.records[0]._formula},\n          {key: 'Molecular weight', value: res.records[0]._mw},\n          {key: 'Wildman-Crippen logP', value: res.records[0]._logp},\n          {key: 'Non-hydrogen atom count', value: res.records[0]._nonH}\n        ]\n      };\n      profile.cid = res.records[0].compound_id;\n      profile.name = res.records[0].name;\n      profile.src = res.records[0].__source;\n      profile.struct = res.records[0].structure;\n    })\n    .then(() => {\n      const aliasQuery = {\n        workflow: 'exact',\n        targets: resources.filter(e => e.domain === 'chemical').map(e => e.id),\n        queryMol: {\n          format: 'dbid',\n          source: profile.src,\n          value: profile.cid\n        },\n        params: {ignoreHs: true}\n      };\n      return fetcher.get(aliasQuery.workflow, aliasQuery);\n    })\n    .then(fetcher.json)\n    .then(res => {\n      profile.aliases = res;\n      profile.aliases.fields = [\n        {key: 'index', name: 'Index', format: 'd3_format', d3_format: 'd'},\n        {key: 'compound_id', name: 'Compound ID', format: 'compound_id'},\n        {key: 'name', name: 'Name', format: 'text'},\n        {key: '__source', name: 'Source', format: 'text'}\n      ];\n    })\n    .then(() => {\n      const assayQuery = {\n        workflow: 'profile',\n        compound_id: compoundID,\n        targets: resources.filter(e => e.domain === 'activity').map(e => e.id),\n      };\n      return fetcher.get(assayQuery.workflow, assayQuery);\n    })\n    .then(fetcher.json)\n    .then(res => {\n      profile.assays = res;\n      profile.assays.fields = [\n        {key: 'index', name: 'Index', format: 'd3_format', d3_format: 'd'},\n        {key: 'assay_id', name: 'Assay ID', format: 'assay_id'},\n        {key: 'value_type', name: 'Value type', format: 'text'},\n        {key: 'value', name: 'Value', format: 'numeric'}\n      ];\n      return profile;\n    });\n}\n\n\nfunction render(compoundID) {\n  return fetcher.get('schema')\n    .then(fetcher.json)\n    .then(schema => fetchProfile(compoundID, schema.resources))\n    .catch(() => {\n      console.info('Server did not respond');\n      return {\n        aliases: {},\n        assays: {},\n        compound: {}\n      };\n    })\n    .then(res => {\n      const contents = d3.select('#contents')\n          .style('padding-left', '10%')\n          .style('padding-right', '10%');\n      contents.append('h2').classed('mt-5', true).text('Compound ID');\n      contents.append('div').classed('mb-5', true).text(res.cid);\n      contents.append('h2').classed('mt-5', true).text('Name');\n      contents.append('div').classed('mb-5', true).text(res.name);\n      contents.append('h2').classed('mt-5', true).text('Source');\n      contents.append('div').classed('mb-5', true).text(res.src);\n      contents.append('h2').classed('mt-5', true).text('Structure');\n      contents.append('div').classed('mb-5', true).html(res.struct);\n\n      contents.append('h2').classed('mt-5', true).text('Chemical properties');\n      contents.append('div').classed('mb-5', true)\n        .call(table.table, res.compound.fields, res.compound.records,\n              null, 150);\n\n      contents.append('h2').classed('mt-5', true).text('Aliases');\n      contents.append('div').classed('mb-5', true)\n        .call(table.table, res.aliases.fields, res.aliases.records,\n              null, 150);\n\n      contents.append('h2').classed('mt-5', true).text('Assay results');\n      contents.append('div').classed('mb-5', true)\n        .call(table.filterSortTable, res.assays.fields, res.assays.records,\n              null, 400);\n    });\n}\n\n\nfunction run() {\n  const err = client.compatibility();\n  if (err) {\n    d3.select('body')\n      .style('color', '#ff0000')\n      .text(err);\n    return;\n  }\n  // Menubar\n  const menubar = d3.select('#menubar')\n      .classed('my-1', true);\n  menubar.append('a')\n      .call(button.menuButtonLink, 'Dashboard', 'outline-secondary', 'db-gray')\n      .attr('href', 'dashboard.html')\n      .attr('target', '_blank');\n  const compoundID = client.URLQuery().compound || null;\n  if (!compoundID) return;\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";\n  const offLine = 'onLine' in navigator && !navigator.onLine;  client.registerServiceWorker();\n  return render(compoundID);\n}\n\n\nexport default {\n  run\n};\n"],"names":["URLQuery","pairs","window","location","search","substring","split","map","e","_","fromPairs","compatibility","registerServiceWorker","navigator","isDebugBuild","console","info","addEventListener","serviceWorker","register","registerCtrlCommand","key","callback","document","event","ctrlKey","baseURL","get","url","query","q","Object","keys","length","JSON","stringify","fetch","credentials","then","res","status","Promise","reject","Error","statusText","resolve","json","response","text","blob","post","formdata","method","body","error","err","serverStatus","server","schema","iconBaseURL","buttonBox","selection","label","type","classed","append","menuButton","menuButtonLink","icon","attr","style","menuModalLink","target","dropdownMenuButton","button","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","on","d3","select","this","node","click","dropdownMenuFileValue","files","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","format","partialMatch","toString","toUpperCase","indexOf","uuidv4","replace","c","r","Math","random","statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","fields","columns","sort","id","name","dataType","schemaVersion","revision","records","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v10_nodes","reference","convertNetwork","data","edges","hasOwnProperty","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","column","domain","range","unknown","size","visible","nodeContent","structure","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","forEach","i","index","_structure","_index","source","v08_graph","nodeContentVisible","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","$schema","convertPackage","specs","now","Date","isNW","v08_nodes","width","height","convertTable","views","dataset","push","collectionID","contents","workflowID","workflow","viewID","viewType","rows","sortOrder","filterText","checkpoints","date","description","networkThresholdCutoff","filter","view","minConnThld","currentConnThld","edgeColor","color","edgeLabelColor","items","idb","Dexie","getAllItems","orderBy","reverse","toArray","updateItem","storeID","updateFunc","where","equals","modify","catch","version","stores","reset","delete","getItem","first","deleteItem","getView","appendView","viewObj","item","pos","findIndex","splice","updateView","isFunction","deleteView","bin","entries","entry","getAllCollections","flatten","coll","getCollection","collID","colls","updateCollection","collObj","importItem","legacy","misc","slice","sessionStarted","put","newDatagrid","toLocaleString","timeZone","newNetwork","nodesName","edgesID","singleToMulti","mapping","newMapping","m","mappingToTable","mp","concat","rcd","f","tableToMapping","table","ignore","row","csvToMapping","csvString","lines","header","shift","headerIdx","h","line","values","k","Array","apply","fd","uniqBy","Collection","[object Object]","autoIndex","content","addField","fs","mapper","func","command","fetcher","all","sum","some","min","updateHeader","state","selectAll","remove","visibleFields","enter","call","headerCellRenderer","updateRows","recordsToShow","keyFunc","exit","merge","rowHeight","each","d","rowIndex","viewportTop","rowPos","rowFactory","updateViewport","scrollPos","bodyHeight","setScrollPosition","scrollTop","resize","viewport","getBoundingClientRect","top","resizeViewport","innerHeight","viewportHeight","datagrid","floor","previousViewportTop","updateContentsNotifier","applyHeader","applyData","updateFilterNotifier","setFilterText","d3Format","record","d3_format","html","compound_id","image","checkbox","property","disabled","checked","textField","cellFunc","numeric","raw","assay_id","list","plot","plotCell","vega","View","parse","initialize","run","plotThumbnail","vegaSpec","toImageURL","binaryToDataURI","binary","reader","FileReader","onload","result","readAsDataURL","text_field","control","svg","rowCell","cell","DatagridState","sortedRecords","filteredRecords","defaultColumnHeight","none","scrollBarSpace","numViewportRows","viewportBottom","fixedViewportHeight","component","factory","position","ceil","setViewportSize","setNumViewportRows","widthfSum","reduce","a","widthf","assign","b","applyOrder","order","orders","applyFilter","ki","obj","updateFields","joinFields","ci","export","vi","assetBaseURL","badge","updateBadge","notify","transition","duration","ease","easeLinear","delay","loadingCircle","alert","updateAlert","invalidFeedback","updateInvalidMessage","msg","formValue","formValid","checkValidity","setValidity","valid","textareaValid","test","fileInputBox","fileInputValid","updateFormValue","textBox","readonlyBox","updateReadonlyValue","readonlyValue","textareaBox","placeholder","textareaBoxLines","numberBox","updateNumberRange","max","step","dispatch","bubbles","checkBox","box","updateCheckBox","checkBoxValue","colorBox","stopPropagation","clearFileInput","fileInputValue","setFilter","searchBox","setSort","isAsc","setSortOrder","datum","filterTable","rowf","filterSortTable","update","updateRecords","tableRecords","render","compoundID","resources","profile","cmpdQuery","targets","compound","_formula","_mw","_logp","_nonH","cid","src","__source","struct","aliasQuery","queryMol","ignoreHs","aliases","assayQuery","assays","fetchProfile","client","protocol","onLine"],"mappings":"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"}