{"version":3,"file":"dashboardApp.js","sources":["../../src/common/client.js","../../src/common/misc.js","../../src/common/legacySchema.js","../../src/common/idb.js","../../src/common/fetcher.js","../../src/common/mapper.js","../../src/common/collection.js","../../src/common/file.js","../../src/common/specs.js","../../src/component/button.js","../../src/component/modal.js","../../src/component/tree.js","../../src/component/formBox.js","../../src/component/shape.js","../../src/component/formListBox.js","../../src/dialog/search.js","../../src/dialog/formGroup.js","../../src/dialog/struct.js","../../src/dialog/filter.js","../../src/dialog/sdf.js","../../src/dialog/rename.js","../../src/datagrid/component.js","../../src/datagrid/rowFactory.js","../../src/common/image.js","../../src/datagrid/state.js","../../src/datagrid/rowFilter.js","../../src/datagrid/sort.js","../../src/datagrid/table.js","../../src/dashboardApp.js"],"sourcesContent":["\n/** @module common/client */\n\nimport _ from 'lodash';\n\n\nfunction URLQuery() {\n  const pairs = window.location.search.substring(1).split(\"&\")\n    .map(e => e.split('='));\n  return _.fromPairs(pairs);\n}\n\n\nfunction compatibility() {\n  try {\n    () => {};\n  } catch (err) {\n    return 'Client compatibility error: Arrow function not supported';\n  }\n  try {\n    FormData;\n  } catch (err) {\n    return 'Client compatibility error: FormData not supported';\n  }\n  try {\n    fetch;\n  } catch (err) {\n    return 'Client compatibility error: fetch API not supported';\n  }\n}\n\n\nfunction registerServiceWorker() {\n  if ('serviceWorker' in navigator) {\n    window.addEventListener('load', () => {\n      navigator.serviceWorker.register('../sw.js');  // TODO: root path option\n    });\n  } else {\n    console.info('Service worker is not supported');\n  }\n}\n\nexport default {\n  URLQuery, compatibility, registerServiceWorker\n};\n","\n/** @module common/misc */\n\nimport d3 from 'd3';\n\n\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  sortType, formatNum, partialMatch, uuidv4\n};\n","\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: [\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ],\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nfunction convertPackage(json) {\n  if (json.hasOwnProperty('views')) return json;\n  const now = new Date();\n  const isNW = json.hasOwnProperty('edges');\n  const data = isNW ? convertNetwork(json) : convertTable(json);\n  const nodes = isNW ? data.nodes : data;\n  const specs = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    name: data.edges.name,\n    views: [],\n    dataset: []\n  };\n  specs.dataset.push({\n    $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n    collectionID: nodes.id,\n    name: nodes.name,\n    contents: [{\n      $schema: nodes.$schema,\n      workflowID: nodes.reference.workflow,\n      name: nodes.name,\n      fields: nodes.fields,\n      records: nodes.records,\n      created: nodes.created,\n      status: nodes.status,\n      query: nodes.query,\n      execTime: nodes.execTime,\n      progress: nodes.progress\n    }]\n  });\n  specs.views.push({\n    $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n    viewID: nodes.id,\n    name: nodes.name,\n    viewType: \"datagrid\",\n    rows: nodes.id,\n    fields: nodes.fields,\n    sortOrder: null,\n    filterText: null,\n    checkpoints: [{\n      type: 'convert',\n      date: now.toString(),\n      description: 'converted from legacy format'\n    }]\n  });\n  if (isNW) {\n    specs.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: data.edges.id,\n      name: data.edges.name,\n      contents: [{\n        $schema: data.edges.$schema,\n        workflowID: data.edges.reference.workflow,\n        name: data.edges.name,\n        fields: data.edges.fields,\n        records: data.edges.records,\n        created: data.edges.created,\n        status: data.edges.status,\n        query: data.edges.query,\n        execTime: data.edges.execTime,\n        progress: data.edges.progress\n      }]\n    });\n    specs.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: data.edges.id,\n      name: data.edges.name,\n      viewType: \"network\",\n      nodes: nodes.id,\n      edges: data.edges.id,\n      nodeColor: data.edges.snapshot.nodeColor,\n      nodeSize: data.edges.snapshot.nodeSize,\n      nodeLabel: data.edges.snapshot.nodeLabel,\n      nodeLabelColor: data.edges.snapshot.nodeLabelColor,\n      edgeWidth: data.edges.snapshot.edgeWidth,\n      edgeLabel: data.edges.snapshot.edgeLabel,\n      networkThreshold: data.edges.snapshot.networkThreshold,\n      networkThresholdCutoff: data.edges.snapshot.networkThresholdCutoff,\n      fieldTransform: data.edges.snapshot.fieldTransform,\n      coords: data.edges.snapshot.coords,\n      checkpoints: [{\n        type: 'convert',\n        date: now.toString(),\n        description: 'converted from legacy format'\n      }]\n    });\n  }\n  specs.views.filter(e => e.viewType === 'network')\n    .forEach(view => {\n      view.minConnThld = view.networkThresholdCutoff;\n      view.currentConnThld = view.networkThreshold;\n      if (view.hasOwnProperty('nodeLabel')) {\n        view.nodeLabel.field = view.nodeLabel.text;\n      }\n      if (view.hasOwnProperty('edgeLabel')) {\n        view.edgeLabel.field = 'weight';\n      }\n      if (view.hasOwnProperty('edgeWidth')) {\n        view.edgeWidth.field = 'weight';\n      }\n    });\n  return specs;\n}\n\n\nexport default {\n  convertPackage\n};\n","\n/** @module common/idb */\n\nimport _ from 'lodash';\nimport Dexie from 'Dexie';\n\nimport {default as misc} from './misc.js';\nimport {default as legacy} from './legacySchema.js';\n\n// TODO: need package, view and dataset tables?\nconst schema = {\n  items: 'storeID, sessionStarted'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\n/**\n * Delete all data store\n * Try this before dealing with local db issues\n */\nfunction reset() {\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\n\n/**\n * Returns all data store items\n * @return {array} data store objects\n */\nfunction getAllItems() {\n  return idb.items\n    .orderBy('sessionStarted')\n    .reverse()\n    .toArray();\n}\n\n\n/**\n * Get data store items by store ID\n * @param {string} storeID - store ID\n * @return {array} data store object\n */\nfunction getItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .first()\n    .catch(err => {\n      console.error(`IDBError: Unexpected table ID: ${storeID}`, err);\n    });\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - storeID if sucessfully added\n */\nfunction importItem(data) {\n  // Legacy format converter\n  if (!data.hasOwnProperty('views')) {\n    data = legacy.convertPackage(data);\n  }\n  const now = new Date();\n  data.storeID = misc.uuidv4().slice(0, 8);\n  data.sessionStarted = now.toString();\n  return idb.items.put(data);\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} response - response data\n * @return {string} - viewID if sucessfully added\n */\nfunction newDatagrid(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const storeID = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    storeID: storeID,\n    name: viewID,  // TODO: generate from response.query\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n        viewID: viewID,\n        name: viewID,  // TODO: generate from response.query\n        viewType: \"datagrid\",\n        rows: collectionID,\n        checkpoints: [\n          {type: 'creation', date: date}\n        ]\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return idb.items.put(data)\n    .then(() => ({storeID: storeID, viewID:viewID}));\n}\n\n\n/**\n * Update data object in the store\n * @param {string} storeID - store ID\n * @param {function} updateFunc - update function\n * @return {integer} - number of updated items\n */\nfunction updateItem(storeID, updateFunc) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .modify(updateFunc)\n    .catch(err => {\n      console.error('IDBError: Update failed', err);\n    });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteItem(storeID) {\n  return idb.items\n    .where('storeID')\n    .equals(storeID)\n    .delete();\n}\n\n\n/**\n * Returns a view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @return {array} view objects\n */\nfunction getView(storeID, viewID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).views)\n    .then(views => {\n      const view = views.find(e => e.viewID === viewID);\n      if (!view) return;\n      view.storeID = storeID;\n      return view;\n    });\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object\n */\nfunction appendView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos + 1, 0, viewObj);\n  });\n}\n\n\n/**\n * Update view\n * @param {string} storeID - store ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object or update function\n */\nfunction updateView(storeID, viewID, viewObj) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    if (_.isFunction(viewObj)) {\n      viewObj(item.views[pos]);\n    } else {\n      item.views[pos] = viewObj;\n    }\n  });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} storeID - store ID\n * @return {integer} - number of deleted items\n */\nfunction deleteView(storeID, viewID) {\n  return updateItem(storeID, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos, 1);\n    // prune orphaned collections\n    const bin = {};\n    item.dataset.forEach(e => { bin[e.collectionID] = 0; });\n    item.views.forEach(view => {\n      ['rows', 'items', 'nodes', 'edges']\n        .filter(e => view.hasOwnProperty(e))\n        .forEach(e => { bin[view[e]] += 1; });\n    });\n    Object.entries(bin).forEach(entry => {\n      if (!entry[1]) {\n        const i = item.dataset.findIndex(e => e.collectionID === entry[0]);\n        item.dataset.splice(i, 1);\n      }\n    });\n  });\n}\n\n\n/**\n * Returns a collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @return {array} Collection objects\n */\nfunction getCollection(storeID, collID) {\n  return getAllItems()\n    .then(items => items.find(e => e.storeID === storeID).dataset)\n    .then(colls => {\n      const coll = colls.find(e => e.collectionID === collID);\n      if (!coll) return;\n      coll.storeID = storeID;\n      return coll;\n    });\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object\n */\nfunction appendCollection(storeID, collID, collObj) {\n  return updateItem(storeID, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    item.dataset.splice(pos + 1, 0, collObj);\n  });\n}\n\n\n/**\n * Update collection\n * @param {string} storeID - store ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object or update function\n */\nfunction updateCollection(storeID, collID, collObj) {\n  return updateItem(storeID, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    if (_.isFunction(collObj)) {\n      collObj(item.dataset[pos]);\n    } else {\n      item.dataset[pos] = collObj;\n    }\n  });\n}\n\n\nexport default {\n  reset, getAllItems, getItem, importItem, newDatagrid, updateItem, deleteItem,\n  getView, appendView, updateView, deleteView,\n  getCollection, appendCollection, updateCollection\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '../req/';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\nfunction serverStatus() {\n  const response = {};\n  return get('server')\n    .then(json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => get('schema'))\n    .then(json)\n    .then(res => {\n      response.schema = res;\n    })\n    .then(() => response);\n}\n\n\nexport default {\n  get, json, text, blob, post, error, serverStatus\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: [keyField].concat(mp.fields),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: table.fields.filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key)),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: fields,\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(mp.fields)\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/collection */\n\nimport _ from 'lodash';\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as mapper} from './mapper.js';\n\n\nexport default class Collection {\n  /**\n   * Create Collection from a flashflood response datatable\n   * If data is not specified, put datatables later by this.append(data)\n   * @param {object} coll - Collection or response object\n   */\n  constructor(coll) {\n    // Settings\n    this.autoIndex = 'index';  // enumerate records\n\n    this.collectionID = coll.collectionID || null;\n    this.storeID = coll.storeID || null;\n    this.name = coll.name || null;\n    this.contents = coll.contents || [coll];\n    this.fields = [];\n    this.contents.forEach(content => {\n      content.fields.forEach(e => this.addField(e));\n    });\n  }\n\n  /**\n   * Add fields\n   * @param {array} fs - list of fields\n   */\n  addField(field) {\n    if (this.fields.find(e => e.key === field.key)) return;\n    if (!field.hasOwnProperty('name')) field.name = field.key;\n    if (!field.hasOwnProperty('visible')) field.visible = true;\n    if (field.hasOwnProperty('d3_format')) field.format = 'd3_format';\n    if (!field.hasOwnProperty('format')) field.format = 'raw';\n    this.fields.push(field);\n  }\n\n  /**\n   * Update fields properties\n   * @param {array} fs - list of fields\n   */\n  updateFields(fs) {\n    this.fields = [];\n    fs.forEach(e => this.addField(e));\n  }\n\n  /**\n   * Join fields\n   * @param {object} mapping - column mapper object\n   */\n  joinFields(mapping) {\n    this.contents.forEach(c => {\n      mapper.apply(c, mapping);\n    });\n    if (mapping.hasOwnProperty('fields')) {\n      mapping.fields.forEach(e => this.addField(e));\n    } else {\n      this.addField(mapping.field);\n    }\n  }\n\n  /**\n   * Return all records of the collection\n   * @return {array} records\n   */\n  records() {\n    return _.flatten(this.contents.map(e => e.records));\n  }\n\n  fetch(command) {\n    const fs = this.contents\n      .filter(e => ['running', 'ready', 'interrupted', 'queued'].includes(e.status))\n      .map(content => {\n        const query = {id: content.workflowID, command: command};\n        return fetcher.get('progress', query)\n          .then(fetcher.json)\n          .then(data => {\n            return idb.updateCollection(this.storeID, this.collectionID, coll => {\n              const i = coll.contents\n                .findIndex(e => e.workflowID === query.id);\n              if (data.status === 'failure') {  // No data found on server\n                coll.contents[i].status = 'failure';\n              } else {\n                coll.contents[i] = data;\n              }\n            });\n          });\n      });\n    return Promise.all(fs)\n      .then(() => idb.getCollection(this.storeID, this.collectionID))\n      .then(coll => {\n        this.contents = coll.contents;\n      });\n  }\n\n  /**\n   * Retrieve workflows and store it into a local store.\n   * @return {Promise}\n   */\n  pull() {\n    return this.fetch('pull');\n  }\n\n  /**\n   * Retrieve workflows, abort all ongoing workflow task\n   * and store it into a local store.\n   * @return {Promise}\n   */\n  abort() {\n    return this.fetch('abort');\n  }\n\n  /**\n   * Return total number of records\n   * @return {float} total number of records\n   */\n  size() {\n    return _.sum(this.contents.map(e => e.records.length));\n  }\n\n  /**\n   * Return status\n   * @return {string} status\n   */\n  status() {\n    if (this.contents.some(e => e.status === 'interrupted')) return 'interrupted';\n    if (this.contents.some(e => e.status === 'running')) return 'running';\n    if (this.contents.some(e => e.status === 'queued')) return 'queued';\n    if (this.contents.some(e => e.status === 'ready')) return 'ready';\n    if (this.contents.some(e => e.status === 'aborted')) return 'aborted';\n    if (this.contents.some(e => e.status === 'failure')) return 'failure';\n    return 'done';\n  }\n\n  /**\n   * Return ongoing or not\n   * @return {bool} ongoing or not\n   */\n  ongoing() {\n    const s = ['ready', 'queued', 'running', 'interrupted'];\n    return s.includes(this.status());\n  }\n\n  /**\n   * Return percentage of workflow progress\n   * @return {float} progress in percent\n   */\n  progress() {\n    return _.min(this.contents.map(e => e.progress));\n  }\n\n  /**\n   * Return total execution time\n   * @return {float} total time\n   */\n  execTime() {\n    return _.sum(this.contents.map(e => e.execTime));\n  }\n\n  /**\n   * Export collection object as JSON\n   * @return {object} collection JSON\n   */\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: this.collectionID,\n      name: this.name,\n      fields: this.fields,\n      contents: this.contents\n    };\n  }\n}\n","\n/** @module common/file */\n\nimport pako from 'pako';\n\n\nfunction readFile(file, sizeLimit, blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    const truncated = sizeLimit ? file.slice(0, sizeLimit) : file;\n    reader.onload = event => resolve(event.target.result);\n    reader.onerror = error => reject(error);\n    if (blob) {\n      reader.readAsArrayBuffer(truncated);\n    } else {\n      reader.readAsText(truncated);\n    }\n  });\n}\n\n\nfunction parseJSON(data, compressed) {\n  const text = compressed ? pako.inflate(data, {to: 'string'}) : data;\n  return JSON.parse(text);\n}\n\n\nfunction loadJSON(file) {\n  const compressed = file.name.endsWith('c') || file.name.endsWith('.gz');\n  return readFile(file, false, compressed)\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction fetchJSON(url) {\n  const decoded = decodeURIComponent(url);\n  const compressed = decoded.endsWith('c') || decoded.endsWith('.gz');\n  return fetch(decoded)\n    .then(res => compressed ? res.arrayBuffer() : res.json())\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction downloadDataFile(data, name) {\n  try {\n    // cannot hundle large file with dataURI scheme\n    // url = 'data:application/json,' + encodeURIComponent(JSON.stringify(json))\n    const url = window.URL.createObjectURL(new Blob([data]));\n    const a = document.createElement('a');\n    a.download = name;\n    a.href = url;\n    // a.click() does not work on firefox\n    a.dispatchEvent(new MouseEvent('click', {\n      'view': window,\n      'bubbles': true,\n      'cancelable': false\n    }));\n    // window.URL.revokeObjectURL(url) does not work on firefox\n  } catch (e) {\n    // no DOM (unit testing)\n  }\n}\n\n\nfunction downloadJSON(json, name, compress=true) {\n  const str = JSON.stringify(json);\n  const data = compress ? pako.gzip(str) : str;\n  const ext = `.ap${compress ? 'c' : 'r'}`;\n  downloadDataFile(data, `${name}${ext}`);\n}\n\n\nexport default {\n  readFile, parseJSON, loadJSON, fetchJSON,\n  downloadDataFile, downloadJSON\n};\n","\n/** @module common/specs */\n\nimport _ from 'lodash';\n\n\n/**\n * Retern if the package has running tasks\n * @param {object} specs - package JSON\n * @return {bool} if there are any ongoing tasks\n */\nfunction isRunning(specs) {\n  return specs.dataset.some(coll => {\n    return coll.contents.some(e => {\n      return ['ready', 'queued', 'running', 'interrupted'].includes(e.status);\n    });\n  });\n}\n\n\nexport default {\n  isRunning\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction buttonBox(selection, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .text(label);\n}\n\n\nfunction menuButton(selection, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, target, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('label', true)\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, label, type, icon) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  const button = selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  button.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  button.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, label, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, label, target, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, label, accept, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      });\n  selection.append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  iconBaseURL, buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module component/modal */\n\nimport d3 from 'd3';\n\n\nfunction dialogBase(selection, id) {\n  selection\n      .classed('modal', true)\n      .attr('tabindex', -1)\n      .attr('role', 'dialog')\n      .attr('aria-labelledby', '')\n      .attr('aria-hidden', true)\n      .attr('id', id);\n  selection.append('div')\n      .classed('modal-dialog', true)\n      .attr('role', 'document')\n    .append('div')\n      .classed('modal-content', true);\n}\n\n\nfunction confirmDialog(selection, id) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // body\n  base.append('div')\n      .classed('modal-body', true)\n    .append('div')\n      .classed('message', true);\n  // footer\n  const footer = base.append('div')\n      .classed('modal-footer', true);\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-outline-secondary', true)\n      .classed('cancel', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .text('Cancel');\n  footer.append('button')\n      .classed('btn', true)\n      .classed('btn-warning', true)\n      .classed('ok', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('OK')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nfunction updateConfirmDialog(selection, message) {\n  selection.select('.message').text(message);\n}\n\n\nfunction submitDialog(selection, id, title) {\n  const base = selection.call(dialogBase, id)\n      .select('.modal-content');\n  // header\n  const header = base.append('div')\n      .classed('modal-header', true);\n  header.append('h4')\n      .classed('modal-title', true)\n      .text(title);\n  header.append('button')\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('aria-label', 'Close')\n      .classed('close', true)\n    .append('span')\n      .attr('aria-hidden', true)\n      .html('&times;');\n  // body\n  base.append('div')\n      .classed('modal-body', true);\n  // footer\n  base.append('div')\n      .classed('modal-footer', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-primary', true)\n      .classed('submit', true)\n      .attr('type', 'button')\n      .attr('data-dismiss', 'modal')\n      .attr('data-target', `${id}-submit`)\n      .text('Submit')\n      .on('click', () => {\n        d3.select('#loading-icon').style('display', 'inline');\n        selection.dispatch('submit');\n      });\n}\n\n\nexport default {\n  confirmDialog, updateConfirmDialog, submitDialog\n};\n","\n/** @module component/tree */\n\nimport d3 from 'd3';\n\n\nfunction nextLevel(selection, node, nodeFactory) {\n  node.children.forEach(child => {\n    const item = selection.append('li').datum(child.data);  // Bind data record\n    const content = item.append('span')\n      .style('display', 'inline-block');\n    const arrow = child.hasOwnProperty('children') ? '▼ ' : '';\n    content.append('span')\n        .classed('arrow', true)\n        .text(arrow);\n    content.call(nodeFactory, child.data);\n\n    // Collapse on click\n    content.select('.arrow')\n      .on('click', function () {\n        const childList = item.select('ul');\n        if (!childList.size()) return;\n        const expanded = childList.style('display') !== 'none';\n        content.select('.arrow').text(expanded ? '▶ ' : '▼ ');\n        childList.style('display', expanded ? 'none' : 'inherit');\n      });\n\n    // Search next level\n    if (!child.hasOwnProperty('children')) return;\n    item.append('ul')\n        .style('list-style-type', 'none')\n        .call(nextLevel, child, nodeFactory);\n  });\n}\n\n\n // Generate tree view\nfunction tree(selection) {\n  selection\n      .classed('viewport', true)\n      .style('overflow-y', 'scroll')\n      .style('height', '400px')\n    .append('div')\n      .classed('body', true);\n}\n\n\n// Generate tree view\nfunction setHeight(selection, height) {\n  selection.style('height', `${height}px`);\n}\n\n\n// Update tree data\nfunction treeItems(selection, items, keyFunc, nodeFactory) {\n  const root = d3.stratify()\n      .id(keyFunc)\n      .parentId(d => d.parent)(items);\n  selection.select('ul').remove();\n  if (!root.hasOwnProperty('children')) return;\n  selection.select('.body').append('ul')\n      .classed('root', true)\n      .style('padding-left', 0)\n      .style('list-style-type', 'none')\n      .call(nextLevel, root, nodeFactory);\n  selection.selectAll('ul.root > li')\n      .classed('my-2', true);\n}\n\n\n/**\n* Node content\n* @param {d3.selection} selection - selection of node content (span element)\n*/\nfunction checkboxNode(selection, item) {\n  selection.append('input')\n      .attr('type', 'checkbox');\n  selection.append('span')\n      .text(item.id);\n}\n\n\n/**\n * Return list of checkbox values\n * @param {d3.selection} selection - selection of node content (span element)\n */\nfunction checkboxValues(selection) {\n  return selection.select('.body')\n    .selectAll('input:checked').data().map(d => d.id);\n}\n\n\nexport default {\n  tree, treeItems, setHeight, checkboxNode, checkboxValues\n};\n","\n/** @module component/formBox */\n\n\nimport d3 from 'd3';\n\n\nfunction textBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text');\n}\n\nfunction updateTextBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction textBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction readonlyBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .property('readonly', true);\n}\n\n\nfunction textareaBox(selection, label, rows) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows);\n}\n\nfunction updateTextareaBox(selection, value) {\n  selection.select('textarea').property('value', value);\n}\n\nfunction updateTextareaPlaceholder(selection, placeholder) {\n  selection.select('textarea').attr('placeholder', placeholder);\n}\n\nfunction textareaBoxValue(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value;  // TODO: 0 is falsy\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder;\n  return '';\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n').filter(e => e.length > 0);\n  const placeholder = selection.select('textarea').attr('placeholder');\n  if (placeholder) return placeholder.split('\\n').filter(e => e.length > 0);\n  return [];\n}\n\n\nfunction checkBox(selection, label) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox');\n  box.append('span')\n      .text(label);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, label, min, max, step) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'number')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step);\n}\n\nfunction updateNumberBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\nfunction numberFloatValid(selection) {\n  const value = numberBoxFloatValue(selection);\n  const min = parseInt(selection.select('input').attr('min'));\n  const max = parseInt(selection.select('input').attr('max'));\n  const valid = !isNaN(value) && value >= min && value <= max;\n  selection.select('input')\n      .style('background-color', valid ? '#ffffff' : '#ffcccc');\n  return valid;\n}\n\nfunction numberBoxIntValue(selection) {\n  return parseInt(selection.select('input').property('value'));\n}\n\nfunction numberBoxFloatValue(selection) {\n  return parseFloat(selection.select('input').property('value'));\n}\n\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n}\n\n\nfunction updateColorBox(selection, value) {\n  selection.select('input').property('value', value);\n}\n\n\nfunction colorBoxValue(selection) {\n  return selection.select('input').property('value');\n}\n\n\nfunction fileInputBox(selection, label, accept) {\nselection\n    .classed('form-group', true)\n    .classed('form-row', true);\nselection.append('label')\n    .classed('col-form-label', true)\n    .classed('col-form-label-sm', true)\n    .classed('col-4', true)\n    .text(label);\nselection.append('input')\n    .classed('form-control', true)\n    .classed('form-control-sm', true)\n    .classed('form-control-file', true)\n    .classed('col-8', true)\n    .attr('type', 'file')\n    .attr('accept', accept);\n}\n\nfunction clearFileInput(selection) {\n  // TODO: FileList object (input.files) may be a readonly property\n  const accept = selection.select('input').attr();\n  selection.select('input').remove();\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('form-control-file', true)\n      .classed('col-8', true)\n      .attr('type', 'file')\n      .attr('accept', accept);\n}\n\nfunction fileInputBoxValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\n\nexport default {\n  textBox, updateTextBox, textBoxValue, readonlyBox,\n  textareaBox, updateTextareaBox, updateTextareaPlaceholder,\n  textareaBoxValue, textareaBoxLines,\n  checkBox, updateCheckBox, checkBoxValue,\n  numberBox, updateNumberBox, numberFloatValid,\n  numberBoxIntValue, numberBoxFloatValue,\n  colorBox, updateColorBox, colorBoxValue,\n  fileInputBox, clearFileInput, fileInputBoxValue\n};\n","\n/** @module component/shape */\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction monocolorBar(selection, colors, text) {\n  selection.attr('viewBox', '0 0 100 10')\n      .attr('preserveAspectRatio', 'none');\n  const group = selection.append('g');\n  group.append('rect')\n      .attr('x', 0).attr('y', 0)\n      .attr('width', 100).attr('height', 10)\n      .attr('fill', colors[0]);\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 10)\n      .attr('font-size', 12)\n      .text(text);\n}\n\nfunction bicolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n      .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n      .attr('offset', 1).attr('stop-color', colors[1]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction tricolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n    .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n    .attr('offset', 0.5).attr('stop-color', colors[1]);\n  grad.append('stop')\n    .attr('offset', 1).attr('stop-color', colors[2]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction categoricalBar(selection, colors, text) {\n  selection.attr('viewBox', '0 0 100 10')\n      .attr('preserveAspectRatio', 'none');\n  const sw = 100 / colors.length;\n  const group = selection.append('g');\n  colors.forEach((e, i) => {\n    group.append('rect')\n        .attr('x', sw * i).attr('y', 0)\n        .attr('width', sw).attr('height', 20)\n        .attr('fill', colors[i]);\n  });\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 20)\n      .attr('font-size', 20)\n      .text(text);\n}\n\nfunction setSize(selection, width, height) {\n  selection.attr('width', width).attr('height', height);\n}\n\n\nconst colorBar = {\n  'monocolor': monocolorBar,\n  'bicolor': bicolorBar,\n  'tricolor': tricolorBar,\n  'categorical': categoricalBar,\n  'custom': monocolorBar\n};\n\n\nexport default {\n  colorBar, setSize\n};\n","\n/** @module component/formListBox */\n\nimport d3 from 'd3';\n\nimport {default as shape} from './shape.js';\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction selectBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('select')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n}\n\nfunction selectBoxItems(selection, items) {\n  const options = selection.select('select')\n    .selectAll('option')\n      .data(items, d => d.key);\n  options.exit().remove();\n  options.enter()\n    .append('option')\n      .attr('value', d => d.key)\n      .text(d => d.name);\n}\n\nfunction updateSelectBox(selection, value) {\n  selection.select('select').property('value', value);\n}\n\nfunction selectBoxValue(selection) {\n  return selection.select('select').property('value');\n}\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction checklistBox(selection, label) {\n  // TODO: scroll\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('ul')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n}\n\nfunction checklistBoxItems(selection, items) {\n  const listitems = selection.select('ul')\n    .selectAll('li')\n      .data(items, d => d.key);\n  listitems.exit().remove();\n  const form = listitems.enter()\n    .append('li')\n      .attr('class', 'form-check')\n    .append('label')\n      .attr('class', 'form-check-label');\n  form.append('input')\n      .attr('type', 'checkbox')\n      .attr('class', 'form-check-input')\n      .property('value', d => d.key);\n  form.append('span')\n      .text(d => d.name);\n}\n\nfunction updateChecklistBox(selection, values) {\n  if (!values) return;\n  selection.selectAll('input')\n    .each(function (d) {\n      d3.select(this).property('checked', values.includes(d.key));\n    });\n}\n\nfunction checklistBoxValue(selection) {\n  return selection.selectAll('input:checked').data().map(d => d.key);\n}\n\nfunction anyChecked(selection) {\n  return checklistBoxValue(selection).length > 0;\n}\n\n\nfunction colorScaleBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label || 'Colorscale');\n  const form = selection.append('div')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n  const dropdown = form.append('div')\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  dropdown.append('button')\n      .classed('btn', true)\n      .classed(`btn-light`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  dropdown.append('div')\n      .classed('dropdown-menu', true)\n      .classed('py-0', true);\n  form.append('span')\n      .classed('selected', true);\n}\n\nfunction colorScaleBoxItems(selection, items) {\n  const listitems = selection.select('.dropdown-menu')\n    .selectAll('a')\n      .data(items, d => d);\n  listitems.exit().remove();\n  listitems.enter()\n    .append('a')\n      .classed('dropdown-item', true)\n      .classed('py-0', true)\n      .attr('href', '#')\n      .attr('title', d => d.key)\n      .on('click', function (d) {\n        selection.call(setSelectedColorScale, d);\n        selection.dispatch('change', {bubbles: true});\n      })\n    .append('svg')\n      .each(function (d) {\n        d3.select(this)\n          .call(shape.colorBar[d.type], d.colors, d.text)\n          .call(shape.setSize, 100, 10);\n      });\n}\n\nfunction setSelectedColorScale(selection, item) {\n  const selected = selection.select('.selected');\n  selected.selectAll('svg').remove();\n  selected.datum(item);  // Bind selected item record\n  selected.append('svg')\n      .call(shape.colorBar[item.type], item.colors, item.text)\n      .call(shape.setSize, 100, 10);\n}\n\nfunction updateColorScaleBox(selection, key) {\n  const data = selection.select('.dropdown-menu')\n    .selectAll('a').data();\n  const item = data.find(e => e.key === key);\n  selection.call(setSelectedColorScale, item);\n}\n\nfunction colorScaleBoxValue(selection) {\n  return selection.select('.selected').datum().key;\n}\n\nfunction colorScaleBoxItem(selection) {\n  return selection.select('.selected').datum();\n}\n\n\nexport default {\n  selectBox, selectBoxItems, updateSelectBox, selectBoxValue,\n  checklistBox, checklistBoxItems, updateChecklistBox, checklistBoxValue,\n  anyChecked,\n  colorScaleBox, colorScaleBoxItems, updateColorScaleBox,\n  colorScaleBoxValue, colorScaleBoxItem\n};\n","\n/** @module dialog/search */\n\nimport d3 from 'd3';\nimport _ from 'lodash';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'search-dialog';\nconst title = 'Search by compound ID';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-searchtext');\n}\n\n\nfunction body(selection) {\n  const mbody = selection.call(modal.submitDialog, id, title)\n    .select('.modal-body');\n  mbody.append('div')\n      .classed('field', true)\n      .call(lbox.selectBox, 'Field');\n  mbody.append('div')\n      .classed('query', true)\n      .call(box.textareaBox, 'Query', 20);\n}\n\n\nfunction updateBody(selection, resources, placeholder) {\n  const fields = _(resources.map(e => e.fields))\n    .flatten()\n    .uniqBy('key')\n    .value()\n    .filter(e => e.hasOwnProperty('d3_format')\n                 || ['compound_id', 'numeric', 'text'].includes(e.format));\n  const def = fields.find(e => e.format === 'compound_id') || fields[0];\n  selection.select('.field')\n      .call(lbox.selectBoxItems, fields)\n      .call(lbox.updateSelectBox, def.key);\n  selection.select('.query')\n      .call(box.updateTextareaBox, '')\n      .call(box.updateTextareaPlaceholder, placeholder)\n      .on('input', function() {  // Validation\n        const values = box.textareaBoxLines(d3.select(this));\n        selection.select('.submit').property('disabled', !values.length);\n      });\n}\n\n\nfunction execute(selection, resources) {\n  const query = {\n    workflow: 'search',\n    targets: resources.map(e => e.id),  // All DBs\n    key: lbox.selectBoxValue(selection.select('.field')),\n    values: box.textareaBoxLines(selection.select('.query'))\n  };\n  return fetcher.get(query.workflow, query)\n    .then(fetcher.json);\n}\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module dialog/formGroup */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\n\n\n/**\n * Render color range control box group\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction queryMolGroup(selection) {\n  selection\n      .classed('mb-3', true);\n  selection.append('div')\n      .classed('format', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Format')\n      .call(lbox.selectBoxItems,\n            [\n              {key: 'molfile', name: 'MDL Molfile'},\n              {key: 'dbid', name: 'Compound ID'}\n            ]);\n  selection.append('div')\n      .classed('source', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Source');\n  selection.append('div')\n      .classed('textquery', true)\n      .classed('mb-1', true)\n      .call(box.textBox, 'Query');\n  selection.append('div')\n      .classed('areaquery', true)\n      .classed('mb-1', true)\n      .call(box.textareaBox, 'Query', 6, null);\n  // Popover\n  $(function () {\n    $('[data-toggle=\"popover\"]')\n      .popover({html: true, trigger: 'focus'});\n  });\n  selection.append('div')\n      .classed('form-row', true)\n      .classed('justify-content-end', true)\n    .append('button')\n      .classed('preview', true)\n      .attr('data-toggle', 'popover')\n      .attr('data-html', 'true')\n      .attr('data-content', '<div id=\"previmg\"></div>')\n      .call(button.menuButton, 'Structure preview', 'primary');\n}\n\nfunction updateQueryMolGroup(selection, resources) {\n  selection.select('.format')\n      .call(lbox.updateSelectBox, 'molfile')\n      .on('change', function () {\n        const value = lbox.selectBoxValue(d3.select(this));\n        selection.select('.source')\n          .select('select')\n            .property('disabled', value !== 'dbid');\n        selection.select('.textquery')\n            .property('hidden', value !== 'dbid');\n        selection.select('.areaquery')\n            .property('hidden', value !== 'molfile');\n      })\n      .dispatch('change');\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  selection.select('.source')\n      .call(lbox.selectBoxItems, res)\n      .call(lbox.updateSelectBox, null);\n  selection.select('.preview')\n      .on('click', function () {\n        const query = queryMolGroupValue(selection);\n        return fetcher.get('strprev', query)\n          .then(fetcher.text)\n          .then(res => d3.select('#previmg').html(res), fetcher.error);\n      });\n  selection.select('.textquery')\n      .call(box.updateTextBox, '')\n      .on('input', function() {\n        selection.dispatch('validate');\n      });\n  selection.select('.areaquery')\n      .call(box.updateTextareaBox, '')\n      .on('input', function() {\n        selection.dispatch('validate');\n      });\n}\n\nfunction queryMolGroupValue(selection) {\n  const format = lbox.selectBoxValue(selection.select('.format'));\n  const source = lbox.selectBoxValue(selection.select('.source'));\n  const textquery = box.textBoxValue(selection.select('.textquery'));\n  const areaquery = box.textareaBoxLines(selection.select('.areaquery'));\n  return {\n    format: format,\n    source: format === 'dbid' ? source : null,\n    value: format === 'molfile' ? areaquery : textquery\n  };\n}\n\nfunction queryMolGroupValid(selection) {\n  const format = lbox.selectBoxValue(selection.select('.format'));\n  const textquery = box.textBoxValue(selection.select('.textquery'));\n  const areaquery = box.textareaBoxLines(selection.select('.areaquery'));\n  return format === 'molfile' ? areaquery.length : textquery !== '';\n}\n\n\nfunction simOptionGroup(selection) {\n  const id = misc.uuidv4().slice(0, 8);\n  selection\n      .classed('mb-3', true)\n    .append('p')\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-sm', true)\n      .classed('btn-outline-primary', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'collapse')\n      .attr('data-target', `#${id}-collapse`)\n      .attr('aria-expanded', 'false')\n      .attr('aria-controls', `${id}-collapse`)\n      .text('Optional parameters');\n  const collapse = selection.append('div')\n      .classed('collapse', true)\n      .attr('id', `${id}-collapse`)\n    .append('div')\n      .classed('card', true)\n      .classed('card-body', true);\n  collapse.append('div')\n      .classed('ignoreh', true)\n      .classed('mb-1', true)\n      .call(box.checkBox, 'Ignore explicit hydrogens');\n  collapse.append('div')\n      .classed('timeout', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Timeout', 1, 999, 1);\n  collapse.append('div')\n      .classed('diam', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Diameter (MCS-DR/GLS)', 4, 999, 1);\n  collapse.selectAll('label.col-form-label')\n      .classed('col-4', false)\n      .classed('col-6', true);\n  collapse.selectAll('input.form-control')\n      .classed('col-8', false)\n      .classed('col-6', true);\n}\n\n\nfunction updateSimOptionGroup(selection) {\n  selection.select('.ignoreh')\n      .call(box.updateCheckBox, true);\n  selection.select('.timeout')\n      .call(box.updateNumberBox, 2);\n  selection.select('.diam')\n      .call(box.updateNumberBox, 8);\n}\n\n\nfunction simOptionGroupValue(selection) {\n  const timeout = selection.select('.timeout');\n  const diam = selection.select('.diam');\n  const query = {\n    ignoreHs: box.checkBoxValue(selection.select('.ignoreh'))\n  };\n  if (!timeout.select('input').property('disabled')) {\n    query.timeout = box.numberBoxIntValue(timeout);\n  }\n  if (!diam.select('input').property('disabled')) {\n    query.diameter = box.numberBoxIntValue(diam);\n  }\n  return query;\n}\n\n\nexport default {\n  queryMolGroup, updateQueryMolGroup, queryMolGroupValue, queryMolGroupValid,\n  simOptionGroup, updateSimOptionGroup, simOptionGroupValue\n};\n","\n/** @module dialog/struct */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\nimport {default as group} from './formGroup.js';\n\n\nconst id = 'struct-dialog';\nconst title = 'Search by structure';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-searchchem');\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  // Query molecule\n  dialog.select('.modal-body').append('div')\n      .classed('qmol', true)\n      .call(group.queryMolGroup);\n  dialog.select('.modal-body').append('div')\n      .classed('method', true)\n      .call(lbox.selectBox, 'Method');\n  // Measure\n  dialog.select('.modal-body').append('div')\n      .classed('measure', true)\n      .call(lbox.selectBox, 'Measure')\n      .call(lbox.selectBoxItems, [\n              {key: 'sim', name: 'Similarity'},\n              {key: 'edge', name: 'Edge count'}\n            ]);\n  // Threshold\n  dialog.select('.modal-body').append('div')\n      .classed('thld', true)\n      .call(box.numberBox, 'Threshold', 0.5, 1, 0.01);\n  // Similarity search options\n  dialog.select('.modal-body').append('div')\n      .classed('option', true)\n      .call(group.simOptionGroup);\n  // Targets\n  dialog.select('.modal-body').append('div')\n      .classed('target', true)\n      .call(lbox.checklistBox, 'Target databases');\n}\n\n\nfunction updateBody(selection, resources, rdk) {\n  selection.select('.qmol')\n      .call(group.updateQueryMolGroup, resources);\n  // Search type\n  const methodList = [\n    {key: 'exact', name: 'Exact match'},\n    {key: 'substr', name: 'Substructure'},\n    {key: 'supstr', name: 'Superstructure'},\n    {key: 'gls', name: 'MCS-DR/GLS'}\n  ];\n  if (rdk) {\n    methodList.push({key: 'rdmorgan', name: 'RDKit Morgan similarity'});\n    methodList.push({key: 'rdfmcs', name: 'RDKit FMCS'});\n  }\n  selection.select('.method')\n      .call(lbox.selectBoxItems, methodList)\n      .call(lbox.updateSelectBox, 'exact')\n      .on('change', function () {\n        const value = lbox.selectBoxValue(d3.select(this));\n        const mcs = ['gls', 'rdfmcs'].includes(value);\n        selection.select('.measure')\n          .select('select')\n            .property('value', mcs ? undefined : 'sim')\n            .property('disabled', !mcs);\n        selection.selectAll('.thld')\n          .select('input')\n            .property('disabled', ['exact', 'substr', 'supstr'].includes(value));\n        selection.selectAll('.diam')\n          .select('input')\n            .property('disabled', value !== 'gls');\n        selection.select('.timeout')\n          .select('input')\n            .property('disabled', !mcs);\n      })\n      .dispatch('change');\n  selection.select('.measure')\n      .call(lbox.updateSelectBox, 'sim');\n  selection.select('.thld')\n      .call(box.updateNumberBox, 0.5);\n  selection.select('.option')\n      .call(group.updateSimOptionGroup, 'struct');\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  selection.select('.target')\n      .call(lbox.checklistBoxItems, res)\n      .call(lbox.updateChecklistBox, null)\n      .on('change', function() {\n        d3.select(this).dispatch('validate');\n      });\n  // Input validation\n  selection.selectAll('.qmol,.target')\n      .on('validate', function () {\n        const qmolValid = group.queryMolGroupValid(selection.select('.qmol'));\n        const targetChecked = lbox.anyChecked(selection.select('.target'));\n        selection.select('.submit')\n          .property('disabled', !(qmolValid && targetChecked));\n      })\n      .dispatch('validate');\n}\n\n\nfunction execute(selection) {\n  const params = group.simOptionGroupValue(selection.select('.option'));\n  const measure = selection.select('.measure');\n  const thld = selection.select('.thld');\n  if (!measure.select('select').property('disabled')) {\n    params.measure = lbox.selectBoxValue(measure);\n  }\n  if (!thld.select('input').property('disabled')) {\n    params.threshold = box.numberBoxFloatValue(thld);\n  }\n  const query = {\n    workflow: lbox.selectBoxValue(selection.select('.method')),\n    targets: lbox.checklistBoxValue(selection.select('.target')),\n    queryMol: group.queryMolGroupValue(selection.select('.qmol')),\n    params: params\n  };\n  return fetcher.get(query.workflow, query)\n    .then(fetcher.json);\n}\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module dialog/filter */\n\nimport _ from 'lodash';\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'filter-dialog';\nconst title = 'Search by properties';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-searchprop');\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-body').append('div')\n      .classed('key', true)\n      .call(lbox.selectBox, 'Field');\n  dialog.select('.modal-body').append('div')\n      .classed('operator', true)\n      .call(lbox.selectBox, 'Operator')\n      .call(lbox.selectBoxItems, [\n              {key: 'eq', name: '='},\n              {key: 'gt', name: '>'},\n              {key: 'lt', name: '<'},\n              {key: 'ge', name: '>='},\n              {key: 'le', name: '>='},\n              {key: 'lk', name: 'LIKE'}\n            ]);\n  dialog.select('.modal-body').append('div')\n      .classed('value', true)\n      .call(box.textBox, 'Value');\n  // Targets\n  dialog.select('.modal-body').append('div')\n      .classed('target', true)\n      .call(lbox.checklistBox, 'Target databases');\n}\n\n\nfunction updateBody(selection, resources) {\n  const fields = _(resources.map(e => e.fields))\n    .flatten()\n    .uniqBy('key')\n    .value()\n    .filter(e => e.hasOwnProperty('d3_format')\n                 || ['compound_id', 'numeric', 'text'].includes(e.format));\n  selection.select('.key')\n      .call(lbox.selectBoxItems, fields)\n      .call(lbox.updateSelectBox, fields[0]);\n  selection.select('.operator')\n      .call(lbox.updateSelectBox, 'eq');\n  selection.select('.value')\n      .call(box.updateTextBox, '')\n      .on('input', function () {\n        d3.select(this).dispatch('validate');\n      });\n  const res = resources.map(d => ({key: d.id, name: d.name}));\n  selection.select('.target')\n      .call(lbox.checklistBoxItems, res)\n      .call(lbox.updateChecklistBox, null)\n      .on('change', function () {\n        d3.select(this).dispatch('validate');\n      });\n  // Input validation\n  selection.selectAll('.value,.target')\n      .on('validate', function () {\n        const textValid = box.textBoxValue(selection.select('.value')) !== '';\n        const targetChecked = lbox.anyChecked(selection.select('.target'));\n        selection.select('.submit')\n          .property('disabled', !(textValid && targetChecked));\n      })\n      .dispatch('validate');\n}\n\n\n\nfunction execute(selection) {\n  const query = {\n    workflow: 'filter',\n    targets: lbox.checklistBoxValue(selection.select('.target')),\n    key: lbox.selectBoxValue(selection.select('.key')),\n    value: box.textBoxValue(selection.select('.value')),\n    operator: lbox.selectBoxValue(selection.select('.operator'))\n  };\n  return fetcher.get(query.workflow, query)\n    .then(fetcher.json);\n}\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module dialog/sdf */\n\nimport d3 from 'd3';\n\nimport {default as fetcher} from '../common/fetcher.js';\nimport {default as hfile} from '../common/file.js';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nfunction getSDFPropList(str) {\n  const re = />.*?<(\\S+)>/g;\n  const uniqCols = new Set();\n  let arr;\n  while ((arr = re.exec(str)) !== null) {\n    uniqCols.add(arr[1]);\n  }\n  return Array.from(uniqCols);\n}\n\n\nconst id = 'sdf-dialog';\nconst title = 'Import SDFile';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-importsdf');\n}\n\n\nfunction body(selection) {\n  const dialog = selection.call(modal.submitDialog, id, title);\n  dialog.select('.modal-body').append('div')\n      .classed('file', true)\n      .call(box.fileInputBox, 'File', '.mol,.sdf');\n  dialog.select('.modal-body').append('div')\n      .classed('field', true)\n      .call(lbox.checklistBox, 'Fields');\n  dialog.select('.modal-body').append('div')\n      .classed('implh', true)\n      .call(box.checkBox, 'Make hydrogens implicit');\n  dialog.select('.modal-body').append('div')\n      .classed('recalc', true)\n      .call(box.checkBox, 'Recalculate 2D coords');\n}\n\n\nfunction updateBody(selection) {\n  selection.select('.file')\n      .on('change', function () {\n        const file = box.fileInputBoxValue(d3.select(this));\n        d3.select(this).dispatch('validate');\n        // Scan only first 100mb of the file due to memory limit.\n        return hfile.readFile(file, 100 * 1024 * 1024, false)\n          .then(data => {\n            const fields = getSDFPropList(data)\n              .map(e => ({key: e, name: e}));\n            selection.select('.field')\n              .call(lbox.checklistBoxItems, fields);\n          });\n      });\n  selection.select('.field')\n      .call(lbox.checklistBoxItems, [])\n      .on('change', function () {\n        d3.select(this).dispatch('validate');\n      });\n  selection.select('.implh')\n      .call(box.updateCheckBox, true);\n  selection.select('.recalc')\n      .call(box.updateCheckBox, false);\n  // Input validation\n  selection.selectAll('.field,.file')\n      .on('validate', function () {\n        const fileSelected = box.fileInputBoxValue(selection.select('.file'));\n        const fieldChecked = lbox.anyChecked(selection.select('.field'));\n        selection.select('.submit')\n          .property('disabled', !(fileSelected && fieldChecked));\n      })\n      .dispatch('validate');\n}\n\n\nfunction execute(selection) {\n  const params = {\n    fields: lbox.checklistBoxValue(selection.select('.field')),\n    implh: box.checkBoxValue(selection.select('.implh')),\n    recalc: box.checkBoxValue(selection.select('.recalc'))\n  };\n  const formData = new FormData();\n  formData.append('contents', box.fileInputBoxValue(selection.select('.file')));\n  formData.append('params', JSON.stringify(params));\n  return fetcher.post('sdfin', formData)\n    .then(fetcher.json);\n}\n\n\n\nexport default {\n  menuLink, body, updateBody, execute\n};\n","\n/** @module dialog/rename */\n\nimport d3 from 'd3';\n\nimport {default as button} from '../component/button.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as modal} from '../component/modal.js';\n\n\nconst id = 'rename-dialog';\nconst title = 'Rename';\n\n\nfunction menuLink(selection) {\n  selection.call(button.dropdownMenuModal, title, id, 'menu-edittext');\n}\n\n\nfunction body(selection) {\n  selection.call(modal.submitDialog, id, title)\n    .select('.modal-body').append('div')\n      .classed('rename', true)\n      .call(box.textBox, 'New name');\n}\n\n\nfunction updateBody(selection, name) {\n  selection.select('.rename')\n      .call(box.updateTextBox, name)\n      .on('input', function () {  // Validation\n        const keyValid = box.textBoxValue(d3.select(this)) !== '';\n        selection.select('.submit').property('disabled', !keyValid);\n      })\n      .dispatch('input');\n}\n\n\nfunction value(selection) {\n  return box.textBoxValue(selection.select('.rename'));\n}\n\n\nexport default {\n  menuLink, body, updateBody, value\n};\n","\n/** @module datagrid/component */\n\nimport d3 from 'd3';\n\n\nfunction headerCellRenderer(header) {\n  header.style('display', 'inline-block')\n    .style('width', d => `${d.width}%`)\n    .text(d => d.name);\n}\n\n\nfunction updateHeader(selection, state) {\n  const header = selection.select('.dg-header');\n  header.selectAll('.dg-hcell').remove();\n  header.selectAll('.dg-hcell').data(state.visibleFields)\n    .enter().append('div')\n      .classed('dg-hcell', true)\n      .call(state.headerCellRenderer);\n}\n\n\nfunction updateRows(selection, state) {\n  const rows = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(state.recordsToShow(), state.keyFunc);\n  rows.exit().remove();\n  rows.selectAll('.dg-cell').remove();\n  rows.enter()\n    .append('div')\n      .attr('class', 'dg-row')\n      .style('position', 'absolute')\n      .style('width', '100%')\n    .merge(rows)\n      .style('height', `${state.rowHeight}px`)\n      .each(function (d, i) {\n        const rowIndex = state.viewportTop + i;\n        const rowPos = rowIndex * state.rowHeight;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (rowIndex) % 2 === 0)\n          .call(state.rowFactory(), d);\n      });\n}\n\n\nfunction updateViewport(selection, state, scrollPos) {\n  selection.select('.dg-body').style('height', `${state.bodyHeight}px`);\n  state.setScrollPosition(scrollPos);\n  selection.call(updateRows, state, scrollPos);\n  selection.select('.dg-viewport').node().scrollTop = scrollPos * state.rowHeight;\n}\n\n\nfunction resize(selection, state) {\n  const viewport = selection.select('.dg-viewport');\n  const viewportTop = viewport.node().getBoundingClientRect().top;\n  state.resizeViewport(window.innerHeight - viewportTop - 5);\n  viewport.style('height', `${state.viewportHeight}px`);\n}\n\n\nfunction datagrid(selection, state) {\n  selection.append('div')\n      .classed('dg-header', true);\n  selection.append('div')\n      .classed('dg-viewport', true)\n      .style('overflow-y', 'auto')\n      .on('scroll', function () {\n        const pos = Math.floor(this.scrollTop / state.rowHeight);\n        if (pos !== state.previousViewportTop) {\n          state.setScrollPosition(pos);\n          selection.call(updateRows, state, pos);\n        }\n      })\n    .append('div')\n      .classed('dg-body', true)\n      .style('position', 'relative');\n  state.updateContentsNotifier = () => {\n    state.applyHeader();\n    selection.call(updateHeader, state);\n    selection.call(resize, state);\n    state.applyData();\n    selection.call(updateViewport, state, state.viewportTop);\n  };\n  state.updateFilterNotifier = value => {\n    state.setFilterText(value);\n    selection.call(updateViewport, state, 0);\n  };\n  state.updateContentsNotifier();  // TODO: remove\n}\n\n\n\nexport default {\n  headerCellRenderer, updateHeader, updateRows, updateViewport,\n  resize, datagrid\n};\n","\n/** @module datagrid/rowFactory */\n\nimport {default as misc} from '../common/misc.js';\nimport {default as img} from '../common/image.js';\n\n\nfunction d3Format(selection, record, field) {\n  selection.text(misc.formatNum(record[field.key], field.d3_format));\n}\n\n\nfunction text(selection, record, field) {\n  selection.text(record[field.key]);\n}\n\n\nfunction date(selection, record, field) {\n  // TODO; formatter\n  selection.text(record[field.key]);\n}\n\n\nfunction html(selection, record, field) {\n  selection.html(record[field.key]);\n}\n\n\nfunction compound_id(selection, record, field) {\n  selection.append('a')\n      .attr('href',`profile.html?compound=${record[field.key]}`)\n      .attr('target', '_blank')\n      .text(record[field.key]);\n}\n\n\nfunction image(selection, record, field) {\n  selection.append('img')\n      .attr('width', 180)\n      .attr('height', 180)\n      .attr('src', record[field.key]);\n}\n\nfunction checkbox(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'checkbox')\n      .property('checked', record[field.key])\n      .property('disabled', field.disabled ? record[field.disabled] : false)\n      .on('click', function () {\n        record[field.key] = this.checked;\n      });\n}\n\nfunction textField(selection, record, field) {\n  selection.append('input')\n      .attr('type', 'text')\n      .style('width', '90%')\n      .property('value', record[field.key])\n      .on('change', function () {\n        record[field.key] = this.value;\n      });\n}\n\nfunction call(selection, value) {\n  selection.call(value);\n}\n\n\nconst cellFunc = {\n  numeric: text,\n  text: text,\n  date: date,\n  raw: text,\n  d3_format: d3Format,\n  compound_id: compound_id,\n  assay_id: text,\n  list: text,\n  plot: img.plotCell,\n  image: image,\n  checkbox: checkbox,\n  text_field: textField,\n  control: call,\n  svg: html,\n  html: html\n};\n\n\nfunction rowCell(selection) {\n  selection.classed('dg-cell', true)\n    .classed('align-middle', true)\n    .classed('text-truncate', true)\n    .style('display', 'inline-block');\n}\n\n\nfunction rowFactory(fields) {\n  return (selection, record) => {\n    fields.forEach(field => {\n      const cell = selection.append('div')\n          .call(rowCell)\n          .style('width', `${field.width}%`);\n      if (!record.hasOwnProperty(field.key)) return;\n      cell.call(cellFunc[field.format], record, field);\n    });\n  };\n}\n\n\nexport default {\n  d3Format, text, html, compound_id, image, checkbox, textField, call,\n  rowCell, rowFactory\n};\n","\n/** @module common/image */\n\nimport vega from 'vega';\n\n\nfunction plotCell(selection, record, field) {\n  new vega.View(vega.parse(record[field.key]))\n    .initialize(selection.node())\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nfunction binaryToDataURI(binary) {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      resolve(event.target.result);\n    };\n    reader.readAsDataURL(binary);\n  });\n}\n\n\nexport default {\n  plotCell, plotThumbnail, binaryToDataURI\n};\n","\n/** @module datagrid/state */\n\nimport _ from 'lodash';\n\nimport Collection from '../common/collection.js';\nimport {default as idb} from '../common/idb.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as component} from './component.js';\nimport {default as factory} from './rowFactory.js';\n\n\nexport default class DatagridState {\n  constructor(view, coll) {\n    this.storeID = view.storeID || null;\n    this.viewID = view.viewID || null;\n    this.name = view.name || null;\n    this.sortOrder = view.sortOrder || [];\n    this.filterText = view.filterText || null;\n    this.rows = new Collection(coll);\n\n    this.visibleFields = null;\n    this.sortedRecords = null;\n    this.filteredRecords = null;\n\n    // TODO: auto adjust\n    this.defaultColumnHeight = {\n      numeric: 40,\n      text: 40,\n      none: 200\n    };\n    this.scrollBarSpace = 20;\n    this.keyFunc = d => d.index;\n\n    // Size\n    this.rowHeight = null;\n    this.bodyHeight = null;\n\n    // Viewport\n    this.viewportHeight = null;\n    this.numViewportRows = null;\n    this.viewportTop = 0;\n    this.previousViewportTop = null;\n    this.viewportBottom = null;\n\n    this.fixedViewportHeight = null;\n\n    // Event notifier\n    this.updateContentsNotifier = null;\n    this.updateFilterNotifier = null;\n\n    this.headerCellRenderer = component.headerCellRenderer;\n    this.rowFactory = () => factory.rowFactory(this.visibleFields);\n  }\n\n  /**\n   * Set viewport height and number of rows to show\n   * @param {int} height - viewport height\n   */\n  setViewportSize(height) {\n    this.viewportHeight = this.fixedViewportHeight || height;\n  }\n\n  /**\n   * Set range of the row indices to show\n   * @param {int} position - Index of the top row to show\n   */\n  setScrollPosition(position) {\n    this.previousViewportTop = this.viewportTop;\n    this.viewportTop = position;\n    this.viewportBottom = Math.min(\n      this.viewportTop + this.numViewportRows, this.filteredRecords.length);\n  }\n\n  setNumViewportRows() {\n    this.numViewportRows = Math.ceil(this.viewportHeight / this.rowHeight) + 1;\n  }\n\n  resizeViewport(height) {\n    this.setViewportSize(height);\n    this.setNumViewportRows();\n  }\n\n  /**\n   * Apply header data\n   */\n  applyHeader() {\n    this.visibleFields = this.rows.fields.filter(e => e.visible);\n    const widthfSum = this.visibleFields.reduce((a, c) => a + (c.widthf || 1), 0);\n    this.visibleFields = this.visibleFields.map(e => {\n      const field = {\n        width: (e.widthf || 1) / widthfSum * 100,\n        height: e.height || this.defaultColumnHeight[misc.sortType(e.format)]\n      };\n      return Object.assign(field, e);\n    });\n    this.rowHeight = this.visibleFields\n      .reduce((a, b) => a.height > b.height ? a : b, 0).height;\n  }\n\n  /**\n   * Apply row data\n   * 1. applyHeader: define fields and set rowHeight\n   * 2. resize: measure actual window size and calc viewportHeight\n   * 3. applyData: calc number of rows from rowHeight and viewportHeight\n   * 4. setScrollPosition: calc row index range\n   * 5. recordsToShow: slice rows to show\n   */\n  applyData() {\n    this.setNumViewportRows();\n    this.applyOrder();\n  }\n\n  applyOrder(key, order) {\n    if (key) {\n      this.sortedRecords = _.orderBy(this.rows.records().slice(), [key], [order]);\n    } else {\n      const keys = this.sortOrder.map(e => e.key);\n      const orders = this.sortOrder.map(e => e.order);\n      if (keys) {\n        this.sortedRecords = _.orderBy(this.rows.records().slice(), keys, orders);\n      }\n    }\n    this.applyFilter();\n  }\n\n  applyFilter() {\n    if (this.filterText === null) {\n      this.filteredRecords = this.sortedRecords.slice();\n    } else {\n      const fields = this.visibleFields\n        .filter(e => misc.sortType(e.format) !== 'none')\n        .map(e => e.key);\n      this.filteredRecords = this.sortedRecords.filter(row => {\n        return fields.some(f => misc.partialMatch(this.filterText, row[f]));\n      });\n    }\n    this.bodyHeight = this.filteredRecords.length * this.rowHeight;\n  }\n\n  setSortOrder(key, order) {\n    const ki  = this.sortOrder.findIndex(e => e.key);\n    const obj = {key: key, order: order};\n    if (ki !== -1) this.sortOrder.splice(ki, 1);\n    this.sortOrder.splice(0, 0, obj);\n    this.applyOrder(key, order);\n  }\n\n  setFilterText(text) {\n    this.filterText = text;\n    this.applyFilter();\n  }\n\n  updateFields(fs) {\n    this.rows.updateFields(fs);\n  }\n\n  joinFields(mapping) {\n    this.rows.joinFields(mapping);\n    this.applyData();\n  }\n\n  recordsToShow() {\n    return this.filteredRecords.slice(this.viewportTop, this.viewportBottom);\n  }\n\n  save() {\n    return idb.updateItem(this.storeID, item => {\n      const ci = item.dataset\n        .findIndex(e => e.collectionID === this.rows.collectionID);\n      item.dataset[ci] = this.rows.export();\n      const vi = item.views.findIndex(e => e.viewID === this.viewID);\n      item.views[vi] = this.export();\n    });\n  }\n\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: this.viewID,\n      name: this.name,\n      viewType: \"datagrid\",\n      rows: this.rows.collectionID,\n      sortOrder: this.sortOrder,\n      filterText: this.filterText\n    };\n  }\n}\n","\n/** @module datagrid/rowFilter */\n\nimport {default as box} from '../component/formBox.js';\n\n\nfunction setFilter(selection, state) {\n  const searchBox = selection\n      .classed('row', true)\n      .classed('justify-content-end', true)\n    .append('div')\n      .classed('col-5', true)\n      .call(box.textBox, 'Search');\n  searchBox.select('label').classed('text-right', true);\n  searchBox.select('input')\n    .on('keyup', function () {\n      state.updateFilterNotifier(box.textBoxValue(searchBox));\n    });\n}\n\n\nexport default {\n  setFilter\n};\n","\n/** @module datagrid/sort */\n\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as component} from './component.js';\n\n\nfunction setSort(selection, state) {\n  state.headerCellRenderer = header => {\n    header.style('display', 'inline-block')\n      .style('width', d => `${d.width}%`)\n      .text(d => d.name)\n      .filter(d => misc.sortType(d.format) !== 'none')\n      .append('span').append('a')\n        .attr('id', d => `sort-${d.key}`)\n        .text('^v')\n        .style('display', 'inline-block')\n        .style('width', '30px')\n        .style('text-align', 'center')\n      .on('click', d => {\n        const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n        d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n        state.setSortOrder(d.key, isAsc ? 'desc' : 'asc');\n        selection.call(component.updateRows, state);\n      });\n  };\n}\n\n\nexport default {\n  setSort\n};\n","\n/** @module datagrid/table */\n\nimport Collection from '../common/collection.js';\n\nimport DatagridState from './state.js';\nimport {default as component} from './component.js';\nimport {default as rowf} from './rowFilter.js';\nimport {default as sort} from './sort.js';\n\n\nfunction table(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  state.keyFunc = d => d;\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction filterSortTable(selection, fields, records, rowFactory, height) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = new DatagridState({}, data);\n  if (rowFactory) {\n    state.rowFactory = () => rowFactory(state.visibleFields);\n  }\n  state.fixedViewportHeight = height || 300;\n  selection.append('div')\n    .classed('search', true)\n    .call(rowf.setFilter, state);\n  selection.append('div')\n    .classed('table', true)\n    .call(sort.setSort, state)\n    .call(component.datagrid, state);\n  selection.datum(state);\n}\n\n\nfunction update(selection, fields, records) {\n  const data = {\n    fields: fields,\n    records: records\n  };\n  const state = selection.datum();\n  state.rows = new Collection(data);\n  state.updateContentsNotifier();\n}\n\n\nfunction updateRecords(selection, records) {\n  const state = selection.datum();\n  state.rows.contents[0].records = records;\n  state.updateContentsNotifier();\n}\n\n\nfunction tableRecords(selection) {\n  const state = selection.datum();\n  return state.rows.records();\n}\n\n\nexport default {\n  table, filterTable, filterSortTable, update, updateRecords, tableRecords\n};\n","\n/** @module dashboardApp */\n\nimport _ from 'lodash';\nimport d3 from 'd3';\n\nimport {default as client} from './common/client.js';\nimport Collection from './common/collection.js';\nimport {default as fetcher} from './common/fetcher.js';\nimport {default as hfile} from './common/file.js';\nimport {default as idb} from './common/idb.js';\nimport {default as specs} from './common/specs.js';\n\nimport {default as button} from './component/button.js';\nimport {default as modal} from './component/modal.js';\nimport {default as tree} from './component/tree.js';\n\nimport {default as searchDialog} from './dialog/search.js';\nimport {default as structDialog} from './dialog/struct.js';\nimport {default as filterDialog} from './dialog/filter.js';\nimport {default as sdfDialog} from './dialog/sdf.js';\nimport {default as renameDialog} from './dialog/rename.js';\n\nimport {default as table} from './datagrid/table.js';\n\n\nfunction nodeFactory(selection, record) {\n  const iconv = {\n    'datagrid': 'table-darkorange', 'network': 'network-turquoise',\n    'tile': 'tiles-yellowgreen'\n  };\n  const icon = record.viewID ? iconv[record.viewType] : 'file-seagreen';\n  const storeID = record.storeID || record.parent;\n  const node = record.viewID\n    ? selection.append('a')\n      .attr(\n        'href',\n        `${record.viewType}.html?store=${storeID}&view=${record.viewID}`\n      )\n      .attr('target', '_blank')\n    : selection;\n  node.append('img')\n      .attr('src', icon ? `${button.iconBaseURL}${icon}.svg` : null)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  node.append('span')\n      .classed('mr-1', true)\n      .text(record.name);\n  const colors = {\n    done: 'green', running: 'darkorange',\n    ready: 'cornflowerblue', queued: 'cornflowerblue',\n    interrupted: 'salmon', aborted: 'salmon', failure: 'salmon',\n    rows: 'gray', items: 'gray',\n    nodes: 'gray', edges: 'gray'\n  };\n  const icons = {\n    done: 'check-green', running: 'running-darkorange',\n    ready: 'clock-cornflowerblue', queued: 'clock-cornflowerblue',\n    interrupted: 'caution-salmon', aborted: 'caution-salmon',\n    failure: 'caution-salmon',\n    rows: 'table-gray', items: 'tiles-gray',\n    nodes: 'nodes-gray', edges: 'edges-gray'\n  };\n    if (record.viewID) {\n    record.stats.forEach(stat => {\n      selection.append('img')\n          .attr('src', `${button.iconBaseURL}${icons[stat[0]]}.svg`)\n          .style('width', '1rem')\n          .style('height', '1rem');\n      selection.append('span')\n          .classed('pr-1', true)\n          .style('font-size', '0.8rem')\n          .style('color', colors[stat[0]])\n          .text(stat[1]);\n    });\n  } else {\n    selection.append('span')\n        .classed('pr-1', true)\n        .style('font-size', '0.7rem')\n        .style('color', '#999999')\n        .text(record.sessionStarted);\n  }\n  const action = selection.append('span')\n      .classed('p-1', true)\n      .style('border', '1px solid #999999')\n      .style('border-radius', '5px');\n  const actionIcon = (sel, icon) => sel.append('img')\n      .attr('src', `${button.iconBaseURL}${icon}.svg`)\n      .classed('mx-1', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  if (!record.viewID) {\n    action.append('a').call(actionIcon, 'menu-export')\n        .on('click', () => {\n          const data = JSON.parse(JSON.stringify(record));\n          delete data.storeID;\n          delete data.sessionStarted;\n          hfile.downloadJSON(data, data.name);\n        });\n  }\n  action.append('a')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', '#rename-dialog')\n      .call(actionIcon, 'menu-edittext')\n      .on('click', () =>{\n        d3.select('#rename-dialog')\n          .call(renameDialog.updateBody, record.name)\n          .on('submit', function () {\n            if (record.viewID) {\n              idb.updateView(record.parent, record.viewID, view => {\n                view.name = renameDialog.value(d3.select(this));\n              }).then(updateApp);\n            } else {\n              idb.updateItem(record.storeID, item => {\n                item.name = renameDialog.value(d3.select(this));\n              }).then(updateApp);\n            }\n          });\n      });\n  if (!record.ongoing) {\n    const recordType = record.viewID ? record.viewType : 'package';\n    const deleteType = record.alone ? 'package' : recordType;\n    const deleteName = record.alone ? record.parentName : record.name;\n    action.append('a')\n        .attr('data-toggle', 'modal')\n        .attr('data-target', '#delete-dialog')\n        .call(actionIcon, 'delete-gray')\n        .on('click', () =>{\n          d3.select('#delete-dialog')\n            .call(\n              modal.updateConfirmDialog,\n              `Are you sure you want to delete ${deleteType} ${deleteName} ?`\n            )\n            .on('submit', () => {\n              if (record.viewID && !record.alone) {\n                idb.deleteView(record.parent, record.viewID)\n                  .then(updateApp);\n              } else {\n                idb.deleteItem(record.storeID || record.parent)\n                  .then(updateApp);\n              }\n            });\n        });\n  }\n  action.selectAll('img')\n    .on('mouseenter', function() {\n      d3.select(this).style('background-color', '#ffcccc');\n    })\n    .on('mouseleave', function() {\n      d3.select(this).style('background-color', null);\n    });\n}\n\n\nfunction app() {\n  // Menubar\n  const menubar = d3.select('#menubar');\n  // Start\n  const startMenu = menubar.append('div')\n      .call(button.dropdownMenuButton, 'Start', 'primary', 'plus-white')\n      .select('.dropdown-menu');\n  startMenu.append('a').classed('online-command', true)\n      .call(searchDialog.menuLink);\n  startMenu.append('a').classed('online-command', true)\n      .call(structDialog.menuLink);\n  startMenu.append('a').classed('online-command', true)\n      .call(filterDialog.menuLink);\n  startMenu.append('a').classed('online-command', true)\n      .call(sdfDialog.menuLink);\n  startMenu.append('a')\n      .call(button.dropdownMenuFile, 'Open file',\n            '.apc,.apr,.ndc,.ndr,.gfc,.gfr,.json,.gz', 'menu-import')\n      .on('change', function () {\n        const file = button.dropdownMenuFileValue(d3.select(this));\n        hfile.loadJSON(file)\n          .then(idb.importItem)\n          .then(updateApp);\n      });\n\n  // Refresh\n  menubar.append('a')\n      .classed('refresh', true)\n      .classed('online-command', true)\n      .call(button.menuButtonLink,\n            'Refresh all', 'outline-secondary', 'refresh-gray')\n      .on('click', () => updateApp());\n  // Delete all\n  menubar.append('a')\n      .call(button.menuModalLink, 'reset-dialog',\n            'Reset local datastore', 'warning', 'delete-gray');\n\n  const contents = d3.select('#contents')\n      .style('padding-left', '10%')\n      .style('padding-right', '10%');\n\n  // Stored analysis packages\n  contents.append('h5').classed('mt-5', true).text('Packages on local storage');\n  contents.append('div').classed('mb-5', true)\n      .classed('stored', true)\n      .style('border', '1px solid #333333')\n      .call(tree.tree)\n      .call(tree.setHeight, 300);\n\n  // Server calc jobs\n  // TODO: only for admin\n  const calcFields = [\n    {key: 'id', name: 'Workflow ID', format: 'text'},\n    {key: 'size', name: 'File size', format: 'd3_format', d3_format: '.3s'},\n    {key: 'status', name: 'Status', format: 'text'},\n    {key: 'created', name: 'Created', format: 'date', height: 40},\n    {key: 'expires', name: 'Expires', format: 'date', height: 40}\n  ];\n  contents.append('h5').classed('mt-5', true).text('Server calculation job');\n  contents.append('div').classed('mb-5', true).classed('calc', true)\n  .call(table.table, calcFields, [], null, 300);\n\n  // Server status\n  const serverFields = [\n    {key: 'key', name: 'Key', format: 'text'},\n    {key: 'value', name: 'Value', format: 'text'}\n  ];\n  contents.append('h5').classed('mt-5', true).text('Server status');\n  contents.append('div').classed('mb-5', true).classed('server', true)\n  .call(table.table, serverFields, [], null, 300);\n\n  // Dialogs\n  const dialogs = d3.select('#dialogs');\n  dialogs.append('div')\n      .classed('searchd', true)\n      .call(searchDialog.body);\n  dialogs.append('div')\n      .classed('structd', true)\n      .call(structDialog.body);\n  dialogs.append('div')\n      .classed('filterd', true)\n      .call(filterDialog.body);\n  dialogs.append('div')\n      .classed('sdfd', true)\n      .call(sdfDialog.body);\n  dialogs.append('div')\n      .classed('renamed', true)\n      .call(renameDialog.body);\n  dialogs.append('div')\n      .call(modal.confirmDialog, 'reset-dialog')\n      .call(modal.updateConfirmDialog,\n            'Are you sure you want to delete all local tables and reset the datastore ?')\n      .on('submit', () => idb.reset().then(updateApp));\n  dialogs.append('div')\n      .call(modal.confirmDialog, 'delete-dialog');\n\n  // Update\n  updateApp();\n}\n\nfunction updateApp() {\n  const dialogs = d3.select('#dialogs');\n  // Server bound tasks\n  fetcher.serverStatus().then(response => {\n    // Update server status table\n    d3.select('#contents').select('.calc')\n      .call(table.updateRecords, response.server.calc.records);\n    const serverRecords = Object.entries(response.server)\n      .filter(e => e[0] !== 'calc')\n      .map(e => ({key: e[0], value: e[1]}));\n    d3.select('#contents').select('.server')\n      .call(table.updateRecords, serverRecords);\n\n    // Dialogs\n    const chemrsrc = response.schema.resources.filter(e => e.domain === 'chemical');\n    dialogs.select('.searchd')\n        .call(searchDialog.updateBody, chemrsrc, response.schema.compoundIDPlaceholder)\n        .on('submit', function () {\n          searchDialog.execute(d3.select(this), chemrsrc)\n            .then(idb.newDatagrid)\n            .then(r => {\n              window.open(\n                `datagrid.html?store=${r.storeID}&view=${r.viewID}`, '_blank');\n            });\n        });\n    dialogs.select('.structd')\n        .call(structDialog.updateBody, chemrsrc, response.server.rdkit)\n        .on('submit', function () {\n          structDialog.execute(d3.select(this))\n            .then(idb.newDatagrid)\n            .then(r => {\n              window.open(\n                `datagrid.html?store=${r.storeID}&view=${r.viewID}`, '_blank');\n            });\n        });\n    dialogs.select('.filterd')\n        .call(filterDialog.updateBody, chemrsrc)\n        .on('submit', function () {\n          filterDialog.execute(d3.select(this))\n            .then(idb.newDatagrid)\n            .then(r => {\n              window.open(\n                `datagrid.html?store=${r.storeID}&view=${r.viewID}`, '_blank');\n            });\n        });\n    dialogs.select('.sdfd')\n        .call(sdfDialog.updateBody, chemrsrc)\n        .on('submit', function () {\n          sdfDialog.execute(d3.select(this))\n            .then(idb.newDatagrid)\n            .then(r => {\n              window.open(\n                `datagrid.html?store=${r.storeID}&view=${r.viewID}`, '_blank');\n            });\n        });\n\n    // Fetch all ongoing tasks\n    return idb.getAllItems()\n      .then(items => _.flatten(items.map(e => e.dataset)))\n      .then(colls => {\n        const ongoings = colls.map(e => new Collection(e))\n          .filter(e => e.ongoing());\n        return Promise.all(ongoings.map(o => o.pull()));\n      });\n  })\n  .catch(err => {\n    console.info('Server did not respond');\n    console.error(err);\n    // disable on-line commands\n    menubar.selectAll('.online-command')\n      .attr('data-target', null)\n      .classed('disabled', true);\n    d3.select('#contents').select('.calc').text('Off-line');\n    d3.select('#contents').select('.server').text('Off-line');\n  })\n  .finally(() => {\n    // update stored package tree\n    return idb.getAllItems().then(items => {\n      const treeNodes = [{storeID: 'root'}];\n      items.forEach(pkg => {\n        pkg.parent = 'root';\n        pkg.ongoing = specs.isRunning(pkg);\n        treeNodes.push(pkg);\n        pkg.views.forEach(view => {\n          view.parent = pkg.storeID;\n          view.ongoing = pkg.ongoing;\n          view.alone = pkg.views.length <= 1;\n          view.parentName = pkg.name;\n          view.stats = ['nodes', 'edges', 'rows', 'items']\n            .filter(e => view.hasOwnProperty(e))\n            .map(e => [e,\n              d3.format(\".3~s\")(\n                pkg.dataset.find(d => d.collectionID === view[e])\n                  .contents.reduce((a, b) => a + b.records.length, 0))]);\n          const coll = new Collection(pkg.dataset\n            .find(d => d.collectionID === view[\n              ['edges', 'rows', 'items'].filter(e => view.hasOwnProperty(e))[0]\n            ]));\n          const statusText = coll.status() === 'done' ? '' : coll.status();\n          const progText = coll.ongoing() ? `${coll.progress()}%` : '';\n          view.stats.push([coll.status(), `${statusText}${progText}`]);\n          treeNodes.push(view);\n        });\n      });\n      d3.select('#contents').select('.stored')\n        .call(tree.treeItems, treeNodes, d => d.storeID, nodeFactory);\n    });\n  });\n}\n\n\nfunction run() {\n  const err = client.compatibility();\n  if (err) {\n    d3.select('body')\n      .style('color', '#ff0000')\n      .text(err);\n    return;\n  }\n  // TODO: show browser status\n  // TODO: offline mode flags\n  const localFile = document.location.protocol !== \"file:\";  // TODO\n  const offLine = 'onLine' in navigator && !navigator.onLine;  // TODO\n  client.registerServiceWorker();\n  app();\n}\n\n\nexport default {\n  run\n};\n"],"names":["URLQuery","pairs","window","location","search","substring","split","map","e","_","fromPairs","compatibility","registerServiceWorker","navigator","addEventListener","serviceWorker","register","console","info","sortType","fmt","includes","formatNum","value","d3format","Number","isNaN","parseFloat","d3","format","partialMatch","query","target","toString","toUpperCase","indexOf","uuidv4","replace","c","r","Math","random","statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","json","fields","columns","sort","id","name","dataType","schemaVersion","revision","status","records","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v10_nodes","reference","convertNetwork","data","edges","hasOwnProperty","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","key","column","domain","range","unknown","size","text","visible","nodeContent","structure","label","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","forEach","i","index","_structure","_index","source","v08_graph","nodeContentVisible","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","$schema","convertPackage","now","Date","isNW","v08_nodes","width","height","convertTable","specs","views","dataset","push","collectionID","contents","workflowID","workflow","viewID","viewType","rows","sortOrder","filterText","checkpoints","type","date","description","networkThresholdCutoff","filter","view","minConnThld","currentConnThld","schema","items","idb","Dexie","getAllItems","orderBy","reverse","toArray","updateItem","storeID","updateFunc","where","equals","modify","catch","err","error","version","stores","reset","delete","then","getItem","first","importItem","legacy","misc","slice","sessionStarted","put","newDatagrid","response","toLocaleString","timeZone","deleteItem","getView","appendView","viewObj","item","pos","findIndex","splice","updateView","isFunction","deleteView","bin","Object","entries","entry","getCollection","collID","colls","coll","appendCollection","collObj","updateCollection","baseURL","get","url","q","keys","length","JSON","stringify","fetch","credentials","res","Promise","reject","Error","statusText","resolve","blob","post","formdata","method","body","serverStatus","server","singleToMulti","mapping","newMapping","m","mappingToTable","mp","concat","rcd","f","tableToMapping","table","ignore","row","csvToMapping","csvString","lines","header","shift","headerIdx","h","line","values","k","Array","apply","fd","uniqBy","Collection","[object Object]","this","autoIndex","content","addField","fs","mapper","flatten","command","fetcher","all","sum","some","min","readFile","file","sizeLimit","reader","FileReader","truncated","onload","event","result","onerror","readAsArrayBuffer","readAsText","parseJSON","compressed","pako","inflate","to","parse","downloadDataFile","URL","createObjectURL","Blob","a","document","createElement","download","href","dispatchEvent","MouseEvent","bubbles","cancelable","loadJSON","endsWith","fetchJSON","decoded","decodeURIComponent","arrayBuffer","downloadJSON","compress","str","gzip","isRunning","iconBaseURL","buttonBox","selection","classed","append","menuButton","menuButtonLink","icon","attr","style","menuModalLink","dropdownMenuButton","button","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","accept","on","select","node","click","dropdownMenuFileValue","files","dialogBase","confirmDialog","base","call","footer","dispatch","updateConfirmDialog","message","submitDialog","title","html","nextLevel","nodeFactory","children","child","datum","arrow","childList","expanded","tree","treeItems","keyFunc","root","stratify","parentId","d","parent","remove","selectAll","setHeight","checkboxNode","checkboxValues","numberBoxFloatValue","property","textBox","updateTextBox","textBoxValue","readonlyBox","textareaBox","updateTextareaBox","updateTextareaPlaceholder","placeholder","textareaBoxValue","textareaBoxLines","checkBox","box","updateCheckBox","checked","checkBoxValue","numberBox","max","step","updateNumberBox","numberFloatValid","parseInt","valid","numberBoxIntValue","colorBox","stopPropagation","updateColorBox","colorBoxValue","fileInputBox","clearFileInput","fileInputBoxValue","monocolorBar","colors","group","colorBar","monocolor","bicolor","grad","tricolor","categorical","sw","custom","setSize","checklistBoxValue","setSelectedColorScale","selected","shape","selectBox","selectBoxItems","options","exit","enter","updateSelectBox","selectBoxValue","checklistBox","checklistBoxItems","listitems","form","updateChecklistBox","each","anyChecked","colorScaleBox","dropdown","colorScaleBoxItems","updateColorScaleBox","colorScaleBoxValue","colorScaleBoxItem","menuLink","mbody","modal","lbox","updateBody","resources","def","execute","targets","queryMolGroupValue","textquery","areaquery","queryMolGroup","$","popover","trigger","updateQueryMolGroup","queryMolGroupValid","simOptionGroup","collapse","updateSimOptionGroup","simOptionGroupValue","timeout","diam","ignoreHs","diameter","dialog","rdk","methodList","mcs","undefined","qmolValid","targetChecked","measure","thld","queryMol","textValid","operator","hfile","re","uniqCols","Set","arr","exec","add","from","getSDFPropList","fileSelected","fieldChecked","implh","recalc","formData","FormData","keyValid","updateHeader","state","visibleFields","headerCellRenderer","updateRows","recordsToShow","merge","rowHeight","rowIndex","viewportTop","rowPos","rowFactory","updateViewport","scrollPos","bodyHeight","setScrollPosition","scrollTop","resize","viewport","getBoundingClientRect","top","resizeViewport","innerHeight","viewportHeight","datagrid","floor","previousViewportTop","updateContentsNotifier","applyHeader","applyData","updateFilterNotifier","setFilterText","d3Format","record","d3_format","compound_id","image","checkbox","disabled","textField","cellFunc","numeric","raw","assay_id","list","plot","plotCell","vega","View","initialize","run","plotThumbnail","vegaSpec","toImageURL","binaryToDataURI","binary","readAsDataURL","text_field","control","svg","rowCell","cell","DatagridState","sortedRecords","filteredRecords","defaultColumnHeight","none","scrollBarSpace","numViewportRows","viewportBottom","fixedViewportHeight","component","factory","position","ceil","setViewportSize","setNumViewportRows","widthfSum","reduce","widthf","assign","b","applyOrder","order","orders","applyFilter","ki","obj","updateFields","joinFields","ci","export","vi","setFilter","searchBox","setSort","isAsc","setSortOrder","filterTable","rowf","filterSortTable","update","updateRecords","tableRecords","network","tile","done","running","ready","queued","interrupted","aborted","failure","icons","stats","stat","action","actionIcon","sel","renameDialog","updateApp","ongoing","recordType","deleteType","alone","deleteName","parentName","dialogs","calc","serverRecords","chemrsrc","searchDialog","compoundIDPlaceholder","open","structDialog","rdkit","filterDialog","sdfDialog","ongoings","o","pull","menubar","finally","treeNodes","pkg","progText","client","protocol","onLine","startMenu","app"],"mappings":";6jBA2CEA,SArCF,WACE,MAAMC,EAAQC,OAAOC,SAASC,OAAOC,UAAU,GAAGC,MAAM,KACrDC,IAAIC,GAAKA,EAAEF,MAAM,MACpB,OAAOG,EAAEC,UAAUT,IAkCTU,cA9BZ,aA8B2BC,sBAX3B,WACM,kBAAmBC,UACrBX,OAAOY,iBAAiB,OAAQ,KAC9BD,UAAUE,cAAcC,SAAS,cAGnCC,QAAQC,KAAK,4CCGfC,SAnCF,SAAkBC,GAChB,OAAK,UAAW,aAAaC,SAASD,GAAa,WAC9C,OAAQ,cAAe,WAAY,QAAQC,SAASD,GAAa,OAC/D,QAgCGE,UAvBZ,SAAmBC,EAAOC,GACxB,OAAID,MAAAA,GAAyCE,OAAOC,MAAMH,GAAe,GAClEA,GAASI,WAAWJ,GAASK,EAAGC,OAAOL,EAAVI,CAAoBL,GAASA,GAqB5CO,aAjBvB,SAAsBC,EAAOC,GAC3B,OAAIA,MAAAA,GAAsD,KAAXA,IAEC,IADzCA,EAAOC,WAAWC,cACtBC,QAAQJ,EAAME,WAAWC,gBAcOE,OATrC,WACE,MAAO,uCAAuCC,QAAQ,QAAS,SAASC,GACtE,IAAIC,EAAoB,GAAhBC,KAAKC,SAAgB,EAC7B,OADyC,KAALH,EAAWC,EAAS,EAAJA,EAAU,GACrDN,SAAS,QC7BtB,MAAMS,GACJC,OAAQ,QACRC,cAAe,UACfC,SAAU,UACVC,QAAS,UACTC,UAAW,OACXC,QAAS,WAGLC,GACJC,UAAW,QACXC,WAAY,SAGd,SAASC,EAAiBC,GACxB,MAAMC,EAASD,EAAKE,QAAQhD,IAAIC,IACf,YAAXA,EAAEgD,KACJhD,EAAEqB,OAAS,UACS,SAAXrB,EAAEgD,KACXhD,EAAEqB,OAAS,OACS,SAAXrB,EAAEgD,OACXhD,EAAEqB,OAAS,OAENrB,IAET,OACEiD,GAAIJ,EAAKI,GACTC,KAAML,EAAKK,KACXC,SAAUV,EAAaI,EAAKxB,QAC5B+B,cAAe,GACfC,SAAU,EACVC,OAAQpB,EAAWW,EAAKS,QACxBR,OAAQA,EACRS,QAASV,EAAKU,QACdhC,MAAOsB,EAAKtB,MACZiC,UAAWX,EAAKY,YAChBC,UAAWb,EAAKc,gBAAkBd,EAAKY,YACvCG,YAAaf,EAAKgB,YAClBC,SAA0B,IAAhBjB,EAAKiB,SACfC,SAAUlB,EAAKkB,SACfC,QAASnB,EAAKoB,UAAYpB,EAAKqB,cAqInC,SAASC,EAAUtB,GACjB,OACEI,GAAIJ,EAAKI,GACTC,KAAML,EAAKK,KACXC,SAAUN,EAAKM,SACfC,cAAe,OACfC,SAAUR,EAAKQ,SACfC,OAAQT,EAAKS,OACbR,OAAQD,EAAKC,OACbS,QAASV,EAAKU,QACdhC,MAAOsB,EAAKtB,MACZuC,SAAUjB,EAAKiB,SACfC,SAAUlB,EAAKkB,SACfC,QAASnB,EAAKmB,QACdI,cAgGJ,SAASC,EAAexB,GACtB,IAAIyB,EAAOzB,EAkBX,OAjBMyB,EAAKC,MAAMC,eAAe,kBAAoBF,EAAKC,MAAMC,eAAe,aAC5EF,EAAKG,MAAQ7B,EAAiB0B,EAAKG,OACnCH,EAAKC,MAnPT,SAA0B1B,EAAM6B,GAC9B,MAAMC,GACJC,eAAgB/B,EAAKgC,SAASD,eAC9BE,cAAejC,EAAKgC,SAASC,cAC7BC,aACAC,YACAC,aACAC,SAgDF,OA9CIrC,EAAKgC,SAASL,eAAe,cAC/BG,EAAII,UAAU9B,GAAKJ,EAAKgC,SAASE,UAAU9B,GAC3C0B,EAAII,UAAUI,MAAQtC,EAAKgC,SAASE,UAAUI,MAC9CR,EAAII,UAAUK,MAAQV,EAAWW,KAAKrF,GAAKA,EAAEsF,MAAQzC,EAAKgC,SAASE,UAAUQ,SAE7EZ,EAAII,WACF9B,GAAI,QAASmC,MAAOV,EAAW,GAC/BS,OAAQA,MAAO,SAAUK,QAAS,EAAG,GAAIC,OAAQ,QAAS,SAAUC,QAAS,SAG7E7C,EAAKgC,SAASL,eAAe,aAC/BG,EAAIK,SAAS/B,GAAKJ,EAAKgC,SAASG,SAAS/B,GACzC0B,EAAIK,SAASG,MAAQtC,EAAKgC,SAASG,SAASG,MAC5CR,EAAIK,SAASI,MAAQV,EAAWW,KAAKrF,GAAKA,EAAEsF,MAAQzC,EAAKgC,SAASG,SAASO,SAE3EZ,EAAIK,UACF/B,GAAI,OAAQmC,MAAOV,EAAW,GAC9BS,OAAQA,MAAO,SAAUK,QAAS,EAAG,GAAIC,OAAQ,GAAI,IAAKC,QAAS,KAGnE7C,EAAKgC,SAASL,eAAe,cAC/BG,EAAIM,UAAUhC,GAAKJ,EAAKgC,SAASI,UAAUhC,GAC3C0B,EAAIM,UAAUU,KAAO9C,EAAKgC,SAASI,UAAUU,KAC7ChB,EAAIM,UAAUW,KAAO/C,EAAKgC,SAASI,UAAUW,KAC7CjB,EAAIM,UAAUY,QAAUhD,EAAKgC,SAASI,UAAUY,QAChDlB,EAAIM,UAAUE,MAAQtC,EAAKgC,SAASI,UAAUE,MAC9CR,EAAIM,UAAUG,MAAQV,EAAWW,KAAKrF,GAAKA,EAAEsF,MAAQzC,EAAKgC,SAASI,UAAUM,SAE7EZ,EAAIM,WACFhC,GAAI,QAAS0C,KAAM,GAAIC,KAAM,QAASC,SAAS,EAAOT,MAAOV,EAAW,GACxES,OAAQA,MAAO,SAAUK,QAAS,EAAG,GAAIC,OAAQ,QAAS,SAAUC,QAAS,SAG7E7C,EAAKgC,SAASL,eAAe,eAC/BG,EAAImB,YAAcjD,EAAKgC,SAASiB,YAEhCnB,EAAImB,aAAeC,WAAYF,SAAS,IAEtChD,EAAKgC,SAASL,eAAe,QAC/BG,EAAIO,KAAOrC,EAAKgC,SAASK,KAEzBP,EAAIO,MACFjC,GAAI,QAAS+C,OAAQL,KAAM,GAAIE,SAAS,GAAQA,SAAS,EACzDV,OAAQA,MAAO,SAAUK,QAAS,EAAG,GAAIC,OAAQ,EAAG,GAAIC,QAAS,KAInEzC,GAAIJ,EAAKI,GACTC,KAAML,EAAKK,KACXC,SAAUV,EAAaI,EAAKxB,QAC5B+B,cAAe,GACfC,SAAU,EACVe,WACEK,MAAO5B,EAAKoD,aAEd3C,OAAQpB,EAAWW,EAAKS,QACxBR,SACGwC,IAAO,WACPA,IAAO,WACPA,IAAO,WAEV/B,QAASV,EAAKU,QACdhC,MAAOsB,EAAKtB,MACZ2E,iBAAkBrD,EAAKqD,iBACvB1C,UAAWX,EAAKY,YAChBC,UAAWb,EAAKc,gBAAkBd,EAAKY,YACvCG,YAAaf,EAAKgB,YAClBC,SAA0B,IAAhBjB,EAAKiB,SACfC,SAAUlB,EAAKkB,SACfC,QAASnB,EAAKoB,UAAYpB,EAAKqB,aAC/BW,SAAUF,GAoKGwB,CAAiB7B,EAAKC,MAAOD,EAAKG,MAAM3B,SAEvB,OAA5BwB,EAAKC,MAAMnB,eAAuD,KAA7BkB,EAAKC,MAAMnB,iBAClDkB,EAjJJ,SAAmBzB,GAIjB,GAHKA,EAAK0B,MAAMC,eAAe,eAC7B3B,EAAK0B,MAAMH,WAAaK,MAAO5B,EAAK0B,MAAM6B,UAExCvD,EAAK4B,MAAM3B,OAAOuC,KAAKrF,GAAe,WAAVA,EAAEsF,KAAmB,CACnD,MAAMe,KACNxD,EAAK4B,MAAMlB,QAAQ+C,QAAQ,CAACtG,EAAGuG,KAC3BvG,EAAEwG,MAAQD,EACVvG,EAAE+F,UAAY/F,EAAEyG,WAChBJ,EAAcrG,EAAE0G,QAAU1G,EAAEwG,aACrBxG,EAAE0G,cACF1G,EAAEyG,aAEb5D,EAAK0B,MAAMhB,QAAQ+C,QAAQtG,IACvBA,EAAE2G,OAASN,EAAcrG,EAAE2G,QAC3B3G,EAAEwB,OAAS6E,EAAcrG,EAAEwB,UAE/BqB,EAAK4B,MAAM3B,OAAOwD,QAAQtG,IACV,WAAVA,EAAEsF,MAAkBtF,EAAEsF,IAAM,SAClB,eAAVtF,EAAEsF,MAAsBtF,EAAEsF,IAAM,aACrB,YAAXtF,EAAEgD,OAAoBhD,EAAEqB,OAAS,WACtB,SAAXrB,EAAEgD,OAAiBhD,EAAEqB,OAAS,QACnB,SAAXrB,EAAEgD,OAAiBhD,EAAEqB,OAAS,SAGtC,OAAOwB,EAwHE+D,CAAUtC,IACZG,MAAQN,EAAUG,EAAKG,OAC5BH,EAAKC,MApGT,SAAmB1B,GACjB,MAAMgC,GACJqB,iBAAkBrD,EAAKqD,kBA+CzB,OA7CArB,EAASgC,mBAAqBhE,EAAKgC,SAASiB,YAAYC,UAAUF,QAClEhB,EAASE,UAAYlC,EAAKgC,SAASE,UAAUI,UACzCN,EAASE,UAAUK,QACrBP,EAASE,UAAUK,MAAQvC,EAAKgC,SAASE,UAAUK,MAAME,IACxB,WAA7BT,EAASE,UAAUK,QACrBP,EAASE,UAAUK,MAAQ,UAGE,YAA7BP,EAASE,UAAUI,QACrBN,EAASE,UAAUU,MAAQrE,EAAG0F,kBAEhCjC,EAASG,SAAWnC,EAAKgC,SAASG,SAASG,UACvCtC,EAAKgC,SAASG,SAASI,QACzBP,EAASG,SAASI,MAAQvC,EAAKgC,SAASG,SAASI,MAAME,IACvB,WAA5BT,EAASG,SAASI,QACpBP,EAASG,SAASI,MAAQ,UAG9BP,EAASI,aACLpC,EAAKgC,SAASI,UAAUW,OAC1Bf,EAASI,UAAUW,KAAO/C,EAAKgC,SAASI,UAAUW,KAAKN,IACvB,WAA5BT,EAASI,UAAUW,OACrBf,EAASI,UAAUW,KAAO,UAG9Bf,EAASI,UAAUU,KAAO9C,EAAKgC,SAASI,UAAUU,KAClDd,EAASI,UAAUY,QAAUhD,EAAKgC,SAASI,UAAUY,QACrDhB,EAASkC,eAAiBlE,EAAKgC,SAASI,UAAUE,UAC9CtC,EAAKgC,SAASI,UAAUG,QAC1BP,EAASkC,eAAe3B,MAAQvC,EAAKgC,SAASI,UAAUG,MAAME,IACxB,WAAlCT,EAASkC,eAAe3B,QAC1BP,EAASkC,eAAe3B,MAAQ,UAGE,YAAlCP,EAASkC,eAAe5B,QAC1BN,EAASkC,eAAetB,MAAQrE,EAAG0F,kBAErCjC,EAASmC,YAAcnE,EAAKgC,SAASK,KAAKW,QAC1ChB,EAASoC,UAAYpE,EAAKgC,SAASK,KAAKC,UACxCN,EAASqC,aACTrC,EAASqC,UAAUvB,KAAO9C,EAAKgC,SAASK,KAAKc,MAAML,KACnDd,EAASqC,UAAUrB,QAAUhD,EAAKgC,SAASK,KAAKc,MAAMH,QACtDhB,EAASqB,iBAAmBrD,EAAKqD,kBAAoBrD,EAAKtB,MAAM4F,UAChEtC,EAASuC,OAASvE,EAAKgC,SAASC,eAG9B7B,GAAIJ,EAAKI,GACTC,KAAML,EAAKK,KACXC,SAAUN,EAAKM,SACfC,cAAe,OACfC,SAAUR,EAAKQ,SACfC,OAAQT,EAAKS,OACbR,OAAQD,EAAKC,OACbS,QAASV,EAAKU,QACdhC,OAAQ8F,OAAQxE,EAAKtB,OACrBuC,SAAUjB,EAAKiB,SACfC,SAAUlB,EAAKkB,SACfC,QAASnB,EAAKmB,QACda,SAAUA,EACVT,UAAWvB,EAAKuB,WAqCHkD,CAAUhD,EAAKC,QAEzBD,EAAKC,MAAMC,eAAe,oBACtBF,EAAKG,MAAMrB,qBACXkB,EAAKC,MAAMnB,qBACXkB,EAAKG,MAAMpB,gBACXiB,EAAKC,MAAMlB,SAClBiB,EAAKG,MAAM8C,QAAU,yEACrBjD,EAAKC,MAAMgD,QAAU,0EAEhBjD,SA6GPkD,eAzGF,SAAwB3E,GACtB,GAAIA,EAAK2B,eAAe,SAAU,OAAO3B,EACzC,MAAM4E,EAAM,IAAIC,KACVC,EAAO9E,EAAK2B,eAAe,SAC3BF,EAAOqD,EAAOtD,EAAexB,GAnDrC,SAAsBA,GACpB,IAAIyB,EAAOzB,EAoBX,OAnBMyB,EAAKE,eAAe,kBAAoBF,EAAKE,eAAe,aAChEF,EAAO1B,EAAiB0B,IAEA,OAAtBA,EAAKlB,gBAEPkB,EAAOH,EADPG,EAzIJ,SAAmBzB,GAcjB,OAbAA,EAAKU,QAAQ+C,QAAQ,CAACtG,EAAGuG,KACvBvG,EAAEwG,MAAQD,EACVvG,EAAE+F,UAAY/F,EAAEyG,kBACTzG,EAAE0G,cACF1G,EAAEyG,aAEX5D,EAAKC,OAAOwD,QAAQtG,IACJ,WAAVA,EAAEsF,MAAkBtF,EAAEsF,IAAM,SAClB,eAAVtF,EAAEsF,MAAsBtF,EAAEsF,IAAM,aACrB,YAAXtF,EAAEgD,OAAoBhD,EAAEqB,OAAS,WACtB,SAAXrB,EAAEgD,OAAiBhD,EAAEqB,OAAS,QACnB,SAAXrB,EAAEgD,OAAiBhD,EAAEqB,OAAS,SAE7BwB,EA2HE+E,CAAUtD,KAGdA,EAAKE,eAAe,oBAChBF,EAAKlB,qBACLkB,EAAKjB,SACZiB,EAAKiD,QAAU,0EAEjBjD,EAAKxB,OAAOwD,QAAQtG,IACJ,cAAVA,EAAEsF,MACJtF,EAAEqB,OAAS,cAENrB,EAAE6H,aACF7H,EAAE8H,SAEJxD,EA8BoCyD,CAAalF,GAClD4B,EAAQkD,EAAOrD,EAAKG,MAAQH,EAC5B0D,GACJT,QAAS,0DACTrE,KAAMoB,EAAKC,MAAMrB,KACjB+E,SACAC,YA0FF,OAxFAF,EAAME,QAAQC,MACZZ,QAAS,6DACTa,aAAc3D,EAAMxB,GACpBC,KAAMuB,EAAMvB,KACZmF,WACEd,QAAS9C,EAAM8C,QACfe,WAAY7D,EAAML,UAAUmE,SAC5BrF,KAAMuB,EAAMvB,KACZJ,OAAQ2B,EAAM3B,OACdS,QAASkB,EAAMlB,QACfS,QAASS,EAAMT,QACfV,OAAQmB,EAAMnB,OACd/B,MAAOkD,EAAMlD,MACbwC,SAAUU,EAAMV,SAChBD,SAAUW,EAAMX,aAGpBkE,EAAMC,MAAME,MACVZ,QAAS,2DACTiB,OAAQ/D,EAAMxB,GACdC,KAAMuB,EAAMvB,KACZuF,SAAU,WACVC,KAAMjE,EAAMxB,GACZH,OAAQ2B,EAAM3B,OACd6F,UAAW,KACXC,WAAY,KACZC,cACEC,KAAM,UACNC,KAAMtB,EAAIhG,WACVuH,YAAa,mCAGbrB,IACFK,EAAME,QAAQC,MACZZ,QAAS,6DACTa,aAAc9D,EAAKC,MAAMtB,GACzBC,KAAMoB,EAAKC,MAAMrB,KACjBmF,WACEd,QAASjD,EAAKC,MAAMgD,QACpBe,WAAYhE,EAAKC,MAAMH,UAAUmE,SACjCrF,KAAMoB,EAAKC,MAAMrB,KACjBJ,OAAQwB,EAAKC,MAAMzB,OACnBS,QAASe,EAAKC,MAAMhB,QACpBS,QAASM,EAAKC,MAAMP,QACpBV,OAAQgB,EAAKC,MAAMjB,OACnB/B,MAAO+C,EAAKC,MAAMhD,MAClBwC,SAAUO,EAAKC,MAAMR,SACrBD,SAAUQ,EAAKC,MAAMT,aAGzBkE,EAAMC,MAAME,MACVZ,QAAS,0DACTiB,OAAQlE,EAAKC,MAAMtB,GACnBC,KAAMoB,EAAKC,MAAMrB,KACjBuF,SAAU,UACVhE,MAAOA,EAAMxB,GACbsB,MAAOD,EAAKC,MAAMtB,GAClB8B,UAAWT,EAAKC,MAAMM,SAASE,UAC/BC,SAAUV,EAAKC,MAAMM,SAASG,SAC9BC,UAAWX,EAAKC,MAAMM,SAASI,UAC/B8B,eAAgBzC,EAAKC,MAAMM,SAASkC,eACpCE,UAAW3C,EAAKC,MAAMM,SAASoC,UAC/BC,UAAW5C,EAAKC,MAAMM,SAASqC,UAC/BhB,iBAAkB5B,EAAKC,MAAMM,SAASqB,iBACtC+C,uBAAwB3E,EAAKC,MAAMM,SAASoE,uBAC5CrE,eAAgBN,EAAKC,MAAMM,SAASD,eACpCwC,OAAQ9C,EAAKC,MAAMM,SAASuC,OAC5ByB,cACEC,KAAM,UACNC,KAAMtB,EAAIhG,WACVuH,YAAa,oCAInBhB,EAAMC,MAAMiB,OAAOlJ,GAAoB,YAAfA,EAAEyI,UACvBnC,QAAQ6C,IACPA,EAAKC,YAAcD,EAAKF,uBACxBE,EAAKE,gBAAkBF,EAAKjD,iBACxBiD,EAAK3E,eAAe,eACtB2E,EAAKlE,UAAUG,MAAQ+D,EAAKlE,UAAUW,MAEpCuD,EAAK3E,eAAe,eACtB2E,EAAKjC,UAAU9B,MAAQ,UAErB+D,EAAK3E,eAAe,eACtB2E,EAAKlC,UAAU7B,MAAQ,YAGtB4C,IClZT,MAAMsB,GACJC,MAAO,2BAGT,IAAIC,EAAM,IAAIC,EAAM,SAoBpB,SAASC,IACP,OAAOF,EAAID,MACRI,QAAQ,kBACRC,UACAC,UAoFL,SAASC,EAAWC,EAASC,GAC3B,OAAOR,EAAID,MACRU,MAAM,WACNC,OAAOH,GACPI,OAAOH,GACPI,MAAMC,IACL5J,QAAQ6J,MAAM,0BAA2BD,KAjH/Cb,EAAIe,QAAQ,GAAGC,OAAOlB,UAmQpBmB,MA5PF,WACE,OAAOjB,EAAIkB,SAASC,KAAK,MACvBnB,EAAM,IAAIC,EAAM,UACZc,QAAQ,GAAGC,OAAOlB,MAyPjBI,YAAAA,EAAakB,QAnOtB,SAAiBb,GACf,OAAOP,EAAID,MACRU,MAAM,WACNC,OAAOH,GACPc,QACAT,MAAMC,IACL5J,QAAQ6J,wCAAwCP,IAAWM,MA6NlCS,WAnN/B,SAAoBxG,GAEbA,EAAKE,eAAe,WACvBF,EAAOyG,EAAOvD,eAAelD,IAE/B,MAAMmD,EAAM,IAAIC,KAGhB,OAFApD,EAAKyF,QAAUiB,EAAKpJ,SAASqJ,MAAM,EAAG,GACtC3G,EAAK4G,eAAiBzD,EAAIhG,WACnB+H,EAAID,MAAM4B,IAAI7G,IA2MoB8G,YAlM3C,SAAqBC,GACnB,MACMtC,GADM,IAAIrB,MACC4D,eAAe,SAAWC,SAAU,eAC/CxB,EAAUiB,EAAKpJ,SAASqJ,MAAM,EAAG,GACjCzC,EAASwC,EAAKpJ,SAASqJ,MAAM,EAAG,GAChC7C,EAAeiD,EAAS/C,WAAW2C,MAAM,EAAG,GAC5C3G,GACJiD,QAAS,0DACTwC,QAASA,EACT7G,KAAMsF,EACNP,QAEIV,QAAS,2DACTiB,OAAQA,EACRtF,KAAMsF,EACNC,SAAU,WACVC,KAAMN,EACNS,cACGC,KAAM,WAAYC,KAAMA,MAI/Bb,UAEIX,QAAS,6DACTa,aAAcA,EACdC,UAAWgD,KAGfH,eAAgBnC,GAElB,OAAOS,EAAID,MAAM4B,IAAI7G,GAClBqG,KAAK,MAAQZ,QAASA,EAASvB,OAAOA,MAkKasB,WAAAA,EAAY0B,WAxIpE,SAAoBzB,GAClB,OAAOP,EAAID,MACRU,MAAM,WACNC,OAAOH,GACPW,UAqIHe,QA3HF,SAAiB1B,EAASvB,GACxB,OAAOkB,IACJiB,KAAKpB,GAASA,EAAMlE,KAAKrF,GAAKA,EAAE+J,UAAYA,GAAS9B,OACrD0C,KAAK1C,IACJ,MAAMkB,EAAOlB,EAAM5C,KAAKrF,GAAKA,EAAEwI,SAAWA,GAC1C,GAAKW,EAEL,OADAA,EAAKY,QAAUA,EACRZ,KAoHFuC,WAzGX,SAAoB3B,EAASvB,EAAQmD,GACnC,OAAO7B,EAAWC,EAAS6B,IACzB,MAAMC,EAAMD,EAAK3D,MAAM6D,UAAU9L,GAAKA,EAAEwI,SAAWA,GACnDoD,EAAK3D,MAAM8D,OAAOF,EAAM,EAAG,EAAGF,MAsGXK,WA3FvB,SAAoBjC,EAASvB,EAAQmD,GACnC,OAAO7B,EAAWC,EAAS6B,IACzB,MAAMC,EAAMD,EAAK3D,MAAM6D,UAAU9L,GAAKA,EAAEwI,SAAWA,GAC/CvI,EAAEgM,WAAWN,GACfA,EAAQC,EAAK3D,MAAM4D,IAEnBD,EAAK3D,MAAM4D,GAAOF,KAqFWO,WA1EnC,SAAoBnC,EAASvB,GAC3B,OAAOsB,EAAWC,EAAS6B,IACzB,MAAMC,EAAMD,EAAK3D,MAAM6D,UAAU9L,GAAKA,EAAEwI,SAAWA,GACnDoD,EAAK3D,MAAM8D,OAAOF,EAAK,GAEvB,MAAMM,KACNP,EAAK1D,QAAQ5B,QAAQtG,IAAOmM,EAAInM,EAAEoI,cAAgB,IAClDwD,EAAK3D,MAAM3B,QAAQ6C,KAChB,OAAQ,QAAS,QAAS,SACxBD,OAAOlJ,GAAKmJ,EAAK3E,eAAexE,IAChCsG,QAAQtG,IAAOmM,EAAIhD,EAAKnJ,KAAO,MAEpCoM,OAAOC,QAAQF,GAAK7F,QAAQgG,IAC1B,IAAKA,EAAM,GAAI,CACb,MAAM/F,EAAIqF,EAAK1D,QAAQ4D,UAAU9L,GAAKA,EAAEoI,eAAiBkE,EAAM,IAC/DV,EAAK1D,QAAQ6D,OAAOxF,EAAG,SA4D7BgG,cA/CF,SAAuBxC,EAASyC,GAC9B,OAAO9C,IACJiB,KAAKpB,GAASA,EAAMlE,KAAKrF,GAAKA,EAAE+J,UAAYA,GAAS7B,SACrDyC,KAAK8B,IACJ,MAAMC,EAAOD,EAAMpH,KAAKrF,GAAKA,EAAEoI,eAAiBoE,GAChD,GAAKE,EAEL,OADAA,EAAK3C,QAAUA,EACR2C,KAwCIC,iBA7BjB,SAA0B5C,EAASyC,EAAQI,GACzC,OAAO9C,EAAWC,EAAS6B,IACzB,MAAMC,EAAMD,EAAK1D,QAAQ4D,UAAU9L,GAAKA,EAAEoI,eAAiBoE,GAC3DZ,EAAK1D,QAAQ6D,OAAOF,EAAM,EAAG,EAAGe,MA0BDC,iBAfnC,SAA0B9C,EAASyC,EAAQI,GACzC,OAAO9C,EAAWC,EAAS6B,IACzB,MAAMC,EAAMD,EAAK1D,QAAQ4D,UAAU9L,GAAKA,EAAEoI,eAAiBoE,GACvDvM,EAAEgM,WAAWW,GACfA,EAAQhB,EAAK1D,QAAQ2D,IAErBD,EAAK1D,QAAQ2D,GAAOe,MCvQ1B,MAAME,EAAU,UAEhB,SAASC,EAAIC,EAAKzL,MAChB,MACM0L,EADUb,OAAOc,KAAK3L,GAAO4L,iBACLC,KAAKC,UAAU9L,KAAW,GACxD,OAAO+L,SACFR,IAAUE,IAAMC,KAEjBM,YAAa,YAEf5C,KAAK6C,GACc,MAAfA,EAAIlK,OACCmK,QAAQC,OAAO,IAAIC,MAAMH,EAAII,aAE/BH,QAAQI,QAAQL,IAI3B,SAAS3K,EAAKwI,GACZ,OAAOA,EAASxI,cAiDhBkK,IAAAA,EAAKlK,KAAAA,EAAM+C,KA9Cb,SAAcyF,GACZ,OAAOA,EAASzF,QA6CCkI,KA1CnB,SAAczC,GACZ,OAAOA,EAASyC,QAyCOC,KAtCzB,SAAcf,EAAKgB,GACjB,OAAOV,SACFR,IAAUE,KAEXiB,OAAQ,OACRC,KAAMF,EACNT,YAAa,YAEf5C,KAAK6C,GACc,MAAfA,EAAIlK,OACCmK,QAAQC,OAAO,IAAIC,MAAMH,EAAII,aAE/BH,QAAQI,QAAQL,KA0BIlD,MAtB/B,SAAeD,GAEb,OADA5J,QAAQ6J,MAAMD,GACP,MAoB6B8D,aAjBtC,WACE,MAAM9C,KACN,OAAO0B,EAAI,UACRpC,KAAK9H,GACL8H,KAAK6C,IACJnC,EAAS+C,OAASZ,IAEnB7C,KAAK,IAAMoC,EAAI,WACfpC,KAAK9H,GACL8H,KAAK6C,IACJnC,EAAS/B,OAASkE,IAEnB7C,KAAK,IAAMU,KCxDhB,SAASgD,EAAcC,GACrB,MAAMC,KAIN,OAHAnC,OAAOC,QAAQiC,EAAQA,SAAShI,QAAQkI,IACtCD,EAAWC,EAAE,KAAOA,EAAE,OAGtBxK,QAASsK,EAAQtK,QACjBlB,QAASwL,EAAQlJ,OACjBE,IAAKgJ,EAAQhJ,IACbgJ,QAASC,UA2GXF,cAAAA,EAAeI,eAjGjB,SAAwBH,GACtB,MAAMI,EAAKJ,EAAQ9J,eAAe,SAAW6J,EAAcC,GAAWA,EAatE,OAVExL,SAFgBwC,IAAKoJ,EAAGpJ,IAAKjE,OAAQ,SAElBsN,OAAOD,EAAG5L,QAC7BS,QAAS6I,OAAOC,QAAQqC,EAAGJ,SAASvO,IAAIuM,IACtC,MAAMsC,KAKN,OAJAA,EAAIF,EAAGpJ,KAAOgH,EAAM,GACpBoC,EAAG5L,OAAOwD,QAAQ,CAACuI,EAAGtI,KACpBqI,EAAIC,EAAEvJ,KAAOgH,EAAM,GAAG/F,KAEjBqI,MAsFoBE,eAzEjC,SAAwBC,EAAOzJ,EAAK0J,GAAQ,UAC1C,MACMV,GACJtK,SAFU,IAAI0D,MAEDjG,WACbqB,OAAQiM,EAAMjM,OAAOoG,OAAOlJ,GAAKA,EAAEsF,MAAQA,GACxC4D,OAAOlJ,IAAMgP,EAAOnO,SAASb,EAAEsF,MAClCA,IAAKA,EACLgJ,YAKF,OAHAS,EAAMxL,QAAQ+C,QAAQ2I,IACpBX,EAAQA,QAAQW,EAAI3J,IAAQgJ,EAAQxL,OAAO/C,IAAIC,GAAKiP,EAAIjP,EAAEsF,QAErDgJ,GA6DwCY,aApDjD,SAAsBC,GACpB,MAAMC,EAAQD,EAAUrP,MAAM,cACxBuP,EAASD,EAAME,QAAQxP,MAAM,KAC7BwF,EAAM+J,EAAOC,QACb7H,EAAM,IAAIC,KACV6H,KACAzM,KACNuM,EAAO/I,QAAQ,CAACkJ,EAAGjJ,KACP,KAANiJ,IACJD,EAAUpH,KAAK5B,GACfzD,EAAOqF,MAAM7C,IAAKkK,EAAGnO,OAAQ,YAE/B,MAAMiN,GACJtK,QAASyD,EAAIhG,WACbqB,OAAQA,EACRwC,IAAKA,EACLgJ,YAUF,OARAc,EAAM9I,QAAQmJ,IACZ,MAAMC,EAASD,EAAK3P,MAAM,KACpB6P,EAAID,EAAOJ,QACjBhB,EAAQA,QAAQqB,GAAKC,MAAML,EAAUpC,QACrCoC,EAAUjJ,QAAQC,IAChB+H,EAAQA,QAAQqB,GAAGpJ,GAAKmJ,EAAOnJ,OAG5B+H,GA0BsDuB,MAhB/D,SAAevL,EAAMgK,GACnB,MAAMI,EAAKJ,EAAQ9J,eAAe,SAAW6J,EAAcC,GAAWA,EACtEhK,EAAKf,QACF2F,OAAO0F,GAAOF,EAAGJ,QAAQ9J,eAAeoK,EAAIF,EAAGpJ,OAC/CgB,QAAQsI,IACPF,EAAG5L,OAAOwD,QAAQ,CAACwJ,EAAIvJ,KACrBqI,EAAIkB,EAAGxK,KAAOoJ,EAAGJ,QAAQM,EAAIF,EAAGpJ,MAAMiB,OAG5CjC,EAAKxB,OAAU7C,EAAEqE,EAAKxB,QACnB6L,OAAOD,EAAG5L,QACViN,OAAO,OACPhP,gBCjHgBiP,EAMnBC,YAAYvD,GAEVwD,KAAKC,UAAY,QAEjBD,KAAK9H,aAAesE,EAAKtE,cAAgB,KACzC8H,KAAKnG,QAAU2C,EAAK3C,SAAW,KAC/BmG,KAAKhN,KAAOwJ,EAAKxJ,MAAQ,KACzBgN,KAAK7H,SAAWqE,EAAKrE,WAAaqE,GAClCwD,KAAKpN,UACLoN,KAAK7H,SAAS/B,QAAQ8J,IACpBA,EAAQtN,OAAOwD,QAAQtG,GAAKkQ,KAAKG,SAASrQ,MAQ9CiQ,SAAS7K,GACH8K,KAAKpN,OAAOuC,KAAKrF,GAAKA,EAAEsF,MAAQF,EAAME,OACrCF,EAAMZ,eAAe,UAASY,EAAMlC,KAAOkC,EAAME,KACjDF,EAAMZ,eAAe,aAAYY,EAAMS,SAAU,GAClDT,EAAMZ,eAAe,eAAcY,EAAM/D,OAAS,aACjD+D,EAAMZ,eAAe,YAAWY,EAAM/D,OAAS,OACpD6O,KAAKpN,OAAOqF,KAAK/C,IAOnB6K,aAAaK,GACXJ,KAAKpN,UACLwN,EAAGhK,QAAQtG,GAAKkQ,KAAKG,SAASrQ,IAOhCiQ,WAAW3B,GACT4B,KAAK7H,SAAS/B,QAAQxE,IACpByO,EAAOV,MAAM/N,EAAGwM,KAEdA,EAAQ9J,eAAe,UACzB8J,EAAQxL,OAAOwD,QAAQtG,GAAKkQ,KAAKG,SAASrQ,IAE1CkQ,KAAKG,SAAS/B,EAAQlJ,OAQ1B6K,UACE,OAAOhQ,EAAEuQ,QAAQN,KAAK7H,SAAStI,IAAIC,GAAKA,EAAEuD,UAG5C0M,MAAMQ,GACJ,MAAMH,EAAKJ,KAAK7H,SACba,OAAOlJ,IAAM,UAAW,QAAS,cAAe,UAAUa,SAASb,EAAEsD,SACrEvD,IAAIqQ,IACH,MAAM7O,GAAS0B,GAAImN,EAAQ9H,WAAYmI,QAASA,GAChD,OAAOC,EAAQ3D,IAAI,WAAYxL,GAC5BoJ,KAAK+F,EAAQ7N,MACb8H,KAAKrG,GACGkF,EAAIqD,iBAAiBqD,KAAKnG,QAASmG,KAAK9H,aAAcsE,IAC3D,MAAMnG,EAAImG,EAAKrE,SACZyD,UAAU9L,GAAKA,EAAEsI,aAAe/G,EAAM0B,IACrB,YAAhBqB,EAAKhB,OACPoJ,EAAKrE,SAAS9B,GAAGjD,OAAS,UAE1BoJ,EAAKrE,SAAS9B,GAAKjC,OAK/B,OAAOmJ,QAAQkD,IAAIL,GAChB3F,KAAK,IAAMnB,EAAI+C,cAAc2D,KAAKnG,QAASmG,KAAK9H,eAChDuC,KAAK+B,IACJwD,KAAK7H,SAAWqE,EAAKrE,WAQ3B4H,OACE,OAAOC,KAAK5C,MAAM,QAQpB2C,QACE,OAAOC,KAAK5C,MAAM,SAOpB2C,OACE,OAAOhQ,EAAE2Q,IAAIV,KAAK7H,SAAStI,IAAIC,GAAKA,EAAEuD,QAAQ4J,SAOhD8C,SACE,OAAIC,KAAK7H,SAASwI,KAAK7Q,GAAkB,gBAAbA,EAAEsD,QAAkC,cAC5D4M,KAAK7H,SAASwI,KAAK7Q,GAAkB,YAAbA,EAAEsD,QAA8B,UACxD4M,KAAK7H,SAASwI,KAAK7Q,GAAkB,WAAbA,EAAEsD,QAA6B,SACvD4M,KAAK7H,SAASwI,KAAK7Q,GAAkB,UAAbA,EAAEsD,QAA4B,QACtD4M,KAAK7H,SAASwI,KAAK7Q,GAAkB,YAAbA,EAAEsD,QAA8B,UACxD4M,KAAK7H,SAASwI,KAAK7Q,GAAkB,YAAbA,EAAEsD,QAA8B,UACrD,OAOT2M,UAEE,OADW,QAAS,SAAU,UAAW,eAChCpP,SAASqP,KAAK5M,UAOzB2M,WACE,OAAOhQ,EAAE6Q,IAAIZ,KAAK7H,SAAStI,IAAIC,GAAKA,EAAE8D,WAOxCmM,WACE,OAAOhQ,EAAE2Q,IAAIV,KAAK7H,SAAStI,IAAIC,GAAKA,EAAE+D,WAOxCkM,SACE,OACE1I,QAAS,6DACTa,aAAc8H,KAAK9H,aACnBlF,KAAMgN,KAAKhN,KACXJ,OAAQoN,KAAKpN,OACbuF,SAAU6H,KAAK7H,WCzKrB,SAAS0I,EAASC,EAAMC,EAAWnD,GACjC,OAAO,IAAIL,QAAQ,CAACI,EAASH,KAC3B,MAAMwD,EAAS,IAAIC,WACbC,EAAYH,EAAYD,EAAK/F,MAAM,EAAGgG,GAAaD,EACzDE,EAAOG,OAASC,CAAAA,GAASzD,EAAQyD,EAAM9P,OAAO+P,SAC9CL,EAAOM,QAAUlH,CAAAA,GAASoD,EAAOpD,IAC7BwD,EACFoD,EAAOO,kBAAkBL,GAEzBF,EAAOQ,WAAWN,KAMxB,SAASO,EAAUrN,EAAMsN,GACvB,MAAMhM,EAAOgM,EAAaC,EAAKC,QAAQxN,GAAOyN,GAAI,WAAazN,EAC/D,OAAO8I,KAAK4E,MAAMpM,GAoBpB,SAASqM,EAAiB3N,EAAMpB,GAC9B,IAGE,MAAM8J,EAAMtN,OAAOwS,IAAIC,gBAAgB,IAAIC,MAAM9N,KAC3C+N,EAAIC,SAASC,cAAc,KACjCF,EAAEG,SAAWtP,EACbmP,EAAEI,KAAOzF,EAETqF,EAAEK,cAAc,IAAIC,WAAW,SAC7BxJ,KAAQzJ,OACRkT,SAAW,EACXC,YAAc,KAGhB,MAAO7S,YAeT+Q,SAAAA,EAAUY,UAAAA,EAAWmB,SA9CvB,SAAkB9B,GAChB,MAAMY,EAAaZ,EAAK9N,KAAK6P,SAAS,MAAQ/B,EAAK9N,KAAK6P,SAAS,OACjE,OAAOhC,EAASC,GAAM,EAAOY,GAC1BjH,KAAKrG,GAAQqN,EAAUrN,EAAMsN,KA2CDoB,UAvCjC,SAAmBhG,GACjB,MAAMiG,EAAUC,mBAAmBlG,GAC7B4E,EAAaqB,EAAQF,SAAS,MAAQE,EAAQF,SAAS,OAC7D,OAAOzF,MAAM2F,GACVtI,KAAK6C,GAAOoE,EAAapE,EAAI2F,cAAgB3F,EAAI3K,QACjD8H,KAAKrG,GAAQqN,EAAUrN,EAAMsN,KAmChCK,iBAAAA,EAAkBmB,aAVpB,SAAsBvQ,EAAMK,EAAMmQ,GAAS,GACzC,MAAMC,EAAMlG,KAAKC,UAAUxK,GAG3BoP,EAFaoB,EAAWxB,EAAK0B,KAAKD,GAAOA,KAEfpQ,UADRmQ,EAAW,IAAM,kBC9CnCG,UAVF,SAAmBxL,GACjB,OAAOA,EAAME,QAAQ2I,KAAKnE,GACjBA,EAAKrE,SAASwI,KAAK7Q,IAChB,QAAS,SAAU,UAAW,eAAea,SAASb,EAAEsD,YCTtE,MAAMmQ,EAAc,yBA4IlBA,YAAAA,EAAaC,UAzIf,SAAmBC,EAAW3N,EAAO8C,GACnC6K,EACKC,QAAQ,cAAc,GACtBA,QAAQ,QAAQ,GAClBC,OAAO,UACLD,QAAQ,OAAO,GACfA,eAAe9K,KAAQ,GACvB8K,QAAQ,UAAU,GAClBhO,KAAKI,IAiIc8N,WA7H1B,SAAoBH,EAAW3N,EAAO8C,GACpC6K,EACKC,QAAQ,OAAO,GACfA,eAAe9K,KAAQ,GACvB8K,QAAQ,UAAU,GAClBA,QAAQ,QAAQ,GAChBhO,KAAKI,IAuH0B+N,eAnHtC,SAAwBJ,EAAW3N,EAAO8C,EAAMkL,GAC9CL,EACKC,QAAQ,OAAO,GACfA,eAAe9K,KAAQ,GACvB8K,QAAQ,UAAU,GAClBA,QAAQ,QAAQ,GAChBK,KAAK,OAAQ,UACbA,KAAK,OAAQ,KAClBN,EAAUE,OAAO,OACZI,KAAK,MAAOD,KAAUP,IAAcO,QAAa,MACjDE,MAAM,QAAS,WACfA,MAAM,SAAU,WACrBP,EAAUE,OAAO,QACZK,MAAM,iBAAkB,UACxBtO,KAAKI,IAqG0CmO,cAjGtD,SAAuBR,EAAWnS,EAAQwE,EAAO8C,EAAMkL,GACrDL,EACKC,QAAQ,OAAO,GACfA,eAAe9K,KAAQ,GACvB8K,QAAQ,UAAU,GAClBA,QAAQ,QAAQ,GAChBK,KAAK,OAAQ,KACbA,KAAK,OAAQ,UACbA,KAAK,cAAe,SACpBA,KAAK,kBAAmBzS,KAC7BmS,EAAUE,OAAO,OACZI,KAAK,MAAOD,KAAUP,IAAcO,QAAa,MACjDE,MAAM,QAAS,WACfA,MAAM,SAAU,WACrBP,EAAUE,OAAO,QACZD,QAAQ,SAAS,GACjBM,MAAM,iBAAkB,UACxBtO,KAAKI,IAiFVoO,mBA7EF,SAA4BT,EAAW3N,EAAO8C,EAAMkL,GAClDL,EACKC,QAAQ,aAAa,GACrBA,QAAQ,QAAQ,GACrB,MAAMS,EAASV,EAAUE,OAAO,UAC3BD,QAAQ,OAAO,GACfA,eAAe9K,KAAQ,GACvB8K,QAAQ,UAAU,GAClBA,QAAQ,mBAAmB,GAC3BK,KAAK,cAAe,YACzBI,EAAOR,OAAO,OACTI,KAAK,MAAOD,KAAUP,IAAcO,QAAa,MACjDE,MAAM,QAAS,WACfA,MAAM,SAAU,WACrBG,EAAOR,OAAO,QACTK,MAAM,iBAAkB,UACxBtO,KAAKI,GACV2N,EAAUE,OAAO,OACZD,QAAQ,iBAAiB,IA2DVU,iBAvDtB,SAA0BX,EAAW3N,EAAOgO,GAC1CL,EAAUC,QAAQ,iBAAiB,GAC9BK,KAAK,OAAQ,KAClBN,EAAUE,OAAO,OACZI,KAAK,MAAOD,KAAUP,IAAcO,QAAa,MACjDJ,QAAQ,QAAQ,GAChBM,MAAM,QAAS,QACfA,MAAM,SAAU,QACrBP,EAAUE,OAAO,QACZjO,KAAKI,IA8C4BuO,kBA3CxC,SAA2BZ,EAAW3N,EAAOxE,EAAQwS,GACnDL,EAAUC,QAAQ,iBAAiB,GAC9BK,KAAK,OAAQ,KACbA,KAAK,cAAe,SACpBA,KAAK,kBAAmBzS,KAC7BmS,EAAUE,OAAO,OACZI,KAAK,SAAUR,IAAcO,SAC7BJ,QAAQ,QAAQ,GAChBM,MAAM,QAAS,QACfA,MAAM,SAAU,QACrBP,EAAUE,OAAO,QACZjO,KAAKI,IAiCVwO,iBA7BF,SAA0Bb,EAAW3N,EAAOyO,EAAQT,GAClDL,EAAUC,QAAQ,iBAAiB,GAC9BK,KAAK,OAAQ,KACbS,GAAG,QAAS,WACXtT,EAAGuT,OAAOzE,MAAMyE,OAAO,SAASC,OAAOC,UAE7ClB,EAAUE,OAAO,QACZK,MAAM,UAAW,QACnBL,OAAO,SACLI,KAAK,OAAQ,QACbA,KAAK,SAAUQ,GACpBd,EAAUE,OAAO,OACZI,KAAK,SAAUR,IAAcO,SAC7BJ,QAAQ,QAAQ,GAChBM,MAAM,QAAS,QACfA,MAAM,SAAU,QACrBP,EAAUE,OAAO,QACZjO,KAAKI,IAYQ8O,sBARpB,SAA+BnB,GAC7B,OAAOA,EAAUgB,OAAO,SAASC,OAAOG,MAAM,KCtIhD,SAASC,EAAWrB,EAAW1Q,GAC7B0Q,EACKC,QAAQ,SAAS,GACjBK,KAAK,YAAa,GAClBA,KAAK,OAAQ,UACbA,KAAK,kBAAmB,IACxBA,KAAK,eAAe,GACpBA,KAAK,KAAMhR,GAChB0Q,EAAUE,OAAO,OACZD,QAAQ,gBAAgB,GACxBK,KAAK,OAAQ,YACfJ,OAAO,OACLD,QAAQ,iBAAiB,UAiF9BqB,cA7EF,SAAuBtB,EAAW1Q,GAChC,MAAMiS,EAAOvB,EAAUwB,KAAKH,EAAY/R,GACnC0R,OAAO,kBAEZO,EAAKrB,OAAO,OACPD,QAAQ,cAAc,GACxBC,OAAO,OACLD,QAAQ,WAAW,GAExB,MAAMwB,EAASF,EAAKrB,OAAO,OACtBD,QAAQ,gBAAgB,GAC7BwB,EAAOvB,OAAO,UACTD,QAAQ,OAAO,GACfA,QAAQ,yBAAyB,GACjCA,QAAQ,UAAU,GAClBK,KAAK,OAAQ,UACbA,KAAK,eAAgB,SACrBrO,KAAK,UACVwP,EAAOvB,OAAO,UACTD,QAAQ,OAAO,GACfA,QAAQ,eAAe,GACvBA,QAAQ,MAAM,GACdK,KAAK,OAAQ,UACbA,KAAK,eAAgB,SACrBA,KAAK,iBAAkBhR,YACvB2C,KAAK,MACL8O,GAAG,QAAS,KACXtT,EAAGuT,OAAO,iBAAiBT,MAAM,UAAW,UAC5CP,EAAU0B,SAAS,aAiDVC,oBA5CjB,SAA6B3B,EAAW4B,GACtC5B,EAAUgB,OAAO,YAAY/O,KAAK2P,IA2CEC,aAvCtC,SAAsB7B,EAAW1Q,EAAIwS,GACnC,MAAMP,EAAOvB,EAAUwB,KAAKH,EAAY/R,GACnC0R,OAAO,kBAENtF,EAAS6F,EAAKrB,OAAO,OACtBD,QAAQ,gBAAgB,GAC7BvE,EAAOwE,OAAO,MACTD,QAAQ,eAAe,GACvBhO,KAAK6P,GACVpG,EAAOwE,OAAO,UACTI,KAAK,OAAQ,UACbA,KAAK,eAAgB,SACrBA,KAAK,aAAc,SACnBL,QAAQ,SAAS,GACnBC,OAAO,QACLI,KAAK,eAAe,GACpByB,KAAK,WAEVR,EAAKrB,OAAO,OACPD,QAAQ,cAAc,GAE3BsB,EAAKrB,OAAO,OACPD,QAAQ,gBAAgB,GAC1BC,OAAO,UACLD,QAAQ,OAAO,GACfA,QAAQ,eAAe,GACvBA,QAAQ,UAAU,GAClBK,KAAK,OAAQ,UACbA,KAAK,eAAgB,SACrBA,KAAK,iBAAkBhR,YACvB2C,KAAK,UACL8O,GAAG,QAAS,KACXtT,EAAGuT,OAAO,iBAAiBT,MAAM,UAAW,UAC5CP,EAAU0B,SAAS,cCvF3B,SAASM,EAAUhC,EAAWiB,EAAMgB,GAClChB,EAAKiB,SAASvP,QAAQwP,IACpB,MAAMlK,EAAO+H,EAAUE,OAAO,MAAMkC,MAAMD,EAAMxR,MAC1C8L,EAAUxE,EAAKiI,OAAO,QACzBK,MAAM,UAAW,gBACd8B,EAAQF,EAAMtR,eAAe,YAAc,KAAO,GACxD4L,EAAQyD,OAAO,QACVD,QAAQ,SAAS,GACjBhO,KAAKoQ,GACV5F,EAAQ+E,KAAKS,EAAaE,EAAMxR,MAGhC8L,EAAQuE,OAAO,UACZD,GAAG,QAAS,WACX,MAAMuB,EAAYrK,EAAK+I,OAAO,MAC9B,IAAKsB,EAAUtQ,OAAQ,OACvB,MAAMuQ,EAA0C,SAA/BD,EAAU/B,MAAM,WACjC9D,EAAQuE,OAAO,UAAU/O,KAAKsQ,EAAW,KAAO,MAChDD,EAAU/B,MAAM,UAAWgC,EAAW,OAAS,aAI9CJ,EAAMtR,eAAe,aAC1BoH,EAAKiI,OAAO,MACPK,MAAM,kBAAmB,QACzBiB,KAAKQ,EAAWG,EAAOF,YA8D9BO,KAxDF,SAAcxC,GACZA,EACKC,QAAQ,YAAY,GACpBM,MAAM,aAAc,UACpBA,MAAM,SAAU,SAClBL,OAAO,OACLD,QAAQ,QAAQ,IAkDfwC,UAvCR,SAAmBzC,EAAWpK,EAAO8M,EAAST,GAC5C,MAAMU,EAAOlV,EAAGmV,WACXtT,GAAGoT,GACHG,SAASC,GAAKA,EAAEC,OAFRtV,CAEgBmI,GAC7BoK,EAAUgB,OAAO,MAAMgC,SAClBL,EAAK9R,eAAe,cACzBmP,EAAUgB,OAAO,SAASd,OAAO,MAC5BD,QAAQ,QAAQ,GAChBM,MAAM,eAAgB,GACtBA,MAAM,kBAAmB,QACzBiB,KAAKQ,EAAWW,EAAMV,GAC3BjC,EAAUiD,UAAU,gBACfhD,QAAQ,QAAQ,KA2BJiD,UA7CnB,SAAmBlD,EAAW7L,GAC5B6L,EAAUO,MAAM,YAAapM,QA4CDgP,aAnB9B,SAAsBnD,EAAW/H,GAC/B+H,EAAUE,OAAO,SACZI,KAAK,OAAQ,YAClBN,EAAUE,OAAO,QACZjO,KAAKgG,EAAK3I,KAe2B8T,eAP5C,SAAwBpD,GACtB,OAAOA,EAAUgB,OAAO,SACrBiC,UAAU,iBAAiBtS,OAAOvE,IAAI0W,GAAKA,EAAExT,MCmElD,SAAS+T,EAAoBrD,GAC3B,OAAOxS,WAAWwS,EAAUgB,OAAO,SAASsC,SAAS,iBAmFrDC,QAxOF,SAAiBvD,EAAW3N,GAC1B2N,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhO,KAAKI,GACV2N,EAAUE,OAAO,SACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,GACjBK,KAAK,OAAQ,SA0NTkD,cAvNX,SAAuBxD,EAAW5S,GAChC4S,EAAUgB,OAAO,SAASsC,SAAS,QAASlW,IAsNpBqW,aAnN1B,SAAsBzD,GACpB,OAAOA,EAAUgB,OAAO,SAASsC,SAAS,UAkNJI,YA9MxC,SAAqB1D,EAAW3N,GAC9B2N,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhO,KAAKI,GACV2N,EAAUE,OAAO,SACZD,QAAQ,0BAA0B,GAClCA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,GACjBK,KAAK,OAAQ,QACbgD,SAAS,YAAY,IAgM1BK,YA5LF,SAAqB3D,EAAW3N,EAAO0C,GACrCiL,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACzBD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhO,KAAKI,GACV2N,EAAUE,OAAO,YACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,GACjBK,KAAK,OAAQvL,IA+KL6O,kBA5Kf,SAA2B5D,EAAW5S,GACpC4S,EAAUgB,OAAO,YAAYsC,SAAS,QAASlW,IA2KfyW,0BAxKlC,SAAmC7D,EAAW8D,GAC5C9D,EAAUgB,OAAO,YAAYV,KAAK,cAAewD,IAwKjDC,iBArKF,SAA0B/D,GACxB,MAAM5S,EAAQ4S,EAAUgB,OAAO,YAAYsC,SAAS,SACpD,GAAIlW,EAAO,OAAOA,EAClB,MAAM0W,EAAc9D,EAAUgB,OAAO,YAAYV,KAAK,eACtD,OAAIwD,GACG,IAgKWE,iBA7JpB,SAA0BhE,GACxB,MAAM5S,EAAQ4S,EAAUgB,OAAO,YAAYsC,SAAS,SACpD,GAAIlW,EAAO,OAAOA,EAAMjB,MAAM,MAAMoJ,OAAOlJ,GAAKA,EAAEmN,OAAS,GAC3D,MAAMsK,EAAc9D,EAAUgB,OAAO,YAAYV,KAAK,eACtD,OAAIwD,EAAoBA,EAAY3X,MAAM,MAAMoJ,OAAOlJ,GAAKA,EAAEmN,OAAS,OA0JvEyK,SArJF,SAAkBjE,EAAW3N,GAC3B,MAAM6R,EAAMlE,EACPC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,cAAc,GACxBC,OAAO,SACLD,QAAQ,oBAAoB,GAC5BA,QAAQ,qBAAqB,GAClCiE,EAAIhE,OAAO,SACND,QAAQ,oBAAoB,GAC5BK,KAAK,OAAQ,YAClB4D,EAAIhE,OAAO,QACNjO,KAAKI,IAyIA8R,eAtIZ,SAAwBnE,EAAWoE,GACjCpE,EAAUgB,OAAO,SAASsC,SAAS,UAAWc,IAqIpBC,cAlI5B,SAAuBrE,GACrB,OAAOA,EAAUgB,OAAO,SAASsC,SAAS,YAkI1CgB,UA9HF,SAAmBtE,EAAW3N,EAAO8K,EAAKoH,EAAKC,GAC7CxE,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhO,KAAKI,GACV2N,EAAUE,OAAO,SACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,GACjBK,KAAK,OAAQ,UACbA,KAAK,MAAOnD,GACZmD,KAAK,MAAOiE,GACZjE,KAAK,OAAQkE,IA6GPC,gBA1Gb,SAAyBzE,EAAW5S,GAClC4S,EAAUgB,OAAO,SAASsC,SAAS,QAASlW,IAyGhBsX,iBAtG9B,SAA0B1E,GACxB,MAAM5S,EAAQiW,EAAoBrD,GAC5B7C,EAAMwH,SAAS3E,EAAUgB,OAAO,SAASV,KAAK,QAC9CiE,EAAMI,SAAS3E,EAAUgB,OAAO,SAASV,KAAK,QAC9CsE,GAASrX,MAAMH,IAAUA,GAAS+P,GAAO/P,GAASmX,EAGxD,OAFAvE,EAAUgB,OAAO,SACZT,MAAM,mBAAoBqE,EAAQ,UAAY,WAC5CA,GAgGPC,kBA7FF,SAA2B7E,GACzB,OAAO2E,SAAS3E,EAAUgB,OAAO,SAASsC,SAAS,WA4FhCD,oBAAAA,EACnByB,SAjFF,SAAkB9E,EAAW3N,GAC3B2N,EACKC,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GAC9Bc,GAAG,SAAU,KAEZtT,EAAGkQ,MAAMoH,oBAEf/E,EAAUE,OAAO,OACZD,QAAQ,cAAc,GACtBA,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBA,QAAQ,QAAQ,GAChBhO,KAAKI,GACV2N,EAAUE,OAAO,OACZD,QAAQ,cAAc,GACtBA,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBA,QAAQ,QAAQ,GAClBC,OAAO,SACLD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BK,KAAK,OAAQ,UAyDR0E,eArDZ,SAAwBhF,EAAW5S,GACjC4S,EAAUgB,OAAO,SAASsC,SAAS,QAASlW,IAoDlB6X,cAhD5B,SAAuBjF,GACrB,OAAOA,EAAUgB,OAAO,SAASsC,SAAS,UAgD1C4B,aA5CF,SAAsBlF,EAAW3N,EAAOyO,GACxCd,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACzBD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhO,KAAKI,GACV2N,EAAUE,OAAO,SACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBK,KAAK,OAAQ,QACbA,KAAK,SAAUQ,IA6BJqE,eA1BhB,SAAwBnF,GAEtB,MAAMc,EAASd,EAAUgB,OAAO,SAASV,OACzCN,EAAUgB,OAAO,SAASgC,SAC1BhD,EAAUE,OAAO,SACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBK,KAAK,OAAQ,QACbA,KAAK,SAAUQ,IAgBUsE,kBAbhC,SAA2BpF,GACzB,OAAOA,EAAUgB,OAAO,SAASsC,SAAS,SAAS,KCpOrD,SAAS+B,EAAarF,EAAWsF,EAAQrT,GACvC+N,EAAUM,KAAK,UAAW,cACrBA,KAAK,sBAAuB,QACjC,MAAMiF,EAAQvF,EAAUE,OAAO,KAC/BqF,EAAMrF,OAAO,QACRI,KAAK,IAAK,GAAGA,KAAK,IAAK,GACvBA,KAAK,QAAS,KAAKA,KAAK,SAAU,IAClCA,KAAK,OAAQgF,EAAO,IACzBC,EAAMrF,OAAO,QACRI,KAAK,cAAe,UACpBA,KAAK,IAAK,IAAIA,KAAK,IAAK,IACxBA,KAAK,YAAa,IAClBrO,KAAKA,UAkEVuT,UATAC,UAAaJ,EACbK,QAvDF,SAAoB1F,EAAWsF,EAAQrT,GACrC,MAAM3C,EAAK+H,EAAKpJ,SAASqJ,MAAM,EAAG,GAClC0I,EAAUwB,KAAK6D,EAAcC,EAAQrT,GACrC,MAAM0T,EAAO3F,EAAUE,OAAO,QAC3BA,OAAO,kBACLI,KAAK,KAAMhR,GAChBqW,EAAKzF,OAAO,QACPI,KAAK,SAAU,GAAGA,KAAK,aAAcgF,EAAO,IACjDK,EAAKzF,OAAO,QACPI,KAAK,SAAU,GAAGA,KAAK,aAAcgF,EAAO,IACjDtF,EAAUgB,OAAO,QACZV,KAAK,eAAgBhR,OA6C1BsW,SA1CF,SAAqB5F,EAAWsF,EAAQrT,GACtC,MAAM3C,EAAK+H,EAAKpJ,SAASqJ,MAAM,EAAG,GAClC0I,EAAUwB,KAAK6D,EAAcC,EAAQrT,GACrC,MAAM0T,EAAO3F,EAAUE,OAAO,QAC3BA,OAAO,kBACLI,KAAK,KAAMhR,GAChBqW,EAAKzF,OAAO,QACTI,KAAK,SAAU,GAAGA,KAAK,aAAcgF,EAAO,IAC/CK,EAAKzF,OAAO,QACTI,KAAK,SAAU,IAAKA,KAAK,aAAcgF,EAAO,IACjDK,EAAKzF,OAAO,QACTI,KAAK,SAAU,GAAGA,KAAK,aAAcgF,EAAO,IAC/CtF,EAAUgB,OAAO,QACZV,KAAK,eAAgBhR,OA8B1BuW,YA3BF,SAAwB7F,EAAWsF,EAAQrT,GACzC+N,EAAUM,KAAK,UAAW,cACrBA,KAAK,sBAAuB,QACjC,MAAMwF,EAAK,IAAMR,EAAO9L,OAClB+L,EAAQvF,EAAUE,OAAO,KAC/BoF,EAAO3S,QAAQ,CAACtG,EAAGuG,KACjB2S,EAAMrF,OAAO,QACRI,KAAK,IAAKwF,EAAKlT,GAAG0N,KAAK,IAAK,GAC5BA,KAAK,QAASwF,GAAIxF,KAAK,SAAU,IACjCA,KAAK,OAAQgF,EAAO1S,MAE3B2S,EAAMrF,OAAO,QACRI,KAAK,cAAe,UACpBA,KAAK,IAAK,IAAIA,KAAK,IAAK,IACxBA,KAAK,YAAa,IAClBrO,KAAKA,IAaV8T,OAAUV,GAKAW,QAfZ,SAAiBhG,EAAW9L,EAAOC,GACjC6L,EAAUM,KAAK,QAASpM,GAAOoM,KAAK,SAAUnM,KCyBhD,SAAS8R,EAAkBjG,GACzB,OAAOA,EAAUiD,UAAU,iBAAiBtS,OAAOvE,IAAI0W,GAAKA,EAAEnR,KA6DhE,SAASuU,EAAsBlG,EAAW/H,GACxC,MAAMkO,EAAWnG,EAAUgB,OAAO,aAClCmF,EAASlD,UAAU,OAAOD,SAC1BmD,EAAS/D,MAAMnK,GACfkO,EAASjG,OAAO,OACXsB,KAAK4E,EAAMZ,SAASvN,EAAK9C,MAAO8C,EAAKqN,OAAQrN,EAAKhG,MAClDuP,KAAK4E,EAAMJ,QAAS,IAAK,WAoB9BK,UA3KF,SAAmBrG,EAAW3N,GAC5B2N,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhO,KAAKI,GACV2N,EAAUE,OAAO,UACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,IA8JXqG,eA3Jb,SAAwBtG,EAAWpK,GACjC,MAAM2Q,EAAUvG,EAAUgB,OAAO,UAC9BiC,UAAU,UACRtS,KAAKiF,EAAOkN,GAAKA,EAAEnR,KACxB4U,EAAQC,OAAOxD,SACfuD,EAAQE,QACLvG,OAAO,UACLI,KAAK,QAASwC,GAAKA,EAAEnR,KACrBM,KAAK6Q,GAAKA,EAAEvT,OAmJUmX,gBAhJ7B,SAAyB1G,EAAW5S,GAClC4S,EAAUgB,OAAO,UAAUsC,SAAS,QAASlW,IA+IDuZ,eA5I9C,SAAwB3G,GACtB,OAAOA,EAAUgB,OAAO,UAAUsC,SAAS,UA4I3CsD,aApIF,SAAsB5G,EAAW3N,GAE/B2N,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhO,KAAKI,GACV2N,EAAUE,OAAO,MACZD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,IAsHR4G,kBAnHhB,SAA2B7G,EAAWpK,GACpC,MAAMkR,EAAY9G,EAAUgB,OAAO,MAChCiC,UAAU,MACRtS,KAAKiF,EAAOkN,GAAKA,EAAEnR,KACxBmV,EAAUN,OAAOxD,SACjB,MAAM+D,EAAOD,EAAUL,QACpBvG,OAAO,MACLI,KAAK,QAAS,cAChBJ,OAAO,SACLI,KAAK,QAAS,oBACnByG,EAAK7G,OAAO,SACPI,KAAK,OAAQ,YACbA,KAAK,QAAS,oBACdgD,SAAS,QAASR,GAAKA,EAAEnR,KAC9BoV,EAAK7G,OAAO,QACPjO,KAAK6Q,GAAKA,EAAEvT,OAoGgByX,mBAjGnC,SAA4BhH,EAAWjE,GAChCA,GACLiE,EAAUiD,UAAU,SACjBgE,KAAK,SAAUnE,GACdrV,EAAGuT,OAAOzE,MAAM+G,SAAS,UAAWvH,EAAO7O,SAAS4V,EAAEnR,SA6FLsU,kBAAAA,EACrDiB,WAtFF,SAAoBlH,GAClB,OAAOiG,EAAkBjG,GAAWxG,OAAS,GAsF7C2N,cAlFF,SAAuBnH,EAAW3N,GAChC2N,EACKC,QAAQ,cAAc,GACtBA,QAAQ,YAAY,GACpBA,QAAQ,sBAAsB,GACnCD,EAAUE,OAAO,SACZD,QAAQ,kBAAkB,GAC1BA,QAAQ,qBAAqB,GAC7BA,QAAQ,SAAS,GACjBhO,KAAKI,GAAS,cACnB,MAAM0U,EAAO/G,EAAUE,OAAO,OACzBD,QAAQ,gBAAgB,GACxBA,QAAQ,mBAAmB,GAC3BA,QAAQ,SAAS,GAChBmH,EAAWL,EAAK7G,OAAO,OACxBD,QAAQ,aAAa,GACrBA,QAAQ,QAAQ,GACrBmH,EAASlH,OAAO,UACXD,QAAQ,OAAO,GACfA,QAAQ,aAAa,GACrBA,QAAQ,UAAU,GAClBA,QAAQ,mBAAmB,GAC3BK,KAAK,cAAe,YACzB8G,EAASlH,OAAO,OACXD,QAAQ,iBAAiB,GACzBA,QAAQ,QAAQ,GACrB8G,EAAK7G,OAAO,QACPD,QAAQ,YAAY,IAuDVoH,mBApDjB,SAA4BrH,EAAWpK,GACrC,MAAMkR,EAAY9G,EAAUgB,OAAO,kBAChCiC,UAAU,KACRtS,KAAKiF,EAAOkN,GAAKA,GACtBgE,EAAUN,OAAOxD,SACjB8D,EAAUL,QACPvG,OAAO,KACLD,QAAQ,iBAAiB,GACzBA,QAAQ,QAAQ,GAChBK,KAAK,OAAQ,KACbA,KAAK,QAASwC,GAAKA,EAAEnR,KACrBoP,GAAG,QAAS,SAAU+B,GACrB9C,EAAUwB,KAAK0E,EAAuBpD,GACtC9C,EAAU0B,SAAS,UAAWzC,SAAS,MAE1CiB,OAAO,OACL+G,KAAK,SAAUnE,GACdrV,EAAGuT,OAAOzE,MACPiF,KAAK4E,EAAMZ,SAAS1C,EAAE3N,MAAO2N,EAAEwC,OAAQxC,EAAE7Q,MACzCuP,KAAK4E,EAAMJ,QAAS,IAAK,OAiCCsB,oBApBrC,SAA6BtH,EAAWrO,GACtC,MAEMsG,EAFO+H,EAAUgB,OAAO,kBAC3BiC,UAAU,KAAKtS,OACAe,KAAKrF,GAAKA,EAAEsF,MAAQA,GACtCqO,EAAUwB,KAAK0E,EAAuBjO,IAiBtCsP,mBAdF,SAA4BvH,GAC1B,OAAOA,EAAUgB,OAAO,aAAaoB,QAAQzQ,KAazB6V,kBAVtB,SAA2BxH,GACzB,OAAOA,EAAUgB,OAAO,aAAaoB,UCpKvC,MAAM9S,EAAK,gBACLwS,EAAQ,+BAsDZ2F,SAnDF,SAAkBzH,GAChBA,EAAUwB,KAAKd,EAAOE,kBAAmBkB,EAAOxS,EAAI,oBAkD1CiL,KA9CZ,SAAcyF,GACZ,MAAM0H,EAAQ1H,EAAUwB,KAAKmG,EAAM9F,aAAcvS,EAAIwS,GAClDd,OAAO,eACV0G,EAAMxH,OAAO,OACRD,QAAQ,SAAS,GACjBuB,KAAKoG,EAAKvB,UAAW,SAC1BqB,EAAMxH,OAAO,OACRD,QAAQ,SAAS,GACjBuB,KAAK0C,EAAIP,YAAa,QAAS,KAsCpBkE,WAlClB,SAAoB7H,EAAW8H,EAAWhE,GACxC,MAAM3U,EAAS7C,EAAEwb,EAAU1b,IAAIC,GAAKA,EAAE8C,SACnC0N,UACAT,OAAO,OACPhP,QACAmI,OAAOlJ,GAAKA,EAAEwE,eAAe,eACb,cAAe,UAAW,QAAQ3D,SAASb,EAAEqB,SAC1Dqa,EAAM5Y,EAAOuC,KAAKrF,GAAkB,gBAAbA,EAAEqB,SAA6ByB,EAAO,GACnE6Q,EAAUgB,OAAO,UACZQ,KAAKoG,EAAKtB,eAAgBnX,GAC1BqS,KAAKoG,EAAKlB,gBAAiBqB,EAAIpW,KACpCqO,EAAUgB,OAAO,UACZQ,KAAK0C,EAAIN,kBAAmB,IAC5BpC,KAAK0C,EAAIL,0BAA2BC,GACpC/C,GAAG,QAAS,WACX,MAAMhF,EAASmI,EAAIF,iBAAiBvW,EAAGuT,OAAOzE,OAC9CyD,EAAUgB,OAAO,WAAWsC,SAAS,YAAavH,EAAOvC,WAkBnCwO,QAb9B,SAAiBhI,EAAW8H,GAC1B,MAAMla,GACJgH,SAAU,SACVqT,QAASH,EAAU1b,IAAIC,GAAKA,EAAEiD,IAC9BqC,IAAKiW,EAAKjB,eAAe3G,EAAUgB,OAAO,WAC1CjF,OAAQmI,EAAIF,iBAAiBhE,EAAUgB,OAAO,YAEhD,OAAOjE,EAAQ3D,IAAIxL,EAAMgH,SAAUhH,GAChCoJ,KAAK+F,EAAQ7N,QC8BlB,SAASgZ,EAAmBlI,GAC1B,MAAMtS,EAASka,EAAKjB,eAAe3G,EAAUgB,OAAO,YAC9ChO,EAAS4U,EAAKjB,eAAe3G,EAAUgB,OAAO,YAC9CmH,EAAYjE,EAAIT,aAAazD,EAAUgB,OAAO,eAC9CoH,EAAYlE,EAAIF,iBAAiBhE,EAAUgB,OAAO,eACxD,OACEtT,OAAQA,EACRsF,OAAmB,SAAXtF,EAAoBsF,EAAS,KACrC5F,MAAkB,YAAXM,EAAuB0a,EAAYD,UAiF5CE,cAtKF,SAAuBrI,GACrBA,EACKC,QAAQ,QAAQ,GACrBD,EAAUE,OAAO,OACZD,QAAQ,UAAU,GAClBA,QAAQ,QAAQ,GAChBuB,KAAKoG,EAAKvB,UAAW,UACrB7E,KAAKoG,EAAKtB,iBAEF3U,IAAK,UAAWpC,KAAM,gBACtBoC,IAAK,OAAQpC,KAAM,iBAEhCyQ,EAAUE,OAAO,OACZD,QAAQ,UAAU,GAClBA,QAAQ,QAAQ,GAChBuB,KAAKoG,EAAKvB,UAAW,UAC1BrG,EAAUE,OAAO,OACZD,QAAQ,aAAa,GACrBA,QAAQ,QAAQ,GAChBuB,KAAK0C,EAAIX,QAAS,SACvBvD,EAAUE,OAAO,OACZD,QAAQ,aAAa,GACrBA,QAAQ,QAAQ,GAChBuB,KAAK0C,EAAIP,YAAa,QAAS,EAAG,MAEvC2E,EAAE,WACAA,EAAE,2BACCC,SAASxG,MAAM,EAAMyG,QAAS,YAEnCxI,EAAUE,OAAO,OACZD,QAAQ,YAAY,GACpBA,QAAQ,uBAAuB,GACjCC,OAAO,UACLD,QAAQ,WAAW,GACnBK,KAAK,cAAe,WACpBA,KAAK,YAAa,QAClBA,KAAK,eAAgB,4BACrBkB,KAAKd,EAAOP,WAAY,oBAAqB,YAiInCsI,oBA9HjB,SAA6BzI,EAAW8H,GACtC9H,EAAUgB,OAAO,WACZQ,KAAKoG,EAAKlB,gBAAiB,WAC3B3F,GAAG,SAAU,WACZ,MAAM3T,EAAQwa,EAAKjB,eAAelZ,EAAGuT,OAAOzE,OAC5CyD,EAAUgB,OAAO,WACdA,OAAO,UACLsC,SAAS,WAAsB,SAAVlW,GAC1B4S,EAAUgB,OAAO,cACZsC,SAAS,SAAoB,SAAVlW,GACxB4S,EAAUgB,OAAO,cACZsC,SAAS,SAAoB,YAAVlW,KAEzBsU,SAAS,UACd,MAAM7H,EAAMiO,EAAU1b,IAAI0W,KAAOnR,IAAKmR,EAAExT,GAAIC,KAAMuT,EAAEvT,QACpDyQ,EAAUgB,OAAO,WACZQ,KAAKoG,EAAKtB,eAAgBzM,GAC1B2H,KAAKoG,EAAKlB,gBAAiB,MAChC1G,EAAUgB,OAAO,YACZD,GAAG,QAAS,WACX,MAAMnT,EAAQsa,EAAmBlI,GACjC,OAAOjD,EAAQ3D,IAAI,UAAWxL,GAC3BoJ,KAAK+F,EAAQ9K,MACb+E,KAAK6C,GAAOpM,EAAGuT,OAAO,YAAYe,KAAKlI,GAAMkD,EAAQpG,SAE9DqJ,EAAUgB,OAAO,cACZQ,KAAK0C,EAAIV,cAAe,IACxBzC,GAAG,QAAS,WACXf,EAAU0B,SAAS,cAEzB1B,EAAUgB,OAAO,cACZQ,KAAK0C,EAAIN,kBAAmB,IAC5B7C,GAAG,QAAS,WACXf,EAAU0B,SAAS,eA6FWwG,mBAAAA,EAAoBQ,mBA7E1D,SAA4B1I,GAC1B,MAAMtS,EAASka,EAAKjB,eAAe3G,EAAUgB,OAAO,YAC9CmH,EAAYjE,EAAIT,aAAazD,EAAUgB,OAAO,eAC9CoH,EAAYlE,EAAIF,iBAAiBhE,EAAUgB,OAAO,eACxD,MAAkB,YAAXtT,EAAuB0a,EAAU5O,OAAuB,KAAd2O,GA0EjDQ,eAtEF,SAAwB3I,GACtB,MAAM1Q,EAAK+H,EAAKpJ,SAASqJ,MAAM,EAAG,GAClC0I,EACKC,QAAQ,QAAQ,GAClBC,OAAO,KACPA,OAAO,UACLD,QAAQ,OAAO,GACfA,QAAQ,UAAU,GAClBA,QAAQ,uBAAuB,GAC/BA,QAAQ,mBAAmB,GAC3BK,KAAK,cAAe,YACpBA,KAAK,kBAAmBhR,cACxBgR,KAAK,gBAAiB,SACtBA,KAAK,mBAAoBhR,cACzB2C,KAAK,uBACV,MAAM2W,EAAW5I,EAAUE,OAAO,OAC7BD,QAAQ,YAAY,GACpBK,KAAK,QAAShR,cAChB4Q,OAAO,OACLD,QAAQ,QAAQ,GAChBA,QAAQ,aAAa,GAC1B2I,EAAS1I,OAAO,OACXD,QAAQ,WAAW,GACnBA,QAAQ,QAAQ,GAChBuB,KAAK0C,EAAID,SAAU,6BACxB2E,EAAS1I,OAAO,OACXD,QAAQ,WAAW,GACnBA,QAAQ,QAAQ,GAChBuB,KAAK0C,EAAII,UAAW,UAAW,EAAG,IAAK,GAC5CsE,EAAS1I,OAAO,OACXD,QAAQ,QAAQ,GAChBA,QAAQ,QAAQ,GAChBuB,KAAK0C,EAAII,UAAW,wBAAyB,EAAG,IAAK,GAC1DsE,EAAS3F,UAAU,wBACdhD,QAAQ,SAAS,GACjBA,QAAQ,SAAS,GACtB2I,EAAS3F,UAAU,sBACdhD,QAAQ,SAAS,GACjBA,QAAQ,SAAS,IAgCN4I,qBA5BlB,SAA8B7I,GAC5BA,EAAUgB,OAAO,YACZQ,KAAK0C,EAAIC,gBAAgB,GAC9BnE,EAAUgB,OAAO,YACZQ,KAAK0C,EAAIO,gBAAiB,GAC/BzE,EAAUgB,OAAO,SACZQ,KAAK0C,EAAIO,gBAAiB,IAsBOqE,oBAlBxC,SAA6B9I,GAC3B,MAAM+I,EAAU/I,EAAUgB,OAAO,YAC3BgI,EAAOhJ,EAAUgB,OAAO,SACxBpT,GACJqb,SAAU/E,EAAIG,cAAcrE,EAAUgB,OAAO,cAQ/C,OANK+H,EAAQ/H,OAAO,SAASsC,SAAS,cACpC1V,EAAMmb,QAAU7E,EAAIW,kBAAkBkE,IAEnCC,EAAKhI,OAAO,SAASsC,SAAS,cACjC1V,EAAMsb,SAAWhF,EAAIW,kBAAkBmE,IAElCpb,ICpKT,MAAM0B,EAAK,gBACLwS,EAAQ,sCAGd,SAAkB9B,GAChBA,EAAUwB,KAAKd,EAAOE,kBAAmBkB,EAAOxS,EAAI,yBAItD,SAAc0Q,GACZ,MAAMmJ,EAASnJ,EAAUwB,KAAKmG,EAAM9F,aAAcvS,EAAIwS,GAEtDqH,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,QAAQ,GAChBuB,KAAK+D,EAAM8C,eAChBc,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,UAAU,GAClBuB,KAAKoG,EAAKvB,UAAW,UAE1B8C,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,WAAW,GACnBuB,KAAKoG,EAAKvB,UAAW,WACrB7E,KAAKoG,EAAKtB,iBACF3U,IAAK,MAAOpC,KAAM,eAClBoC,IAAK,OAAQpC,KAAM,gBAGhC4Z,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,QAAQ,GAChBuB,KAAK0C,EAAII,UAAW,YAAa,GAAK,EAAG,KAE9C6E,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,UAAU,GAClBuB,KAAK+D,EAAMoD,gBAEhBQ,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,UAAU,GAClBuB,KAAKoG,EAAKhB,aAAc,gCAI/B,SAAoB5G,EAAW8H,EAAWsB,GACxCpJ,EAAUgB,OAAO,SACZQ,KAAK+D,EAAMkD,oBAAqBX,GAErC,MAAMuB,IACH1X,IAAK,QAASpC,KAAM,gBACpBoC,IAAK,SAAUpC,KAAM,iBACrBoC,IAAK,SAAUpC,KAAM,mBACrBoC,IAAK,MAAOpC,KAAM,eAEjB6Z,IACFC,EAAW7U,MAAM7C,IAAK,WAAYpC,KAAM,4BACxC8Z,EAAW7U,MAAM7C,IAAK,SAAUpC,KAAM,gBAExCyQ,EAAUgB,OAAO,WACZQ,KAAKoG,EAAKtB,eAAgB+C,GAC1B7H,KAAKoG,EAAKlB,gBAAiB,SAC3B3F,GAAG,SAAU,WACZ,MAAM3T,EAAQwa,EAAKjB,eAAelZ,EAAGuT,OAAOzE,OACtC+M,GAAO,MAAO,UAAUpc,SAASE,GACvC4S,EAAUgB,OAAO,YACdA,OAAO,UACLsC,SAAS,QAASgG,OAAMC,EAAY,OACpCjG,SAAS,YAAagG,GAC3BtJ,EAAUiD,UAAU,SACjBjC,OAAO,SACLsC,SAAS,YAAa,QAAS,SAAU,UAAUpW,SAASE,IACjE4S,EAAUiD,UAAU,SACjBjC,OAAO,SACLsC,SAAS,WAAsB,QAAVlW,GAC1B4S,EAAUgB,OAAO,YACdA,OAAO,SACLsC,SAAS,YAAagG,KAE5B5H,SAAS,UACd1B,EAAUgB,OAAO,YACZQ,KAAKoG,EAAKlB,gBAAiB,OAChC1G,EAAUgB,OAAO,SACZQ,KAAK0C,EAAIO,gBAAiB,IAC/BzE,EAAUgB,OAAO,WACZQ,KAAK+D,EAAMsD,qBAAsB,UACtC,MAAMhP,EAAMiO,EAAU1b,IAAI0W,KAAOnR,IAAKmR,EAAExT,GAAIC,KAAMuT,EAAEvT,QACpDyQ,EAAUgB,OAAO,WACZQ,KAAKoG,EAAKf,kBAAmBhN,GAC7B2H,KAAKoG,EAAKZ,mBAAoB,MAC9BjG,GAAG,SAAU,WACZtT,EAAGuT,OAAOzE,MAAMmF,SAAS,cAG/B1B,EAAUiD,UAAU,iBACflC,GAAG,WAAY,WACd,MAAMyI,EAAYjE,EAAMmD,mBAAmB1I,EAAUgB,OAAO,UACtDyI,EAAgB7B,EAAKV,WAAWlH,EAAUgB,OAAO,YACvDhB,EAAUgB,OAAO,WACdsC,SAAS,aAAckG,GAAaC,MAExC/H,SAAS,qBAIhB,SAAiB1B,GACf,MAAMtM,EAAS6R,EAAMuD,oBAAoB9I,EAAUgB,OAAO,YACpD0I,EAAU1J,EAAUgB,OAAO,YAC3B2I,EAAO3J,EAAUgB,OAAO,SACzB0I,EAAQ1I,OAAO,UAAUsC,SAAS,cACrC5P,EAAOgW,QAAU9B,EAAKjB,eAAe+C,IAElCC,EAAK3I,OAAO,SAASsC,SAAS,cACjC5P,EAAOF,UAAY0Q,EAAIb,oBAAoBsG,IAE7C,MAAM/b,GACJgH,SAAUgT,EAAKjB,eAAe3G,EAAUgB,OAAO,YAC/CiH,QAASL,EAAK3B,kBAAkBjG,EAAUgB,OAAO,YACjD4I,SAAUrE,EAAM2C,mBAAmBlI,EAAUgB,OAAO,UACpDtN,OAAQA,GAEV,OAAOqJ,EAAQ3D,IAAIxL,EAAMgH,SAAUhH,GAChCoJ,KAAK+F,EAAQ7N,QCtHlB,MAAMI,EAAK,gBACLwS,EAAQ,wCAGd,SAAkB9B,GAChBA,EAAUwB,KAAKd,EAAOE,kBAAmBkB,EAAOxS,EAAI,yBAItD,SAAc0Q,GACZ,MAAMmJ,EAASnJ,EAAUwB,KAAKmG,EAAM9F,aAAcvS,EAAIwS,GACtDqH,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,OAAO,GACfuB,KAAKoG,EAAKvB,UAAW,SAC1B8C,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,YAAY,GACpBuB,KAAKoG,EAAKvB,UAAW,YACrB7E,KAAKoG,EAAKtB,iBACF3U,IAAK,KAAMpC,KAAM,MACjBoC,IAAK,KAAMpC,KAAM,MACjBoC,IAAK,KAAMpC,KAAM,MACjBoC,IAAK,KAAMpC,KAAM,OACjBoC,IAAK,KAAMpC,KAAM,OACjBoC,IAAK,KAAMpC,KAAM,UAE9B4Z,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,SAAS,GACjBuB,KAAK0C,EAAIX,QAAS,SAEvB4F,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,UAAU,GAClBuB,KAAKoG,EAAKhB,aAAc,gCAI/B,SAAoB5G,EAAW8H,GAC7B,MAAM3Y,EAAS7C,EAAEwb,EAAU1b,IAAIC,GAAKA,EAAE8C,SACnC0N,UACAT,OAAO,OACPhP,QACAmI,OAAOlJ,GAAKA,EAAEwE,eAAe,eACb,cAAe,UAAW,QAAQ3D,SAASb,EAAEqB,SAChEsS,EAAUgB,OAAO,QACZQ,KAAKoG,EAAKtB,eAAgBnX,GAC1BqS,KAAKoG,EAAKlB,gBAAiBvX,EAAO,IACvC6Q,EAAUgB,OAAO,aACZQ,KAAKoG,EAAKlB,gBAAiB,MAChC1G,EAAUgB,OAAO,UACZQ,KAAK0C,EAAIV,cAAe,IACxBzC,GAAG,QAAS,WACXtT,EAAGuT,OAAOzE,MAAMmF,SAAS,cAE/B,MAAM7H,EAAMiO,EAAU1b,IAAI0W,KAAOnR,IAAKmR,EAAExT,GAAIC,KAAMuT,EAAEvT,QACpDyQ,EAAUgB,OAAO,WACZQ,KAAKoG,EAAKf,kBAAmBhN,GAC7B2H,KAAKoG,EAAKZ,mBAAoB,MAC9BjG,GAAG,SAAU,WACZtT,EAAGuT,OAAOzE,MAAMmF,SAAS,cAG/B1B,EAAUiD,UAAU,kBACflC,GAAG,WAAY,WACd,MAAM8I,EAA6D,KAAjD3F,EAAIT,aAAazD,EAAUgB,OAAO,WAC9CyI,EAAgB7B,EAAKV,WAAWlH,EAAUgB,OAAO,YACvDhB,EAAUgB,OAAO,WACdsC,SAAS,aAAcuG,GAAaJ,MAExC/H,SAAS,qBAKhB,SAAiB1B,GACf,MAAMpS,GACJgH,SAAU,SACVqT,QAASL,EAAK3B,kBAAkBjG,EAAUgB,OAAO,YACjDrP,IAAKiW,EAAKjB,eAAe3G,EAAUgB,OAAO,SAC1C5T,MAAO8W,EAAIT,aAAazD,EAAUgB,OAAO,WACzC8I,SAAUlC,EAAKjB,eAAe3G,EAAUgB,OAAO,eAEjD,OAAOjE,EAAQ3D,IAAIxL,EAAMgH,SAAUhH,GAChCoJ,KAAK+F,EAAQ7N,QCtElB,MAAMI,GAAK,aACLwS,GAAQ,iCAGd,SAAkB9B,GAChBA,EAAUwB,KAAKd,EAAOE,kBAAmBkB,GAAOxS,GAAI,wBAItD,SAAc0Q,GACZ,MAAMmJ,EAASnJ,EAAUwB,KAAKmG,EAAM9F,aAAcvS,GAAIwS,IACtDqH,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,QAAQ,GAChBuB,KAAK0C,EAAIgB,aAAc,OAAQ,aACpCiE,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,SAAS,GACjBuB,KAAKoG,EAAKhB,aAAc,UAC7BuC,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,SAAS,GACjBuB,KAAK0C,EAAID,SAAU,2BACxBkF,EAAOnI,OAAO,eAAed,OAAO,OAC/BD,QAAQ,UAAU,GAClBuB,KAAK0C,EAAID,SAAU,qCAI1B,SAAoBjE,GAClBA,EAAUgB,OAAO,SACZD,GAAG,SAAU,WACZ,MAAM1D,EAAO6G,EAAIkB,kBAAkB3X,EAAGuT,OAAOzE,OAG7C,OAFA9O,EAAGuT,OAAOzE,MAAMmF,SAAS,YAElBqI,EAAM3M,SAASC,EAAM,WAAmB,GAC5CrG,KAAKrG,IACJ,MAAMxB,EA7ClB,SAAwBwQ,GACtB,MAAMqK,EAAK,eACLC,EAAW,IAAIC,IACrB,IAAIC,EACJ,KAAgC,QAAxBA,EAAMH,EAAGI,KAAKzK,KACpBsK,EAASI,IAAIF,EAAI,IAEnB,OAAOlO,MAAMqO,KAAKL,GAsCOM,CAAe5Z,GAC3BvE,IAAIC,KAAOsF,IAAKtF,EAAGkD,KAAMlD,KAC5B2T,EAAUgB,OAAO,UACdQ,KAAKoG,EAAKf,kBAAmB1X,OAG1C6Q,EAAUgB,OAAO,UACZQ,KAAKoG,EAAKf,sBACV9F,GAAG,SAAU,WACZtT,EAAGuT,OAAOzE,MAAMmF,SAAS,cAE/B1B,EAAUgB,OAAO,UACZQ,KAAK0C,EAAIC,gBAAgB,GAC9BnE,EAAUgB,OAAO,WACZQ,KAAK0C,EAAIC,gBAAgB,GAE9BnE,EAAUiD,UAAU,gBACflC,GAAG,WAAY,WACd,MAAMyJ,EAAetG,EAAIkB,kBAAkBpF,EAAUgB,OAAO,UACtDyJ,EAAe7C,EAAKV,WAAWlH,EAAUgB,OAAO,WACtDhB,EAAUgB,OAAO,WACdsC,SAAS,aAAckH,GAAgBC,MAE3C/I,SAAS,qBAIhB,SAAiB1B,GACf,MAAMtM,GACJvE,OAAQyY,EAAK3B,kBAAkBjG,EAAUgB,OAAO,WAChD0J,MAAOxG,EAAIG,cAAcrE,EAAUgB,OAAO,WAC1C2J,OAAQzG,EAAIG,cAAcrE,EAAUgB,OAAO,aAEvC4J,EAAW,IAAIC,SAGrB,OAFAD,EAAS1K,OAAO,WAAYgE,EAAIkB,kBAAkBpF,EAAUgB,OAAO,WACnE4J,EAAS1K,OAAO,SAAUzG,KAAKC,UAAUhG,IAClCqJ,EAAQ3C,KAAK,QAASwQ,GAC1B5T,KAAK+F,EAAQ7N,QCtFlB,MAAMI,GAAK,gBACLwS,GAAQ,0BAGd,SAAkB9B,GAChBA,EAAUwB,KAAKd,EAAOE,kBAAmBkB,GAAOxS,GAAI,uBAItD,SAAc0Q,GACZA,EAAUwB,KAAKmG,EAAM9F,aAAcvS,GAAIwS,IACpCd,OAAO,eAAed,OAAO,OAC3BD,QAAQ,UAAU,GAClBuB,KAAK0C,EAAIX,QAAS,wBAIzB,SAAoBvD,EAAWzQ,GAC7ByQ,EAAUgB,OAAO,WACZQ,KAAK0C,EAAIV,cAAejU,GACxBwR,GAAG,QAAS,WACX,MAAM+J,EAAiD,KAAtC5G,EAAIT,aAAahW,EAAGuT,OAAOzE,OAC5CyD,EAAUgB,OAAO,WAAWsC,SAAS,YAAawH,KAEnDpJ,SAAS,UAUctU,MAN9B,SAAe4S,GACb,OAAOkE,EAAIT,aAAazD,EAAUgB,OAAO,cC1B3C,SAAS+J,GAAa/K,EAAWgL,GAC/B,MAAMtP,EAASsE,EAAUgB,OAAO,cAChCtF,EAAOuH,UAAU,aAAaD,SAC9BtH,EAAOuH,UAAU,aAAatS,KAAKqa,EAAMC,eACtCxE,QAAQvG,OAAO,OACbD,QAAQ,YAAY,GACpBuB,KAAKwJ,EAAME,oBAIlB,SAASC,GAAWnL,EAAWgL,GAC7B,MAAMjW,EAAOiL,EAAUgB,OAAO,YAC3BiC,UAAU,WACRtS,KAAKqa,EAAMI,gBAAiBJ,EAAMtI,SACvC3N,EAAKyR,OAAOxD,SACZjO,EAAKkO,UAAU,YAAYD,SAC3BjO,EAAK0R,QACFvG,OAAO,OACLI,KAAK,QAAS,UACdC,MAAM,WAAY,YAClBA,MAAM,QAAS,QACjB8K,MAAMtW,GACJwL,MAAM,YAAayK,EAAMM,eACzBrE,KAAK,SAAUnE,EAAGlQ,GACjB,MAAM2Y,EAAWP,EAAMQ,YAAc5Y,EAC/B6Y,EAASF,EAAWP,EAAMM,UAChC7d,EAAGuT,OAAOzE,MACPgE,MAAM,8BAA+BkL,QACrCxL,QAAQ,MAAO,EAAa,GAAM,GAClCuB,KAAKwJ,EAAMU,aAAc5I,KAKpC,SAAS6I,GAAe3L,EAAWgL,EAAOY,GACxC5L,EAAUgB,OAAO,YAAYT,MAAM,YAAayK,EAAMa,gBACtDb,EAAMc,kBAAkBF,GACxB5L,EAAUwB,KAAK2J,GAAYH,EAAOY,GAClC5L,EAAUgB,OAAO,gBAAgBC,OAAO8K,UAAYH,EAAYZ,EAAMM,UAIxE,SAASU,GAAOhM,EAAWgL,GACzB,MAAMiB,EAAWjM,EAAUgB,OAAO,gBAC5BwK,EAAcS,EAAShL,OAAOiL,wBAAwBC,IAC5DnB,EAAMoB,eAAergB,OAAOsgB,YAAcb,EAAc,GACxDS,EAAS1L,MAAM,YAAayK,EAAMsB,4BAqClCpB,mBA1FF,SAA4BxP,GAC1BA,EAAO6E,MAAM,UAAW,gBACrBA,MAAM,QAASuC,MAAQA,EAAE5O,UACzBjC,KAAK6Q,GAAKA,EAAEvT,OAuFKwb,aAAAA,GAAcI,WAAAA,GAAYQ,eAAAA,GAC9CK,OAAAA,GAAQO,SAlCV,SAAkBvM,EAAWgL,GAC3BhL,EAAUE,OAAO,OACZD,QAAQ,aAAa,GAC1BD,EAAUE,OAAO,OACZD,QAAQ,eAAe,GACvBM,MAAM,aAAc,QACpBQ,GAAG,SAAU,WACZ,MAAM7I,EAAM7J,KAAKme,MAAMjQ,KAAKwP,UAAYf,EAAMM,WAC1CpT,IAAQ8S,EAAMyB,sBAChBzB,EAAMc,kBAAkB5T,GACxB8H,EAAUwB,KAAK2J,GAAYH,EAAO9S,MAGvCgI,OAAO,OACLD,QAAQ,WAAW,GACnBM,MAAM,WAAY,YACvByK,EAAM0B,uBAAyB,MAC7B1B,EAAM2B,cACN3M,EAAUwB,KAAKuJ,GAAcC,GAC7BhL,EAAUwB,KAAKwK,GAAQhB,GACvBA,EAAM4B,YACN5M,EAAUwB,KAAKmK,GAAgBX,EAAOA,EAAMQ,eAE9CR,EAAM6B,qBAAuBzf,CAAAA,IAC3B4d,EAAM8B,cAAc1f,GACpB4S,EAAUwB,KAAKmK,GAAgBX,EAAO,KAExCA,EAAM0B,2BCnFR,SAASK,GAAS/M,EAAWgN,EAAQvb,GACnCuO,EAAU/N,KAAKoF,EAAKlK,UAAU6f,EAAOvb,EAAME,KAAMF,EAAMwb,YAIzD,SAAShb,GAAK+N,EAAWgN,EAAQvb,GAC/BuO,EAAU/N,KAAK+a,EAAOvb,EAAME,MAU9B,SAASoQ,GAAK/B,EAAWgN,EAAQvb,GAC/BuO,EAAU+B,KAAKiL,EAAOvb,EAAME,MAI9B,SAASub,GAAYlN,EAAWgN,EAAQvb,GACtCuO,EAAUE,OAAO,KACZI,KAAK,gCAAgC0M,EAAOvb,EAAME,QAClD2O,KAAK,SAAU,UACfrO,KAAK+a,EAAOvb,EAAME,MAIzB,SAASwb,GAAMnN,EAAWgN,EAAQvb,GAChCuO,EAAUE,OAAO,OACZI,KAAK,QAAS,KACdA,KAAK,SAAU,KACfA,KAAK,MAAO0M,EAAOvb,EAAME,MAGhC,SAASyb,GAASpN,EAAWgN,EAAQvb,GACnCuO,EAAUE,OAAO,SACZI,KAAK,OAAQ,YACbgD,SAAS,UAAW0J,EAAOvb,EAAME,MACjC2R,SAAS,aAAY7R,EAAM4b,UAAWL,EAAOvb,EAAM4b,WACnDtM,GAAG,QAAS,WACXiM,EAAOvb,EAAME,KAAO4K,KAAK6H,UAIjC,SAASkJ,GAAUtN,EAAWgN,EAAQvb,GACpCuO,EAAUE,OAAO,SACZI,KAAK,OAAQ,QACbC,MAAM,QAAS,OACf+C,SAAS,QAAS0J,EAAOvb,EAAME,MAC/BoP,GAAG,SAAU,WACZiM,EAAOvb,EAAME,KAAO4K,KAAKnP,QAIjC,SAASoU,GAAKxB,EAAW5S,GACvB4S,EAAUwB,KAAKpU,GAIjB,MAAMmgB,IACJC,QAASvb,GACTA,KAAMA,GACNmD,KAtDF,SAAc4K,EAAWgN,EAAQvb,GAE/BuO,EAAU/N,KAAK+a,EAAOvb,EAAME,OAqD5B8b,IAAKxb,GACLgb,UAAWF,GACXG,YAAaA,GACbQ,SAAUzb,GACV0b,KAAM1b,GACN2b,MC9CAC,SAzBF,SAAkB7N,EAAWgN,EAAQvb,GACnC,IAAIqc,EAAKC,KAAKD,EAAKzP,MAAM2O,EAAOvb,EAAME,OACnCqc,WAAWhO,EAAUiB,QACrBgN,OAsBOC,cAlBZ,SAAuBC,GAErB,OADa,IAAIL,EAAKC,KAAKD,EAAKzP,MAAM8P,IAC1BC,WAAW,QAgBEC,gBAZ3B,SAAyBC,GACvB,OAAO,IAAIxU,QAAQI,IACjB,MAAMqD,EAAS,IAAIC,WACnBD,EAAOG,OAASC,CAAAA,IACdzD,EAAQyD,EAAM9P,OAAO+P,UAEvBL,EAAOgR,cAAcD,ODoDbT,SACVV,MAAOA,GACPC,SAAUA,GACVoB,WAAYlB,GACZmB,QAASjN,GACTkN,IAAK3M,GACLA,KAAMA,IAIR,SAAS4M,GAAQ3O,GACfA,EAAUC,QAAQ,WAAW,GAC1BA,QAAQ,gBAAgB,GACxBA,QAAQ,iBAAiB,GACzBM,MAAM,UAAW,wBAkBpBwM,SAAAA,QAAU9a,GAAM8P,KAAAA,GAAMmL,YAAAA,GAAaC,MAAAA,GAAOC,SAAAA,GAAUE,UAAAA,GAAW9L,KAAAA,GAC/DmN,QAAAA,GAASjD,WAfX,SAAoBvc,GAClB,MAAO,CAAC6Q,EAAWgN,KACjB7d,EAAOwD,QAAQlB,IACb,MAAMmd,EAAO5O,EAAUE,OAAO,OACzBsB,KAAKmN,IACLpO,MAAM,WAAY9O,EAAMyC,UACxB8Y,EAAOnc,eAAeY,EAAME,MACjCid,EAAKpN,KAAK+L,GAAS9b,EAAM/D,QAASsf,EAAQvb,cEzF3Bod,GACnBvS,YAAY9G,EAAMuD,GAChBwD,KAAKnG,QAAUZ,EAAKY,SAAW,KAC/BmG,KAAK1H,OAASW,EAAKX,QAAU,KAC7B0H,KAAKhN,KAAOiG,EAAKjG,MAAQ,KACzBgN,KAAKvH,UAAYQ,EAAKR,cACtBuH,KAAKtH,WAAaO,EAAKP,YAAc,KACrCsH,KAAKxH,KAAO,IAAIsH,EAAWtD,GAE3BwD,KAAK0O,cAAgB,KACrB1O,KAAKuS,cAAgB,KACrBvS,KAAKwS,gBAAkB,KAGvBxS,KAAKyS,qBACHxB,QAAS,GACTvb,KAAM,GACNgd,KAAM,KAER1S,KAAK2S,eAAiB,GACtB3S,KAAKmG,QAAUI,CAAAA,GAAKA,EAAEjQ,OAGtB0J,KAAK+O,UAAY,KACjB/O,KAAKsP,WAAa,KAGlBtP,KAAK+P,eAAiB,KACtB/P,KAAK4S,gBAAkB,KACvB5S,KAAKiP,YAAc,EACnBjP,KAAKkQ,oBAAsB,KAC3BlQ,KAAK6S,eAAiB,KAEtB7S,KAAK8S,oBAAsB,KAG3B9S,KAAKmQ,uBAAyB,KAC9BnQ,KAAKsQ,qBAAuB,KAE5BtQ,KAAK2O,mBAAqBoE,GAAUpE,mBACpC3O,KAAKmP,WAAa,KAAM6D,GAAQ7D,WAAWnP,KAAK0O,gBAOlD3O,gBAAgBnI,GACdoI,KAAK+P,eAAiB/P,KAAK8S,qBAAuBlb,EAOpDmI,kBAAkBkT,GAChBjT,KAAKkQ,oBAAsBlQ,KAAKiP,YAChCjP,KAAKiP,YAAcgE,EACnBjT,KAAK6S,eAAiB/gB,KAAK8O,IACzBZ,KAAKiP,YAAcjP,KAAK4S,gBAAiB5S,KAAKwS,gBAAgBvV,QAGlE8C,qBACEC,KAAK4S,gBAAkB9gB,KAAKohB,KAAKlT,KAAK+P,eAAiB/P,KAAK+O,WAAa,EAG3EhP,eAAenI,GACboI,KAAKmT,gBAAgBvb,GACrBoI,KAAKoT,qBAMPrT,cACEC,KAAK0O,cAAgB1O,KAAKxH,KAAK5F,OAAOoG,OAAOlJ,GAAKA,EAAE6F,SACpD,MAAM0d,EAAYrT,KAAK0O,cAAc4E,OAAO,CAACnR,EAAGvQ,IAAMuQ,GAAKvQ,EAAE2hB,QAAU,GAAI,GAC3EvT,KAAK0O,cAAgB1O,KAAK0O,cAAc7e,IAAIC,IAC1C,MAAMoF,GACJyC,OAAQ7H,EAAEyjB,QAAU,GAAKF,EAAY,IACrCzb,OAAQ9H,EAAE8H,QAAUoI,KAAKyS,oBAAoB3X,EAAKrK,SAASX,EAAEqB,UAE/D,OAAO+K,OAAOsX,OAAOte,EAAOpF,KAE9BkQ,KAAK+O,UAAY/O,KAAK0O,cACnB4E,OAAO,CAACnR,EAAGsR,IAAMtR,EAAEvK,OAAS6b,EAAE7b,OAASuK,EAAIsR,EAAG,GAAG7b,OAWtDmI,YACEC,KAAKoT,qBACLpT,KAAK0T,aAGP3T,WAAW3K,EAAKue,GACd,GAAIve,EACF4K,KAAKuS,cAAgBxiB,EAAE0J,QAAQuG,KAAKxH,KAAKnF,UAAU0H,SAAU3F,IAAOue,QAC/D,CACL,MAAM3W,EAAOgD,KAAKvH,UAAU5I,IAAIC,GAAKA,EAAEsF,KACjCwe,EAAS5T,KAAKvH,UAAU5I,IAAIC,GAAKA,EAAE6jB,OACrC3W,IACFgD,KAAKuS,cAAgBxiB,EAAE0J,QAAQuG,KAAKxH,KAAKnF,UAAU0H,QAASiC,EAAM4W,IAGtE5T,KAAK6T,cAGP9T,cACE,GAAwB,OAApBC,KAAKtH,WACPsH,KAAKwS,gBAAkBxS,KAAKuS,cAAcxX,YACrC,CACL,MAAMnI,EAASoN,KAAK0O,cACjB1V,OAAOlJ,GAAiC,SAA5BgL,EAAKrK,SAASX,EAAEqB,SAC5BtB,IAAIC,GAAKA,EAAEsF,KACd4K,KAAKwS,gBAAkBxS,KAAKuS,cAAcvZ,OAAO+F,GACxCnM,EAAO+N,KAAKhC,GAAK7D,EAAK1J,aAAa4O,KAAKtH,WAAYqG,EAAIJ,MAGnEqB,KAAKsP,WAAatP,KAAKwS,gBAAgBvV,OAAS+C,KAAK+O,UAGvDhP,aAAa3K,EAAKue,GAChB,MAAMG,EAAM9T,KAAKvH,UAAUmD,UAAU9L,GAAKA,EAAEsF,KACtC2e,GAAO3e,IAAKA,EAAKue,MAAOA,IAClB,IAARG,GAAW9T,KAAKvH,UAAUoD,OAAOiY,EAAI,GACzC9T,KAAKvH,UAAUoD,OAAO,EAAG,EAAGkY,GAC5B/T,KAAK0T,WAAWte,EAAKue,GAGvB5T,cAAcrK,GACZsK,KAAKtH,WAAahD,EAClBsK,KAAK6T,cAGP9T,aAAaK,GACXJ,KAAKxH,KAAKwb,aAAa5T,GAGzBL,WAAW3B,GACT4B,KAAKxH,KAAKyb,WAAW7V,GACrB4B,KAAKqQ,YAGPtQ,gBACE,OAAOC,KAAKwS,gBAAgBzX,MAAMiF,KAAKiP,YAAajP,KAAK6S,gBAG3D9S,OACE,OAAOzG,EAAIM,WAAWoG,KAAKnG,QAAS6B,IAClC,MAAMwY,EAAKxY,EAAK1D,QACb4D,UAAU9L,GAAKA,EAAEoI,eAAiB8H,KAAKxH,KAAKN,cAC/CwD,EAAK1D,QAAQkc,GAAMlU,KAAKxH,KAAK2b,SAC7B,MAAMC,EAAK1Y,EAAK3D,MAAM6D,UAAU9L,GAAKA,EAAEwI,SAAW0H,KAAK1H,QACvDoD,EAAK3D,MAAMqc,GAAMpU,KAAKmU,WAI1BpU,SACE,OACE1I,QAAS,2DACTiB,OAAQ0H,KAAK1H,OACbtF,KAAMgN,KAAKhN,KACXuF,SAAU,WACVC,KAAMwH,KAAKxH,KAAKN,aAChBO,UAAWuH,KAAKvH,UAChBC,WAAYsH,KAAKtH,qBCnKrB2b,UAhBF,SAAmB5Q,EAAWgL,GAC5B,MAAM6F,EAAY7Q,EACbC,QAAQ,OAAO,GACfA,QAAQ,uBAAuB,GACjCC,OAAO,OACLD,QAAQ,SAAS,GACjBuB,KAAK0C,EAAIX,QAAS,UACvBsN,EAAU7P,OAAO,SAASf,QAAQ,cAAc,GAChD4Q,EAAU7P,OAAO,SACdD,GAAG,QAAS,WACXiK,EAAM6B,qBAAqB3I,EAAIT,aAAaoN,gBCgBhDC,QAvBF,SAAiB9Q,EAAWgL,GAC1BA,EAAME,mBAAqBxP,CAAAA,IACzBA,EAAO6E,MAAM,UAAW,gBACrBA,MAAM,QAASuC,MAAQA,EAAE5O,UACzBjC,KAAK6Q,GAAKA,EAAEvT,MACZgG,OAAOuN,GAAiC,SAA5BzL,EAAKrK,SAAS8V,EAAEpV,SAC5BwS,OAAO,QAAQA,OAAO,KACpBI,KAAK,KAAMwC,WAAaA,EAAEnR,OAC1BM,KAAK,MACLsO,MAAM,UAAW,gBACjBA,MAAM,QAAS,QACfA,MAAM,aAAc,UACtBQ,GAAG,QAAS+B,IACX,MAAMiO,EAA+C,MAAvCtjB,EAAGuT,gBAAgB8B,EAAEnR,OAAOM,OAC1CxE,EAAGuT,gBAAgB8B,EAAEnR,OAAOM,KAAK8e,EAAQ,IAAM,KAC/C/F,EAAMgG,aAAalO,EAAEnR,IAAKof,EAAQ,OAAS,OAC3C/Q,EAAUwB,KAAK8N,GAAUnE,WAAYH,iBCsE3C5P,MApFF,SAAe4E,EAAW7Q,EAAQS,EAAS8b,EAAYvX,GACrD,MAIM6W,EAAQ,IAAI6D,OAHhB1f,OAAQA,EACRS,QAASA,IAGXob,EAAMtI,QAAUI,CAAAA,GAAKA,GACjB4I,IACFV,EAAMU,WAAa,KAAMA,EAAWV,EAAMC,iBAE5CD,EAAMqE,oBAAsBlb,GAAU,IACtC6L,EAAUE,OAAO,OACdD,QAAQ,SAAS,GACjBuB,KAAK8N,GAAU/C,SAAUvB,GAC5BhL,EAAUoC,MAAM4I,IAsETiG,YAlET,SAAqBjR,EAAW7Q,EAAQS,EAAS8b,EAAYvX,GAC3D,MAIM6W,EAAQ,IAAI6D,OAHhB1f,OAAQA,EACRS,QAASA,IAGP8b,IACFV,EAAMU,WAAa,KAAMA,EAAWV,EAAMC,iBAE5CD,EAAMqE,oBAAsBlb,GAAU,IACtC6L,EAAUE,OAAO,OACdD,QAAQ,UAAU,GAClBuB,KAAK0P,GAAKN,UAAW5F,GACxBhL,EAAUE,OAAO,OACdD,QAAQ,SAAS,GACjBuB,KAAK8N,GAAU/C,SAAUvB,GAC5BhL,EAAUoC,MAAM4I,IAkDImG,gBA9CtB,SAAyBnR,EAAW7Q,EAAQS,EAAS8b,EAAYvX,GAC/D,MAIM6W,EAAQ,IAAI6D,OAHhB1f,OAAQA,EACRS,QAASA,IAGP8b,IACFV,EAAMU,WAAa,KAAMA,EAAWV,EAAMC,iBAE5CD,EAAMqE,oBAAsBlb,GAAU,IACtC6L,EAAUE,OAAO,OACdD,QAAQ,UAAU,GAClBuB,KAAK0P,GAAKN,UAAW5F,GACxBhL,EAAUE,OAAO,OACdD,QAAQ,SAAS,GACjBuB,KAAKnS,GAAKyhB,QAAS9F,GACnBxJ,KAAK8N,GAAU/C,SAAUvB,GAC5BhL,EAAUoC,MAAM4I,IA6BqBoG,OAzBvC,SAAgBpR,EAAW7Q,EAAQS,GACjC,MAAMe,GACJxB,OAAQA,EACRS,QAASA,GAELob,EAAQhL,EAAUoC,QACxB4I,EAAMjW,KAAO,IAAIsH,EAAW1L,GAC5Bqa,EAAM0B,0BAkBuC2E,cAd/C,SAAuBrR,EAAWpQ,GAChC,MAAMob,EAAQhL,EAAUoC,QACxB4I,EAAMjW,KAAKL,SAAS,GAAG9E,QAAUA,EACjCob,EAAM0B,0BAWsD4E,aAP9D,SAAsBtR,GAEpB,OADcA,EAAUoC,QACXrN,KAAKnF,YChEpB,SAASqS,GAAYjC,EAAWgN,GAC9B,MAIM3M,EAAO2M,EAAOnY,QAHlB0X,SAAY,mBAAoBgF,QAAW,oBAC3CC,KAAQ,qBAEyBxE,EAAOlY,UAAY,gBAChDsB,EAAU4W,EAAO5W,SAAW4W,EAAOjK,OACnC9B,EAAO+L,EAAOnY,OAChBmL,EAAUE,OAAO,KAChBI,KACC,UACG0M,EAAOlY,uBAAuBsB,UAAgB4W,EAAOnY,UAEzDyL,KAAK,SAAU,UAChBN,EACJiB,EAAKf,OAAO,OACPI,KAAK,MAAOD,KAAUK,EAAOZ,cAAcO,QAAa,MACxDJ,QAAQ,QAAQ,GAChBM,MAAM,QAAS,QACfA,MAAM,SAAU,QACrBU,EAAKf,OAAO,QACPD,QAAQ,QAAQ,GAChBhO,KAAK+a,EAAOzd,MACjB,MAAM+V,GACJmM,KAAM,QAASC,QAAS,aACxBC,MAAO,iBAAkBC,OAAQ,iBACjCC,YAAa,SAAUC,QAAS,SAAUC,QAAS,SACnDhd,KAAM,OAAQa,MAAO,OACrB9E,MAAO,OAAQF,MAAO,QAElBohB,GACJP,KAAM,cAAeC,QAAS,qBAC9BC,MAAO,uBAAwBC,OAAQ,uBACvCC,YAAa,iBAAkBC,QAAS,iBACxCC,QAAS,iBACThd,KAAM,aAAca,MAAO,aAC3B9E,MAAO,aAAcF,MAAO,cAExBoc,EAAOnY,OACXmY,EAAOiF,MAAMtf,QAAQuf,IACnBlS,EAAUE,OAAO,OACZI,KAAK,SAAUI,EAAOZ,cAAckS,EAAME,EAAK,WAC/C3R,MAAM,QAAS,QACfA,MAAM,SAAU,QACrBP,EAAUE,OAAO,QACZD,QAAQ,QAAQ,GAChBM,MAAM,YAAa,UACnBA,MAAM,QAAS+E,EAAO4M,EAAK,KAC3BjgB,KAAKigB,EAAK,MAGjBlS,EAAUE,OAAO,QACZD,QAAQ,QAAQ,GAChBM,MAAM,YAAa,UACnBA,MAAM,QAAS,WACftO,KAAK+a,EAAOzV,gBAEnB,MAAM4a,EAASnS,EAAUE,OAAO,QAC3BD,QAAQ,OAAO,GACfM,MAAM,SAAU,qBAChBA,MAAM,gBAAiB,OACtB6R,EAAa,CAACC,EAAKhS,IAASgS,EAAInS,OAAO,OACxCI,KAAK,SAAUI,EAAOZ,cAAcO,SACpCJ,QAAQ,QAAQ,GAChBM,MAAM,QAAS,WACfA,MAAM,SAAU,WA6BrB,GA5BKyM,EAAOnY,QACVsd,EAAOjS,OAAO,KAAKsB,KAAK4Q,EAAY,eAC/BrR,GAAG,QAAS,KACX,MAAMpQ,EAAO8I,KAAK4E,MAAM5E,KAAKC,UAAUsT,WAChCrc,EAAKyF,eACLzF,EAAK4G,eACZwS,EAAMtK,aAAa9O,EAAMA,EAAKpB,QAGtC4iB,EAAOjS,OAAO,KACTI,KAAK,cAAe,SACpBA,KAAK,cAAe,kBACpBkB,KAAK4Q,EAAY,iBACjBrR,GAAG,QAAS,KACXtT,EAAGuT,OAAO,kBACPQ,KAAK8Q,GAAazK,WAAYmF,EAAOzd,MACrCwR,GAAG,SAAU,WACRiM,EAAOnY,OACTgB,EAAIwC,WAAW2U,EAAOjK,OAAQiK,EAAOnY,OAAQW,IAC3CA,EAAKjG,KAAO+iB,GAAallB,MAAMK,EAAGuT,OAAOzE,SACxCvF,KAAKub,IAER1c,EAAIM,WAAW6W,EAAO5W,QAAS6B,IAC7BA,EAAK1I,KAAO+iB,GAAallB,MAAMK,EAAGuT,OAAOzE,SACxCvF,KAAKub,SAIfvF,EAAOwF,QAAS,CACnB,MAAMC,EAAazF,EAAOnY,OAASmY,EAAOlY,SAAW,UAC/C4d,EAAa1F,EAAO2F,MAAQ,UAAYF,EACxCG,EAAa5F,EAAO2F,MAAQ3F,EAAO6F,WAAa7F,EAAOzd,KAC7D4iB,EAAOjS,OAAO,KACTI,KAAK,cAAe,SACpBA,KAAK,cAAe,kBACpBkB,KAAK4Q,EAAY,eACjBrR,GAAG,QAAS,KACXtT,EAAGuT,OAAO,kBACPQ,KACCmG,EAAMhG,uDAC6B+Q,KAAcE,OAElD7R,GAAG,SAAU,KACRiM,EAAOnY,SAAWmY,EAAO2F,MAC3B9c,EAAI0C,WAAWyU,EAAOjK,OAAQiK,EAAOnY,QAClCmC,KAAKub,IAER1c,EAAIgC,WAAWmV,EAAO5W,SAAW4W,EAAOjK,QACrC/L,KAAKub,QAKtBJ,EAAOlP,UAAU,OACdlC,GAAG,aAAc,WAChBtT,EAAGuT,OAAOzE,MAAMgE,MAAM,mBAAoB,aAE3CQ,GAAG,aAAc,WAChBtT,EAAGuT,OAAOzE,MAAMgE,MAAM,mBAAoB,QAyGhD,SAASgS,KACP,MAAMO,EAAUrlB,EAAGuT,OAAO,YAE1BjE,EAAQvC,eAAexD,KAAKU,IAE1BjK,EAAGuT,OAAO,aAAaA,OAAO,SAC3BQ,KAAKpG,GAAMiW,cAAe3Z,EAAS+C,OAAOsY,KAAKnjB,SAClD,MAAMojB,EAAgBva,OAAOC,QAAQhB,EAAS+C,QAC3ClF,OAAOlJ,GAAc,SAATA,EAAE,IACdD,IAAIC,KAAOsF,IAAKtF,EAAE,GAAIe,MAAOf,EAAE,MAClCoB,EAAGuT,OAAO,aAAaA,OAAO,WAC3BQ,KAAKpG,GAAMiW,cAAe2B,GAG7B,MAAMC,EAAWvb,EAAS/B,OAAOmS,UAAUvS,OAAOlJ,GAAkB,aAAbA,EAAEwF,QA2CzD,OA1CAihB,EAAQ9R,OAAO,YACVQ,KAAK0R,EAAarL,WAAYoL,EAAUvb,EAAS/B,OAAOwd,uBACxDpS,GAAG,SAAU,WACZmS,EAAalL,QAAQva,EAAGuT,OAAOzE,MAAO0W,GACnCjc,KAAKnB,EAAI4B,aACTT,KAAK5I,IACJrC,OAAOqnB,4BACkBhlB,EAAEgI,gBAAgBhI,EAAEyG,SAAU,cAGjEie,EAAQ9R,OAAO,YACVQ,KAAK6R,EAAaxL,WAAYoL,EAAUvb,EAAS+C,OAAO6Y,OACxDvS,GAAG,SAAU,WACZsS,EAAarL,QAAQva,EAAGuT,OAAOzE,OAC5BvF,KAAKnB,EAAI4B,aACTT,KAAK5I,IACJrC,OAAOqnB,4BACkBhlB,EAAEgI,gBAAgBhI,EAAEyG,SAAU,cAGjEie,EAAQ9R,OAAO,YACVQ,KAAK+R,GAAa1L,WAAYoL,GAC9BlS,GAAG,SAAU,WACZwS,GAAavL,QAAQva,EAAGuT,OAAOzE,OAC5BvF,KAAKnB,EAAI4B,aACTT,KAAK5I,IACJrC,OAAOqnB,4BACkBhlB,EAAEgI,gBAAgBhI,EAAEyG,SAAU,cAGjEie,EAAQ9R,OAAO,SACVQ,KAAKgS,GAAU3L,WAAYoL,GAC3BlS,GAAG,SAAU,WACZyS,GAAUxL,QAAQva,EAAGuT,OAAOzE,OACzBvF,KAAKnB,EAAI4B,aACTT,KAAK5I,IACJrC,OAAOqnB,4BACkBhlB,EAAEgI,gBAAgBhI,EAAEyG,SAAU,cAK1DgB,EAAIE,cACRiB,KAAKpB,GAAStJ,EAAEuQ,QAAQjH,EAAMxJ,IAAIC,GAAKA,EAAEkI,WACzCyC,KAAK8B,IACJ,MAAM2a,EAAW3a,EAAM1M,IAAIC,GAAK,IAAIgQ,EAAWhQ,IAC5CkJ,OAAOlJ,GAAKA,EAAEmmB,WACjB,OAAO1Y,QAAQkD,IAAIyW,EAASrnB,IAAIsnB,GAAKA,EAAEC,aAG5Cld,MAAMC,IACL5J,QAAQC,KAAK,0BACbD,QAAQ6J,MAAMD,GAEdkd,QAAQ3Q,UAAU,mBACf3C,KAAK,cAAe,MACpBL,QAAQ,YAAY,GACvBxS,EAAGuT,OAAO,aAAaA,OAAO,SAAS/O,KAAK,YAC5CxE,EAAGuT,OAAO,aAAaA,OAAO,WAAW/O,KAAK,cAE/C4hB,QAAQ,IAEAhe,EAAIE,cAAciB,KAAKpB,IAC5B,MAAMke,IAAc1d,QAAS,SAC7BR,EAAMjD,QAAQohB,IACZA,EAAIhR,OAAS,OACbgR,EAAIvB,QAAUne,EAAMwL,UAAUkU,GAC9BD,EAAUtf,KAAKuf,GACfA,EAAIzf,MAAM3B,QAAQ6C,IAChBA,EAAKuN,OAASgR,EAAI3d,QAClBZ,EAAKgd,QAAUuB,EAAIvB,QACnBhd,EAAKmd,MAAQoB,EAAIzf,MAAMkF,QAAU,EACjChE,EAAKqd,WAAakB,EAAIxkB,KACtBiG,EAAKyc,OAAS,QAAS,QAAS,OAAQ,SACrC1c,OAAOlJ,GAAKmJ,EAAK3E,eAAexE,IAChCD,IAAIC,IAAMA,EACToB,EAAGC,OAAO,OAAVD,CACEsmB,EAAIxf,QAAQ7C,KAAKoR,GAAKA,EAAErO,eAAiBe,EAAKnJ,IAC3CqI,SAASmb,OAAO,CAACnR,EAAGsR,IAAMtR,EAAIsR,EAAEpgB,QAAQ4J,OAAQ,MACzD,MAAMT,EAAO,IAAIsD,EAAW0X,EAAIxf,QAC7B7C,KAAKoR,GAAKA,EAAErO,eAAiBe,GAC3B,QAAS,OAAQ,SAASD,OAAOlJ,GAAKmJ,EAAK3E,eAAexE,IAAI,MAE7D4N,EAA+B,SAAlBlB,EAAKpJ,SAAsB,GAAKoJ,EAAKpJ,SAClDqkB,EAAWjb,EAAKyZ,aAAezZ,EAAK5I,cAAgB,GAC1DqF,EAAKyc,MAAMzd,MAAMuE,EAAKpJ,YAAasK,IAAa+Z,MAChDF,EAAUtf,KAAKgB,OAGnB/H,EAAGuT,OAAO,aAAaA,OAAO,WAC3BQ,KAAKgB,EAAKC,UAAWqR,EAAWhR,GAAKA,EAAE1M,QAAS6L,cAwBvDgM,IAlBF,WACE,MAAMvX,EAAMud,EAAOznB,gBACnB,GAAIkK,EAIF,YAHAjJ,EAAGuT,OAAO,QACPT,MAAM,QAAS,WACftO,KAAKyE,GAKQiI,SAAS3S,SAASkoB,SACpB,WAAYxnB,WAAcA,UAAUynB,OACpDF,EAAOxnB,wBA/NT,WAEE,MAAMmnB,EAAUnmB,EAAGuT,OAAO,YAEpBoT,EAAYR,EAAQ1T,OAAO,OAC5BsB,KAAKd,EAAOD,mBAAoB,QAAS,UAAW,cACpDO,OAAO,kBACZoT,EAAUlU,OAAO,KAAKD,QAAQ,kBAAkB,GAC3CuB,KAAK0R,EAAazL,UACvB2M,EAAUlU,OAAO,KAAKD,QAAQ,kBAAkB,GAC3CuB,KAAK6R,EAAa5L,UACvB2M,EAAUlU,OAAO,KAAKD,QAAQ,kBAAkB,GAC3CuB,KAAK+R,GAAa9L,UACvB2M,EAAUlU,OAAO,KAAKD,QAAQ,kBAAkB,GAC3CuB,KAAKgS,GAAU/L,UACpB2M,EAAUlU,OAAO,KACZsB,KAAKd,EAAOG,iBAAkB,YACzB,0CAA2C,eAChDE,GAAG,SAAU,WACZ,MAAM1D,EAAOqD,EAAOS,sBAAsB1T,EAAGuT,OAAOzE,OACpDwN,EAAM5K,SAAS9B,GACZrG,KAAKnB,EAAIsB,YACTH,KAAKub,MAIdqB,EAAQ1T,OAAO,KACVD,QAAQ,WAAW,GACnBA,QAAQ,kBAAkB,GAC1BuB,KAAKd,EAAON,eACP,cAAe,oBAAqB,gBACzCW,GAAG,QAAS,IAAMwR,MAEvBqB,EAAQ1T,OAAO,KACVsB,KAAKd,EAAOF,cAAe,eACtB,wBAAyB,UAAW,eAE9C,MAAM9L,EAAWjH,EAAGuT,OAAO,aACtBT,MAAM,eAAgB,OACtBA,MAAM,gBAAiB,OAG5B7L,EAASwL,OAAO,MAAMD,QAAQ,QAAQ,GAAMhO,KAAK,6BACjDyC,EAASwL,OAAO,OAAOD,QAAQ,QAAQ,GAClCA,QAAQ,UAAU,GAClBM,MAAM,SAAU,qBAChBiB,KAAKgB,EAAKA,MACVhB,KAAKgB,EAAKU,UAAW,KAW1BxO,EAASwL,OAAO,MAAMD,QAAQ,QAAQ,GAAMhO,KAAK,0BACjDyC,EAASwL,OAAO,OAAOD,QAAQ,QAAQ,GAAMA,QAAQ,QAAQ,GAC5DuB,KAAKpG,GAAMA,QARTzJ,IAAK,KAAMpC,KAAM,cAAe7B,OAAQ,SACxCiE,IAAK,OAAQpC,KAAM,YAAa7B,OAAQ,YAAauf,UAAW,QAChEtb,IAAK,SAAUpC,KAAM,SAAU7B,OAAQ,SACvCiE,IAAK,UAAWpC,KAAM,UAAW7B,OAAQ,OAAQyG,OAAQ,KACzDxC,IAAK,UAAWpC,KAAM,UAAW7B,OAAQ,OAAQyG,OAAQ,QAIzB,KAAM,KAOzCO,EAASwL,OAAO,MAAMD,QAAQ,QAAQ,GAAMhO,KAAK,iBACjDyC,EAASwL,OAAO,OAAOD,QAAQ,QAAQ,GAAMA,QAAQ,UAAU,GAC9DuB,KAAKpG,GAAMA,QALTzJ,IAAK,MAAOpC,KAAM,MAAO7B,OAAQ,SACjCiE,IAAK,QAASpC,KAAM,QAAS7B,OAAQ,YAIH,KAAM,KAG3C,MAAMolB,EAAUrlB,EAAGuT,OAAO,YAC1B8R,EAAQ5S,OAAO,OACVD,QAAQ,WAAW,GACnBuB,KAAK0R,EAAa3Y,MACvBuY,EAAQ5S,OAAO,OACVD,QAAQ,WAAW,GACnBuB,KAAK6R,EAAa9Y,MACvBuY,EAAQ5S,OAAO,OACVD,QAAQ,WAAW,GACnBuB,KAAK+R,GAAahZ,MACvBuY,EAAQ5S,OAAO,OACVD,QAAQ,QAAQ,GAChBuB,KAAKgS,GAAUjZ,MACpBuY,EAAQ5S,OAAO,OACVD,QAAQ,WAAW,GACnBuB,KAAK8Q,GAAa/X,MACvBuY,EAAQ5S,OAAO,OACVsB,KAAKmG,EAAMrG,cAAe,gBAC1BE,KAAKmG,EAAMhG,oBACN,8EACLZ,GAAG,SAAU,IAAMlL,EAAIiB,QAAQE,KAAKub,KACzCO,EAAQ5S,OAAO,OACVsB,KAAKmG,EAAMrG,cAAe,iBAG/BiR,KA+HA8B"}